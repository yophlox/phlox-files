/*
* Heya, script modified by @YoPhlox
* Added some shit I thought would be nice lol
*/

using System;
using System.Text;
using System.IO;
using System.Linq;
using System.Threading;
using System.Threading.Tasks;
using System.Text.RegularExpressions;
using System.Runtime.Serialization;
using System.Drawing;
using System.Diagnostics;
using System.Windows.Forms;
using UndertaleModLib.Models;
using UndertaleModLib.Util;
using Newtonsoft.Json;
using NAudio.Vorbis;
using NAudio.Wave;
using System.Xml;
using System.Xml.Serialization;

// configuration
var ignore = new List<string>() // ignore certain assets from attempting to decompile
{
	
};
bool skipErrors = true; // skip all errors and instead log them to a txt file
string dataPath = $"{Path.GetDirectoryName(FilePath)}\\";
string rootPath; // We'll set this after user selects the folder

// Add this function to prompt for folder selection
string SelectExportFolder()
{
    using (var folderDialog = new FolderBrowserDialog())
    {
        folderDialog.Description = "Select folder to export decompiled files";
        folderDialog.RootFolder = Environment.SpecialFolder.Desktop;
        if (folderDialog.ShowDialog() == DialogResult.OK)
        {
            return folderDialog.SelectedPath;
        }
        return null;
    }
}

// yummy data loading (you need data.win to be loaded!)
EnsureDataLoaded();

// Prompt user to select export folder
rootPath = SelectExportFolder();
if (string.IsNullOrEmpty(rootPath))
{
    ScriptMessage("Export cancelled. No folder selected.");
    return;
}
rootPath = Path.Combine(rootPath, "") + Path.DirectorySeparatorChar;

// important
GMProject exportData;
TextureWorker worker = new TextureWorker();
List<string> errorList = new List<string>();
Dictionary<string, string> tpageAlign = new Dictionary<string, string>();

// gross
#region GM2022 Asset Structure

string GMS1Compatibility = System.Text.Encoding.UTF8.GetString(System.Convert.FromBase64String("ZnVuY3Rpb24gX19nbG9iYWxfb2JqZWN0X2RlcHRocygpCnsKCS8vIEluaXRpYWxpc2UgdGhlIGdsb2JhbCBhcnJheSB0aGF0IGFsbG93cyB0aGUgbG9va3VwIG9mIHRoZSBkZXB0aCBvZiBhIGdpdmVuIG9iamVjdAoJLy8gR00yLjAgZG9lcyBub3QgaGF2ZSBhIGRlcHRoIG9uIG9iamVjdHMgc28gb24gaW1wb3J0IGZyb20gMS54IGEgZ2xvYmFsIGFycmF5IGlzIGNyZWF0ZWQKCS8vIE5PVEU6IE1hY3JvRXhwYW5zaW9uIGlzIHVzZWQgdG8gaW5zZXJ0IHRoZSBhcnJheSBpbml0aWFsaXNhdGlvbiBhdCBpbXBvcnQgdGltZQoJZ21sX3ByYWdtYSggImdsb2JhbCIsICJfX2dsb2JhbF9vYmplY3RfZGVwdGhzKCkiKTsKCQoJLy8gaW5zZXJ0IHRoZSBnZW5lcmF0ZWQgYXJyYXlzIGhlcmUKCS8vJHtjb21wYXRpYmlsaXR5T2JqZWN0RGVwdGhzfQoJCgkvLyBjcmVhdGUgYW5vdGhlciBhcnJheSB0aGF0IGhhcyB0aGUgY29ycmVjdCBlbnRyaWVzCgl2YXIgbGVuID0gYXJyYXlfbGVuZ3RoXzFkKGdsb2JhbC5fX29iamVjdERlcHRocyk7CglnbG9iYWwuX19vYmplY3RJRDJEZXB0aCA9IFtdOwoJZm9yKCB2YXIgaT0wOyBpPGxlbjsgKytpICkgewoJCXZhciBvYmpJRCA9IGFzc2V0X2dldF9pbmRleCggZ2xvYmFsLl9fb2JqZWN0TmFtZXNbaV0gKTsKCQlpZiAob2JqSUQgPj0gMCkgewoJCQlnbG9iYWwuX19vYmplY3RJRDJEZXB0aFsgb2JqSUQgXSA9IGdsb2JhbC5fX29iamVjdERlcHRoc1tpXTsKCQl9IC8vIGVuZCBpZgoJfSAvLyBlbmQgZm9yCn0KCmZ1bmN0aW9uIF9faW5pdF9nbG9iYWwoKQp7CglnbWxfcHJhZ21hKCAiZ2xvYmFsIiwgIl9faW5pdF9nbG9iYWwoKTsiKTsKCQoJLy8gc2V0IGFueSBnbG9iYWwgZGVmYXVsdHMKCWxheWVyX2ZvcmNlX2RyYXdfZGVwdGgodHJ1ZSwwKTsJCS8vIGZvcmNlIGFsbCBsYXllcnMgdG8gZHJhdyBhdCBkZXB0aCAwCglkcmF3X3NldF9jb2xvdXIoIGNfYmxhY2sgKTsKfQoKI3JlZ2lvbiB2aWV3CgpmdW5jdGlvbiByb29tX3NldF92aWV3KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIGEgdmlldyBhbmQgaXRzIHJlbGF0ZWQgYXR0cmlidXRlcyBvZiBhIGdpdmVuIHJvb20uCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIHJvb20gdG8gc2V0IHRoZSB2aWV3IG9mLgoJLy8vIEBwYXJhbSB2aW5kIFRoZSB2aWV3ICdzbG90JyB0byBzZXQsIGJldHdlZW4gMCBhbmQgNy4KCS8vLyBAcGFyYW0gdmlzIFdoZXRoZXIgdGhlIHZpZXcgaXMgdmlzaWJsZSAodHJ1ZSkgb3Igbm90IChmYWxzZSkuCgkvLy8gQHBhcmFtIHh2aWV3IFRoZSB4IHBvc2l0aW9uIG9mIHRoZSBsZWZ0IG9mIHRoZSBhcmVhIHRoZSB2aWV3IGNhcHR1cmVzLgoJLy8vIEBwYXJhbSB5dmlldyBUaGUgeSBwb3NpdGlvbiBvZiB0aGUgdG9wIG9mIHRoZSBhcmVhIHRoZSB2aWV3IGNhcHR1cmVzLgoJLy8vIEBwYXJhbSB3dmlldyBUaGUgd2lkdGggb2YgdGhlIGFyZWEgdGhlIHZpZXcgY2FwdHVyZXMuCgkvLy8gQHBhcmFtIGh2aWV3IFRoZSBoZWlnaHQgb2YgdGhlIGFyZWEgdGhlIHZpZXcgY2FwdHVyZXMuCgkvLy8gQHBhcmFtIHhwb3J0IFRoZSB4IHBvc2l0aW9uIG9mIHRoZSBsZWZ0IG9mIHRoZSBhcmVhIHRoZSB2aWV3IG9jY3VwaWVzIG9uLXNjcmVlbi4KCS8vLyBAcGFyYW0geXBvcnQgVGhlIHkgcG9zaXRpb24gb2YgdGhlIHRvcCBvZiB0aGUgYXJlYSB0aGUgdmlldyBvY2N1cGllcyBvbi1zY3JlZW4uCgkvLy8gQHBhcmFtIHdwb3J0IFRoZSB3aWR0aCBvZiB0aGUgYXJlYSB0aGUgdmlldyBvY2N1cGllcyBvbi1zY3JlZW4uCgkvLy8gQHBhcmFtIGhwb3J0IFRoZSBoZWlnaHQgb2YgdGhlIGFyZWEgdGhlIHZpZXcgb2NjdXBpZXMgb24tc2NyZWVuLgoJLy8vIEBwYXJhbSBoYm9yZGVyIFRoZSBtaW5pbXVtIGhvcml6b250YWwgc3BhY2UgYmV0d2VlbiB0aGUgZWRnZSBvZiB0aGUgdmlldyBhbmQgdGhlIG9iamVjdCBpdCBpcyBzZXQgdG8gZm9sbG93IChiZWZvcmUgdGhlIHZpZXcgYmVnaW5zIG1vdmluZyBhbmQgaWYgaXQgaXMgc2V0IHRvIGZvbGxvdyBhbiBvYmplY3QpLgoJLy8vIEBwYXJhbSB2Ym9yZGVyIFRoZSBtaW5pbXVtIHZlcnRpY2FsIHNwYWNlIGJldHdlZW4gdGhlIGVkZ2Ugb2YgdGhlIHZpZXcgYW5kIHRoZSBvYmplY3QgaXQgaXMgc2V0IHRvIGZvbGxvdyAoYmVmb3JlIHRoZSB2aWV3IGJlZ2lucyBtb3ZpbmcgYW5kIGlmIGl0IGlzIHNldCB0byBmb2xsb3cgYW4gb2JqZWN0KS4KCS8vLyBAcGFyYW0gaHNwZWVkIFRoZSBtYXhpbXVtIGhvcml6b250YWwgc3BlZWQgdGhlIHZpZXcgY2FuIG1vdmUgYXQuCgkvLy8gQHBhcmFtIHZzcGVlZCBUaGUgbWF4aW11bSB2ZXJ0aWNhbCBzcGVlZCB0aGUgdmlldyBjYW4gbW92ZSBhdC4KCS8vLyBAcGFyYW0gb2JqIFRoZSBvYmplY3Qgb3IgaW5zdGFuY2UgdG8gZm9sbG93LiAtMSB0byBkaXNhYmxlIG9iamVjdCBmb2xsb3dpbmcuCgkKCXZhciBfX2luZCA9IGFyZ3VtZW50MDsKCXZhciBfX3ZpbmQgPSBhcmd1bWVudDE7Cgl2YXIgX192aXMgPSBhcmd1bWVudDI7Cgl2YXIgX194dmlldyA9IGFyZ3VtZW50MzsKCXZhciBfX3l2aWV3ID0gYXJndW1lbnQ0OwoJdmFyIF9fd3ZpZXcgPSBhcmd1bWVudDU7Cgl2YXIgX19odmlldyA9IGFyZ3VtZW50NjsKCXZhciBfX3hwb3J0ID0gYXJndW1lbnQ3OwoJdmFyIF9feXBvcnQgPSBhcmd1bWVudDg7Cgl2YXIgX193cG9ydCA9IGFyZ3VtZW50OTsKCXZhciBfX2hwb3J0ID0gYXJndW1lbnQxMDsKCXZhciBfX2hib3JkZXIgPSBhcmd1bWVudDExOwoJdmFyIF9fdmJvcmRlciA9IGFyZ3VtZW50MTI7Cgl2YXIgX19oc3BlZWQgPSBhcmd1bWVudDEzOwoJdmFyIF9fdnNwZWVkID0gYXJndW1lbnQxNDsKCXZhciBfX29iaiA9IGFyZ3VtZW50MTU7CgkKCWlmICghcm9vbV9leGlzdHMoX19pbmQpKQoJewoJCXNob3dfZGVidWdfbWVzc2FnZSgicm9vbV9zZXRfdmlldzogcm9vbSAiICsgc3RyaW5nKF9faW5kKSArICIgZG9lcyBub3QgZXhpc3QiKTsKCQlyZXR1cm4gLTE7Cgl9CgkKCWlmICgoX192aW5kIDwgMCkgfHwgKF9fdmluZCA+IDcpKQoJewoJCXNob3dfZGVidWdfbWVzc2FnZSgicm9vbV9zZXRfdmlldzogdmlldyBpbmRleCBvdXQgb2YgcmFuZ2UiKTsKCQlyZXR1cm4gLTE7Cgl9CgkKCS8vIENyZWF0ZSBuZXcgY2FtZXJhIHdpdGggc3BlY2lmaWVkIHBhcmFtcwoJdmFyIF9fbmV3Y2FtID0gY2FtZXJhX2NyZWF0ZV92aWV3KF9feHZpZXcsIF9feXZpZXcsIF9fd3ZpZXcsIF9faHZpZXcsIDAsIF9fb2JqLCBfX2hzcGVlZCwgX192c3BlZWQsIF9faGJvcmRlciwgX192Ym9yZGVyKTsKCQoJLy8gR2V0IGV4aXN0aW5nIGNhbWVyYSBpbiByb29tCgl2YXIgX19jdXJyY2FtID0gcm9vbV9nZXRfY2FtZXJhKF9faW5kLCBfX3ZpbmQpOwoJaWYgKF9fY3VycmNhbSAhPSAtMSkKCXsKCQkvLyBkZXN0cm95IGl0IHNvIHdlIGRvbid0IGxlYXZlIGl0IGluIGxpbWJvCgkJY2FtZXJhX2Rlc3Ryb3koX19jdXJyY2FtKTsKCX0KCQoJcm9vbV9zZXRfY2FtZXJhKF9faW5kLCBfX3ZpbmQsIF9fbmV3Y2FtKTsKCQoJcm9vbV9zZXRfdmlld3BvcnQoX19pbmQsIF9fdmluZCwgX192aXMsIF9feHBvcnQsIF9feXBvcnQsIF9fd3BvcnQsIF9faHBvcnQpOwoJCglyZXR1cm4gLTE7Cn0KCmZ1bmN0aW9uIF9faW5pdF92aWV3KCkKewoJZW51bSBlX19WVwoJewoJCVhWaWV3LAoJCVlWaWV3LAoJCVdWaWV3LAoJCUhWaWV3LAoJCUFuZ2xlLAoJCUhCb3JkZXIsCgkJVkJvcmRlciwKCQlIU3BlZWQsCgkJVlNwZWVkLAoJCU9iamVjdCwKCQlWaXNpYmxlLAoJCVhQb3J0LAoJCVlQb3J0LAoJCVdQb3J0LAoJCUhQb3J0LAoJCUNhbWVyYSwKCQlTdXJmYWNlSUQsCgl9Owp9CgpmdW5jdGlvbiBfX3ZpZXdfZ2V0KCkKewoJdmFyIF9fcHJvcCA9IGFyZ3VtZW50MDsKCXZhciBfX2luZGV4ID0gYXJndW1lbnQxOwoJCgl2YXIgX19yZXMgPSAtMTsKCQoJc3dpdGNoKF9fcHJvcCkKCXsKCWNhc2UgZV9fVlcuWFZpZXc6IHZhciBfX2NhbSA9IHZpZXdfZ2V0X2NhbWVyYShfX2luZGV4KTsgX19yZXMgPSBjYW1lcmFfZ2V0X3ZpZXdfeChfX2NhbSk7IGJyZWFrOwoJY2FzZSBlX19WVy5ZVmlldzogdmFyIF9fY2FtID0gdmlld19nZXRfY2FtZXJhKF9faW5kZXgpOyBfX3JlcyA9IGNhbWVyYV9nZXRfdmlld195KF9fY2FtKTsgYnJlYWs7CgljYXNlIGVfX1ZXLldWaWV3OiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IF9fcmVzID0gY2FtZXJhX2dldF92aWV3X3dpZHRoKF9fY2FtKTsgYnJlYWs7CgljYXNlIGVfX1ZXLkhWaWV3OiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IF9fcmVzID0gY2FtZXJhX2dldF92aWV3X2hlaWdodChfX2NhbSk7IGJyZWFrOwoJY2FzZSBlX19WVy5BbmdsZTogdmFyIF9fY2FtID0gdmlld19nZXRfY2FtZXJhKF9faW5kZXgpOyBfX3JlcyA9IGNhbWVyYV9nZXRfdmlld19hbmdsZShfX2NhbSk7IGJyZWFrOwoJY2FzZSBlX19WVy5IQm9yZGVyOiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IF9fcmVzID0gY2FtZXJhX2dldF92aWV3X2JvcmRlcl94KF9fY2FtKTsgYnJlYWs7CgljYXNlIGVfX1ZXLlZCb3JkZXI6IHZhciBfX2NhbSA9IHZpZXdfZ2V0X2NhbWVyYShfX2luZGV4KTsgX19yZXMgPSBjYW1lcmFfZ2V0X3ZpZXdfYm9yZGVyX3koX19jYW0pOyBicmVhazsKCWNhc2UgZV9fVlcuSFNwZWVkOiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IF9fcmVzID0gY2FtZXJhX2dldF92aWV3X3NwZWVkX3goX19jYW0pOyBicmVhazsKCWNhc2UgZV9fVlcuVlNwZWVkOiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IF9fcmVzID0gY2FtZXJhX2dldF92aWV3X3NwZWVkX3koX19jYW0pOyBicmVhazsKCWNhc2UgZV9fVlcuT2JqZWN0OiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IF9fcmVzID0gY2FtZXJhX2dldF92aWV3X3RhcmdldChfX2NhbSk7IGJyZWFrOwoJY2FzZSBlX19WVy5WaXNpYmxlOiBfX3JlcyA9IHZpZXdfZ2V0X3Zpc2libGUoX19pbmRleCk7IGJyZWFrOwoJY2FzZSBlX19WVy5YUG9ydDogX19yZXMgPSB2aWV3X2dldF94cG9ydChfX2luZGV4KTsgYnJlYWs7CgljYXNlIGVfX1ZXLllQb3J0OiBfX3JlcyA9IHZpZXdfZ2V0X3lwb3J0KF9faW5kZXgpOyBicmVhazsKCWNhc2UgZV9fVlcuV1BvcnQ6IF9fcmVzID0gdmlld19nZXRfd3BvcnQoX19pbmRleCk7IGJyZWFrOwoJY2FzZSBlX19WVy5IUG9ydDogX19yZXMgPSB2aWV3X2dldF9ocG9ydChfX2luZGV4KTsgYnJlYWs7CgljYXNlIGVfX1ZXLkNhbWVyYTogX19yZXMgPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IGJyZWFrOwoJY2FzZSBlX19WVy5TdXJmYWNlSUQ6IF9fcmVzID0gdmlld19nZXRfc3VyZmFjZV9pZChfX2luZGV4KTsgYnJlYWs7CglkZWZhdWx0OiBicmVhazsKCX07CgkKCXJldHVybiBfX3JlczsKfQoKZnVuY3Rpb24gX192aWV3X3NldCgpCnsKCXZhciBfX3Byb3AgPSBhcmd1bWVudDA7Cgl2YXIgX19pbmRleCA9IGFyZ3VtZW50MTsKCXZhciBfX3ZhbCA9IGFyZ3VtZW50MjsKCQoJX192aWV3X3NldF9pbnRlcm5hbChfX3Byb3AsIF9faW5kZXgsIF9fdmFsKTsKCQoJdmFyIF9fcmVzID0gX192aWV3X2dldChfX3Byb3AsIF9faW5kZXgpOwoJCglyZXR1cm4gX19yZXM7Cn0KCmZ1bmN0aW9uIF9fdmlld19zZXRfaW50ZXJuYWwoKQp7Cgl2YXIgX19wcm9wID0gYXJndW1lbnQwOwoJdmFyIF9faW5kZXggPSBhcmd1bWVudDE7Cgl2YXIgX192YWwgPSBhcmd1bWVudDI7CgkKCXN3aXRjaChfX3Byb3ApCgl7CgljYXNlIGVfX1ZXLlhWaWV3OiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IGNhbWVyYV9zZXRfdmlld19wb3MoX19jYW0sIF9fdmFsLCBjYW1lcmFfZ2V0X3ZpZXdfeShfX2NhbSkpOyBicmVhazsKCWNhc2UgZV9fVlcuWVZpZXc6IHZhciBfX2NhbSA9IHZpZXdfZ2V0X2NhbWVyYShfX2luZGV4KTsgY2FtZXJhX3NldF92aWV3X3BvcyhfX2NhbSwgY2FtZXJhX2dldF92aWV3X3goX19jYW0pLCBfX3ZhbCk7IGJyZWFrOwoJY2FzZSBlX19WVy5XVmlldzogdmFyIF9fY2FtID0gdmlld19nZXRfY2FtZXJhKF9faW5kZXgpOyBjYW1lcmFfc2V0X3ZpZXdfc2l6ZShfX2NhbSwgX192YWwsIGNhbWVyYV9nZXRfdmlld19oZWlnaHQoX19jYW0pKTsgYnJlYWs7CgljYXNlIGVfX1ZXLkhWaWV3OiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IGNhbWVyYV9zZXRfdmlld19zaXplKF9fY2FtLCBjYW1lcmFfZ2V0X3ZpZXdfd2lkdGgoX19jYW0pLCBfX3ZhbCk7IGJyZWFrOwoJY2FzZSBlX19WVy5BbmdsZTogdmFyIF9fY2FtID0gdmlld19nZXRfY2FtZXJhKF9faW5kZXgpOyBjYW1lcmFfc2V0X3ZpZXdfYW5nbGUoX19jYW0sIF9fdmFsKTsgYnJlYWs7CgljYXNlIGVfX1ZXLkhCb3JkZXI6IHZhciBfX2NhbSA9IHZpZXdfZ2V0X2NhbWVyYShfX2luZGV4KTsgY2FtZXJhX3NldF92aWV3X2JvcmRlcihfX2NhbSwgX192YWwsIGNhbWVyYV9nZXRfdmlld19ib3JkZXJfeShfX2NhbSkpOyBicmVhazsKCWNhc2UgZV9fVlcuVkJvcmRlcjogdmFyIF9fY2FtID0gdmlld19nZXRfY2FtZXJhKF9faW5kZXgpOyBjYW1lcmFfc2V0X3ZpZXdfYm9yZGVyKF9fY2FtLCBjYW1lcmFfZ2V0X3ZpZXdfYm9yZGVyX3goX19jYW0pLCBfX3ZhbCk7IGJyZWFrOwoJY2FzZSBlX19WVy5IU3BlZWQ6IHZhciBfX2NhbSA9IHZpZXdfZ2V0X2NhbWVyYShfX2luZGV4KTsgY2FtZXJhX3NldF92aWV3X3NwZWVkKF9fY2FtLCBfX3ZhbCwgY2FtZXJhX2dldF92aWV3X3NwZWVkX3koX19jYW0pKTsgYnJlYWs7CgljYXNlIGVfX1ZXLlZTcGVlZDogdmFyIF9fY2FtID0gdmlld19nZXRfY2FtZXJhKF9faW5kZXgpOyBjYW1lcmFfc2V0X3ZpZXdfc3BlZWQoX19jYW0sIGNhbWVyYV9nZXRfdmlld19zcGVlZF94KF9fY2FtKSwgX192YWwpOyBicmVhazsKCWNhc2UgZV9fVlcuT2JqZWN0OiB2YXIgX19jYW0gPSB2aWV3X2dldF9jYW1lcmEoX19pbmRleCk7IGNhbWVyYV9zZXRfdmlld190YXJnZXQoX19jYW0sIF9fdmFsKTsgYnJlYWs7CgljYXNlIGVfX1ZXLlZpc2libGU6IF9fcmVzID0gdmlld19zZXRfdmlzaWJsZShfX2luZGV4LCBfX3ZhbCk7IGJyZWFrOwoJY2FzZSBlX19WVy5YUG9ydDogX19yZXMgPSB2aWV3X3NldF94cG9ydChfX2luZGV4LCBfX3ZhbCk7IGJyZWFrOwoJY2FzZSBlX19WVy5ZUG9ydDogX19yZXMgPSB2aWV3X3NldF95cG9ydChfX2luZGV4LCBfX3ZhbCk7IGJyZWFrOwoJY2FzZSBlX19WVy5XUG9ydDogX19yZXMgPSB2aWV3X3NldF93cG9ydChfX2luZGV4LCBfX3ZhbCk7IGJyZWFrOwoJY2FzZSBlX19WVy5IUG9ydDogX19yZXMgPSB2aWV3X3NldF9ocG9ydChfX2luZGV4LCBfX3ZhbCk7IGJyZWFrOwoJY2FzZSBlX19WVy5DYW1lcmE6IF9fcmVzID0gdmlld19zZXRfY2FtZXJhKF9faW5kZXgsIF9fdmFsKTsgYnJlYWs7CgljYXNlIGVfX1ZXLlN1cmZhY2VJRDogX19yZXMgPSB2aWV3X3NldF9zdXJmYWNlX2lkKF9faW5kZXgsIF9fdmFsKTsgYnJlYWs7CglkZWZhdWx0OiBicmVhazsKCX07CgkKCXJldHVybiAwOwp9CgpmdW5jdGlvbiBfX3ZpZXdfc2V0X3BwKCkKewoJdmFyIF9fcHJvcCA9IGFyZ3VtZW50MDsKCXZhciBfX2luZGV4ID0gYXJndW1lbnQxOwoJdmFyIF9fdmFsID0gYXJndW1lbnQyOwoJCgl2YXIgX19yZXMgPSBfX3ZpZXdfZ2V0KF9fcHJvcCwgX19pbmRleCk7CgkKCV9fdmlld19zZXRfaW50ZXJuYWwoX19wcm9wLCBfX2luZGV4LCBfX3ZhbCk7CgkKCXJldHVybiBfX3JlczsKfQoKI2VuZHJlZ2lvbgojcmVnaW9uIHRpbGUKCmZ1bmN0aW9uIHJvb21fdGlsZV9hZGQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIEFkZCBhIG5ldyB0aWxlIHRvIGEgcm9vbSBhbmQgcmV0dXJuIGl0cyBpbmRleC4KCS8vLyBAcGFyYW0gaW5kIFRoZSBpbmRleCBvZiB0aGUgcm9vbSB0byBzZXQgdGhlIGJhY2tncm91bmQgb2YuCgkvLy8gQHBhcmFtIGJhY2sgVGhlIGJhY2tncm91bmQgZnJvbSB3aGljaCB0aGUgdGlsZSBpcyB0YWtlbi4KCS8vLyBAcGFyYW0gbGVmdCBUaGUgeCBjb29yZGluYXRlIG9mIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIHRpbGUgcmVsYXRpdmUgdG8gdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHRvcCBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSB0b3Agc2lkZSBvZiB0aGUgdGlsZSByZWxhdGl2ZSB0byB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSB0aWxlLgoJLy8vIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgdGlsZS4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHdoZXJlIHRvIHBsYWNlIHRoZSB0aWxlLiAKCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHdoZXJlIHRvIHBsYWNlIHRoZSB0aWxlLgoJLy8vIEBwYXJhbSBkZXB0aCBUaGUgZGVwdGggb2YgdGhlIHRpbGUgaW4gdGhlIHJvb20uCgkvLy8gQHJldHVybnMge251bWJlcn0gcmVzb3VyY2UgbmFtZSBmb3IgdGhlIG5ldyB0aWxlCgkKCXZhciBfX2luZCA9IGFyZ3VtZW50MDsKCXZhciBfX2JhY2sgPSBhcmd1bWVudDE7Cgl2YXIgX19sZWZ0ID0gYXJndW1lbnQyOwoJdmFyIF9fdG9wID0gYXJndW1lbnQzOwoJdmFyIF9fd2lkdGggPSBhcmd1bWVudDQ7Cgl2YXIgX19oZWlnaHQgPSBhcmd1bWVudDU7Cgl2YXIgX194ID0gYXJndW1lbnQ2OwoJdmFyIF9feSA9IGFyZ3VtZW50NzsKCXZhciBfX2RlcHRoID0gYXJndW1lbnQ4OwoJCgkvLyBGaXJzdCBjaGVjayB0byBzZWUgaWYgdGhlIHRhcmdldCByb29tIGFjdHVhbGx5IGV4aXN0cwoJaWYgKHJvb21fZXhpc3RzKF9faW5kKSA9PSBmYWxzZSkKCXsKCQlyZXR1cm4gLTE7Cgl9CgkKCS8vIFNhdmUgdGhlIGN1cnJlbnQgdGFyZ2V0IHJvb20gYW5kIHN3aXRjaCB0byB0aGUgbmV3IG9uZQoJdmFyIF9fY3VycnJvb20gPSBsYXllcl9nZXRfdGFyZ2V0X3Jvb20oKTsKCWxheWVyX3NldF90YXJnZXRfcm9vbShfX2luZCk7CgkKCS8vIFNjYW4gZm9yIGEgbGF5ZXIgd2l0aCB0aGUgY29ycmVjdCBkZXB0aAoJdmFyIF9fbGF5ZXJzID0gbGF5ZXJfZ2V0X2FsbCgpOwoJdmFyIF9fbnVtbGF5ZXJzID0gYXJyYXlfbGVuZ3RoXzFkKF9fbGF5ZXJzKTsKCQoJdmFyIF9fbGF5ZXJ0b3VzZSA9IC0xOwoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPCBfX251bWxheWVyczsgX19pKyspCgl7CgkJaWYgKGxheWVyX2dldF9kZXB0aChfX2xheWVyc1tfX2ldKSA9PSBfX2RlcHRoKQoJCXsKCQkJLy8gRG9uJ3QgYm90aGVyIGNoZWNraW5nIG5hbWVzIC0gd2UnbGwganVzdCBhZGQgdGlsZXMgdG8gd2hhdGV2ZXIgbGF5ZXIgaXMgaGFuZHkKCQkJX19sYXllcnRvdXNlID0gX19sYXllcnNbX19pXTsKCQkJYnJlYWs7CQkKCQl9Cgl9CgkKCWlmIChfX2xheWVydG91c2UgPT0gLTEpCgl7CgkJLy8gZGlkbid0IGZpbmQgYSBsYXllciBvZiB0aGUgY29ycmVjdCBkZXB0aCwgc28gY3JlYXRlIG9uZQoJCV9fbGF5ZXJ0b3VzZSA9IGxheWVyX2NyZWF0ZShfX2RlcHRoKTsKCX0KCQoJLy8gTm93IGNyZWF0ZSBhIG5ldyB0aWxlIGVsZW1lbnQgYW5kIGFkZCBpdCB0byB0aGUgbGF5ZXIKCXZhciBfX3RpbGUgPSBsYXllcl90aWxlX2NyZWF0ZShfX2xheWVydG91c2UsIF9feCwgX195LCBfX2JhY2ssIF9fbGVmdCwgX190b3AsIF9fd2lkdGgsIF9faGVpZ2h0KTsKCQoJLy8gRmluYWxseSwgcmVzdG9yZSBvdXIgb3JpZ2luYWwgcm9vbSB0YXJnZXQKCWxheWVyX3NldF90YXJnZXRfcm9vbShfX2N1cnJyb29tKTsKCQoJcmV0dXJuIF9fdGlsZTsKfQoKZnVuY3Rpb24gcm9vbV90aWxlX2FkZF9leHQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIEFkZHMgYSBuZXcgdGlsZSB0byBhIGdpdmVuIHJvb20gYW5kIHNldHMgaXRzIHByb3BlcnRpZXMuCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIHJvb20gdG8gc2V0IHRoZSBiYWNrZ3JvdW5kIG9mLgoJLy8vIEBwYXJhbSBiYWNrIFRoZSBiYWNrZ3JvdW5kIGZyb20gd2hpY2ggdGhlIHRpbGUgaXMgdGFrZW4uCgkvLy8gQHBhcmFtIGxlZnQgVGhlIHggY29vcmRpbmF0ZSBvZiB0aGUgbGVmdCBzaWRlIG9mIHRoZSB0aWxlIHJlbGF0aXZlIHRvIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSB0b3AgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgdG9wIHNpZGUgb2YgdGhlIHRpbGUgcmVsYXRpdmUgdG8gdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgdGlsZS4KCS8vLyBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHRpbGUuCgkvLy8gQHBhcmFtIHggVGhlIHggY29vcmRpbmF0ZSBvZiB3aGVyZSB0byBwbGFjZSB0aGUgdGlsZS4gCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB3aGVyZSB0byBwbGFjZSB0aGUgdGlsZS4KCS8vLyBAcGFyYW0gZGVwdGggVGhlIGRlcHRoIG9mIHRoZSB0aWxlIGluIHRoZSByb29tLgoJLy8vIEBwYXJhbSB4c2NhbGUgVGhlIGhvcml6b250YWwgc2NhbGUgb2YgdGhlIHRpbGUuIDE9bm9ybWFsIHNpemUsIDAuNT1oYWxmLCAyPWRvdWJsZSwgZXRjLgoJLy8vIEBwYXJhbSB5c2NhbGUgVGhlIHZlcnRpY2FsIHNjYWxlIG9mIHRoZSB0aWxlLiAxPW5vcm1hbCBzaXplLCAwLjU9aGFsZiwgMj1kb3VibGUsIGV0Yy4KCS8vLyBAcGFyYW0gYWxwaGEgVGhlIGFscGhhICh0cmFuc3BhcmVuY3kpIG9mIHRoZSB0aWxlLiAwPWludmlzaWJsZSwgMT1vcGFxdWUsIDAuNT10cmFuc2x1Y2VudCBldGMuCgkvLy8gQHJldHVybnMge251bWJlcn0gcmVzb3VyY2UgbmFtZSBmb3IgdGhlIG5ldyB0aWxlCgkKCXZhciBfX2luZCA9IGFyZ3VtZW50MDsKCXZhciBfX2JhY2sgPSBhcmd1bWVudDE7Cgl2YXIgX19sZWZ0ID0gYXJndW1lbnQyOwoJdmFyIF9fdG9wID0gYXJndW1lbnQzOwoJdmFyIF9fd2lkdGggPSBhcmd1bWVudDQ7Cgl2YXIgX19oZWlnaHQgPSBhcmd1bWVudDU7Cgl2YXIgX194ID0gYXJndW1lbnQ2OwoJdmFyIF9feSA9IGFyZ3VtZW50NzsKCXZhciBfX2RlcHRoID0gYXJndW1lbnQ4OwoJdmFyIF9feHNjYWxlID0gYXJndW1lbnQ5OwoJdmFyIF9feXNjYWxlID0gYXJndW1lbnQxMDsKCXZhciBfX2FscGhhID0gYXJndW1lbnQxMTsKCQoJLy8gRmlyc3QgY2hlY2sgdG8gc2VlIGlmIHRoZSB0YXJnZXQgcm9vbSBhY3R1YWxseSBleGlzdHMKCWlmIChyb29tX2V4aXN0cyhfX2luZCkgPT0gZmFsc2UpCgl7CgkJcmV0dXJuIC0xOwoJfQoJCgkvLyBTYXZlIHRoZSBjdXJyZW50IHRhcmdldCByb29tIGFuZCBzd2l0Y2ggdG8gdGhlIG5ldyBvbmUKCXZhciBfX2N1cnJyb29tID0gbGF5ZXJfZ2V0X3RhcmdldF9yb29tKCk7CglsYXllcl9zZXRfdGFyZ2V0X3Jvb20oX19pbmQpOwoJCgkvLyBTY2FuIGZvciBhIGxheWVyIHdpdGggdGhlIGNvcnJlY3QgZGVwdGgKCXZhciBfX2xheWVycyA9IGxheWVyX2dldF9hbGwoKTsKCXZhciBfX251bWxheWVycyA9IGFycmF5X2xlbmd0aF8xZChfX2xheWVycyk7CgkKCXZhciBfX2xheWVydG91c2UgPSAtMTsKCXZhciBfX2k7Cglmb3IoX19pID0gMDsgX19pIDwgX19udW1sYXllcnM7IF9faSsrKQoJewoJCWlmIChsYXllcl9nZXRfZGVwdGgoX19sYXllcnNbX19pXSkgPT0gX19kZXB0aCkKCQl7CgkJCS8vIERvbid0IGJvdGhlciBjaGVja2luZyBuYW1lcyAtIHdlJ2xsIGp1c3QgYWRkIHRpbGVzIHRvIHdoYXRldmVyIGxheWVyIGlzIGhhbmR5CgkJCV9fbGF5ZXJ0b3VzZSA9IF9fbGF5ZXJzW19faV07CgkJCWJyZWFrOwkJCgkJfQoJfQoJCglpZiAoX19sYXllcnRvdXNlID09IC0xKQoJewoJCS8vIGRpZG4ndCBmaW5kIGEgbGF5ZXIgb2YgdGhlIGNvcnJlY3QgZGVwdGgsIHNvIGNyZWF0ZSBvbmUKCQlfX2xheWVydG91c2UgPSBsYXllcl9jcmVhdGUoX19kZXB0aCk7Cgl9CgkKCS8vIE5vdyBjcmVhdGUgYSBuZXcgdGlsZSBlbGVtZW50IGFuZCBhZGQgaXQgdG8gdGhlIGxheWVyCgl2YXIgX190aWxlID0gbGF5ZXJfdGlsZV9jcmVhdGUoX19sYXllcnRvdXNlLCBfX3gsIF9feSwgX19iYWNrLCBfX2xlZnQsIF9fdG9wLCBfX3dpZHRoLCBfX2hlaWdodCk7CglsYXllcl90aWxlX3hzY2FsZShfX3RpbGUsIF9feHNjYWxlKTsKCWxheWVyX3RpbGVfeXNjYWxlKF9fdGlsZSwgX195c2NhbGUpOwoJbGF5ZXJfdGlsZV9hbHBoYShfX3RpbGUsIF9fYWxwaGEpOwoJCgkvLyBGaW5hbGx5LCByZXN0b3JlIG91ciBvcmlnaW5hbCByb29tIHRhcmdldAoJbGF5ZXJfc2V0X3RhcmdldF9yb29tKF9fY3VycnJvb20pOwoJCglyZXR1cm4gX190aWxlOwp9CgpmdW5jdGlvbiByb29tX3RpbGVfY2xlYXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIENsZWFycyBhbGwgdGlsZXMgZnJvbSBhIGdpdmVuIHJvb20uCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIHJvb20gdG8gY2xlYXIgYWxsIHRpbGVzIGZyb20uCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2luZCA9IGFyZ3VtZW50MDsKCQoJLy8gRmlyc3QgY2hlY2sgdG8gc2VlIGlmIHRoZSB0YXJnZXQgcm9vbSBhY3R1YWxseSBleGlzdHMKCWlmIChyb29tX2V4aXN0cyhfX2luZCkgPT0gZmFsc2UpCgl7CgkJcmV0dXJuIC0xOwoJfQoJCgkvLyBTYXZlIHRoZSBjdXJyZW50IHRhcmdldCByb29tIGFuZCBzd2l0Y2ggdG8gdGhlIG5ldyBvbmUKCXZhciBfX2N1cnJyb29tID0gbGF5ZXJfZ2V0X3RhcmdldF9yb29tKCk7CglsYXllcl9zZXRfdGFyZ2V0X3Jvb20oX19pbmQpOwoJCgkvLyBTY2FuIGFsbCBsYXllcnMgZm9yIHRpbGUgZWxlbWVudHMgYW5kIGRlc3Ryb3kgYW55IHRoYXQgd2UgZmluZAoJdmFyIF9fbGF5ZXJzID0gbGF5ZXJfZ2V0X2FsbCgpOwoJdmFyIF9fbnVtbGF5ZXJzID0gYXJyYXlfbGVuZ3RoXzFkKF9fbGF5ZXJzKTsKCQoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPCBfX251bWxheWVyczsgX19pKyspCgl7CgkJdmFyIF9fZWxzID0gbGF5ZXJfZ2V0X2FsbF9lbGVtZW50cyhfX2xheWVyc1tfX2ldKTsKCQl2YXIgX19udW1lbHMgPSBhcnJheV9sZW5ndGhfMWQoX19lbHMpOwoJCQoJCXZhciBfX2o7CgkJZm9yKF9faiA9IDA7IF9faiA8IF9fbnVtZWxzOyBfX2orKykKCQl7CgkJCXZhciBfX2VsdHlwZSA9IGxheWVyX2dldF9lbGVtZW50X3R5cGUoX19lbHNbX19qXSk7CgkJCWlmIChfX2VsdHlwZSA9PSBsYXllcmVsZW1lbnR0eXBlX3RpbGUpCgkJCXsKCQkJCWxheWVyX3RpbGVfZGVzdHJveShfX2Vsc1tfX2pdKTsKCQkJfQoJCX0JCgl9CgkKCQoJLy8gRmluYWxseSwgcmVzdG9yZSBvdXIgb3JpZ2luYWwgcm9vbSB0YXJnZXQKCWxheWVyX3NldF90YXJnZXRfcm9vbShfX2N1cnJyb29tKTsKfQoKZnVuY3Rpb24gdGlsZV9hZGQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIEFkZHMgYSBuZXcgdGlsZSB0byB0aGUgcm9vbSwgYWxsb3dpbmcgY3VzdG9taXNhdGlvbiBvZiBpdHMgYXR0cmlidXRlcywgYW5kIHJldHVybmluZyBpdHMgaW5kZXguCgkvLy8gQHBhcmFtIGJhY2tncm91bmQgVGhlIGJhY2tncm91bmQgYXNzZXQgZnJvbSB3aGljaCB0aGUgbmV3IHRpbGUgd2lsbCBiZSBleHRyYWN0ZWQuCgkvLy8gQHBhcmFtIGxlZnQgVGhlIHggY29vcmRpbmF0ZSBvZiB0aGUgbGVmdCBvZiB0aGUgbmV3IHRpbGUsIHJlbGF0aXZlIHRvIHRoZSBiYWNrZ3JvdW5kIGFzc2V0J3MgdG9wIGxlZnQgY29ybmVyLgoJLy8vIEBwYXJhbSB0b3AgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgdG9wIG9mIHRoZSBuZXcgdGlsZSwgcmVsYXRpdmUgdG8gdGhlIGJhY2tncm91bmQgYXNzZXRzIHRvcCBsZWZ0IGNvcm5lci4KCS8vLyBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSB0aWxlLgoJLy8vIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgdGlsZS4KCS8vLyBAcGFyYW0geCBUaGUgeCBwb3NpdGlvbiBpbiB0aGUgcm9vbSB0byBwbGFjZSB0aGUgdGlsZS4KCS8vLyBAcGFyYW0geSBUaGUgeSBwb3NpdGlvbiBpbiB0aGUgcm9vbSB0byBwbGFjZSB0aGUgdGlsZS4KCS8vLyBAcGFyYW0gZGVwdGggVGhlIGRlcHRoIGF0IHdoaWNoIHRvIHBsYWNlIHRoZSB0aWxlLgoJLy8vIEByZXR1cm5zIHtudW1iZXJ9IHJlc291cmNlIG5hbWUgZm9yIHRoZSBuZXcgdGlsZQoJCgl2YXIgX19iYWNrID0gYXJndW1lbnQwOwoJdmFyIF9fbGVmdCA9IGFyZ3VtZW50MTsKCXZhciBfX3RvcCA9IGFyZ3VtZW50MjsKCXZhciBfX3dpZHRoID0gYXJndW1lbnQzOwoJdmFyIF9faGVpZ2h0ID0gYXJndW1lbnQ0OwoJdmFyIF9feCA9IGFyZ3VtZW50NTsKCXZhciBfX3kgPSBhcmd1bWVudDY7Cgl2YXIgX19kZXB0aCA9IGFyZ3VtZW50NzsKCQoJLy8gU2NhbiBmb3IgYSBsYXllciB3aXRoIHRoZSBjb3JyZWN0IGRlcHRoCgl2YXIgX19sYXllcnMgPSBsYXllcl9nZXRfYWxsKCk7Cgl2YXIgX19udW1sYXllcnMgPSBhcnJheV9sZW5ndGhfMWQoX19sYXllcnMpOwoJCgl2YXIgX19sYXllcnRvdXNlID0gLTE7Cgl2YXIgX19pOwoJZm9yKF9faSA9IDA7IF9faSA8IF9fbnVtbGF5ZXJzOyBfX2krKykKCXsKCQlpZiAobGF5ZXJfZ2V0X2RlcHRoKF9fbGF5ZXJzW19faV0pID09IF9fZGVwdGgpCgkJewoJCQkvLyBEb24ndCBib3RoZXIgY2hlY2tpbmcgbmFtZXMgLSB3ZSdsbCBqdXN0IGFkZCB0aWxlcyB0byB3aGF0ZXZlciBsYXllciBpcyBoYW5keQoJCQlfX2xheWVydG91c2UgPSBfX2xheWVyc1tfX2ldOwoJCQlicmVhazsJCQoJCX0KCX0KCQoJaWYgKF9fbGF5ZXJ0b3VzZSA9PSAtMSkKCXsKCQkvLyBkaWRuJ3QgZmluZCBhIGxheWVyIG9mIHRoZSBjb3JyZWN0IGRlcHRoLCBzbyBjcmVhdGUgb25lCgkJX19sYXllcnRvdXNlID0gbGF5ZXJfY3JlYXRlKF9fZGVwdGgpOwoJfQoJCgkvLyBOb3cgY3JlYXRlIGEgbmV3IHRpbGUgZWxlbWVudCBhbmQgYWRkIGl0IHRvIHRoZSBsYXllcgoJdmFyIF9fdGlsZSA9IGxheWVyX3RpbGVfY3JlYXRlKF9fbGF5ZXJ0b3VzZSwgX194LCBfX3ksIF9fYmFjaywgX19sZWZ0LCBfX3RvcCwgX193aWR0aCwgX19oZWlnaHQpOwoJCglyZXR1cm4gX190aWxlOwp9CgpmdW5jdGlvbiB0aWxlX2RlbGV0ZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRGVsZXRlcyBhIGdpdmVuIHRpbGUgaW4gdGhlIHJvb20uCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgdGlsZSB0byBkZWxldGUuCgkvLy8gQHJldHVybnMKCQoJdmFyIF9faW5kZXggPSBhcmd1bWVudDA7CgkKCWxheWVyX3RpbGVfZGVzdHJveShfX2luZGV4KTsKfQoKZnVuY3Rpb24gdGlsZV9leGlzdHMoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIENoZWNrcyBpZiBhIGdpdmVuIHRpbGUgZXhpc3RzIGluIHRoZSByb29tLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUgdG8gY2hlY2sgZm9yLgoJLy8vIEByZXR1cm5zIHtib29sZWFufSB3aGV0aGVyIHRoZSB0aWxlIGV4aXN0cwoJCgl2YXIgX19pbmRleCA9IGFyZ3VtZW50MDsKCQoJcmV0dXJuIGxheWVyX3RpbGVfZXhpc3RzKF9faW5kZXgpOwp9CgpmdW5jdGlvbiB0aWxlX2dldF9hbHBoYSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgYWxwaGEgdmFsdWUgb2YgYSBnaXZlbiB0aWxlLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUuCgkvLy8gQHJldHVybnMge251bWJlcn0gVGhlIGFscGhhIG9mIHRoZSB0aWxlCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJCglyZXR1cm4gbGF5ZXJfdGlsZV9nZXRfYWxwaGEoX19pbmRleCk7Cn0KCmZ1bmN0aW9uIHRpbGVfZ2V0X2JhY2tncm91bmQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIGJhY2tncm91bmQgaW5kZXggYSBnaXZlbiB0aWxlIGlzIGRyYXduIGZyb20uCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgdGlsZS4KCS8vLyBAcmV0dXJucyB7bnVtYmVyfSBUaGUgYmFja2dyb3VuZCBpbmRleAoJCgl2YXIgX19pbmRleCA9IGFyZ3VtZW50MDsKCQoJcmV0dXJuIGxheWVyX3RpbGVfZ2V0X3Nwcml0ZShfX2luZGV4KTsKfQoKZnVuY3Rpb24gdGlsZV9nZXRfYmxlbmQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIGJsZW5kaW5nIGNvbG91ciBvZiBhIGdpdmVuIHRpbGUuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgdGlsZS4KCS8vLyBAcmV0dXJucyB7bnVtYmVyfSBUaGUgYmFja2dyb3VuZCBpbmRleAoJCgl2YXIgX19pbmRleCA9IGFyZ3VtZW50MDsKCQoJcmV0dXJuIGxheWVyX3RpbGVfZ2V0X2JsZW5kKF9faW5kZXgpOwp9CgpmdW5jdGlvbiB0aWxlX2dldF9jb3VudCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIHRpbGVzIGluIGEgcm9vbS4KCS8vLyBAcmV0dXJucyB7bnVtYmVyfSB0b3RhbCBudW1iZXIgb2YgdGlsZXMgaW4gcm9vbQoJCgl2YXIgX190b3RhbHRpbGVzID0gMDsKCQoJLy8gU2NhbiBmb3IgYSBsYXllciB3aXRoIHRoZSBjb3JyZWN0IGRlcHRoCgl2YXIgX19sYXllcnMgPSBsYXllcl9nZXRfYWxsKCk7Cgl2YXIgX19udW1sYXllcnMgPSBhcnJheV9sZW5ndGhfMWQoX19sYXllcnMpOwoJCgl2YXIgX19pOwoJZm9yKF9faSA9IDA7IF9faSA8IF9fbnVtbGF5ZXJzOyBfX2krKykKCXsKCQl2YXIgX19lbHMgPSBsYXllcl9nZXRfYWxsX2VsZW1lbnRzKF9fbGF5ZXJzW19faV0pOwoJCXZhciBfX251bWVscyA9IGFycmF5X2xlbmd0aF8xZChfX2Vscyk7CgkJCgkJdmFyIF9fajsKCQlmb3IoX19qID0gMDsgX19qIDwgX19udW1lbHM7IF9faisrKQoJCXsKCQkJdmFyIF9fZWx0eXBlID0gbGF5ZXJfZ2V0X2VsZW1lbnRfdHlwZShfX2Vsc1tfX2pdKTsKCQkJaWYgKF9fZWx0eXBlID09IGxheWVyZWxlbWVudHR5cGVfdGlsZSkKCQkJewoJCQkJX190b3RhbHRpbGVzKys7CgkJCX0KCQl9CQoJfQoJCglyZXR1cm4gX190b3RhbHRpbGVzOwp9CgpmdW5jdGlvbiB0aWxlX2dldF9kZXB0aCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgZGVwdGggb2YgYSBnaXZlbiB0aWxlLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUgdG8gY2hlY2suCgkvLy8gQHJldHVybnMge251bWJlcn0gdGhlIGRlcHRoIG9mIHRoZSB0aWxlCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJCgkvLyBTaG91bGQgcmVhbGx5IGNoZWNrIGlmIHRoZSBlbGVtZW50IElEIHBvaW50cyB0byBhIHRpbGUgKGFuZCBub3QgYSBkaWZmZXJlbnQgc29ydCBvZiBlbGVtZW50KQoJdmFyIF9fbGF5ZXJpZCA9IGxheWVyX2dldF9lbGVtZW50X2xheWVyKF9faW5kZXgpOwoJcmV0dXJuIGxheWVyX2dldF9kZXB0aChfX2xheWVyaWQpOwp9CgpmdW5jdGlvbiB0aWxlX2dldF9oZWlnaHQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIGhlaWdodCBvZiBhIGdpdmVuIHRpbGUuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgdGlsZS4KCS8vLyBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaGVpZ2h0IG9mIHRoZSB0aWxlCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJCgl2YXIgX19yZWcgPSBsYXllcl90aWxlX2dldF9yZWdpb24oX19pbmRleCk7CglpZiAoYXJyYXlfbGVuZ3RoXzFkKF9fcmVnKSA9PSAwKQoJCXJldHVybiAwOwoJCglyZXR1cm4gX19yZWdbM107CgkJCn0KCmZ1bmN0aW9uIHRpbGVfZ2V0X2lkKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRoZSB1bmlxdWUgaWQgZm9yIHRoZSBnaXZlbiB0aWxlIGluZGV4LgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUuCgkvLy8gQHJldHVybnMge251bWJlcn0gdG90YWwgbnVtYmVyIG9mIHRpbGVzIGluIHJvb20KCQoJdmFyIF9faW5kZXggPSBhcmd1bWVudDA7CgkKCXZhciBfX2N1cnJ0aWxlID0gMDsKCQoJLy8gU2NhbiB0aHJvdWdoIGFsbCBsYXllcnMgbG9va2luZyBmb3IgdGhlIHNwZWNpZmllZCB0aWxlIChzbG93ISkKCXZhciBfX2xheWVycyA9IGxheWVyX2dldF9hbGwoKTsKCXZhciBfX251bWxheWVycyA9IGFycmF5X2xlbmd0aF8xZChfX2xheWVycyk7CgkKCXZhciBfX2k7Cglmb3IoX19pID0gMDsgX19pIDwgX19udW1sYXllcnM7IF9faSsrKQoJewoJCXZhciBfX2VscyA9IGxheWVyX2dldF9hbGxfZWxlbWVudHMoX19sYXllcnNbX19pXSk7CgkJdmFyIF9fbnVtZWxzID0gYXJyYXlfbGVuZ3RoXzFkKF9fZWxzKTsKCQkKCQl2YXIgX19qOwoJCWZvcihfX2ogPSAwOyBfX2ogPCBfX251bWVsczsgX19qKyspCgkJewoJCQl2YXIgX19lbHR5cGUgPSBsYXllcl9nZXRfZWxlbWVudF90eXBlKF9fZWxzW19fal0pOwoJCQlpZiAoX19lbHR5cGUgPT0gbGF5ZXJlbGVtZW50dHlwZV90aWxlKQoJCQl7CgkJCQlpZiAoX19jdXJydGlsZSA9PSBfX2luZGV4KQoJCQkJewoJCQkJCXJldHVybiBfX2Vsc1tfX2pdOwoJCQkJfQoJCQkJCgkJCQlfX2N1cnJ0aWxlKys7CgkJCX0KCQl9CQoJfQoJCglyZXR1cm4gLTE7Cn0KCmZ1bmN0aW9uIHRpbGVfZ2V0X2lkcygpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIHRoZSB1bmlxdWUgSUQgdmFsdWVzIGZvciBhbGwgdGlsZXMgaW4gYSByb29tLgoJLy8vIEByZXR1cm5zIHthcnJheX0gSURzIG9mIGFsbCB0aWxlcyBpbiB0aGUgcm9vbQoJCgl2YXIgX190aWxlczsKCV9fdGlsZXNbMF0gPSAtMTsKCXZhciBfX2N1cnJ0aWxlID0gMDsKCQoJLy8gU2NhbiB0aHJvdWdoIGFsbCBsYXllcnMgbG9va2luZyBmb3IgdGlsZXMKCXZhciBfX2xheWVycyA9IGxheWVyX2dldF9hbGwoKTsKCXZhciBfX251bWxheWVycyA9IGFycmF5X2xlbmd0aF8xZChfX2xheWVycyk7CgkKCXZhciBfX2k7Cglmb3IoX19pID0gMDsgX19pIDwgX19udW1sYXllcnM7IF9faSsrKQoJewoJCXZhciBfX2VscyA9IGxheWVyX2dldF9hbGxfZWxlbWVudHMoX19sYXllcnNbX19pXSk7CgkJdmFyIF9fbnVtZWxzID0gYXJyYXlfbGVuZ3RoXzFkKF9fZWxzKTsKCQkKCQl2YXIgX19qOwoJCWZvcihfX2ogPSAwOyBfX2ogPCBfX251bWVsczsgX19qKyspCgkJewoJCQl2YXIgX19lbHR5cGUgPSBsYXllcl9nZXRfZWxlbWVudF90eXBlKF9fZWxzW19fal0pOwoJCQlpZiAoX19lbHR5cGUgPT0gbGF5ZXJlbGVtZW50dHlwZV90aWxlKQoJCQl7CgkJCQlfX3RpbGVzW19fY3VycnRpbGVdID0gX19lbHNbX19qXTsJCQkJCQkKCQkJCV9fY3VycnRpbGUrKzsKCQkJfQoJCX0JCgl9CgkKCXJldHVybiBfX3RpbGVzOwp9CgpmdW5jdGlvbiB0aWxlX2dldF9pZHNfYXRfZGVwdGgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgdW5pcXVlIElEIHZhbHVlcyBmb3IgYWxsIHRpbGVzIGF0IGEgZ2l2ZW4gZGVwdGguCgkvLy8gQHBhcmFtIGRlcHRoIFRoZSBkZXB0aCBvZiB0aGUgdGlsZSBsYXllciB0byBnZXQgdGhlIElEcyBvZi4KCS8vLyBAcmV0dXJucyB7YXJyYXl9IElEcyBvZiBhbGwgdGlsZXMgb2YgdGhlIHNwZWNpZmllZCBkZXB0aCBpbiB0aGUgcm9vbQoJCgl2YXIgX19kZXB0aCA9IGFyZ3VtZW50MDsKCQoJdmFyIF9fdGlsZXM7CglfX3RpbGVzWzBdID0gLTE7Cgl2YXIgX19jdXJydGlsZSA9IDA7CgkKCS8vIFNjYW4gdGhyb3VnaCBhbGwgbGF5ZXJzIGxvb2tpbmcgZm9yIHRpbGVzCgl2YXIgX19sYXllcnMgPSBsYXllcl9nZXRfYWxsKCk7Cgl2YXIgX19udW1sYXllcnMgPSBhcnJheV9sZW5ndGhfMWQoX19sYXllcnMpOwoJCgl2YXIgX19pOwoJZm9yKF9faSA9IDA7IF9faSA8IF9fbnVtbGF5ZXJzOyBfX2krKykKCXsKCQlpZiAobGF5ZXJfZ2V0X2RlcHRoKF9fbGF5ZXJzW19faV0pICE9IF9fZGVwdGgpCgkJCWNvbnRpbnVlOwoJCQoJCXZhciBfX2VscyA9IGxheWVyX2dldF9hbGxfZWxlbWVudHMoX19sYXllcnNbX19pXSk7CgkJdmFyIF9fbnVtZWxzID0gYXJyYXlfbGVuZ3RoXzFkKF9fZWxzKTsKCQkKCQl2YXIgX19qOwoJCWZvcihfX2ogPSAwOyBfX2ogPCBfX251bWVsczsgX19qKyspCgkJewoJCQl2YXIgX19lbHR5cGUgPSBsYXllcl9nZXRfZWxlbWVudF90eXBlKF9fZWxzW19fal0pOwoJCQlpZiAoX19lbHR5cGUgPT0gbGF5ZXJlbGVtZW50dHlwZV90aWxlKQoJCQl7CgkJCQlfX3RpbGVzW19fY3VycnRpbGVdID0gX19lbHNbX19qXTsJCQkJCQkKCQkJCV9fY3VycnRpbGUrKzsKCQkJfQoJCX0JCgl9CgkKCXJldHVybiBfX3RpbGVzOwp9CgpmdW5jdGlvbiB0aWxlX2dldF9sZWZ0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRoZSBsZWZ0IGNvb3JkaW5hdGUgb2YgYSBnaXZlbiB0aWxlIGZyb20gaXRzIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgdGlsZS4KCS8vLyBAcmV0dXJucyB7bnVtYmVyfSBUaGUgd2lkdGggb2YgdGhlIHRpbGUKCQoJdmFyIF9faW5kZXggPSBhcmd1bWVudDA7CgkKCXZhciBfX3JlZyA9IGxheWVyX3RpbGVfZ2V0X3JlZ2lvbihfX2luZGV4KTsKCWlmIChhcnJheV9sZW5ndGhfMWQoX19yZWcpID09IDApCgkJcmV0dXJuIDA7CgkJCglyZXR1cm4gX19yZWdbMF07Cn0KCmZ1bmN0aW9uIHRpbGVfZ2V0X3RvcCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgdG9wIGNvb3JkaW5hdGUgb2YgYSBnaXZlbiB0aWxlIGZyb20gaXRzIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgdGlsZS4KCS8vLyBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdG9wIG9mIHRoZSB0aWxlCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJCgl2YXIgX19yZWcgPSBsYXllcl90aWxlX2dldF9yZWdpb24oX19pbmRleCk7CglpZiAoYXJyYXlfbGVuZ3RoXzFkKF9fcmVnKSA9PSAwKQoJCXJldHVybiAwOwoJCQoJcmV0dXJuIF9fcmVnWzFdOwp9CgpmdW5jdGlvbiB0aWxlX2dldF92aXNpYmxlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHdoZXRoZXIgYSB0aWxlIGlzIHZpc2libGUgb3Igbm90LgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUuCgkvLy8gQHJldHVybnMge2Jvb2xlYW59IFRoZSB2aXNpYmlsaXR5IG9mIHRoZSB0aWxlCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJCglyZXR1cm4gbGF5ZXJfdGlsZV9nZXRfdmlzaWJsZShfX2luZGV4KTsKfQoKZnVuY3Rpb24gdGlsZV9nZXRfd2lkdGgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHdpZHRoIG9mIGEgZ2l2ZW4gdGlsZS4KCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSB0aWxlLgoJLy8vIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB3aWR0aCBvZiB0aGUgdGlsZQoJCgl2YXIgX19pbmRleCA9IGFyZ3VtZW50MDsKCQoJdmFyIF9fcmVnID0gbGF5ZXJfdGlsZV9nZXRfcmVnaW9uKF9faW5kZXgpOwoJaWYgKGFycmF5X2xlbmd0aF8xZChfX3JlZykgPT0gMCkKCQlyZXR1cm4gMDsKCQkKCXJldHVybiBfX3JlZ1syXTsKfQoKZnVuY3Rpb24gdGlsZV9nZXRfeCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgeCBjb29yZGluYXRlIG9mIGEgZ2l2ZW4gdGlsZS4KCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSB0aWxlLgoJLy8vIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB4IHBvc2l0aW9uIG9mIHRoZSB0aWxlCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJCglyZXR1cm4gbGF5ZXJfdGlsZV9nZXRfeChfX2luZGV4KTsKfQoKZnVuY3Rpb24gdGlsZV9nZXRfeHNjYWxlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRoZSBob3Jpem9udGFsIHNjYWxpbmcgb2YgYSBnaXZlbiB0aWxlLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUuCgkvLy8gQHJldHVybnMge251bWJlcn0gVGhlIGhvcml6b250YWwgc2NhbGluZyBvZiB0aGUgdGlsZQoJCgl2YXIgX19pbmRleCA9IGFyZ3VtZW50MDsKCQoJcmV0dXJuIGxheWVyX3RpbGVfZ2V0X3hzY2FsZShfX2luZGV4KTsKfQoKZnVuY3Rpb24gdGlsZV9nZXRfeSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgeSBjb29yZGluYXRlIG9mIGEgZ2l2ZW4gdGlsZS4KCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSB0aWxlLgoJLy8vIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB5IHBvc2l0aW9uIG9mIHRoZSB0aWxlCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJCglyZXR1cm4gbGF5ZXJfdGlsZV9nZXRfeShfX2luZGV4KTsKfQoKZnVuY3Rpb24gdGlsZV9nZXRfeXNjYWxlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRoZSB2ZXJ0aWNhbCBzY2FsaW5nIG9mIGEgZ2l2ZW4gdGlsZS4KCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSB0aWxlLgoJLy8vIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB2ZXJ0aWNhbCBzY2FsaW5nIG9mIHRoZSB0aWxlCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJCglyZXR1cm4gbGF5ZXJfdGlsZV9nZXRfeXNjYWxlKF9faW5kZXgpOwp9CgpmdW5jdGlvbiB0aWxlX2xheWVyX2RlbGV0ZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRGVsZXRlcyBhbGwgdGlsZXMgYXQgdGhlIGluZGljYXRlZCBkZXB0aCBsYXllci4KCS8vLyBAcGFyYW0gZGVwdGggVGhlIGRlcHRoIG9mIHRpbGVzIHdoaWNoIGlzIHRvIGJlIGRlbGV0ZWQuCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2RlcHRoID0gYXJndW1lbnQwOwoJCgkvLyBTY2FuIHRocm91Z2ggYWxsIGxheWVycyBsb29raW5nIGZvciB0aWxlcwoJdmFyIF9fbGF5ZXJzID0gbGF5ZXJfZ2V0X2FsbCgpOwoJdmFyIF9fbnVtbGF5ZXJzID0gYXJyYXlfbGVuZ3RoXzFkKF9fbGF5ZXJzKTsKCQoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPCBfX251bWxheWVyczsgX19pKyspCgl7CgkJaWYgKGxheWVyX2dldF9kZXB0aChfX2xheWVyc1tfX2ldKSAhPSBfX2RlcHRoKQoJCQljb250aW51ZTsKCQkKCQl2YXIgX19lbHMgPSBsYXllcl9nZXRfYWxsX2VsZW1lbnRzKF9fbGF5ZXJzW19faV0pOwoJCXZhciBfX251bWVscyA9IGFycmF5X2xlbmd0aF8xZChfX2Vscyk7CgkJCgkJdmFyIF9fajsKCQlmb3IoX19qID0gMDsgX19qIDwgX19udW1lbHM7IF9faisrKQoJCXsKCQkJdmFyIF9fZWx0eXBlID0gbGF5ZXJfZ2V0X2VsZW1lbnRfdHlwZShfX2Vsc1tfX2pdKTsKCQkJaWYgKF9fZWx0eXBlID09IGxheWVyZWxlbWVudHR5cGVfdGlsZSkKCQkJewoJCQkJbGF5ZXJfdGlsZV9kZXN0cm95KF9fZWxzW19fal0pOwkJCQoJCQl9CgkJfQkKCX0KfQoKZnVuY3Rpb24gdGlsZV9sYXllcl9kZWxldGVfYXQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIERlbGV0ZXMgdGhlIHRpbGUocykgYXQgYSBnaXZlbiBkZXB0aCBhbmQgcG9zaXRpb24uCgkvLy8gQHBhcmFtIGRlcHRoIFRoZSBkZXB0aCBvZiBhIHRpbGUgdG8gYmUgZGVsZXRlZC4KCS8vLyBAcGFyYW0geCBUaGUgeCBwb3NpdGlvbiBhdCB3aGljaCB0byBkZWxldGUgYSB0aWxlLgoJLy8vIEBwYXJhbSB5IFRoZSB5IHBvc2l0aW9uIGF0IHdoaWNoIHRvIGRlbGV0ZSBhIHRpbGUuCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2RlcHRoID0gYXJndW1lbnQwOwoJdmFyIF9feCA9IGFyZ3VtZW50MTsKCXZhciBfX3kgPSBhcmd1bWVudDI7CgkKCXZhciBfX3RpbGVfZWwgPSB0aWxlX2xheWVyX2ZpbmQoX19kZXB0aCwgX194LCBfX3kpOwoJaWYgKF9fdGlsZV9lbCAhPSAtMSkKCXsKCQlsYXllcl90aWxlX2Rlc3Ryb3koX190aWxlX2VsKTsJCQkKCX0KfQoKZnVuY3Rpb24gdGlsZV9sYXllcl9kZXB0aCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gTW92ZXMgYWxsIHRpbGVzIGF0IGEgZ2l2ZW4gZGVwdGggdG8gYSBuZXcgZGVwdGguCgkvLy8gQHBhcmFtIGRlcHRoIFRoZSBjdXJyZW50IGRlcHRoIG9mIHRoZSB0aWxlIGxheWVyLgoJLy8vIEBwYXJhbSBuZXdkZXB0aCBUaGUgZGVwdGggdG8gY2hhbmdlIHRoZSBsYXllciB0by4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9fZGVwdGggPSBhcmd1bWVudDA7Cgl2YXIgX19uZXdkZXB0aCA9IGFyZ3VtZW50MTsKCQoJLy8gU2NhbiBmb3IgYSBsYXllciB3aXRoIHRoZSBkZXB0aAoJdmFyIF9fbGF5ZXJzID0gbGF5ZXJfZ2V0X2FsbCgpOwoJdmFyIF9fbnVtbGF5ZXJzID0gYXJyYXlfbGVuZ3RoXzFkKF9fbGF5ZXJzKTsKCXZhciBfX2xheWVyc3RvbW92ZTsKCV9fbGF5ZXJzdG9tb3ZlWzBdID0gLTE7Cgl2YXIgX19udW1sYXllcnN0b21vdmUgPSAwOwoJCgl2YXIgX19sYXllcnRvdXNlID0gLTE7Cgl2YXIgX19pOwoJZm9yKF9faSA9IDA7IF9faSA8IF9fbnVtbGF5ZXJzOyBfX2krKykKCXsKCQl2YXIgX19sYXllcmRlcHRoID0gbGF5ZXJfZ2V0X2RlcHRoKF9fbGF5ZXJzW19faV0pOwoJCQoJCWlmIChfX2xheWVyZGVwdGggPT0gX19kZXB0aCkKCQl7CgkJCV9fbGF5ZXJzdG9tb3ZlW19fbnVtbGF5ZXJzdG9tb3ZlXSA9IF9fbGF5ZXJzW19faV07CgkJCV9fbnVtbGF5ZXJzdG9tb3ZlKys7CgkJfQkKCQllbHNlIGlmIChsYXllcl9nZXRfZGVwdGgoX19sYXllcnNbX19pXSkgPT0gX19uZXdkZXB0aCkKCQl7CgkJCS8vIERvbid0IGJvdGhlciBjaGVja2luZyBuYW1lcyAtIHdlJ2xsIGp1c3QgYWRkIHRpbGVzIHRvIHdoYXRldmVyIGxheWVyIGlzIGhhbmR5CgkJCV9fbGF5ZXJ0b3VzZSA9IF9fbGF5ZXJzW19faV07CgkJCWJyZWFrOwkJCgkJfQoJfQoJCglpZiAoX19sYXllcnRvdXNlID09IC0xKQoJewoJCS8vIGRpZG4ndCBmaW5kIGEgbGF5ZXIgb2YgdGhlIGNvcnJlY3QgZGVwdGgsIHNvIGNyZWF0ZSBvbmUKCQlfX2xheWVydG91c2UgPSBsYXllcl9jcmVhdGUoX19uZXdkZXB0aCk7Cgl9CgkKCS8vIE5vdyBnbyB0aHJvdWdoIGFnYWluIGFuZCBtb3ZlIGFsbCB0aG9zZSB0aWxlcyBvZiB0aGUgb3JpZ2luYWwgZGVwdGggdG8gdGhlIG5ldyBsYXllcgoJLy8gKHNob3VsZCB3ZSBkZWxldGUgbGF5ZXJzIHRoYXQgYmVjb21lIGVtcHR5PykKCWZvcihfX2kgPSAwOyBfX2kgPCBfX251bWxheWVyc3RvbW92ZTsgX19pKyspCgl7CgkJdmFyIF9fZWxzID0gbGF5ZXJfZ2V0X2FsbF9lbGVtZW50cyhfX2xheWVyc3RvbW92ZVtfX2ldKTsKCQl2YXIgX19udW1lbHMgPSBhcnJheV9sZW5ndGhfMWQoX19lbHMpOwoJCQoJCXZhciBfX2o7CgkJZm9yKF9faiA9IDA7IF9faiA8IF9fbnVtZWxzOyBfX2orKykKCQl7CgkJCWlmIChsYXllcl9nZXRfZWxlbWVudF90eXBlKF9fZWxzW19fal0pID09IGxheWVyZWxlbWVudHR5cGVfdGlsZSkKCQkJewoJCQkJbGF5ZXJfZWxlbWVudF9tb3ZlKF9fZWxzW19fal0sIF9fbGF5ZXJ0b3VzZSk7CgkJCX0KCQl9Cgl9Cn0KCmZ1bmN0aW9uIHRpbGVfbGF5ZXJfZmluZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgaWQgb2YgYSB0aWxlIGF0IGEgZ2l2ZW4gZGVwdGggYW5kIHBvc2l0aW9uLgoJLy8vIEBwYXJhbSBkZXB0aCBUaGUgZGVwdGggb2YgdGhlIHRpbGUgdG8gYmUgZm91bmQuCgkvLy8gQHBhcmFtIHggVGhlIHggcG9zaXRpb24gdG8gY2hlY2suCgkvLy8gQHBhcmFtIHkgVGhlIHkgcG9zaXRpb24gdG8gY2hlY2suCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2RlcHRoID0gYXJndW1lbnQwOwoJdmFyIF9feCA9IGFyZ3VtZW50MTsKCXZhciBfX3kgPSBhcmd1bWVudDI7CgkKCS8vIFNjYW4gdGhyb3VnaCBhbGwgbGF5ZXJzIGxvb2tpbmcgZm9yIHRpbGVzCgkvLyBUaGlzIGlzIGdvaW5nIHRvIGJlIHNsb3cKCXZhciBfX2xheWVycyA9IGxheWVyX2dldF9hbGwoKTsKCXZhciBfX251bWxheWVycyA9IGFycmF5X2xlbmd0aF8xZChfX2xheWVycyk7CgkKCXZhciBfX2k7Cglmb3IoX19pID0gMDsgX19pIDwgX19udW1sYXllcnM7IF9faSsrKQoJewoJCWlmIChsYXllcl9nZXRfZGVwdGgoX19sYXllcnNbX19pXSkgIT0gX19kZXB0aCkKCQkJY29udGludWU7CgkJCgkJdmFyIF9fZWxzID0gbGF5ZXJfZ2V0X2FsbF9lbGVtZW50cyhfX2xheWVyc1tfX2ldKTsKCQl2YXIgX19udW1lbHMgPSBhcnJheV9sZW5ndGhfMWQoX19lbHMpOwoJCQoJCXZhciBfX2o7CgkJZm9yKF9faiA9IDA7IF9faiA8IF9fbnVtZWxzOyBfX2orKykKCQl7CgkJCXZhciBfX2VsdHlwZSA9IGxheWVyX2dldF9lbGVtZW50X3R5cGUoX19lbHNbX19qXSk7CgkJCWlmIChfX2VsdHlwZSA9PSBsYXllcmVsZW1lbnR0eXBlX3RpbGUpCgkJCXsKCQkJCXZhciBfX3RpbGVYc2NhbGUgPSBsYXllcl90aWxlX2dldF94c2NhbGUoX19lbHNbX19qXSk7CgkJCQl2YXIgX190aWxlWXNjYWxlID0gbGF5ZXJfdGlsZV9nZXRfeXNjYWxlKF9fZWxzW19fal0pOwoJCQkJCgkJCQkvLyBGYXN0KGlzaCkgcGF0aCB3aXRoIG1vcmUgZWFybHktb3V0cwoJCQkJaWYgKChfX3RpbGVYc2NhbGUgPj0gMCkgJiYgKF9fdGlsZVlzY2FsZSA+PSAwKSkKCQkJCXsJCQkKCQkJCQl2YXIgX190aWxlWCA9IGxheWVyX3RpbGVfZ2V0X3goX19lbHNbX19qXSk7CQkJCQkJCgkJCQkJaWYgKF9feCA8IF9fdGlsZVgpCgkJCQkJCWNvbnRpbnVlOwoJCQkJCQkKCQkJCQl2YXIgX190aWxlWSA9IGxheWVyX3RpbGVfZ2V0X3koX19lbHNbX19qXSk7CgkJCQkJaWYgKF9feSA8IF9fdGlsZVkpCgkJCQkJCWNvbnRpbnVlOwoJCQkJCQkJCQoJCQkJCXZhciBfX3RpbGVSZWcgPSBsYXllcl90aWxlX2dldF9yZWdpb24oX19lbHNbX19qXSk7CQkJCgkJCQkJdmFyIF9fdGlsZVJpZ2h0ID0gX190aWxlWCArIChfX3RpbGVYc2NhbGUgKiBfX3RpbGVSZWdbMl0pOwoJCQkJCWlmIChfX3ggPj0gX190aWxlUmlnaHQpCgkJCQkJCWNvbnRpbnVlOwoJCQkJCQkKCQkJCQkKCQkJCQl2YXIgX190aWxlQm90dG9tID0gX190aWxlWSArIChfX3RpbGVZc2NhbGUgKiBfX3RpbGVSZWdbM10pOwoJCQkJCWlmIChfX3kgPj0gX190aWxlQm90dG9tKQoJCQkJCQljb250aW51ZTsKCQkJCQkKCQkJCQkvLyBQYXNzZWQgYWxsIHRoZSB0ZXN0cyBzbyByZXR1cm4gdGhpcyB0aWxlCgkJCQkJcmV0dXJuIF9fZWxzW19fal07CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJdmFyIF9fdGlsZVJlZyA9IGxheWVyX3RpbGVfZ2V0X3JlZ2lvbihfX2Vsc1tfX2pdKTsKCQkJCQl2YXIgX19taW54ID0gbGF5ZXJfdGlsZV9nZXRfeChfX2Vsc1tfX2pdKTsKCQkJCQl2YXIgX19tYXh4ID0gX19taW54ICsgKF9fdGlsZVhzY2FsZSAqIF9fdGlsZVJlZ1syXSk7CgkJCQkJaWYgKF9fbWlueCA+IF9fbWF4eCkKCQkJCQl7CgkJCQkJCXZhciBfX3RlbXAgPSBfX21pbng7CgkJCQkJCV9fbWlueCA9IF9fbWF4eDsKCQkJCQkJX19tYXh4ID0gX190ZW1wOwoJCQkJCX0KCQkJCQkKCQkJCQlpZiAoX194IDwgX19taW54KQoJCQkJCQljb250aW51ZTsKCQkJCQkJCgkJCQkJaWYgKF9feCA+PSBfX21heHgpCgkJCQkJCWNvbnRpbnVlOwoJCQkJCQkKCQkJCQl2YXIgX19taW55ID0gbGF5ZXJfdGlsZV9nZXRfeShfX2Vsc1tfX2pdKTsKCQkJCQl2YXIgX19tYXh5ID0gX19taW55ICsgKF9fdGlsZVlzY2FsZSAqIF9fdGlsZVJlZ1szXSk7CgkJCQkJaWYgKF9fbWlueSA+IF9fbWF4eSkKCQkJCQl7CgkJCQkJCXZhciBfX3RlbXAgPSBfX21pbnk7CgkJCQkJCV9fbWlueSA9IF9fbWF4eTsKCQkJCQkJX19tYXh5ID0gX190ZW1wOwoJCQkJCX0KCQkJCQkKCQkJCQlpZiAoX195IDwgX19taW55KQoJCQkJCQljb250aW51ZTsKCQkJCQkJCgkJCQkJaWYgKF9feSA+PSBfX21heHkpCgkJCQkJCWNvbnRpbnVlOwoJCQkJCQkKCQkJCQkvLyBQYXNzZWQgYWxsIHRoZSB0ZXN0cyBzbyByZXR1cm4gdGhpcyB0aWxlCgkJCQkJcmV0dXJuIF9fZWxzW19fal07CgkJCQkJCgkJCQl9CgkJCX0KCQl9CQoJfQoJCglyZXR1cm4gLTE7Cn0KCmZ1bmN0aW9uIHRpbGVfbGF5ZXJfaGlkZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gSGlkZXMgYWxsIHRpbGVzIGF0IHRoZSBpbmRpY2F0ZWQgZGVwdGggbGF5ZXIuCgkvLy8gQHBhcmFtIGRlcHRoIFRoZSBkZXB0aCBvZiB0aWxlcyB3aGljaCBpcyB0byBiZSBoaWRkZW4uCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2RlcHRoID0gYXJndW1lbnQwOwoJCgkvLyBTY2FuIHRocm91Z2ggYWxsIGxheWVycyBsb29raW5nIGZvciB0aWxlcwoJdmFyIF9fbGF5ZXJzID0gbGF5ZXJfZ2V0X2FsbCgpOwoJdmFyIF9fbnVtbGF5ZXJzID0gYXJyYXlfbGVuZ3RoXzFkKF9fbGF5ZXJzKTsKCQoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPCBfX251bWxheWVyczsgX19pKyspCgl7CgkJaWYgKGxheWVyX2dldF9kZXB0aChfX2xheWVyc1tfX2ldKSAhPSBfX2RlcHRoKQoJCQljb250aW51ZTsKCQkKCQl2YXIgX19lbHMgPSBsYXllcl9nZXRfYWxsX2VsZW1lbnRzKF9fbGF5ZXJzW19faV0pOwoJCXZhciBfX251bWVscyA9IGFycmF5X2xlbmd0aF8xZChfX2Vscyk7CgkJCgkJdmFyIF9fajsKCQlmb3IoX19qID0gMDsgX19qIDwgX19udW1lbHM7IF9faisrKQoJCXsKCQkJdmFyIF9fZWx0eXBlID0gbGF5ZXJfZ2V0X2VsZW1lbnRfdHlwZShfX2Vsc1tfX2pdKTsKCQkJaWYgKF9fZWx0eXBlID09IGxheWVyZWxlbWVudHR5cGVfdGlsZSkKCQkJewoJCQkJbGF5ZXJfdGlsZV92aXNpYmxlKF9fZWxzW19fal0sZmFsc2UpOwkJCQoJCQl9CgkJfQkKCX0KfQoKZnVuY3Rpb24gdGlsZV9sYXllcl9zaGlmdCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gU2hpZnRzIGFsbCB0aWxlcyBhdCB0aGUgaW5kaWNhdGVkIGRlcHRoIGxheWVyIGJ5IGEgZ2l2ZW4gYW1vdW50LgoJLy8vIEBwYXJhbSBkZXB0aCBUaGUgZGVwdGggb2YgdGlsZXMgd2hpY2ggaXMgdG8gYmUgc2hpZnRlZC4KCS8vLyBAcGFyYW0geCBUaGUgYW1vdW50IHRvIHNoaWZ0IG92ZXIgdGhlIHgtYXhpcy4KCS8vLyBAcGFyYW0geSBUaGUgYW1vdW50IHRvIHNoaWZ0IG92ZXIgdGhlIHktYXhpcy4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9fZGVwdGggPSBhcmd1bWVudDA7Cgl2YXIgX194ID0gYXJndW1lbnQxOwoJdmFyIF9feSA9IGFyZ3VtZW50MjsKCQoJLy8gU2NhbiB0aHJvdWdoIGFsbCBsYXllcnMgbG9va2luZyBmb3IgdGlsZXMKCXZhciBfX2xheWVycyA9IGxheWVyX2dldF9hbGwoKTsKCXZhciBfX251bWxheWVycyA9IGFycmF5X2xlbmd0aF8xZChfX2xheWVycyk7CgkKCXZhciBfX2k7Cglmb3IoX19pID0gMDsgX19pIDwgX19udW1sYXllcnM7IF9faSsrKQoJewoJCWlmIChsYXllcl9nZXRfZGVwdGgoX19sYXllcnNbX19pXSkgIT0gX19kZXB0aCkKCQkJY29udGludWU7CgkJCgkJdmFyIF9fZWxzID0gbGF5ZXJfZ2V0X2FsbF9lbGVtZW50cyhfX2xheWVyc1tfX2ldKTsKCQl2YXIgX19udW1lbHMgPSBhcnJheV9sZW5ndGhfMWQoX19lbHMpOwoJCQoJCXZhciBfX2o7CgkJZm9yKF9faiA9IDA7IF9faiA8IF9fbnVtZWxzOyBfX2orKykKCQl7CgkJCXZhciBfX2VsdHlwZSA9IGxheWVyX2dldF9lbGVtZW50X3R5cGUoX19lbHNbX19qXSk7CgkJCWlmIChfX2VsdHlwZSA9PSBsYXllcmVsZW1lbnR0eXBlX3RpbGUpCgkJCXsKCQkJCWxheWVyX3RpbGVfeChfX2Vsc1tfX2pdLCBsYXllcl90aWxlX2dldF94KF9fZWxzW19fal0pICsgX194KTsKCQkJCWxheWVyX3RpbGVfeShfX2Vsc1tfX2pdLCBsYXllcl90aWxlX2dldF95KF9fZWxzW19fal0pICsgX195KTsJCQkKCQkJfQoJCX0JCgl9Cn0KCmZ1bmN0aW9uIHRpbGVfbGF5ZXJfc2hvdygpCnsKCS8vLyBAZGVzY3JpcHRpb24gU2hvd3MgYWxsIHRpbGVzIGF0IHRoZSBpbmRpY2F0ZWQgZGVwdGggbGF5ZXIuCgkvLy8gQHBhcmFtIGRlcHRoIFRoZSBkZXB0aCBvZiB0aWxlcyB3aGljaCBpcyB0byBiZSBzaG93bi4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9fZGVwdGggPSBhcmd1bWVudDA7CgkKCS8vIFNjYW4gdGhyb3VnaCBhbGwgbGF5ZXJzIGxvb2tpbmcgZm9yIHRpbGVzCgl2YXIgX19sYXllcnMgPSBsYXllcl9nZXRfYWxsKCk7Cgl2YXIgX19udW1sYXllcnMgPSBhcnJheV9sZW5ndGhfMWQoX19sYXllcnMpOwoJCgl2YXIgX19pOwoJZm9yKF9faSA9IDA7IF9faSA8IF9fbnVtbGF5ZXJzOyBfX2krKykKCXsKCQlpZiAobGF5ZXJfZ2V0X2RlcHRoKF9fbGF5ZXJzW19faV0pICE9IF9fZGVwdGgpCgkJCWNvbnRpbnVlOwoJCQoJCXZhciBfX2VscyA9IGxheWVyX2dldF9hbGxfZWxlbWVudHMoX19sYXllcnNbX19pXSk7CgkJdmFyIF9fbnVtZWxzID0gYXJyYXlfbGVuZ3RoXzFkKF9fZWxzKTsKCQkKCQl2YXIgX19qOwoJCWZvcihfX2ogPSAwOyBfX2ogPCBfX251bWVsczsgX19qKyspCgkJewoJCQl2YXIgX19lbHR5cGUgPSBsYXllcl9nZXRfZWxlbWVudF90eXBlKF9fZWxzW19fal0pOwoJCQlpZiAoX19lbHR5cGUgPT0gbGF5ZXJlbGVtZW50dHlwZV90aWxlKQoJCQl7CgkJCQlsYXllcl90aWxlX3Zpc2libGUoX19lbHNbX19qXSx0cnVlKTsJCQkKCQkJfQoJCX0JCgl9Cn0KCmZ1bmN0aW9uIHRpbGVfc2V0X2FscGhhKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIGEgdGlsZSdzIGFscGhhICh0cmFuc3BhcmVuY3kpLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUuCgkvLy8gQHBhcmFtIGFscGhhIFRoZSB0cmFuc3BhcmVuY3kgb2YgdGhlIHRpbGUuCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJdmFyIF9fYWxwaGEgPSBhcmd1bWVudDE7CgkKCXJldHVybiBsYXllcl90aWxlX2FscGhhKF9faW5kZXgsIF9fYWxwaGEpOwp9CgpmdW5jdGlvbiB0aWxlX3NldF9iYWNrZ3JvdW5kKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSBiYWNrZ3JvdW5kIGZvciBhIHRpbGUgdG8gYmUgZHJhd24gZnJvbS4KCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSB0aWxlLgoJLy8vIEBwYXJhbSBiYWNrZ3JvdW5kIFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCB0byB0YWtlIHRoZSB0aWxlIGZyb20uCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJdmFyIF9fYmFja2dyb3VuZCA9IGFyZ3VtZW50MTsKCQoJcmV0dXJuIGxheWVyX3RpbGVfY2hhbmdlKF9faW5kZXgsIF9fYmFja2dyb3VuZCk7Cn0KCmZ1bmN0aW9uIHRpbGVfc2V0X2JsZW5kKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIGEgdGlsZSdzIGJsZW5kaW5nLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUuCgkvLy8gQHBhcmFtIGNvbG91ciBUaGUgY29sb3VyIHRvIGJsZW5kIHRoZSB0aWxlIHdpdGguCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJdmFyIF9fY29sb3VyID0gYXJndW1lbnQxOwoJCglyZXR1cm4gbGF5ZXJfdGlsZV9ibGVuZChfX2luZGV4LCBfX2NvbG91cik7Cn0KCmZ1bmN0aW9uIHRpbGVfc2V0X2RlcHRoKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIGEgdGlsZSdzIGRlcHRoLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUgdG8gc2V0LgoJLy8vIEBwYXJhbSBkZXB0aCBUaGUgZGVwdGggb2YgdGhlIHRpbGUuCgkvLy8gQHJldHVybnMKCQoJdmFyIF9faW5kZXggPSBhcmd1bWVudDA7Cgl2YXIgX19kZXB0aCA9IGFyZ3VtZW50MTsKCQoJLy8gU2hvdWxkIHJlYWxseSBjaGVjayBpZiB0aGUgZWxlbWVudCBJRCBwb2ludHMgdG8gYSB0aWxlIChhbmQgbm90IGEgZGlmZmVyZW50IHNvcnQgb2YgZWxlbWVudCkKCXZhciBfX2xheWVyaWQgPSBsYXllcl9nZXRfZWxlbWVudF9sYXllcihfX2luZGV4KTsKCWlmIChfX2xheWVyaWQgPT0gLTEpCgkJcmV0dXJuIC0xOwkvLyBub3QgZm91bmQKCQkKCXZhciBfX2N1cnJkZXB0aCA9IGxheWVyX2dldF9kZXB0aChfX2xheWVyaWQpOwoJaWYgKF9fY3VycmRlcHRoID09IF9fZGVwdGgpCgkJcmV0dXJuIC0xOwkvLyBkZXB0aCBhbHJlYWR5IGNvcnJlY3QKCQkKCS8vIFNjYW4gZm9yIGEgbGF5ZXIgd2l0aCB0aGUgY29ycmVjdCBkZXB0aAoJdmFyIF9fbGF5ZXJzID0gbGF5ZXJfZ2V0X2FsbCgpOwoJdmFyIF9fbnVtbGF5ZXJzID0gYXJyYXlfbGVuZ3RoXzFkKF9fbGF5ZXJzKTsKCQoJdmFyIF9fbGF5ZXJ0b3VzZSA9IC0xOwoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPCBfX251bWxheWVyczsgX19pKyspCgl7CgkJaWYgKGxheWVyX2dldF9kZXB0aChfX2xheWVyc1tfX2ldKSA9PSBfX2RlcHRoKQoJCXsKCQkJLy8gRG9uJ3QgYm90aGVyIGNoZWNraW5nIG5hbWVzIC0gd2UnbGwganVzdCBhZGQgdGlsZXMgdG8gd2hhdGV2ZXIgbGF5ZXIgaXMgaGFuZHkKCQkJX19sYXllcnRvdXNlID0gX19sYXllcnNbX19pXTsKCQkJYnJlYWs7CQkKCQl9Cgl9CgkKCWlmIChfX2xheWVydG91c2UgPT0gLTEpCgl7CgkJLy8gZGlkbid0IGZpbmQgYSBsYXllciBvZiB0aGUgY29ycmVjdCBkZXB0aCwgc28gY3JlYXRlIG9uZQoJCV9fbGF5ZXJ0b3VzZSA9IGxheWVyX2NyZWF0ZShfX2RlcHRoKTsKCX0KCQoJLy8gTm93IG1vdmUgdGhlIHRpbGUgZnJvbSBpdCdzIG9sZCBsYXllciB0byB0aGUgbmV3IG9uZQoJbGF5ZXJfZWxlbWVudF9tb3ZlKF9faW5kZXgsIF9fbGF5ZXJ0b3VzZSk7CgkKCXJldHVybiBsYXllcl9nZXRfZGVwdGgoX19sYXllcmlkKTsKCn0KCmZ1bmN0aW9uIHRpbGVfc2V0X3Bvc2l0aW9uKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSBwb3NpdGlvbiBvZiBhIGdpdmVuIHRpbGUuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgdGlsZS4KCS8vLyBAcGFyYW0geCBUaGUgdGlsZSdzIG5ldyB4IHBvc2l0aW9uLgoJLy8vIEBwYXJhbSB5IFRoZSB0aWxlJ3MgbmV3IHkgcG9zaXRpb24uCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX2luZGV4ID0gYXJndW1lbnQwOwoJdmFyIF9feCA9IGFyZ3VtZW50MTsKCXZhciBfX3kgPSBhcmd1bWVudDI7CgkKCWxheWVyX3RpbGVfeChfX2luZGV4LCBfX3gpOwoJbGF5ZXJfdGlsZV95KF9faW5kZXgsIF9feSk7Cn0KCmZ1bmN0aW9uIHRpbGVfc2V0X3JlZ2lvbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gU2V0cyB0aGUgcmVnaW9uIG9mIGl0cyBiYWNrZ3JvdW5kIGEgdGlsZSBpcyB0YWtlbiBmcm9tLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUuCgkvLy8gQHBhcmFtIGxlZnQgVGhlIHRpbGUncyBsZWZ0IHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBiYWNrZ3JvdW5kJ3MgdG9wIGxlZnQgY29ybmVyLgoJLy8vIEBwYXJhbSB0b3AgVGhlIHRpbGUncyB0b3AgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJhY2tncm91bmQncyB0b3AgbGVmdCBjb3JuZXIuCgkvLy8gQHBhcmFtIHdpZHRoIFRoZSB0aWxlJ3Mgd2lkdGguCgkvLy8gQHBhcmFtIGhlaWdodCBUaGUgdGlsZSdzIGhlaWdodC4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9faW5kZXggPSBhcmd1bWVudDA7Cgl2YXIgX19sZWZ0ID0gYXJndW1lbnQxOwoJdmFyIF9fdG9wID0gYXJndW1lbnQyOwoJdmFyIF9fd2lkdGggPSBhcmd1bWVudDM7Cgl2YXIgX19oZWlnaHQgPSBhcmd1bWVudDQ7CgkKCWxheWVyX3RpbGVfcmVnaW9uKF9faW5kZXgsIF9fbGVmdCwgX190b3AsIF9fd2lkdGgsIF9faGVpZ2h0KTsKfQoKZnVuY3Rpb24gdGlsZV9zZXRfc2NhbGUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFNldHMgYSB0aWxlJ3MgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwgc2NhbGluZy4KCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSB0aWxlLgoJLy8vIEBwYXJhbSB4c2NhbGUgVGhlIHRpbGUncyBob3Jpem9udGFsIHNjYWxlLgoJLy8vIEBwYXJhbSB5c2NhbGUgVGhlIHRpbGUncyB2ZXJ0aWNhbCBzY2FsZS4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9faW5kZXggPSBhcmd1bWVudDA7Cgl2YXIgX194c2NhbGUgPSBhcmd1bWVudDE7Cgl2YXIgX195c2NhbGUgPSBhcmd1bWVudDI7CgkKCWxheWVyX3RpbGVfeHNjYWxlKF9faW5kZXgsIF9feHNjYWxlKTsKCWxheWVyX3RpbGVfeXNjYWxlKF9faW5kZXgsIF9feXNjYWxlKTsKfQoKZnVuY3Rpb24gdGlsZV9zZXRfdmlzaWJsZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gU2V0cyBhIHRpbGUncyB2aXNpYmlsaXR5LgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHRpbGUuCgkvLy8gQHBhcmFtIHZpc2libGUgVGhlIHZpc2liaWxpdHkgb2YgdGhlIHRpbGUuIHRydWU9dmlzaWJsZSwgZmFsc2U9aW52aXNpYmxlLgoJLy8vIEByZXR1cm5zIAoJCgl2YXIgX19pbmRleCA9IGFyZ3VtZW50MDsKCXZhciBfX3Zpc2libGUgPSBhcmd1bWVudDE7CgkKCWxheWVyX3RpbGVfdmlzaWJsZShfX2luZGV4LCBfX3Zpc2libGUpOwp9CgojZW5kcmVnaW9uCiNyZWdpb24gdGV4dHVyZQoKZnVuY3Rpb24gdGV4dHVyZV9zZXRfYmxlbmRpbmcoKQp7Cgl2YXIgX19kdW1teSA9IGFyZ3VtZW50MDsKCQoJc2hvd19kZWJ1Z19tZXNzYWdlKCJ0ZXh0dXJlX3NldF9ibGVuZGluZygpIGN1cnJlbnRseSBub3Qgc3VwcG9ydGVkIik7Cn0KCmZ1bmN0aW9uIHRleHR1cmVfc2V0X2ludGVycG9sYXRpb24oKQp7CglncHVfc2V0X3RleGZpbHRlcihhcmd1bWVudDApOwp9CgpmdW5jdGlvbiB0ZXh0dXJlX3NldF9pbnRlcnBvbGF0aW9uX2V4dCgpCnsKCWdwdV9zZXRfdGV4ZmlsdGVyX2V4dChhcmd1bWVudDAsIGFyZ3VtZW50MSk7Cn0KCmZ1bmN0aW9uIHRleHR1cmVfc2V0X3JlcGVhdCgpCnsKCWdwdV9zZXRfdGV4cmVwZWF0KCBhcmd1bWVudDAgKTsKfQoKZnVuY3Rpb24gdGV4dHVyZV9zZXRfcmVwZWF0X2V4dCgpCnsKCWdwdV9zZXRfdGV4cmVwZWF0X2V4dCggYXJndW1lbnQwLCBhcmd1bWVudDEgKTsKfQoKI2VuZHJlZ2lvbgojcmVnaW9uIHNvdW5kCgpmdW5jdGlvbiBzb3VuZF9hZGQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChEZXByZWNhdGVkKSBhZGQgYSBzb3VuZCByZXNvdXJjZQoJLy8vIEBwYXJhbSBmbmFtZQlUaGUgZmlsZW5hbWUgb2YgdGhlIHNvdW5kIHRvIGFkZC4KCS8vLyBAcGFyYW0ga2luZAkJVGhlIGtpbmQgb2Ygc291bmQgaXQgc2hvdWxkIGJlIGFkZGVkIGFzIChsZWdhY3kgRmVhdHVyZSkgMD1ub3JtYWwsIDE9YmFja2dyb3VuZCwgMj0zRCwgMz1tdWx0aW1lZGlhIHBsYXllciwgZm9yIHRoaW5ncyBsaWtlIE1QM3MpLgoJLy8vIEBwYXJhbSBwcmVsb2FkCVdoZXRoZXIgdGhlIHNvdW5kIHNob3VsZCBwcmVsb2FkIGludG8gbWVtb3J5IGltbWVkaWF0ZWx5ICh0cnVlKSBvciBub3QgKGZhbHNlKSAobGVnYWN5IEZlYXR1cmUpIC4KCXNob3dfZGVidWdfbWVzc2FnZSggInNvdW5kX2FkZCBpcyBub3Qgc3VwcG9ydGVkIik7CglyZXR1cm4gLTE7Cn0KCmZ1bmN0aW9uIHNvdW5kX2RlbGV0ZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRGVsZXRlcyB0aGUgaW5kaWNhdGVkIHNvdW5kIHRvIGZyZWUgaXQgZnJvbSBnYW1lIG1lbW9yeS4gCgkvLy8gQHBhcmFtIGluZGV4CXNvdW5kIGluZGV4CglhdWRpb19kZWxldGUoYXJndW1lbnQwKTsKCQoKfQoKZnVuY3Rpb24gc291bmRfZGlzY2FyZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gc291bmRfZGlzY2FyZCAtIGRlcHJlY2F0ZWQgZnVuY3Rpb24KCS8vLyBAcGFyYW0gaW5kZXgJc291bmQgaW5kZXgKCXNob3dfZGVidWdfbWVzc2FnZSggInNvdW5kX2Rpc2NhcmQgaXMgYSBkZXByZWNhdGVkIGZ1bmN0aW9uIiApOwoJcmV0dXJuIDA7Cn0KCmZ1bmN0aW9uIHNvdW5kX2V4aXN0cygpCnsKCS8vLyBAZGVzY3JpcHRpb24gQ2hlY2tzIHdoZXRoZXIgdGhlIGdpdmVuIHNvdW5kIGV4aXN0cy4gCgkvLy8gQHBhcmFtIGluZGV4CXNvdW5kIGluZGV4CgkvLy8gQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgc291bmQgZXhpc3RzLCBmYWxzZSBvdGhlcndpc2UKCXJldHVybiBhdWRpb19leGlzdHMoYXJndW1lbnQwKTsKCQoKfQoKZnVuY3Rpb24gc291bmRfZmFkZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRmFkZSBhIHNvdW5kIGluIG9yIG91dCBvdmVyIGEgZ2l2ZW4gdGltZS4KCS8vLyBAcGFyYW0gaW5kZXgJc291bmQgaW5kZXgKCS8vLyBAcGFyYW0gdm9sdW1lCVRoZSBmaW5hbCB2b2x1bWUgZnJvbSAwIHRvIDEuCgkvLy8gQHBhcmFtIHRpbWUJCVRoZSBsZW5ndGggZm9yIHRoZSBjaGFuZ2UgaW4gZ2FpbiBpbiBtaWxsaXNlY29uZHMuIAoJYXVkaW9fc291bmRfZ2FpbiggYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiApOwp9CgpmdW5jdGlvbiBzb3VuZF9nZXRfa2luZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gc291bmRfZ2V0X2tpbmQgLSBkZXByZWNhdGVkIGZ1bmN0aW9uCgkvLy8gQHBhcmFtIGluZGV4CXNvdW5kIGluZGV4CglzaG93X2RlYnVnX21lc3NhZ2UoICJzb3VuZF9nZXRfa2luZCAtIGRlcHJlY2F0ZWQgZnVuY3Rpb24iKTsKCXJldHVybiAwOwoKfQoKZnVuY3Rpb24gc291bmRfZ2V0X25hbWUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHJlc291cmNlIG5hbWUgb2YgdGhlIGdpdmVuIHNvdW5kLgoJLy8vIEBwYXJhbSBpbmRleAlzb3VuZCBpbmRleAoJLy8vIEByZXR1cm5zIHtzdHJpbmd9IHJlc291cmNlIG5hbWUgZm9yIHRoZSBnaXZlbiBzb3VuZAoJcmV0dXJuIGF1ZGlvX2dldF9uYW1lKCBhcmd1bWVudDAgKTsKCn0KCmZ1bmN0aW9uIHNvdW5kX2dldF9wcmVsb2FkKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBzb3VuZF9nZXRfcHJlbG9hZCAtIGRlcHJlY2F0ZWQgZnVuY3Rpb24KCS8vLyBAcGFyYW0gaW5kZXgJc291bmQgaW5kZXgKCXNob3dfZGVidWdfbWVzc2FnZSggInNvdW5kX2dldF9wcmVsb2FkIC0gZGVwcmVjYXRlZCBmdW5jdGlvbiIpOwoJcmV0dXJuIDA7Cgp9CgpmdW5jdGlvbiBzb3VuZF9nbG9iYWxfdm9sdW1lKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSB2b2x1bWUgb2YgYWxsIHNvdW5kcwoJLy8vIEBwYXJhbSB2YWx1ZQlUaGUgbmV3IGdsb2JhbCB2b2x1bWUgZnJvbSAwIHRvIDEuCglhdWRpb19tYXN0ZXJfZ2Fpbihhcmd1bWVudDApCgkKCn0KCmZ1bmN0aW9uIHNvdW5kX2lzcGxheWluZygpCnsKCS8vLyBAZGVzY3JpcHRpb24gQ2hlY2tzIHRvIHNlZSBpZiBhIGdpdmVuIHNvdW5kIGlzIHBsYXlpbmcuCgkvLy8gQHBhcmFtIGluZGV4CXNvdW5kIGluZGV4CgkvLy8gQHJldHVybiB7Ym9vbGVhbn0gCglyZXR1cm4gYXVkaW9faXNfcGxheWluZyggYXJndW1lbnQwICk7Cgp9CgpmdW5jdGlvbiBzb3VuZF9sb29wKCkKewoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLy8gQGRlc2NyaXB0aW9uIExvb3BzIHRoZSBpbmRpY2F0ZWQgc291bmQKCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBzb3VuZCB0byBsb29wCgkKCWF1ZGlvX3BsYXlfc291bmQoIGFyZ3VtZW50MCwgMTAsIHRydWUgKTsKCn0KCmZ1bmN0aW9uIHNvdW5kX25hbWUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIHNvdW5kX25hbWUgLSBkZXByZWNhdGVkIGZ1bmN0aW9uCgkvLy8gQHBhcmFtIGluZGV4CXNvdW5kIGluZGV4CglyZXR1cm4gYXVkaW9fZ2V0X25hbWUoIGFyZ3VtZW50MCApOwoKfQoKZnVuY3Rpb24gc291bmRfcGxheSgpCnsKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8vIEBkZXNjcmlwdGlvbiBQbGF5cyB0aGUgaW5kaWNhdGVkIHNvdW5kIG9uY2UuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgc291bmQgdG8gcGxheQoJCglhdWRpb19wbGF5X3NvdW5kKCBhcmd1bWVudDAsIDEwLCBmYWxzZSApOwoKfQoKZnVuY3Rpb24gc291bmRfcmVwbGFjZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKERlcHJlY2F0ZWQpIFJlcGxhY2VzIGFuIGV4aXN0aW5nIHNvdW5kIHdpdGggb25lIGZyb20gYSBnaXZlbiBmaWxlbmFtZQoJLy8vIEBwYXJhbSBpbmRleCAJVGhlIGluZGV4IG9mIHRoZSBzb3VuZCB0byBiZSByZXBsYWNlLgoJLy8vIEBwYXJhbSBmbmFtZQlUaGUgZmlsZW5hbWUgb2YgdGhlIHNvdW5kIHRvIGFkZC4KCS8vLyBAcGFyYW0ga2luZAkJVGhlIGtpbmQgb2Ygc291bmQgaXQgc2hvdWxkIGJlIGFkZGVkIGFzIChsZWdhY3kgRmVhdHVyZSkgMD1ub3JtYWwsIDE9YmFja2dyb3VuZCwgMj0zRCwgMz1tdWx0aW1lZGlhIHBsYXllciwgZm9yIHRoaW5ncyBsaWtlIE1QM3MpLgoJLy8vIEBwYXJhbSBwcmVsb2FkCVdoZXRoZXIgdGhlIHNvdW5kIHNob3VsZCBwcmVsb2FkIGludG8gbWVtb3J5IGltbWVkaWF0ZWx5ICh0cnVlKSBvciBub3QgKGZhbHNlKSAobGVnYWN5IEZlYXR1cmUpIC4KCXNob3dfZGVidWdfbWVzc2FnZSggInNvdW5kX3JlcGxhY2UgaXMgbm90IHN1cHBvcnRlZCIpOwoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBzb3VuZF9yZXN0b3JlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBzb3VuZF9yZXN0b3JlIC0gZGVwcmVjYXRlZCBmdW5jdGlvbgoJLy8vIEBwYXJhbSBpbmRleAlzb3VuZCBpbmRleAoJc2hvd19kZWJ1Z19tZXNzYWdlKCAic291bmRfcmVzdG9yZSBpcyBhIGRlcHJlY2F0ZWQgZnVuY3Rpb24iICk7CglyZXR1cm4gMDsKfQoKZnVuY3Rpb24gc291bmRfc3RvcCgpCnsKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8vIEBkZXNjcmlwdGlvbiBTdG9wcyBhIGdpdmVuIHNvdW5kLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHNvdW5kIHRvIHN0b3AKCQoJYXVkaW9fc3RvcF9zb3VuZCggYXJndW1lbnQwICk7Cgp9CgpmdW5jdGlvbiBzb3VuZF9zdG9wX2FsbCgpCnsKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8vIEBkZXNjcmlwdGlvbiBTdG9wcyBhIGdpdmVuIHNvdW5kLgoJYXVkaW9fc3RvcF9hbGwoKTsKCQoKfQoKZnVuY3Rpb24gc291bmRfdm9sdW1lKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSB2b2x1bWUgb2YgYSBnaXZlbiBzb3VuZC4KCS8vLyBAcGFyYW0gaW5kZXggCVRoZSBpbmRleCBvZiB0aGUgc291bmQgdG8gY2hhbmdlIHRoZSB2b2x1bWUgb2YuCgkvLy8gQHBhcmFtIHZhbHVlCVRoZSBuZXcgZ2xvYmFsIHZvbHVtZSBmcm9tIDAgdG8gMS4KCWF1ZGlvX3NvdW5kX2dhaW4oIGFyZ3VtZW50MCwgYXJndW1lbnQxLCAwKTsKfQoKI2VuZHJlZ2lvbgojcmVnaW9uIG9iamVjdAoKZnVuY3Rpb24gb2JqZWN0X2dldF9kZXB0aCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgZGVwdGggb2YgdGhlIHNwZWNpZmllZCBvYmplY3QuCgkvLy8gQHBhcmFtIHtOdW1iZXJ9IG9iaiBUaGUgaW5kZXggb2YgdGhlIG9iamVjdCB0byBjaGVjawoJLy8vIEByZXR1cm4ge051bWJlcn0gZGVwdGggb2YgdGhlIG9iamVjdAoJCgl2YXIgb2JqSUQgPSBhcmd1bWVudDA7Cgl2YXIgcmV0ID0gMDsKCWlmIChvYmpJRCA+PSAwKSAmJiAob2JqSUQgPCBhcnJheV9sZW5ndGhfMWQoZ2xvYmFsLl9fb2JqZWN0SUQyRGVwdGgpKSB7CgkJcmV0ID0gZ2xvYmFsLl9fb2JqZWN0SUQyRGVwdGhbb2JqSURdOwoJfSAvLyBlbmQgaWYKCXJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIG9iamVjdF9zZXRfZGVwdGgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFNldHMgdGhlIGRlcHRoIG9mIHRoZSBnaXZlbiBvYmplY3QuCgkvLy8gQHBhcmFtIHtOdW1iZXJ9IGluZGV4IFRoZSBpbmRleCBvZiB0aGUgb2JqZWN0IHRvIGNoYW5nZQoJLy8vIEBwYXJhbSB7TnVtYmVyfSBkZXB0aCBUaGUgbmV3IGRlcHRoIG9mIHRoZSBvYmplY3QKCXZhciBvYmpJRCA9IGFyZ3VtZW50MDsKCWlmIChvYmplY3RfZXhpc3RzKG9iaklEKSkgewoJCXdpdGgoIG9iaklEICkgewoJCQlnbG9iYWwuX19vYmplY3RJRDJEZXB0aFtpZF0gPSBhcmd1bWVudDE7CgkJfSAvLyBlbmQgd2l0aAoJfSAvLyBlbmQgaWYKCn0KCiNlbmRyZWdpb24KI3JlZ2lvbiBqb3lzdGljawoKZnVuY3Rpb24gam95c3RpY2tfYXhlcygpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGF4ZXMgdGhlIGpveXN0aWNrIGhhcy4KCS8vLyBAcGFyYW0gaWQJdGhlIGlkIG9mIHRoZSBqb3lzdGljayAoMSBvciAyKQoJdmFyIGppZD1fX2pveXN0aWNrXzJfZ2FtZXBhZChhcmd1bWVudDApOwoJcmV0dXJuIGdhbWVwYWRfYXhpc19jb3VudChqaWQpOwp9CgpmdW5jdGlvbiBqb3lzdGlja19idXR0b25zKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgYnV0dG9ucyB0aGUgam95c3RpY2sgaGFzLgoJLy8vIEBwYXJhbSBpZAl0aGUgaWQgb2YgdGhlIGpveXN0aWNrICgxIG9yIDIpCgkKCXZhciBqaWQ9X19qb3lzdGlja18yX2dhbWVwYWQoYXJndW1lbnQwKTsKCXJldHVybiBnYW1lcGFkX2J1dHRvbl9jb3VudChqaWQpOwp9CgpmdW5jdGlvbiBqb3lzdGlja19jaGVja19idXR0b24oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIENoZWNrcyB0byBzZWUgaWYgYSBqb3lzdGljayBidXR0b24gaGFzIGJlZW4gcHJlc3NlZC4KCS8vLyBAcGFyYW0gaWQJdGhlIGlkIG9mIHRoZSBqb3lzdGljayAoMSBvciAyKQoJLy8vIEBwYXJhbSBudW1iIFRoZSBudW1iZXIgb2YgdGhlIGJ1dHRvbiB0byBjaGVjayAoZnJvbSAxIHRvIDMyKS4KCS8vLyBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIHNlbGVjdGVkIGJ1dHRvbiBwcmVzc2VkIC8gZmFsc2Ugb3RoZXJ3aXNlCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CgkKCXZhciBidXR0b24gPSAwOwoJc3dpdGNoKCBhcmd1bWVudDEgKQoJewoJY2FzZSAwOglidXR0b24gPSBncF9mYWNlMTsgYnJlYWs7CgljYXNlIDE6CWJ1dHRvbiA9IGdwX2ZhY2UyOyBicmVhazsKCWNhc2UgMjoJYnV0dG9uID0gZ3BfZmFjZTM7IGJyZWFrOwoJY2FzZSAzOglidXR0b24gPSBncF9mYWNlNDsgYnJlYWs7CgljYXNlIDQ6CWJ1dHRvbiA9IGdwX3Nob3VsZGVybDsgYnJlYWs7CgljYXNlIDU6CWJ1dHRvbiA9IGdwX3Nob3VsZGVybGI7IGJyZWFrOwoJY2FzZSA2OglidXR0b24gPSBncF9zaG91bGRlcnI7IGJyZWFrOwoJY2FzZSA3OglidXR0b24gPSBncF9zaG91bGRlcnJiOyBicmVhazsKCWNhc2UgODoJYnV0dG9uID0gZ3Bfc2VsZWN0OyBicmVhazsKCWNhc2UgOToJYnV0dG9uID0gZ3Bfc3RhcnQ7IGJyZWFrOwoJY2FzZSAxMDogYnV0dG9uID0gZ3Bfc3RpY2tsOyBicmVhazsKCWNhc2UgMTE6IGJ1dHRvbiA9IGdwX3N0aWNrcjsgYnJlYWs7CglkZWZhdWx0OgoJCWJ1dHRvbiA9IGFyZ3VtZW50MTsKCQlicmVhazsKCX0KCQoJcmV0dXJuIChnYW1lcGFkX2J1dHRvbl92YWx1ZShqaWQsIGJ1dHRvbikgIT0gMCk7Cn0KCmZ1bmN0aW9uIGpveXN0aWNrX2RpcmVjdGlvbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gQ2hlY2tzIHRvIHNlZSBpZiBhIGpveXN0aWNrIGJ1dHRvbiBoYXMgYmVlbiBwcmVzc2VkLgoJLy8vIEBwYXJhbSBpZAl0aGUgaWQgb2YgdGhlIGpveXN0aWNrICgxIG9yIDIpCgkvLy8gQHJldHVybiAge051bWJlcn0gdmlydHVhbCBrZXkgY29kZSBmb3IgdGhlIG51bWJlcnBhZCBidXR0b25zIGRlcGVuZGluZyBvbiBkaXJlY3Rpb24gYmVpbmcgcHJlc3NlZCBieSB0aGUgam95c3RpY2svZ2FtZXBhZCB3aXRoIHRoZSBnaXZlbiBpZAoJdmFyIGppZD1fX2pveXN0aWNrXzJfZ2FtZXBhZChhcmd1bWVudDApOwoJCgl2YXIgaGF4aXMgPSBnYW1lcGFkX2F4aXNfdmFsdWUoIGppZCwgZ3BfYXhpc2xoICk7Cgl2YXIgdmF4aXMgPSBnYW1lcGFkX2F4aXNfdmFsdWUoIGppZCwgZ3BfYXhpc2x2ICk7CgkKCXZhciBkaXIgPSAwOwoJaWYgKHZheGlzIDwgLTAuMykKCQlkaXIgPSA2OwoJZWxzZQoJaWYgKHZheGlzID4gMC4zKQoJCWRpciA9IDA7CgllbHNlCgkJZGlyID0gMzsKCQoJaWYgKGhheGlzIDwgLTAuMykKCQlkaXIgKz0gMTsKCWVsc2UKCWlmIChoYXhpcyA+IDAuMykKCQlkaXIgKz0gMzsKCWVsc2UgCgkJZGlyICs9IDI7CgkKCXJldHVybiB2a19udW1wYWQwK2RpcjsKfQoKZnVuY3Rpb24gam95c3RpY2tfZXhpc3RzKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBDaGVja3MgZm9yIGEgam95c3RpY2suCgkvLy8gQHBhcmFtIGlkCXRoZSBpZCBvZiB0aGUgam95c3RpY2sgKDEgb3IgMikKCS8vLyBAcmV0dXJuICB7Qm9vbGVhbn0gdHJ1ZSBpZiBhIGpveXN0aWNrL2dhbWVwYWQgd2l0aCB0aGUgZ2l2ZW4gaWQgaXMgY29ubmVjdGVkIG9yIGZhbHNlIGlmIGl0IGlzIG5vdAoJCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CglyZXR1cm4gZ2FtZXBhZF9pc19jb25uZWN0ZWQoamlkKTsKfQoKZnVuY3Rpb24gam95c3RpY2tfaGFzX3BvdigpCnsKCS8vLyBAZGVzY3JpcHRpb24gQ2hlY2tzIHRoZSBwb2ludCBvZiB2aWV3IGNhcGFiaWxpdGllcyBvZiB0aGUgam95c3RpY2suCgkvLy8gQHBhcmFtIGlkCXRoZSBpZCBvZiB0aGUgam95c3RpY2sgKDEgb3IgMikKCS8vLyBAcmV0dXJuICB7Qm9vbGVhbn0gdHJ1ZSBpZiB0aGUgam95c3RpY2svZ2FtZXBhZCB3aXRoIHRoZSBnaXZlbiBpZCBoYXMgcG9pbnQgb2YgdmlldyBjYXBhYmlsaXRpZXMgb3IgZmFsc2UgaWYgaXQgZG9lcyBub3QKCQoJcmV0dXJuIHRydWU7Cgp9CgpmdW5jdGlvbiBqb3lzdGlja19uYW1lKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRoZSBuYW1lIG9mIHRoZSBqb3lzdGljay4KCS8vLyBAcGFyYW0gaWQJdGhlIGlkIG9mIHRoZSBqb3lzdGljayAoMSBvciAyKQoJCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CglyZXR1cm4gZ2FtZXBhZF9nZXRfZGVzY3JpcHRpb24oamlkKTsKfQoKZnVuY3Rpb24gam95c3RpY2tfcG92KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRoZSBuYW1lIG9mIHRoZSBqb3lzdGljay4KCS8vLyBAcGFyYW0gaWQJdGhlIGlkIG9mIHRoZSBqb3lzdGljayAoMSBvciAyKQoJLy8vIEByZXR1cm4ge051bWJlcn0gdGhlIHBvaW50LW9mIHZpZXcgcG9zaXRpb24gb2YgdGhlIGpveXN0aWNrL2dhbWVwYWQgd2l0aCB0aGUgZ2l2ZW4gaWQuIFRoaXMgaXMgYW4gYW5nbGUgYmV0d2VlbiAwIGFuZCAzNjAgZGVncmVlcywgd2hlcmUgMCBpcyBmb3J3YXJkcywgOTAgdG8gdGhlIHJpZ2h0LCAxODAgYmFja3dhcmRzIGFuZCAyNzAgdG8gdGhlIGxlZnQKCQoJdmFyIGppZD1fX2pveXN0aWNrXzJfZ2FtZXBhZChhcmd1bWVudDApOwoJCgl2YXIgbWFzayA9IDA7CgltYXNrIHw9IChnYW1lcGFkX2J1dHRvbl92YWx1ZSggamlkLCBncF9wYWR1KSA+IDApID8gMSA6IDA7CgltYXNrIHw9IChnYW1lcGFkX2J1dHRvbl92YWx1ZSggamlkLCBncF9wYWRyKSA+IDApID8gMiA6IDA7CgltYXNrIHw9IChnYW1lcGFkX2J1dHRvbl92YWx1ZSggamlkLCBncF9wYWRkKSA+IDApID8gNCA6IDA7CgltYXNrIHw9IChnYW1lcGFkX2J1dHRvbl92YWx1ZSggamlkLCBncF9wYWRsKSA+IDApID8gOCA6IDA7CgkKCXJldHVybiBnbG9iYWwuX19qc3RpY2tfcG92YW5nbGVbbWFza107CgkKCn0KCmZ1bmN0aW9uIGpveXN0aWNrX3Byb2Nlc3NfZXZlbnRzKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBQcm9jZXNzIGpveXN0aWNrIGV2ZW50cyAoc2luY2UgdGhlIFJ1bm5lciBubyBsb25nZXIgcHJvY2Vzc2VzIHRoZW0gZGlyZWN0bHkpCglpZiAoYXJndW1lbnRfY291bnQgPiAwKSBhbmQgKGFyZ3VtZW50WzBdID4gMCkgcmV0dXJuOwoJCgkvLyBjaGVjayB0byBzZWUgaWYgam95c3RpY2sgMSBleGlzdHMgYW5kIHByb2Nlc3MgaXRzIGV2ZW50cwoJaWYgKGpveXN0aWNrX2V4aXN0cygxKSkgewoJCgkJdmFyIHhheGlzID0gam95c3RpY2tfeHBvcygxKTsKCQlpZiAoeGF4aXMgPCAtMC4zKSBldmVudF9wZXJmb3JtKGV2X21vdXNlLCBldl9qb3lzdGljazFfbGVmdCApOwoJCWlmICh4YXhpcyA+ICAwLjMpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV9yaWdodCApOwoJCQoJCXZhciB5YXhpcyA9IGpveXN0aWNrX3lwb3MoMSk7CgkJaWYgKHlheGlzIDwgLTAuMykgZXZlbnRfcGVyZm9ybShldl9tb3VzZSwgZXZfam95c3RpY2sxX3VwICk7CgkJaWYgKHlheGlzID4gIDAuMykgZXZlbnRfcGVyZm9ybShldl9tb3VzZSwgZXZfam95c3RpY2sxX2Rvd24gKTsKCQoJCWlmIChqb3lzdGlja19jaGVja19idXR0b24oMSwgMCkpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV9idXR0b24xICk7CgkJaWYgKGpveXN0aWNrX2NoZWNrX2J1dHRvbigxLCAxKSkgZXZlbnRfcGVyZm9ybShldl9tb3VzZSwgZXZfam95c3RpY2sxX2J1dHRvbjIgKTsKCQlpZiAoam95c3RpY2tfY2hlY2tfYnV0dG9uKDEsIDIpKSBldmVudF9wZXJmb3JtKGV2X21vdXNlLCBldl9qb3lzdGljazFfYnV0dG9uMyApOwoJCWlmIChqb3lzdGlja19jaGVja19idXR0b24oMSwgMykpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV9idXR0b240ICk7CgkJaWYgKGpveXN0aWNrX2NoZWNrX2J1dHRvbigxLCA0KSkgZXZlbnRfcGVyZm9ybShldl9tb3VzZSwgZXZfam95c3RpY2sxX2J1dHRvbjUgKTsKCQlpZiAoam95c3RpY2tfY2hlY2tfYnV0dG9uKDEsIDUpKSBldmVudF9wZXJmb3JtKGV2X21vdXNlLCBldl9qb3lzdGljazFfYnV0dG9uNiApOwoJCWlmIChqb3lzdGlja19jaGVja19idXR0b24oMSwgNikpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV9idXR0b243ICk7CgkJaWYgKGpveXN0aWNrX2NoZWNrX2J1dHRvbigxLCA3KSkgZXZlbnRfcGVyZm9ybShldl9tb3VzZSwgZXZfam95c3RpY2sxX2J1dHRvbjggKTsKCX0KCQoJLy8gY2hlY2sgdG8gc2VlIGlmIGpveXN0aWNrIDEgZXhpc3RzIGFuZCBwcm9jZXNzIGl0cyBldmVudHMKCWlmIChqb3lzdGlja19leGlzdHMoMikpIHsKCQoJCXZhciB4YXhpcyA9IGpveXN0aWNrX3hwb3MoMik7CgkJaWYgKHhheGlzIDwgLTAuMykgZXZlbnRfcGVyZm9ybShldl9tb3VzZSwgZXZfam95c3RpY2sxX2xlZnQgKTsKCQlpZiAoeGF4aXMgPiAgMC4zKSBldmVudF9wZXJmb3JtKGV2X21vdXNlLCBldl9qb3lzdGljazFfcmlnaHQgKTsKCQkKCQl2YXIgeWF4aXMgPSBqb3lzdGlja195cG9zKDIpOwoJCWlmICh5YXhpcyA8IC0wLjMpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV91cCApOwoJCWlmICh5YXhpcyA+ICAwLjMpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV9kb3duICk7CgkKCQlpZiAoam95c3RpY2tfY2hlY2tfYnV0dG9uKDIsIDApKSBldmVudF9wZXJmb3JtKGV2X21vdXNlLCBldl9qb3lzdGljazFfYnV0dG9uMSApOwoJCWlmIChqb3lzdGlja19jaGVja19idXR0b24oMiwgMSkpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV9idXR0b24yICk7CgkJaWYgKGpveXN0aWNrX2NoZWNrX2J1dHRvbigyLCAyKSkgZXZlbnRfcGVyZm9ybShldl9tb3VzZSwgZXZfam95c3RpY2sxX2J1dHRvbjMgKTsKCQlpZiAoam95c3RpY2tfY2hlY2tfYnV0dG9uKDIsIDMpKSBldmVudF9wZXJmb3JtKGV2X21vdXNlLCBldl9qb3lzdGljazFfYnV0dG9uNCApOwoJCWlmIChqb3lzdGlja19jaGVja19idXR0b24oMiwgNCkpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV9idXR0b241ICk7CgkJaWYgKGpveXN0aWNrX2NoZWNrX2J1dHRvbigyLCA1KSkgZXZlbnRfcGVyZm9ybShldl9tb3VzZSwgZXZfam95c3RpY2sxX2J1dHRvbjYgKTsKCQlpZiAoam95c3RpY2tfY2hlY2tfYnV0dG9uKDIsIDYpKSBldmVudF9wZXJmb3JtKGV2X21vdXNlLCBldl9qb3lzdGljazFfYnV0dG9uNyApOwoJCWlmIChqb3lzdGlja19jaGVja19idXR0b24oMiwgNykpIGV2ZW50X3BlcmZvcm0oZXZfbW91c2UsIGV2X2pveXN0aWNrMV9idXR0b244ICk7Cgl9Cn0KCmZ1bmN0aW9uIGpveXN0aWNrX3Jwb3MoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHBvc2l0aW9uIG9mIHRoZSByLWF4aXMgb2Ygam95c3RpY2suCgkvLy8gQHBhcmFtIGlkCXRoZSBpZCBvZiB0aGUgam95c3RpY2sgKDEgb3IgMikKCS8vLyBAcmV0dXJuIHtOdW1iZXJ9IHRoZSBwb3NpdGlvbiBvZiB0aGUgci1heGlzIG9mIHRoZSBqb3lzdGljay9nYW1lcGFkIHdpdGggdGhlIGdpdmVuIGlkLCB3aXRoIHRoZSB2YWx1ZSBiZWluZyBzb21ld2hlcmUgYmV0d2VlbiAtMSBhbmQgMQoJCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CgkKCXJldHVybiBnYW1lcGFkX2F4aXNfdmFsdWUoIGppZCwgMyk7Cn0KCmZ1bmN0aW9uIGpveXN0aWNrX3Vwb3MoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHBvc2l0aW9uIG9mIHRoZSB1LWF4aXMgb2Ygam95c3RpY2suCgkvLy8gQHBhcmFtIGlkCXRoZSBpZCBvZiB0aGUgam95c3RpY2sgKDEgb3IgMikKCS8vLyBAcmV0dXJuIHtOdW1iZXJ9IHRoZSBwb3NpdGlvbiBvZiB0aGUgdS1heGlzIG9mIHRoZSBqb3lzdGljay9nYW1lcGFkIHdpdGggdGhlIGdpdmVuIGlkLCB3aXRoIHRoZSB2YWx1ZSBiZWluZyBzb21ld2hlcmUgYmV0d2VlbiAtMSBhbmQgMQoJCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CgkKCXJldHVybiBnYW1lcGFkX2F4aXNfdmFsdWUoIGppZCwgNCk7Cn0KCmZ1bmN0aW9uIGpveXN0aWNrX3Zwb3MoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHBvc2l0aW9uIG9mIHRoZSB2LWF4aXMgb2Ygam95c3RpY2suCgkvLy8gQHBhcmFtIGlkCXRoZSBpZCBvZiB0aGUgam95c3RpY2sgKDEgb3IgMikKCS8vLyBAcmV0dXJuIHtOdW1iZXJ9IHRoZSBwb3NpdGlvbiBvZiB0aGUgdi1heGlzIG9mIHRoZSBqb3lzdGljay9nYW1lcGFkIHdpdGggdGhlIGdpdmVuIGlkLCB3aXRoIHRoZSB2YWx1ZSBiZWluZyBzb21ld2hlcmUgYmV0d2VlbiAtMSBhbmQgMQoJCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CgkKCXJldHVybiBnYW1lcGFkX2F4aXNfdmFsdWUoIGppZCwgNSk7Cn0KCmZ1bmN0aW9uIGpveXN0aWNrX3hwb3MoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHBvc2l0aW9uIG9mIHRoZSB4LWF4aXMgb2Ygam95c3RpY2suCgkvLy8gQHBhcmFtIGlkCXRoZSBpZCBvZiB0aGUgam95c3RpY2sgKDEgb3IgMikKCS8vLyBAcmV0dXJuIHtOdW1iZXJ9IHRoZSBwb3NpdGlvbiBvZiB0aGUgeC1heGlzIG9mIHRoZSBqb3lzdGljay9nYW1lcGFkIHdpdGggdGhlIGdpdmVuIGlkLCB3aXRoIHRoZSB2YWx1ZSBiZWluZyBzb21ld2hlcmUgYmV0d2VlbiAtMSBhbmQgMQoJCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CgkKCXJldHVybiBnYW1lcGFkX2F4aXNfdmFsdWUoIGppZCwgMCk7Cn0KCmZ1bmN0aW9uIGpveXN0aWNrX3lwb3MoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHBvc2l0aW9uIG9mIHRoZSB5eC1heGlzIG9mIGpveXN0aWNrLgoJLy8vIEBwYXJhbSBpZAl0aGUgaWQgb2YgdGhlIGpveXN0aWNrICgxIG9yIDIpCgkvLy8gQHJldHVybiB7TnVtYmVyfSB0aGUgcG9zaXRpb24gb2YgdGhlIHktYXhpcyBvZiB0aGUgam95c3RpY2svZ2FtZXBhZCB3aXRoIHRoZSBnaXZlbiBpZCwgd2l0aCB0aGUgdmFsdWUgYmVpbmcgc29tZXdoZXJlIGJldHdlZW4gLTEgYW5kIDEKCQoJCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CgkKCXJldHVybiBnYW1lcGFkX2F4aXNfdmFsdWUoIGppZCwgMSk7Cn0KCmZ1bmN0aW9uIGpveXN0aWNrX3pwb3MoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHBvc2l0aW9uIG9mIHRoZSB6LWF4aXMgb2Ygam95c3RpY2suCgkvLy8gQHBhcmFtIGlkCXRoZSBpZCBvZiB0aGUgam95c3RpY2sgKDEgb3IgMikKCS8vLyBAcmV0dXJuIHtOdW1iZXJ9IHRoZSBwb3NpdGlvbiBvZiB0aGUgei1heGlzIG9mIHRoZSBqb3lzdGljay9nYW1lcGFkIHdpdGggdGhlIGdpdmVuIGlkLCB3aXRoIHRoZSB2YWx1ZSBiZWluZyBzb21ld2hlcmUgYmV0d2VlbiAtMSBhbmQgMQoJCgl2YXIgamlkPV9fam95c3RpY2tfMl9nYW1lcGFkKGFyZ3VtZW50MCk7CgkKCXJldHVybiBnYW1lcGFkX2F4aXNfdmFsdWUoIGppZCwgMik7Cn0KCmZ1bmN0aW9uIF9faW5pdF9qb3lzdGljaygpCnsKCWdtbF9wcmFnbWEoICJnbG9iYWwiLCAiX19pbml0X2pveXN0aWNrKCk7Iik7CgkvLyNtYWNybyBfX0pPWVNUSUNLXzJfR0FNRVBBRAkoYXJndW1lbnQwID09IDIpID8gZ2xvYmFsLl9fanN0aWNrX3BhZDIgOiBnbG9iYWwuX19qc3RpY2tfcGFkMQoJZ2xvYmFsLl9fanN0aWNrX3BhZDE9NDsKCWdsb2JhbC5fX2pzdGlja19wYWQyPTU7CglnbG9iYWwuX19qc3RpY2tfcG92YW5nbGUgPSBbCgkJCQkJCQkJCS0xLAkJLy8gMCAtIGNlbnRlcmVkCgkJCQkJCQkJCTAsCQkvLyAxIC0gdXAKCQkJCQkJCQkJOTAsCQkvLyAyIC0gcmlnaHQKCQkJCQkJCQkJNDUsCQkvLyAzIC0gdXAgYW5kIHJpZ2h0CgkJCQkJCQkJCTE4MCwJLy8gNCAtIGRvd24KCQkJCQkJCQkJLTEsCQkvLyA1IC0gZG93biBhbmQgdXAgKGludmFsaWQpCgkJCQkJCQkJCTEzNSwJLy8gNiAtIGRvd24gYW5kIHJpZ2h0CgkJCQkJCQkJCS0xLAkJLy8gNyAtIGRvd24sIHVwIGFuZCByaWdodCAoaW52YWxpZCkKCQkJCQkJCQkJMjcwLAkvLyA4IC0gbGVmdAoJCQkJCQkJCQkzMTUsCS8vIDkgLSBsZWZ0IGFuZCB1cAoJCQkJCQkJCQktMSwJCS8vIDEwIC0gbGVmdCBhbmQgcmlnaHQgKGludmFsaWQpCgkJCQkJCQkJCS0xLAkJLy8gMTEgLSBsZWZ0LCB1cCBhbmQgcmlnaHQgKGludmFsaWQpCgkJCQkJCQkJCTIyNSwJLy8gMTIgLSBsZWZ0IGFuZCBkb3duCgkJCQkJCQkJCS0xLAkJLy8gMTMgLSBsZWZ0LCBkb3duIGFuZCB1cCAoaW52YWxpZCkKCQkJCQkJCQkJLTEsCQkvLyAxNCAtIGxlZnQsIGRvd24gYW5kIHJpZ2h0IChpbnZhbGlkKQoJCQkJCQkJCQktMSwJCS8vIDE2IC0gbGVmdCwgcmlnaHQsIHVwIGFuZCBkb3duIChpbnZhbGlkKQoJCQkJCQkJCV07CgkKCQoJLy8gcmVmZXJlbmNlIHRoZSBmdW5jdGlvbiB0byBlbnN1cmUgdGhhdCBpdCBpcyBicm91Z2h0IGluCglqb3lzdGlja19wcm9jZXNzX2V2ZW50cyh0cnVlKTsKfQoKZnVuY3Rpb24gX19qb3lzdGlja18yX2dhbWVwYWQoKQp7CglpZiAoYXJndW1lbnQwID09IDIpIAoJCXJldHVybiBnbG9iYWwuX19qc3RpY2tfcGFkMjsKCWVsc2UKCQlyZXR1cm4gZ2xvYmFsLl9fanN0aWNrX3BhZDE7Cgp9CgojZW5kcmVnaW9uCiNyZWdpb24gaW5zdGFuY2UKCmZ1bmN0aW9uIGluc3RhbmNlX2NyZWF0ZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBhIGdpdmVuIG9iamVjdCBhdCBhIGdpdmVuIHBvc2l0aW9uLgoJLy8vIEBwYXJhbSB4IFRoZSB4IHBvc2l0aW9uIHRoZSBvYmplY3Qgd2lsbCBiZSBjcmVhdGVkIGF0LgoJLy8vIEBwYXJhbSB5IFRoZSB5IHBvc2l0aW9uIHRoZSBvYmplY3Qgd2lsbCBiZSBjcmVhdGVkIGF0LgoJLy8vIEBwYXJhbSBvYmogVGhlIG9iamVjdCB0byBjcmVhdGUgYW4gaW5zdGFuY2Ugb2YuCgl2YXIgbXlEZXB0aCA9IG9iamVjdF9nZXRfZGVwdGgoIGFyZ3VtZW50MiApOwoJcmV0dXJuIGluc3RhbmNlX2NyZWF0ZV9kZXB0aCggYXJndW1lbnQwLCBhcmd1bWVudDEsIG15RGVwdGgsIGFyZ3VtZW50MiApOwoKfQoKI2VuZHJlZ2lvbgojcmVnaW9uIGRyYXcKCmZ1bmN0aW9uIGRyYXdfZW5hYmxlX2FscGhhYmxlbmQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFNldHMgdGhlIGJsZW5kIG1vZGUgZm9yIGRyYXdpbmcuCgkvLy8gQHBhcmFtIG1vZGUgVGhlIGJsZW5kIG1vZGUgY29uc3RhbnQgdG8gc2V0IHRvIAoJZ3B1X3NldF9ibGVuZGVuYWJsZSggYXJndW1lbnQwICk7Cn0KCmZ1bmN0aW9uIGRyYXdfZ2V0X2FscGhhX3Rlc3QoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFNldHMgdGhlIGJsZW5kIG1vZGUgZm9yIGRyYXdpbmcuCgkvLy8gQHBhcmFtIG1vZGUgVGhlIGJsZW5kIG1vZGUgY29uc3RhbnQgdG8gc2V0IHRvIAoJcmV0dXJuIGdwdV9nZXRfYWxwaGF0ZXN0ZW5hYmxlKCk7Cn0KCmZ1bmN0aW9uIGRyYXdfZ2V0X2FscGhhX3Rlc3RfcmVmX3ZhbHVlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSBibGVuZCBtb2RlIGZvciBkcmF3aW5nLgoJLy8vIEBwYXJhbSBtb2RlIFRoZSBibGVuZCBtb2RlIGNvbnN0YW50IHRvIHNldCB0byAKCXJldHVybiBncHVfZ2V0X2FscGhhdGVzdHJlZigpOwp9CgpmdW5jdGlvbiBkcmF3X3NldF9hbHBoYV90ZXN0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSBibGVuZCBtb2RlIGZvciBkcmF3aW5nLgoJLy8vIEBwYXJhbSBtb2RlIFRoZSBibGVuZCBtb2RlIGNvbnN0YW50IHRvIHNldCB0byAKCWdwdV9zZXRfYWxwaGF0ZXN0ZW5hYmxlKCBhcmd1bWVudDAgKTsKfQoKZnVuY3Rpb24gZHJhd19zZXRfYWxwaGFfdGVzdF9yZWZfdmFsdWUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFNldHMgdGhlIGJsZW5kIG1vZGUgZm9yIGRyYXdpbmcuCgkvLy8gQHBhcmFtIG1vZGUgVGhlIGJsZW5kIG1vZGUgY29uc3RhbnQgdG8gc2V0IHRvIAoJZ3B1X3NldF9hbHBoYXRlc3RyZWYoIGFyZ3VtZW50MCApOwp9CgpmdW5jdGlvbiBkcmF3X3NldF9ibGVuZF9tb2RlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIHRoZSBibGVuZCBtb2RlIGZvciBkcmF3aW5nLgoJLy8vIEBwYXJhbSBtb2RlIFRoZSBibGVuZCBtb2RlIGNvbnN0YW50IHRvIHNldCB0byAKCWdwdV9zZXRfYmxlbmRtb2RlKCBhcmd1bWVudDAgKTsKfQoKZnVuY3Rpb24gZHJhd19zZXRfYmxlbmRfbW9kZV9leHQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFNldHMgYW4gZXh0ZW5kZWQgYmxlbmQgbW9kZSBmb3IgZHJhd2luZy4KCS8vLyBAcGFyYW0gc3JjIFNvdXJjZSBibGVuZCBtb2RlCgkvLy8gQHBhcmFtIGRlc3QgRGVzdGluYXRpb24gYmxlbmQgbW9kZQoJZ3B1X3NldF9ibGVuZG1vZGVfZXh0KCBhcmd1bWVudDAsIGFyZ3VtZW50MSApOwp9CgpmdW5jdGlvbiBkcmF3X3NldF9jb2xvcl93cml0ZV9lbmFibGUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFNldHMgdGhlIGJsZW5kIG1vZGUgZm9yIGRyYXdpbmcuCgkvLy8gQHBhcmFtIG1vZGUgVGhlIGJsZW5kIG1vZGUgY29uc3RhbnQgdG8gc2V0IHRvIAoJZ3B1X3NldF9jb2xvcndyaXRlZW5hYmxlKCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDMgKTsKfQoKZnVuY3Rpb24gZHJhd19zZXRfY29sb3VyX3dyaXRlX2VuYWJsZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gU2V0cyB0aGUgYmxlbmQgbW9kZSBmb3IgZHJhd2luZy4KCS8vLyBAcGFyYW0gbW9kZSBUaGUgYmxlbmQgbW9kZSBjb25zdGFudCB0byBzZXQgdG8gCglncHVfc2V0X2NvbG9yd3JpdGVlbmFibGUoIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MyApOwp9CgojZW5kcmVnaW9uCiNyZWdpb24gZDNkCgpmdW5jdGlvbiBkM2RfZHJhd19ibG9jaygpCnsKCS8vLyBAZGVzY3JpcHRpb24gRHJhd3MgYSBzaW1wbGUgM0QgYmxvY2suCgkvLy8gQHBhcmFtIHgxIFRoZSBpbml0aWFsIHggY29vcmRpbmF0ZSBvZiB0aGUgYmxvY2suIAoJLy8vIEBwYXJhbSB5MSBUaGUgaW5pdGlhbCB5IGNvb3JkaW5hdGUgb2YgdGhlIGJsb2NrLgoJLy8vIEBwYXJhbSB6MSBUaGUgaW5pdGlhbCB6IGNvb3JkaW5hdGUgb2YgdGhlIGJsb2NrLgoJLy8vIEBwYXJhbSB4MiBUaGUgb3Bwb3NpdGUgeCBjb29yZGluYXRlIG9mIHRoZSBibG9jay4KCS8vLyBAcGFyYW0geTIgVGhlIG9wcG9zaXRlIHkgY29vcmRpbmF0ZSBvZiB0aGUgYmxvY2suCgkvLy8gQHBhcmFtIHoyIFRoZSBvcHBvc2l0ZSB6IGNvb3JkaW5hdGUgb2YgdGhlIGJsb2NrLgoJLy8vIEBwYXJhbSB0ZXggVGhlIGlkIG9mIHRoZSB0ZXh0dXJlIHRvIHVzZSAoLTEgZm9yIG5vIHRleHR1cmUpCgkvLy8gQHBhcmFtIGhyZXBlYXQgQW1vdW50IG9mIGhvcml6b250YWwgcmVwZXRpdGlvbnMgZm9yIHRoZSB0ZXh0dXJlLgoJLy8vIEBwYXJhbSB2cmVwZWF0IEFtb3VudCBvZiB2ZXJ0aWNhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX3gxID0gYXJndW1lbnQwOwoJdmFyIF9feTEgPSBhcmd1bWVudDE7Cgl2YXIgX196MSA9IGFyZ3VtZW50MjsKCXZhciBfX3gyID0gYXJndW1lbnQzOwoJdmFyIF9feTIgPSBhcmd1bWVudDQ7Cgl2YXIgX196MiA9IGFyZ3VtZW50NTsKCXZhciBfX3RleCA9IGFyZ3VtZW50NjsKCXZhciBfX2hyZXBlYXQgPSBhcmd1bWVudDc7Cgl2YXIgX192cmVwZWF0ID0gYXJndW1lbnQ4OwoJCgl2YXIgX19vbGRyZXAgPSBncHVfZ2V0X3RleHJlcGVhdCgpOwoJZ3B1X3NldF90ZXhyZXBlYXQodHJ1ZSkJCgkKCWQzZF9wcmltaXRpdmVfYmVnaW5fdGV4dHVyZShwcl90cmlhbmdsZWxpc3QsIF9fdGV4KTsKCQoJCglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTEsIF9fejEsIDAsIDAsIC0xLCAwLCAwKTsKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MiwgX196MSwgMCwgMCwgLTEsIDAsIF9fdnJlcGVhdCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDIsIF9feTIsIF9fejEsIDAsIDAsIC0xLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MiwgX195MiwgX196MSwgMCwgMCwgLTEsIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MiwgX195MSwgX196MSwgMCwgMCwgLTEsIF9faHJlcGVhdCwgMCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTEsIF9fejEsIDAsIDAsIC0xLCAwLCAwKTsKCQoJCglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTEsIF9fejIsIDAsIDAsIDEsIDAsIDApOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gyLCBfX3kxLCBfX3oyLCAwLCAwLCAxLCBfX2hyZXBlYXQsIDApOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gyLCBfX3kyLCBfX3oyLCAwLCAwLCAxLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MiwgX195MiwgX196MiwgMCwgMCwgMSwgX19ocmVwZWF0LCBfX3ZyZXBlYXQpOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gxLCBfX3kyLCBfX3oyLCAwLCAwLCAxLCAwLCBfX3ZyZXBlYXQpOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gxLCBfX3kxLCBfX3oyLCAwLCAwLCAxLCAwLCAwKTsKCQoJCglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTIsIF9fejEsIDAsIDEsIDAsIDAsIDApOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gxLCBfX3kyLCBfX3oyLCAwLCAxLCAwLCAwLCBfX3ZyZXBlYXQpOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gyLCBfX3kyLCBfX3oyLCAwLCAxLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MiwgX195MiwgX196MiwgMCwgMSwgMCwgX19ocmVwZWF0LCBfX3ZyZXBlYXQpOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gyLCBfX3kyLCBfX3oxLCAwLCAxLCAwLCBfX2hyZXBlYXQsIDApOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gxLCBfX3kyLCBfX3oxLCAwLCAxLCAwLCAwLCAwKTsKCQoJCglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDIsIF9feTIsIF9fejEsIDEsIDAsIDAsIDAsIDApOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gyLCBfX3kyLCBfX3oyLCAxLCAwLCAwLCAwLCBfX3ZyZXBlYXQpOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gyLCBfX3kxLCBfX3oyLCAxLCAwLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MiwgX195MSwgX196MiwgMSwgMCwgMCwgX19ocmVwZWF0LCBfX3ZyZXBlYXQpOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gyLCBfX3kxLCBfX3oxLCAxLCAwLCAwLCBfX2hyZXBlYXQsIDApOwoJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX3gyLCBfX3kyLCBfX3oxLCAxLCAwLCAwLCAwLCAwKTsKCQoJCglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDIsIF9feTEsIF9fejEsIDAsIC0xLCAwLCAwLCAwKTsKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MiwgX195MSwgX196MiwgMCwgLTEsIDAsIDAsIF9fdnJlcGVhdCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTEsIF9fejIsIDAsIC0xLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MSwgX196MiwgMCwgLTEsIDAsIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MSwgX196MSwgMCwgLTEsIDAsIF9faHJlcGVhdCwgMCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDIsIF9feTEsIF9fejEsIDAsIC0xLCAwLCAwLCAwKTsKCQoJCglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTEsIF9fejEsIC0xLCAwLCAwLCAwLCAwKTsKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MSwgX196MiwgLTEsIDAsIDAsIDAsIF9fdnJlcGVhdCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTIsIF9fejIsIC0xLCAwLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MiwgX196MiwgLTEsIDAsIDAsIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MiwgX196MSwgLTEsIDAsIDAsIF9faHJlcGVhdCwgMCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTEsIF9fejEsIC0xLCAwLCAwLCAwLCAwKTsKCQoJZDNkX3ByaW1pdGl2ZV9lbmQoKTsKCQoJZ3B1X3NldF90ZXhyZXBlYXQoX19vbGRyZXApOwp9CgpmdW5jdGlvbiBkM2RfZHJhd19jb25lKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEcmF3cyBhIHNpbXBsZSAzRCBjb25lLgoJLy8vIEBwYXJhbSB4MSBUaGUgaW5pdGlhbCB4IGNvb3JkaW5hdGUgb2YgdGhlIGNvbmUuCgkvLy8gQHBhcmFtIHkxIFRoZSBpbml0aWFsIHkgY29vcmRpbmF0ZSBvZiB0aGUgY29uZS4KCS8vLyBAcGFyYW0gejEgVGhlIGluaXRpYWwgeiBjb29yZGluYXRlIG9mIHRoZSBjb25lLgoJLy8vIEBwYXJhbSB4MiBUaGUgb3Bwb3NpdGUgeCBjb29yZGluYXRlIG9mIHRoZSBjb25lLgoJLy8vIEBwYXJhbSB5MiBUaGUgb3Bwb3NpdGUgeSBjb29yZGluYXRlIG9mIHRoZSBjb25lLiAKCS8vLyBAcGFyYW0gejIgVGhlIG9wcG9zaXRlIHogY29vcmRpbmF0ZSBvZiB0aGUgY29uZS4KCS8vLyBAcGFyYW0gdGV4IFRoZSBpZCBvZiB0aGUgdGV4dHVyZSB0byB1c2UgKC0xIGZvciBubyB0ZXh0dXJlKQoJLy8vIEBwYXJhbSBocmVwZWF0IEFtb3VudCBvZiBob3Jpem9udGFsIHJlcGV0aXRpb25zIGZvciB0aGUgdGV4dHVyZS4KCS8vLyBAcGFyYW0gdnJlcGVhdCBBbW91bnQgb2YgdmVydGljYWwgcmVwZXRpdGlvbnMgZm9yIHRoZSB0ZXh0dXJlLgoJLy8vIEBwYXJhbSBjbG9zZWQgU2V0cyB3aGV0aGVyIHRvIGNsb3NlICh0cnVlKSB0aGUgYm90dG9tIG9mIHRoZSBjb25lIG9yIG5vdCAoZmFsc2UpLgoJLy8vIEBwYXJhbSBzdGVwcyBIb3cgbWFueSBzdGVwcyBhcmUgdXNlZCB0byBtYWtlIHRoZSBjb25lICJyb3VuZCIgKHR5cGljYWxseSAyNCkKCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9feDEgPSBhcmd1bWVudDA7Cgl2YXIgX195MSA9IGFyZ3VtZW50MTsKCXZhciBfX3oxID0gYXJndW1lbnQyOwoJdmFyIF9feDIgPSBhcmd1bWVudDM7Cgl2YXIgX195MiA9IGFyZ3VtZW50NDsKCXZhciBfX3oyID0gYXJndW1lbnQ1OwoJdmFyIF9fdGV4ID0gYXJndW1lbnQ2OwoJdmFyIF9faHJlcGVhdCA9IGFyZ3VtZW50NzsKCXZhciBfX3ZyZXBlYXQgPSBhcmd1bWVudDg7Cgl2YXIgX19jbG9zZWQgPSBhcmd1bWVudDk7Cgl2YXIgX19zdGVwcyA9IGFyZ3VtZW50MTA7CgkKCWlmIChfX3N0ZXBzIDwgMykKCXsKCQlfX3N0ZXBzID0gMzsKCX0KCQoJaWYgKF9fc3RlcHMgPiAxMjgpCgl7CgkJX19zdGVwcyA9IDEyODsKCX0KCQoJLy8gQ3JlYXRlIHNpbiBhbmQgY29zIHRhYmxlcwoJdmFyIF9fY2M7Cgl2YXIgX19zczsKCQoJX19jY1tfX3N0ZXBzXSA9IDA7CglfX3NzW19fc3RlcHNdID0gMDsKCQoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPD0gX19zdGVwczsgX19pKyspCgl7CgkJdmFyIF9fcmFkID0gKF9faSAqIDIuMCAqIHBpKSAvIF9fc3RlcHM7CgkJX19jY1tfX2ldID0gY29zKF9fcmFkKTsKCQlfX3NzW19faV0gPSBzaW4oX19yYWQpOwoJfQoJCgl2YXIgX19teCA9IChfX3gyICsgX194MSkgLyAyOwoJdmFyIF9fbXkgPSAoX195MiArIF9feTEpIC8gMjsKCXZhciBfX3J4ID0gKF9feDIgLSBfX3gxKSAvIDI7Cgl2YXIgX19yeSA9IChfX3kyIC0gX195MSkgLyAyOwoJCgl2YXIgX19vbGRyZXAgPSBncHVfZ2V0X3RleHJlcGVhdCgpOwoJZ3B1X3NldF90ZXhyZXBlYXQodHJ1ZSkJCgkKCWQzZF9wcmltaXRpdmVfYmVnaW5fdGV4dHVyZShwcl90cmlhbmdsZXN0cmlwLCBfX3RleCk7CgkKCWZvcihfX2kgPSAwOyBfX2kgPD0gX19zdGVwczsgX19pKyspCgl7CgkJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX214LCBfX215LCBfX3oyLCAwLCAwLCAxLCBfX2hyZXBlYXQgKiBfX2kgLyBfX3N0ZXBzLCBfX3ZyZXBlYXQpOwoJCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19teCArIF9fY2NbX19pXSpfX3J4LCBfX215ICsgX19zc1tfX2ldKl9fcnksIF9fejEsIF9fY2NbX19pXSAsIF9fc3NbX19pXSAsMCAsIF9faHJlcGVhdCAqIF9faSAvIF9fc3RlcHMsIDApOwoJfQoJCglkM2RfcHJpbWl0aXZlX2VuZCgpOwoJCglpZiAoX19jbG9zZWQgPT0gdHJ1ZSkKCXsKCQlkM2RfcHJpbWl0aXZlX2JlZ2luX3RleHR1cmUocHJfdHJpYW5nbGVmYW4sIF9fdGV4KTsKCQlkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9fbXgsIF9fbXksIF9fejEsIDAsIDAsIC0xLCAwLCAwKTsKCQlmb3IoX19pID0gX19zdGVwczsgX19pID49IDA7IF9faS0tKQoJCXsKCQkJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX214K19fY2NbX19pXSpfX3J4LCBfX215K19fc3NbX19pXSpfX3J5LCBfX3oxLCAwLCAwLCAtMSwgMCwgMCk7CQkKCQl9CgkJZDNkX3ByaW1pdGl2ZV9lbmQoKTsKCX0KCQoJZ3B1X3NldF90ZXhyZXBlYXQoX19vbGRyZXApOwp9CgpmdW5jdGlvbiBkM2RfZHJhd19jeWxpbmRlcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gRHJhd3MgYSBzaW1wbGUgM0QgY3lsaW5kZXIuCgkvLy8gQHBhcmFtIHgxIFRoZSBpbml0aWFsIHggY29vcmRpbmF0ZSBvZiB0aGUgY3lsaW5kZXIuCgkvLy8gQHBhcmFtIHkxIFRoZSBpbml0aWFsIHkgY29vcmRpbmF0ZSBvZiB0aGUgY3lsaW5kZXIuCgkvLy8gQHBhcmFtIHoxIFRoZSBpbml0aWFsIHogY29vcmRpbmF0ZSBvZiB0aGUgY3lsaW5kZXIuCgkvLy8gQHBhcmFtIHgyIFRoZSBvcHBvc2l0ZSB4IGNvb3JkaW5hdGUgb2YgdGhlIGN5bGluZGVyLgoJLy8vIEBwYXJhbSB5MiBUaGUgb3Bwb3NpdGUgeSBjb29yZGluYXRlIG9mIHRoZSBjeWxpbmRlci4gCgkvLy8gQHBhcmFtIHoyIFRoZSBvcHBvc2l0ZSB6IGNvb3JkaW5hdGUgb2YgdGhlIGN5bGluZGVyLgoJLy8vIEBwYXJhbSB0ZXggVGhlIGlkIG9mIHRoZSB0ZXh0dXJlIHRvIHVzZSAoLTEgZm9yIG5vIHRleHR1cmUpCgkvLy8gQHBhcmFtIGhyZXBlYXQgQW1vdW50IG9mIGhvcml6b250YWwgcmVwZXRpdGlvbnMgZm9yIHRoZSB0ZXh0dXJlLgoJLy8vIEBwYXJhbSB2cmVwZWF0IEFtb3VudCBvZiB2ZXJ0aWNhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHBhcmFtIGNsb3NlZCBTZXRzIHdoZXRoZXIgdG8gY2xvc2UgKHRydWUpIHRoZSBib3R0b20gYW5kIHRvcCBvZiB0aGUgY3lsaW5kZXIgb3Igbm90IChmYWxzZSkuCgkvLy8gQHBhcmFtIHN0ZXBzIEhvdyBtYW55IHN0ZXBzIGFyZSB1c2VkIHRvIG1ha2UgdGhlIGN5bGluZGVyICJyb3VuZCIgKHR5cGljYWxseSAyNCkKCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9feDEgPSBhcmd1bWVudDA7Cgl2YXIgX195MSA9IGFyZ3VtZW50MTsKCXZhciBfX3oxID0gYXJndW1lbnQyOwoJdmFyIF9feDIgPSBhcmd1bWVudDM7Cgl2YXIgX195MiA9IGFyZ3VtZW50NDsKCXZhciBfX3oyID0gYXJndW1lbnQ1OwoJdmFyIF9fdGV4ID0gYXJndW1lbnQ2OwoJdmFyIF9faHJlcGVhdCA9IGFyZ3VtZW50NzsKCXZhciBfX3ZyZXBlYXQgPSBhcmd1bWVudDg7Cgl2YXIgX19jbG9zZWQgPSBhcmd1bWVudDk7Cgl2YXIgX19zdGVwcyA9IGFyZ3VtZW50MTA7CgkKCWlmIChfX3N0ZXBzIDwgMykKCXsKCQlfX3N0ZXBzID0gMzsKCX0KCQoJaWYgKF9fc3RlcHMgPiAxMjgpCgl7CgkJX19zdGVwcyA9IDEyODsKCX0KCQoJLy8gQ3JlYXRlIHNpbiBhbmQgY29zIHRhYmxlcwoJdmFyIF9fY2M7Cgl2YXIgX19zczsKCQoJX19jY1tfX3N0ZXBzXSA9IDA7CglfX3NzW19fc3RlcHNdID0gMDsKCQoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPD0gX19zdGVwczsgX19pKyspCgl7CgkJdmFyIF9fcmFkID0gKF9faSAqIDIuMCAqIHBpKSAvIF9fc3RlcHM7CgkJX19jY1tfX2ldID0gY29zKF9fcmFkKTsKCQlfX3NzW19faV0gPSBzaW4oX19yYWQpOwoJfQoJCgl2YXIgX19teCA9IChfX3gyICsgX194MSkgLyAyOwoJdmFyIF9fbXkgPSAoX195MiArIF9feTEpIC8gMjsKCXZhciBfX3J4ID0gKF9feDIgLSBfX3gxKSAvIDI7Cgl2YXIgX19yeSA9IChfX3kyIC0gX195MSkgLyAyOwoJCgl2YXIgX19vbGRyZXAgPSBncHVfZ2V0X3RleHJlcGVhdCgpOwoJZ3B1X3NldF90ZXhyZXBlYXQodHJ1ZSkJCgkKCWlmIChfX2Nsb3NlZCA9PSB0cnVlKQoJewoJCWQzZF9wcmltaXRpdmVfYmVnaW5fdGV4dHVyZShwcl90cmlhbmdsZWZhbiwgX190ZXgpOwoJCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19teCwgX19teSwgX196MiwgMCwgMCwgMSwgMCwgX192cmVwZWF0KTsKCQlmb3IoX19pID0gMDsgX19pIDw9IF9fc3RlcHM7IF9faSsrKQoJCXsKCQkJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX214K19fY2NbX19pXSpfX3J4LCBfX215K19fc3NbX19pXSpfX3J5LCBfX3oyLCAwLCAwLCAxLCAwLCBfX3ZyZXBlYXQpOwkJCgkJfQoJCWQzZF9wcmltaXRpdmVfZW5kKCk7Cgl9CgkKCWQzZF9wcmltaXRpdmVfYmVnaW5fdGV4dHVyZShwcl90cmlhbmdsZXN0cmlwLCBfX3RleCk7CgkKCWZvcihfX2kgPSAwOyBfX2kgPD0gX19zdGVwczsgX19pKyspCgl7CgkJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX214ICsgX19jY1tfX2ldKl9fcngsIF9fbXkgKyBfX3NzW19faV0qX19yeSwgX196MiwgX19jY1tfX2ldICwgX19zc1tfX2ldICwwICwgX19ocmVwZWF0ICogX19pIC8gX19zdGVwcywgX192cmVwZWF0KTsKCQlkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9fbXggKyBfX2NjW19faV0qX19yeCwgX19teSArIF9fc3NbX19pXSpfX3J5LCBfX3oxLCBfX2NjW19faV0gLCBfX3NzW19faV0gLDAgLCBfX2hyZXBlYXQgKiBfX2kgLyBfX3N0ZXBzLCAwKTsKCX0KCQoJZDNkX3ByaW1pdGl2ZV9lbmQoKTsKCQoJaWYgKF9fY2xvc2VkID09IHRydWUpCgl7CgkJZDNkX3ByaW1pdGl2ZV9iZWdpbl90ZXh0dXJlKHByX3RyaWFuZ2xlZmFuLCBfX3RleCk7CgkJZDNkX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX214LCBfX215LCBfX3oxLCAwLCAwLCAtMSwgMCwgMCk7CgkJZm9yKF9faSA9IF9fc3RlcHM7IF9faSA+PSAwOyBfX2ktLSkKCQl7CgkJCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19teCtfX2NjW19faV0qX19yeCwgX19teStfX3NzW19faV0qX19yeSwgX196MSwgMCwgMCwgLTEsIDAsIDApOwkJCgkJfQoJCWQzZF9wcmltaXRpdmVfZW5kKCk7Cgl9CgkKCWdwdV9zZXRfdGV4cmVwZWF0KF9fb2xkcmVwKTsKfQoKZnVuY3Rpb24gZDNkX2RyYXdfZWxsaXBzb2lkKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEcmF3cyBhIHNpbXBsZSAzRCBlbGxpcHNvaWQuCgkvLy8gQHBhcmFtIHgxIFRoZSBpbml0aWFsIHggY29vcmRpbmF0ZSBvZiB0aGUgZWxsaXBzb2lkLgoJLy8vIEBwYXJhbSB5MSBUaGUgaW5pdGlhbCB5IGNvb3JkaW5hdGUgb2YgdGhlIGVsbGlwc29pZC4KCS8vLyBAcGFyYW0gejEgVGhlIGluaXRpYWwgeiBjb29yZGluYXRlIG9mIHRoZSBlbGxpcHNvaWQuCgkvLy8gQHBhcmFtIHgyIFRoZSBvcHBvc2l0ZSB4IGNvb3JkaW5hdGUgb2YgdGhlIGVsbGlwc29pZC4KCS8vLyBAcGFyYW0geTIgVGhlIG9wcG9zaXRlIHkgY29vcmRpbmF0ZSBvZiB0aGUgZWxsaXBzb2lkLiAKCS8vLyBAcGFyYW0gejIgVGhlIG9wcG9zaXRlIHogY29vcmRpbmF0ZSBvZiB0aGUgZWxsaXBzb2lkLgoJLy8vIEBwYXJhbSB0ZXggVGhlIGlkIG9mIHRoZSB0ZXh0dXJlIHRvIHVzZSAoLTEgZm9yIG5vIHRleHR1cmUpCgkvLy8gQHBhcmFtIGhyZXBlYXQgQW1vdW50IG9mIGhvcml6b250YWwgcmVwZXRpdGlvbnMgZm9yIHRoZSB0ZXh0dXJlLgoJLy8vIEBwYXJhbSB2cmVwZWF0IEFtb3VudCBvZiB2ZXJ0aWNhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHBhcmFtIHN0ZXBzIEhvdyBtYW55IHN0ZXBzIGFyZSB1c2VkIHRvIG1ha2UgdGhlIGVsbGlwc29pZCAicm91bmQiICh0eXBpY2FsbHkgMjQpCgkvLy8gQHJldHVybnMgCgkKCXZhciBfX3gxID0gYXJndW1lbnQwOwoJdmFyIF9feTEgPSBhcmd1bWVudDE7Cgl2YXIgX196MSA9IGFyZ3VtZW50MjsKCXZhciBfX3gyID0gYXJndW1lbnQzOwoJdmFyIF9feTIgPSBhcmd1bWVudDQ7Cgl2YXIgX196MiA9IGFyZ3VtZW50NTsKCXZhciBfX3RleCA9IGFyZ3VtZW50NjsKCXZhciBfX2hyZXBlYXQgPSBhcmd1bWVudDc7Cgl2YXIgX192cmVwZWF0ID0gYXJndW1lbnQ4OwoJdmFyIF9fc3RlcHMgPSBhcmd1bWVudDk7CgkKCWlmIChfX3N0ZXBzIDwgMykKCXsKCQlfX3N0ZXBzID0gMzsKCX0KCQoJaWYgKF9fc3RlcHMgPiAxMjgpCgl7CgkJX19zdGVwcyA9IDEyODsKCX0KCQoJLy8gQ3JlYXRlIHNpbiBhbmQgY29zIHRhYmxlcwoJdmFyIF9fY2M7Cgl2YXIgX19zczsKCQoJX19jY1tfX3N0ZXBzXSA9IDA7CglfX3NzW19fc3RlcHNdID0gMDsKCQoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPD0gX19zdGVwczsgX19pKyspCgl7CgkJdmFyIF9fcmFkID0gKF9faSAqIDIuMCAqIHBpKSAvIF9fc3RlcHM7CgkJX19jY1tfX2ldID0gY29zKF9fcmFkKTsKCQlfX3NzW19faV0gPSBzaW4oX19yYWQpOwoJfQoJCgl2YXIgX19teCA9IChfX3gyICsgX194MSkgLyAyOwoJdmFyIF9fbXkgPSAoX195MiArIF9feTEpIC8gMjsKCXZhciBfX216ID0gKF9fejIgKyBfX3oxKSAvIDI7Cgl2YXIgX19yeCA9IChfX3gyIC0gX194MSkgLyAyOwoJdmFyIF9fcnkgPSAoX195MiAtIF9feTEpIC8gMjsKCXZhciBfX3J6ID0gKF9fejIgLSBfX3oxKSAvIDI7CgkKCXZhciBfX3Jvd3MgPSBmbG9vcigoX19zdGVwcyArIDEpIC8gMik7Cgl2YXIgX19qOwoJCgl2YXIgX19vbGRyZXAgPSBncHVfZ2V0X3RleHJlcGVhdCgpOwoJZ3B1X3NldF90ZXhyZXBlYXQodHJ1ZSkJCgkKCWZvcihfX2ogPSAwOyBfX2ogPD0gKF9fcm93cyAtIDEpOyBfX2orKykKCXsKCQl2YXIgX19yb3cxcmFkID0gKF9faipwaSkvX19yb3dzOwoJCXZhciBfX3JvdzJyYWQgPSAoKF9faisxKSpwaSkvX19yb3dzOwoJCXZhciBfX3JoMSA9IGNvcyhfX3JvdzFyYWQpOwoJCXZhciBfX3JkMSA9IHNpbihfX3JvdzFyYWQpOwoJCXZhciBfX3JoMiA9IGNvcyhfX3JvdzJyYWQpOwoJCXZhciBfX3JkMiA9IHNpbihfX3JvdzJyYWQpOwoJCQoJCWQzZF9wcmltaXRpdmVfYmVnaW5fdGV4dHVyZShwcl90cmlhbmdsZXN0cmlwLCBfX3RleCk7CgkJCgkJZm9yKF9faSA9IDA7IF9faSA8PSBfX3N0ZXBzOyBfX2krKykKCQl7CgkJCS8vIFNvbWUgY29tbW9uIHN1YmV4cHJlc3Npb25zIGhlcmUgdGhhdCBjb3VsZCBiZSBlbGltaW5hdGVkCgkJCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19teCtfX3J4Kl9fcmQxKl9fY2NbX19pXSwgX19teStfX3J5Kl9fcmQxKl9fc3NbX19pXSwgX19teitfX3J6Kl9fcmgxLF9fcmQxKl9fY2NbX19pXSwgX19yZDEqX19zc1tfX2ldLCBfX3JoMSwgX19ocmVwZWF0Kl9faS9fX3N0ZXBzLCBfX2oqX192cmVwZWF0L19fcm93cyk7CgkJCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19teCtfX3J4Kl9fcmQyKl9fY2NbX19pXSwgX19teStfX3J5Kl9fcmQyKl9fc3NbX19pXSwgX19teitfX3J6Kl9fcmgyLF9fcmQyKl9fY2NbX19pXSwgX19yZDIqX19zc1tfX2ldLCBfX3JoMiwgX19ocmVwZWF0Kl9faS9fX3N0ZXBzLCAoX19qKzEpKl9fdnJlcGVhdC9fX3Jvd3MpOwoJCX0KCQkKCQlkM2RfcHJpbWl0aXZlX2VuZCgpOwoJfQoJCglncHVfc2V0X3RleHJlcGVhdChfX29sZHJlcCk7Cn0KCmZ1bmN0aW9uIGQzZF9kcmF3X2Zsb29yKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEcmF3cyBhIHNpbXBsZSAzRCBmbG9vci4KCS8vLyBAcGFyYW0geDEgVGhlIGluaXRpYWwgeCBjb29yZGluYXRlIG9mIHRoZSBmbG9vci4KCS8vLyBAcGFyYW0geTEgVGhlIGluaXRpYWwgeSBjb29yZGluYXRlIG9mIHRoZSBmbG9vci4KCS8vLyBAcGFyYW0gejEgVGhlIGluaXRpYWwgeiBjb29yZGluYXRlIG9mIHRoZSBmbG9vci4KCS8vLyBAcGFyYW0geDIgVGhlIG9wcG9zaXRlIHggY29vcmRpbmF0ZSBvZiB0aGUgZmxvb3IuCgkvLy8gQHBhcmFtIHkyIFRoZSBvcHBvc2l0ZSB5IGNvb3JkaW5hdGUgb2YgdGhlIGZsb29yLiAKCS8vLyBAcGFyYW0gejIgVGhlIG9wcG9zaXRlIHogY29vcmRpbmF0ZSBvZiB0aGUgZmxvb3IuCgkvLy8gQHBhcmFtIHRleCBUaGUgaWQgb2YgdGhlIHRleHR1cmUgdG8gdXNlICgtMSBmb3Igbm8gdGV4dHVyZSkKCS8vLyBAcGFyYW0gaHJlcGVhdCBBbW91bnQgb2YgaG9yaXpvbnRhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHBhcmFtIHZyZXBlYXQgQW1vdW50IG9mIHZlcnRpY2FsIHJlcGV0aXRpb25zIGZvciB0aGUgdGV4dHVyZS4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9feDEgPSBhcmd1bWVudDA7Cgl2YXIgX195MSA9IGFyZ3VtZW50MTsKCXZhciBfX3oxID0gYXJndW1lbnQyOwoJdmFyIF9feDIgPSBhcmd1bWVudDM7Cgl2YXIgX195MiA9IGFyZ3VtZW50NDsKCXZhciBfX3oyID0gYXJndW1lbnQ1OwoJdmFyIF9fdGV4ID0gYXJndW1lbnQ2OwoJdmFyIF9faHJlcGVhdCA9IGFyZ3VtZW50NzsKCXZhciBfX3ZyZXBlYXQgPSBhcmd1bWVudDg7CgkKCXZhciBfX3hkaWZmID0gX194MiAtIF9feDE7Cgl2YXIgX196ZGlmZiA9IF9fejIgLSBfX3oxOwoJCgl2YXIgX19sc3F1YXJlZCA9IChfX3hkaWZmICogX194ZGlmZikgKyAoX196ZGlmZiAqIF9femRpZmYpOwoJaWYgKF9fbHNxdWFyZWQgPT0gMCkKCQlyZXR1cm4gMDsKCQkKCXZhciBfX2wgPSBzcXJ0KF9fbHNxdWFyZWQpOwoJCgl2YXIgX19ueCA9IC1fX3pkaWZmIC8gX19sOwoJdmFyIF9fbnogPSBfX3hkaWZmIC8gX19sOwoJCgl2YXIgX19vbGRyZXAgPSBncHVfZ2V0X3RleHJlcGVhdCgpOwoJZ3B1X3NldF90ZXhyZXBlYXQodHJ1ZSkKCQoJZDNkX3ByaW1pdGl2ZV9iZWdpbl90ZXh0dXJlKHByX3RyaWFuZ2xlZmFuLCBfX3RleCk7CgkKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MSwgX196MSwgX19ueCwgMCwgX19ueiwgMCwgMCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDEsIF9feTIsIF9fejEsIF9fbngsIDAsIF9fbnosIDAsIF9fdnJlcGVhdCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDIsIF9feTIsIF9fejIsIF9fbngsIDAsIF9fbnosIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MiwgX195MSwgX196MiwgX19ueCwgMCwgX19ueiwgX19ocmVwZWF0LCAwKTsKCQoJZDNkX3ByaW1pdGl2ZV9lbmQoKTsKCQoJZ3B1X3NldF90ZXhyZXBlYXQoX19vbGRyZXApOwp9CgpmdW5jdGlvbiBkM2RfZHJhd193YWxsKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEcmF3cyBhIHNpbXBsZSAzRCB2ZXJ0aWNhbCB3YWxsLgoJLy8vIEBwYXJhbSB4MSBUaGUgaW5pdGlhbCB4IGNvb3JkaW5hdGUgb2YgdGhlIHdhbGwuCgkvLy8gQHBhcmFtIHkxIFRoZSBpbml0aWFsIHkgY29vcmRpbmF0ZSBvZiB0aGUgd2FsbC4KCS8vLyBAcGFyYW0gejEgVGhlIGluaXRpYWwgeiBjb29yZGluYXRlIG9mIHRoZSB3YWxsLgoJLy8vIEBwYXJhbSB4MiBUaGUgb3Bwb3NpdGUgeCBjb29yZGluYXRlIG9mIHRoZSB3YWxsLgoJLy8vIEBwYXJhbSB5MiBUaGUgb3Bwb3NpdGUgeSBjb29yZGluYXRlIG9mIHRoZSB3YWxsLiAKCS8vLyBAcGFyYW0gejIgVGhlIG9wcG9zaXRlIHogY29vcmRpbmF0ZSBvZiB0aGUgd2FsbC4KCS8vLyBAcGFyYW0gdGV4IFRoZSBpZCBvZiB0aGUgdGV4dHVyZSB0byB1c2UgKC0xIGZvciBubyB0ZXh0dXJlKQoJLy8vIEBwYXJhbSBocmVwZWF0IEFtb3VudCBvZiBob3Jpem9udGFsIHJlcGV0aXRpb25zIGZvciB0aGUgdGV4dHVyZS4KCS8vLyBAcGFyYW0gdnJlcGVhdCBBbW91bnQgb2YgdmVydGljYWwgcmVwZXRpdGlvbnMgZm9yIHRoZSB0ZXh0dXJlLgoJLy8vIEByZXR1cm5zIAoJCgkvL3ZhciByZXQgPSBnbG9iYWwuX19kM2Q7CgkvL2dsb2JhbC5fX2QzZCA9IGZhbHNlOwoJLy9yZXR1cm4gcmV0OwoJCgl2YXIgX194MSA9IGFyZ3VtZW50MDsKCXZhciBfX3kxID0gYXJndW1lbnQxOwoJdmFyIF9fejEgPSBhcmd1bWVudDI7Cgl2YXIgX194MiA9IGFyZ3VtZW50MzsKCXZhciBfX3kyID0gYXJndW1lbnQ0OwoJdmFyIF9fejIgPSBhcmd1bWVudDU7Cgl2YXIgX190ZXggPSBhcmd1bWVudDY7Cgl2YXIgX19ocmVwZWF0ID0gYXJndW1lbnQ3OwoJdmFyIF9fdnJlcGVhdCA9IGFyZ3VtZW50ODsKCQoJdmFyIF9feGRpZmYgPSBfX3gyIC0gX194MTsKCXZhciBfX3lkaWZmID0gX195MiAtIF9feTE7CgkKCXZhciBfX2xzcXVhcmVkID0gKF9feGRpZmYgKiBfX3hkaWZmKSArIChfX3lkaWZmICogX195ZGlmZik7CglpZiAoX19sc3F1YXJlZCA9PSAwKQoJCXJldHVybiAwOwoJCQoJdmFyIF9fbCA9IHNxcnQoX19sc3F1YXJlZCk7CgkKCXZhciBfX254ID0gX195ZGlmZiAvIF9fbDsKCXZhciBfX255ID0gLV9feGRpZmYgLyBfX2w7CgkKCXZhciBfX29sZHJlcCA9IGdwdV9nZXRfdGV4cmVwZWF0KCk7CglncHVfc2V0X3RleHJlcGVhdCh0cnVlKQkKCQoJZDNkX3ByaW1pdGl2ZV9iZWdpbl90ZXh0dXJlKHByX3RyaWFuZ2xlZmFuLCBfX3RleCk7CgkKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MSwgX196MSwgX19ueCwgX19ueSwgMCwgMCwgMCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDIsIF9feTIsIF9fejEsIF9fbngsIF9fbnksIDAsIF9faHJlcGVhdCwgMCk7CglkM2RfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9feDIsIF9feTIsIF9fejIsIF9fbngsIF9fbnksIDAsIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX194MSwgX195MSwgX196MiwgX19ueCwgX19ueSwgMCwgMCwgX192cmVwZWF0KTsKCQoJZDNkX3ByaW1pdGl2ZV9lbmQoKTsKCQoJZ3B1X3NldF90ZXhyZXBlYXQoX19vbGRyZXApOwp9CgpmdW5jdGlvbiBkM2RfZW5kKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBkaXNhYmxlIDNkCgkvLy8gQHBhcmFtIGVuYWJsZSB0cnVlIGlmIGVuYWJsZWQsIGZhbHNlIGlmIGRpc2FibGVkCgl2YXIgcmV0ID0gZ2xvYmFsLl9fZDNkOwoJZ2xvYmFsLl9fZDNkID0gZmFsc2U7CglncHVfc2V0X3p0ZXN0ZW5hYmxlKGZhbHNlKTsKCWdwdV9zZXRfendyaXRlZW5hYmxlKGZhbHNlKTsKCXJldHVybiByZXQ7Cgp9CgpmdW5jdGlvbiBkM2RfbGlnaHRfZGVmaW5lX2FtYmllbnQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIHNldCB0aGUgYW1iaWVudCBjb2xvdXIKCS8vLyBAcGFyYW0gY29sb3VyIGNvbG91ciBmb3IgdGhlIGFtYmllbnQgbGlnaHQKCWRyYXdfbGlnaHRfZGVmaW5lX2FtYmllbnQoIGFyZ3VtZW50MCApOwoJCgp9CgpmdW5jdGlvbiBkM2RfbGlnaHRfZGVmaW5lX2RpcmVjdGlvbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gc2V0IHRoZSBkaXJlY3Rpb24gb2YgYSBzcGVjaWZpYyBsaWdodAoJLy8vIEBwYXJhbSBpbmRleAludW1iZXIgb2YgbGlnaHQgCgkvLy8gQHBhcmFtIHgJeCBjb21wb25lbnQKCS8vLyBAcGFyYW0geQl5IGNvbXBvbmVudAoJLy8vIEBwYXJhbSB6CXogY29tcG9uZW50CgkvLy8gQHBhcmFtIGNvbAljb2xvdXIgZm9yIHRoaXMgbGlnaHQKCWRyYXdfbGlnaHRfZGVmaW5lX2RpcmVjdGlvbiggYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCBhcmd1bWVudDQgKTsKCQoKfQoKZnVuY3Rpb24gZDNkX2xpZ2h0X2RlZmluZV9wb2ludCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gc2V0IHRoZSBwb2ludCBhbmQgb2YgYSBzcGVjaWZpYyBsaWdodAoJLy8vIEBwYXJhbSBpbmRleAludW1iZXIgb2YgbGlnaHQgCgkvLy8gQHBhcmFtIHgJeCBjb21wb25lbnQKCS8vLyBAcGFyYW0geQl5IGNvbXBvbmVudAoJLy8vIEBwYXJhbSB6CXogY29tcG9uZW50CgkvLy8gQHBhcmFtIHJhbmdlCXJhbmdlIGZvciB0aGlzIGxpZ2h0CgkvLy8gQHBhcmFtIGNvbAljb2xvdXIgZm9yIHRoaXMgbGlnaHQKCWRyYXdfbGlnaHRfZGVmaW5lX3BvaW50KCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1ICk7CgkKCn0KCmZ1bmN0aW9uIGQzZF9saWdodF9lbmFibGUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIGVuYWJsZSBsaWdodGluZwoJLy8vIEBwYXJhbSBpbmRleAludW1iZXIgb2YgbGlnaHQgCgkvLy8gQHBhcmFtIGVuYWJsZQl0cnVlIGlmIGVuYWJsZWQsIGZhbHNlIGlmIGRpc2FibGVkCglkcmF3X2xpZ2h0X2VuYWJsZSggYXJndW1lbnQwLCBhcmd1bWVudDEgKTsKCn0KCmZ1bmN0aW9uIGQzZF9tb2RlbF9ibG9jaygpCnsKCS8vLyBAZGVzY3JpcHRpb24gQWRkcyBhIGJsb2NrIHNoYXBlIHRvIHRoZSBtb2RlbC4KCS8vLyBAcGFyYW0gaW5kIFRoZSBtb2RlbCBpbmRleCB0byBhZGQgdGhlIGJsb2NrIHRvLgoJLy8vIEBwYXJhbSB4MSBUaGUgaW5pdGlhbCB4IGNvb3JkaW5hdGUgb2YgdGhlIGJsb2NrLiAKCS8vLyBAcGFyYW0geTEgVGhlIGluaXRpYWwgeSBjb29yZGluYXRlIG9mIHRoZSBibG9jay4KCS8vLyBAcGFyYW0gejEgVGhlIGluaXRpYWwgeiBjb29yZGluYXRlIG9mIHRoZSBibG9jay4KCS8vLyBAcGFyYW0geDIgVGhlIG9wcG9zaXRlIHggY29vcmRpbmF0ZSBvZiB0aGUgYmxvY2suCgkvLy8gQHBhcmFtIHkyIFRoZSBvcHBvc2l0ZSB5IGNvb3JkaW5hdGUgb2YgdGhlIGJsb2NrLgoJLy8vIEBwYXJhbSB6MiBUaGUgb3Bwb3NpdGUgeiBjb29yZGluYXRlIG9mIHRoZSBibG9jay4KCS8vLyBAcGFyYW0gaHJlcGVhdCBBbW91bnQgb2YgaG9yaXpvbnRhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHBhcmFtIHZyZXBlYXQgQW1vdW50IG9mIHZlcnRpY2FsIHJlcGV0aXRpb25zIGZvciB0aGUgdGV4dHVyZS4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9faW5kID0gYXJndW1lbnQwCgl2YXIgX194MSA9IGFyZ3VtZW50MTsKCXZhciBfX3kxID0gYXJndW1lbnQyOwoJdmFyIF9fejEgPSBhcmd1bWVudDM7Cgl2YXIgX194MiA9IGFyZ3VtZW50NDsKCXZhciBfX3kyID0gYXJndW1lbnQ1OwoJdmFyIF9fejIgPSBhcmd1bWVudDY7Cgl2YXIgX19ocmVwZWF0ID0gYXJndW1lbnQ3OwoJdmFyIF9fdnJlcGVhdCA9IGFyZ3VtZW50ODsKCQkKCQoJZDNkX21vZGVsX3ByaW1pdGl2ZV9iZWdpbihfX2luZCwgcHJfdHJpYW5nbGVsaXN0KTsKCQoJCglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kxLCBfX3oxLCAwLCAwLCAtMSwgMCwgMCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kyLCBfX3oxLCAwLCAwLCAtMSwgMCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTIsIF9fejEsIDAsIDAsIC0xLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTIsIF9fejEsIDAsIDAsIC0xLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gyLCBfX3kxLCBfX3oxLCAwLCAwLCAtMSwgX19ocmVwZWF0LCAwKTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTEsIF9fejEsIDAsIDAsIC0xLCAwLCAwKTsKCQoJCglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kxLCBfX3oyLCAwLCAwLCAxLCAwLCAwKTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTEsIF9fejIsIDAsIDAsIDEsIF9faHJlcGVhdCwgMCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gyLCBfX3kyLCBfX3oyLCAwLCAwLCAxLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTIsIF9fejIsIDAsIDAsIDEsIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTIsIF9fejIsIDAsIDAsIDEsIDAsIF9fdnJlcGVhdCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kxLCBfX3oyLCAwLCAwLCAxLCAwLCAwKTsKCQoJCglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kyLCBfX3oxLCAwLCAxLCAwLCAwLCAwKTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTIsIF9fejIsIDAsIDEsIDAsIDAsIF9fdnJlcGVhdCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gyLCBfX3kyLCBfX3oyLCAwLCAxLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTIsIF9fejIsIDAsIDEsIDAsIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTIsIF9fejEsIDAsIDEsIDAsIF9faHJlcGVhdCwgMCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kyLCBfX3oxLCAwLCAxLCAwLCAwLCAwKTsKCQoJCglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gyLCBfX3kyLCBfX3oxLCAxLCAwLCAwLCAwLCAwKTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTIsIF9fejIsIDEsIDAsIDAsIDAsIF9fdnJlcGVhdCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gyLCBfX3kxLCBfX3oyLCAxLCAwLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTEsIF9fejIsIDEsIDAsIDAsIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTEsIF9fejEsIDEsIDAsIDAsIF9faHJlcGVhdCwgMCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gyLCBfX3kyLCBfX3oxLCAxLCAwLCAwLCAwLCAwKTsKCQoJCglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gyLCBfX3kxLCBfX3oxLCAwLCAtMSwgMCwgMCwgMCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gyLCBfX3kxLCBfX3oyLCAwLCAtMSwgMCwgMCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTEsIF9fejIsIDAsIC0xLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTEsIF9fejIsIDAsIC0xLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kxLCBfX3oxLCAwLCAtMSwgMCwgX19ocmVwZWF0LCAwKTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTEsIF9fejEsIDAsIC0xLCAwLCAwLCAwKTsKCQoJCglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kxLCBfX3oxLCAtMSwgMCwgMCwgMCwgMCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kxLCBfX3oyLCAtMSwgMCwgMCwgMCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTIsIF9fejIsIC0xLCAwLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CgkKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTIsIF9fejIsIC0xLCAwLCAwLCBfX2hyZXBlYXQsIF9fdnJlcGVhdCk7CglkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX3gxLCBfX3kyLCBfX3oxLCAtMSwgMCwgMCwgX19ocmVwZWF0LCAwKTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTEsIF9fejEsIC0xLCAwLCAwLCAwLCAwKTsKCQoJZDNkX21vZGVsX3ByaW1pdGl2ZV9lbmQoX19pbmQpOwp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfY2xlYXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIENsZWFycyB0aGUgbW9kZWwgd2l0aCB0aGUgZ2l2ZW4gaW5kZXgsIHJlbW92aW5nIGFsbCBpdHMgcHJpbWl0aXZlcy4KCS8vLyBAcGFyYW0gaW5kIFRoZSBpbmRleCBvZiB0aGUgbW9kZWwgdG8gYmUgY2xlYXJlZC4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9fbSA9IGFyZ3VtZW50MDsKCQoJLy8gU2NydWIgYW55IGJ1ZmZlcnMgd2UgaGF2ZSBjcmVhdGVkCglpZiAoX19tW2VfX1lZTS5Qb2ludEJdICE9IHVuZGVmaW5lZCkKCXsKCQlidWZmZXJfZGVsZXRlKF9fbVtlX19ZWU0uUG9pbnRCXSk7CgkJX19tW2VfX1lZTS5Qb2ludEJdID0gdW5kZWZpbmVkOwoJfQoJCglpZiAoX19tW2VfX1lZTS5MaW5lQl0gIT0gdW5kZWZpbmVkKQoJewoJCWJ1ZmZlcl9kZWxldGUoX19tW2VfX1lZTS5MaW5lQl0pOwoJCV9fbVtlX19ZWU0uTGluZUJdID0gdW5kZWZpbmVkOwoJfQoJCglpZiAoX19tW2VfX1lZTS5UcmlCXSAhPSB1bmRlZmluZWQpCgl7CgkJYnVmZmVyX2RlbGV0ZShfX21bZV9fWVlNLlRyaUJdKTsKCQlfX21bZV9fWVlNLlRyaUJdID0gdW5kZWZpbmVkOwoJfQoJCglpZiAoX19tW2VfX1lZTS5Qb2ludFVWQl0gIT0gdW5kZWZpbmVkKQoJewoJCWJ1ZmZlcl9kZWxldGUoX19tW2VfX1lZTS5Qb2ludFVWQl0pOwoJCV9fbVtlX19ZWU0uUG9pbnRVVkJdID0gdW5kZWZpbmVkOwoJfQoJCglpZiAoX19tW2VfX1lZTS5MaW5lVVZCXSAhPSB1bmRlZmluZWQpCgl7CgkJYnVmZmVyX2RlbGV0ZShfX21bZV9fWVlNLkxpbmVVVkJdKTsKCQlfX21bZV9fWVlNLkxpbmVVVkJdID0gdW5kZWZpbmVkOwoJfQoJCglpZiAoX19tW2VfX1lZTS5UcmlVVkJdICE9IHVuZGVmaW5lZCkKCXsKCQlidWZmZXJfZGVsZXRlKF9fbVtlX19ZWU0uVHJpVVZCXSk7CgkJX19tW2VfX1lZTS5UcmlVVkJdID0gdW5kZWZpbmVkOwoJfQoJCgkvLyBTY3J1YiBhbnkgdmVydGV4IGJ1ZmZlcnMgd2UgaGF2ZSBjcmVhdGVkCglpZiAoX19tW2VfX1lZTS5Qb2ludFZCXSAhPSB1bmRlZmluZWQpCgl7CgkJdmVydGV4X2RlbGV0ZV9idWZmZXIoX19tW2VfX1lZTS5Qb2ludFZCXSk7CgkJX19tW2VfX1lZTS5Qb2ludFZCXSA9IHVuZGVmaW5lZDsKCX0KCQoJaWYgKF9fbVtlX19ZWU0uTGluZVZCXSAhPSB1bmRlZmluZWQpCgl7CgkJdmVydGV4X2RlbGV0ZV9idWZmZXIoX19tW2VfX1lZTS5MaW5lVkJdKTsKCQlfX21bZV9fWVlNLkxpbmVWQl0gPSB1bmRlZmluZWQ7Cgl9CgkKCWlmIChfX21bZV9fWVlNLlRyaVZCXSAhPSB1bmRlZmluZWQpCgl7CgkJdmVydGV4X2RlbGV0ZV9idWZmZXIoX19tW2VfX1lZTS5UcmlWQl0pOwoJCV9fbVtlX19ZWU0uVHJpVkJdID0gdW5kZWZpbmVkOwoJfQoJCgkvLyBTZXQgbnVtIHZlcnRzIHRvIHplcm8KCV9fbVtlX19ZWU0uTnVtVmVydHNdID0gMDsKCV9fbVtlX19ZWU0uTnVtUG9pbnRDb2xzXSA9IDA7CglfX21bZV9fWVlNLk51bUxpbmVDb2xzXSA9IDA7CglfX21bZV9fWVlNLk51bVRyaUNvbHNdID0gMDsKfQoKZnVuY3Rpb24gZDNkX21vZGVsX2NvbmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIEFkZHMgYSBjb25lIHNoYXBlIHRvIHRoZSBtb2RlbC4KCS8vLyBAcGFyYW0gaW5kIFRoZSBtb2RlbCBpbmRleCB0byBhZGQgdGhlIGNvbmUgdG8uCgkvLy8gQHBhcmFtIHgxIFRoZSBpbml0aWFsIHggY29vcmRpbmF0ZSBvZiB0aGUgY29uZS4KCS8vLyBAcGFyYW0geTEgVGhlIGluaXRpYWwgeSBjb29yZGluYXRlIG9mIHRoZSBjb25lLgoJLy8vIEBwYXJhbSB6MSBUaGUgaW5pdGlhbCB6IGNvb3JkaW5hdGUgb2YgdGhlIGNvbmUuCgkvLy8gQHBhcmFtIHgyIFRoZSBvcHBvc2l0ZSB4IGNvb3JkaW5hdGUgb2YgdGhlIGNvbmUuCgkvLy8gQHBhcmFtIHkyIFRoZSBvcHBvc2l0ZSB5IGNvb3JkaW5hdGUgb2YgdGhlIGNvbmUuIAoJLy8vIEBwYXJhbSB6MiBUaGUgb3Bwb3NpdGUgeiBjb29yZGluYXRlIG9mIHRoZSBjb25lLgoJLy8vIEBwYXJhbSBocmVwZWF0IEFtb3VudCBvZiBob3Jpem9udGFsIHJlcGV0aXRpb25zIGZvciB0aGUgdGV4dHVyZS4KCS8vLyBAcGFyYW0gdnJlcGVhdCBBbW91bnQgb2YgdmVydGljYWwgcmVwZXRpdGlvbnMgZm9yIHRoZSB0ZXh0dXJlLgoJLy8vIEBwYXJhbSBjbG9zZWQgU2V0cyB3aGV0aGVyIHRvIGNsb3NlICh0cnVlKSB0aGUgYm90dG9tIG9mIHRoZSBjb25lIG9yIG5vdCAoZmFsc2UpLgoJLy8vIEBwYXJhbSBzdGVwcyBIb3cgbWFueSBzdGVwcyBhcmUgdXNlZCB0byBtYWtlIHRoZSBjb25lICJyb3VuZCIgKHR5cGljYWxseSAyNCkKCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9faW5kID0gYXJndW1lbnQwOwoJdmFyIF9feDEgPSBhcmd1bWVudDE7Cgl2YXIgX195MSA9IGFyZ3VtZW50MjsKCXZhciBfX3oxID0gYXJndW1lbnQzOwoJdmFyIF9feDIgPSBhcmd1bWVudDQ7Cgl2YXIgX195MiA9IGFyZ3VtZW50NTsKCXZhciBfX3oyID0gYXJndW1lbnQ2OwoJdmFyIF9faHJlcGVhdCA9IGFyZ3VtZW50NzsKCXZhciBfX3ZyZXBlYXQgPSBhcmd1bWVudDg7Cgl2YXIgX19jbG9zZWQgPSBhcmd1bWVudDk7Cgl2YXIgX19zdGVwcyA9IGFyZ3VtZW50MTA7CgkKCWlmIChfX3N0ZXBzIDwgMykKCXsKCQlfX3N0ZXBzID0gMzsKCX0KCQoJaWYgKF9fc3RlcHMgPiAxMjgpCgl7CgkJX19zdGVwcyA9IDEyODsKCX0KCQoJLy8gQ3JlYXRlIHNpbiBhbmQgY29zIHRhYmxlcwoJdmFyIF9fY2M7Cgl2YXIgX19zczsKCQoJX19jY1tfX3N0ZXBzXSA9IDA7CglfX3NzW19fc3RlcHNdID0gMDsKCQoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPD0gX19zdGVwczsgX19pKyspCgl7CgkJdmFyIF9fcmFkID0gKF9faSAqIDIuMCAqIHBpKSAvIF9fc3RlcHM7CgkJX19jY1tfX2ldID0gY29zKF9fcmFkKTsKCQlfX3NzW19faV0gPSBzaW4oX19yYWQpOwoJfQoJCgl2YXIgX19teCA9IChfX3gyICsgX194MSkgLyAyOwoJdmFyIF9fbXkgPSAoX195MiArIF9feTEpIC8gMjsKCXZhciBfX3J4ID0gKF9feDIgLSBfX3gxKSAvIDI7Cgl2YXIgX19yeSA9IChfX3kyIC0gX195MSkgLyAyOwoJCglkM2RfbW9kZWxfcHJpbWl0aXZlX2JlZ2luKF9faW5kLCBwcl90cmlhbmdsZXN0cmlwKTsKCQoJZm9yKF9faSA9IDA7IF9faSA8PSBfX3N0ZXBzOyBfX2krKykKCXsKCQlkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX214LCBfX215LCBfX3oyLCAwLCAwLCAxLCBfX2hyZXBlYXQgKiBfX2kgLyBfX3N0ZXBzLCBfX3ZyZXBlYXQpOwoJCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9fbXggKyBfX2NjW19faV0qX19yeCwgX19teSArIF9fc3NbX19pXSpfX3J5LCBfX3oxLCBfX2NjW19faV0gLCBfX3NzW19faV0gLDAgLCBfX2hyZXBlYXQgKiBfX2kgLyBfX3N0ZXBzLCAwKTsKCX0KCQoJZDNkX21vZGVsX3ByaW1pdGl2ZV9lbmQoX19pbmQpOwoJCglpZiAoX19jbG9zZWQgPT0gdHJ1ZSkKCXsKCQlkM2RfbW9kZWxfcHJpbWl0aXZlX2JlZ2luKF9faW5kLCBwcl90cmlhbmdsZWZhbik7CgkJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX2luZCwgX19teCwgX19teSwgX196MSwgMCwgMCwgLTEsIDAsIDApOwoJCWZvcihfX2kgPSBfX3N0ZXBzOyBfX2kgPj0gMDsgX19pLS0pCgkJewoJCQlkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX214K19fY2NbX19pXSpfX3J4LCBfX215K19fc3NbX19pXSpfX3J5LCBfX3oxLCAwLCAwLCAtMSwgMCwgMCk7CQkKCQl9CgkJZDNkX21vZGVsX3ByaW1pdGl2ZV9lbmQoX19pbmQpOwoJfQp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfY3JlYXRlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBDcmVhdGVzIGEgbmV3IG1vZGVsIGFuZCByZXR1cm5zIGl0cyBpbmRleC4KCS8vLyBAcmV0dXJucyB7bnVtYmVyfSByZXR1cm5zIHRoZSBuZXcgbW9kZWwKCQoJdmFyIHBvaW50Y29sczsKCXZhciBsaW5lY29sczsKCXZhciB0cmljb2xzOwoJcG9pbnRjb2xzWzBdID0gLTE7CglsaW5lY29sc1swXSA9IC0xOwoJdHJpY29sc1swXSA9IC0xOwoJCgl2YXIgbW9kZWwgPSBbIHVuZGVmaW5lZCwJCQkJLy8gcG9pbnQgYnVmZmVyCgkJCQkgIHVuZGVmaW5lZCwJCQkJLy8gbGluZSBidWZmZXIKCQkJCSAgdW5kZWZpbmVkLAkJCQkvLyB0cmkgbGlzdCBidWZmZXIKCQkJCSAgdW5kZWZpbmVkLAkJCQkvLyBwb2ludCB1diBidWZmZXIKCQkJCSAgdW5kZWZpbmVkLAkJCQkvLyBsaW5lIHV2IGJ1ZmZlcgoJCQkJICB1bmRlZmluZWQsCQkJCS8vIHRyaSB1diBidWZmZXIKCQkJCSAgdW5kZWZpbmVkLAkJCQkvLyBwb2ludCB2ZXJ0ZXggYnVmZmVyCgkJCQkgIHVuZGVmaW5lZCwJCQkJLy8gbGluZSB2ZXJ0ZXggYnVmZmVyCgkJCQkgIHVuZGVmaW5lZCwJCQkJLy8gdHJpIGxpc3QgYnVmZmVyCQkJICAKCQkJCSAgJDAwMDEwMDAwLC8qZHJhd19nZXRfY29sb3VyKCksKi8JCS8vIGNvbG91ciB1c2VkIHdoZW4gY3JlYXRpbmcKCQkJCSAgLTEsCQkJCQkJLy8gbGFzdCB0ZXh0dXJlIHVzZWQgZm9yIGRyYXdpbmcKCQkJCSAgMCwJCQkJCQkvLyBudW0gdmVydGljZXMKCQkJCSAgMCwJCQkJCQkvLyBwcmltIGtpbmQKCQkJCSAgMCwJCQkJCQkvLyBudW1iZXIgb2Ygbm9uLWNvbG91ciBwb2ludCB2ZXJ0aWNlcwoJCQkJICAwLAkJCQkJCS8vIG51bWJlciBvZiBub24tY29sb3VyIGxpbmUgdmVydGljZXMKCQkJCSAgMCwJCQkJCQkvLyBudW1iZXIgb2Ygbm9uLWNvbG91ciB0cmkgdmVydGljZXMKCQkJCSAgcG9pbnRjb2xzLAkJCQkvLyBvZmZzZXRzIHRvIHBvaW50IGNvbG91cnMKCQkJCSAgbGluZWNvbHMsCQkJCQkvLyBvZmZzZXRzIHRvIGxpbmUgY29sb3VycwoJCQkJICB0cmljb2xzLAkJCQkJLy8gb2Zmc2V0cyB0byB0cmkgY29sb3VycwoJCQkJICAKCQkJCSAgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwJLy8gdmVydGV4IDEKCQkJCSAgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwJLy8gdmVydGV4IDIKCQkJCSAgCgkJCQldOwoJCQkJICAKCXJldHVybiBtb2RlbDsKCQoJCgp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfY3lsaW5kZXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIEFkZHMgYSBjeWxpbmRlciBzaGFwZSB0byB0aGUgbW9kZWwuCgkvLy8gQHBhcmFtIGluZCBUaGUgbW9kZWwgaW5kZXggdG8gYWRkIHRoZSBjeWxpbmRlciB0by4KCS8vLyBAcGFyYW0geDEgVGhlIGluaXRpYWwgeCBjb29yZGluYXRlIG9mIHRoZSBjeWxpbmRlci4KCS8vLyBAcGFyYW0geTEgVGhlIGluaXRpYWwgeSBjb29yZGluYXRlIG9mIHRoZSBjeWxpbmRlci4KCS8vLyBAcGFyYW0gejEgVGhlIGluaXRpYWwgeiBjb29yZGluYXRlIG9mIHRoZSBjeWxpbmRlci4KCS8vLyBAcGFyYW0geDIgVGhlIG9wcG9zaXRlIHggY29vcmRpbmF0ZSBvZiB0aGUgY3lsaW5kZXIuCgkvLy8gQHBhcmFtIHkyIFRoZSBvcHBvc2l0ZSB5IGNvb3JkaW5hdGUgb2YgdGhlIGN5bGluZGVyLiAKCS8vLyBAcGFyYW0gejIgVGhlIG9wcG9zaXRlIHogY29vcmRpbmF0ZSBvZiB0aGUgY3lsaW5kZXIuCgkvLy8gQHBhcmFtIGhyZXBlYXQgQW1vdW50IG9mIGhvcml6b250YWwgcmVwZXRpdGlvbnMgZm9yIHRoZSB0ZXh0dXJlLgoJLy8vIEBwYXJhbSB2cmVwZWF0IEFtb3VudCBvZiB2ZXJ0aWNhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHBhcmFtIGNsb3NlZCBTZXRzIHdoZXRoZXIgdG8gY2xvc2UgKHRydWUpIHRoZSBib3R0b20gYW5kIHRvcCBvZiB0aGUgY3lsaW5kZXIgb3Igbm90IChmYWxzZSkuCgkvLy8gQHBhcmFtIHN0ZXBzIEhvdyBtYW55IHN0ZXBzIGFyZSB1c2VkIHRvIG1ha2UgdGhlIGN5bGluZGVyICJyb3VuZCIgKHR5cGljYWxseSAyNCkKCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9faW5kID0gYXJndW1lbnQwOwoJdmFyIF9feDEgPSBhcmd1bWVudDE7Cgl2YXIgX195MSA9IGFyZ3VtZW50MjsKCXZhciBfX3oxID0gYXJndW1lbnQzOwoJdmFyIF9feDIgPSBhcmd1bWVudDQ7Cgl2YXIgX195MiA9IGFyZ3VtZW50NTsKCXZhciBfX3oyID0gYXJndW1lbnQ2OwoJdmFyIF9faHJlcGVhdCA9IGFyZ3VtZW50NzsKCXZhciBfX3ZyZXBlYXQgPSBhcmd1bWVudDg7Cgl2YXIgX19jbG9zZWQgPSBhcmd1bWVudDk7Cgl2YXIgX19zdGVwcyA9IGFyZ3VtZW50MTA7CgkKCWlmIChfX3N0ZXBzIDwgMykKCXsKCQlfX3N0ZXBzID0gMzsKCX0KCQoJaWYgKF9fc3RlcHMgPiAxMjgpCgl7CgkJX19zdGVwcyA9IDEyODsKCX0KCQoJLy8gQ3JlYXRlIHNpbiBhbmQgY29zIHRhYmxlcwoJdmFyIF9fY2M7Cgl2YXIgX19zczsKCQoJX19jY1tfX3N0ZXBzXSA9IDA7CglfX3NzW19fc3RlcHNdID0gMDsKCQoJdmFyIF9faTsKCWZvcihfX2kgPSAwOyBfX2kgPD0gX19zdGVwczsgX19pKyspCgl7CgkJdmFyIF9fcmFkID0gKF9faSAqIDIuMCAqIHBpKSAvIF9fc3RlcHM7CgkJX19jY1tfX2ldID0gY29zKF9fcmFkKTsKCQlfX3NzW19faV0gPSBzaW4oX19yYWQpOwoJfQoJCgl2YXIgX19teCA9IChfX3gyICsgX194MSkgLyAyOwoJdmFyIF9fbXkgPSAoX195MiArIF9feTEpIC8gMjsKCXZhciBfX3J4ID0gKF9feDIgLSBfX3gxKSAvIDI7Cgl2YXIgX19yeSA9IChfX3kyIC0gX195MSkgLyAyOwoJCglpZiAoX19jbG9zZWQgPT0gdHJ1ZSkKCXsKCQlkM2RfbW9kZWxfcHJpbWl0aXZlX2JlZ2luKF9faW5kLCBwcl90cmlhbmdsZWZhbik7CgkJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX2luZCwgX19teCwgX19teSwgX196MiwgMCwgMCwgMSwgMCwgX192cmVwZWF0KTsKCQlmb3IoX19pID0gMDsgX19pIDw9IF9fc3RlcHM7IF9faSsrKQoJCXsKCQkJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX2luZCwgX19teCtfX2NjW19faV0qX19yeCwgX19teStfX3NzW19faV0qX19yeSwgX196MiwgMCwgMCwgMSwgMCwgX192cmVwZWF0KTsJCQoJCX0KCQlkM2RfbW9kZWxfcHJpbWl0aXZlX2VuZChfX2luZCk7Cgl9CgkKCWQzZF9tb2RlbF9wcmltaXRpdmVfYmVnaW4oX19pbmQsIHByX3RyaWFuZ2xlc3RyaXApOwoJCglmb3IoX19pID0gMDsgX19pIDw9IF9fc3RlcHM7IF9faSsrKQoJewoJCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9fbXggKyBfX2NjW19faV0qX19yeCwgX19teSArIF9fc3NbX19pXSpfX3J5LCBfX3oyLCBfX2NjW19faV0gLCBfX3NzW19faV0gLDAgLCBfX2hyZXBlYXQgKiBfX2kgLyBfX3N0ZXBzLCBfX3ZyZXBlYXQpOwoJCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9fbXggKyBfX2NjW19faV0qX19yeCwgX19teSArIF9fc3NbX19pXSpfX3J5LCBfX3oxLCBfX2NjW19faV0gLCBfX3NzW19faV0gLDAgLCBfX2hyZXBlYXQgKiBfX2kgLyBfX3N0ZXBzLCAwKTsKCX0KCQoJZDNkX21vZGVsX3ByaW1pdGl2ZV9lbmQoX19pbmQpOwoJCglpZiAoX19jbG9zZWQgPT0gdHJ1ZSkKCXsKCQlkM2RfbW9kZWxfcHJpbWl0aXZlX2JlZ2luKF9faW5kLCBwcl90cmlhbmdsZWZhbik7CgkJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX2luZCwgX19teCwgX19teSwgX196MSwgMCwgMCwgLTEsIDAsIDApOwoJCWZvcihfX2kgPSBfX3N0ZXBzOyBfX2kgPj0gMDsgX19pLS0pCgkJewoJCQlkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX214K19fY2NbX19pXSpfX3J4LCBfX215K19fc3NbX19pXSpfX3J5LCBfX3oxLCAwLCAwLCAtMSwgMCwgMCk7CQkKCQl9CgkJZDNkX21vZGVsX3ByaW1pdGl2ZV9lbmQoX19pbmQpOwoJfQp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfZGVzdHJveSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRGVzdHJveXMgdGhlIG1vZGVsIHdpdGggdGhlIGdpdmVuIGluZGV4LCBmcmVlaW5nIGl0cyBtZW1vcnkuCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIG1vZGVsIHRvIGJlIGRlc3Ryb3llZC4KCS8vLyBAcmV0dXJucyAKCQoJZDNkX21vZGVsX2NsZWFyKGFyZ3VtZW50MCk7Cn0KCmZ1bmN0aW9uIGQzZF9tb2RlbF9kcmF3KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEcmF3cyB0aGUgbW9kZWwgYXQgcG9zaXRpb24gKHgsIHksIHopLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBtb2RlbCB0byBiZSBkcmF3bi4KCS8vLyBAcGFyYW0geCBUaGUgeCBwb3NpdGlvbiB0byBkcmF3IHRoZSBtb2RlbC4gCgkvLy8gQHBhcmFtIHkgVGhlIHkgcG9zaXRpb24gdG8gZHJhdyB0aGUgbW9kZWwuCgkvLy8gQHBhcmFtIHogVGhlIHogcG9zaXRpb24gdG8gZHJhdyB0aGUgbW9kZWwuCgkvLy8gQHBhcmFtIHRleGlkIFRoZSB0ZXh0dXJlIHRvIHVzZSBmb3IgZHJhd2luZyB0aGUgbW9kZWwgKHVzZSAtMSB0byB1c2Ugbm8gdGV4dHVyZSkuCgkvLy8gQHJldHVybnMKCQoJdmFyIG0gPSBhcmd1bWVudDA7CgkKCXZhciB0ZXggPSBhcmd1bWVudDQ7Cgl2YXIgdmVydHNpemUgPSAzNjsKCXZhciB2ZXJ0dXZvZmZzZXQgPSAyODsKCWlmICh0ZXghPS0xICYmIHRleCAhPSBtW2VfX1lZTS5UZXh0dXJlXSkKCXsJCgkKCQl2YXIgdGV4dXZzID0gdGV4dHVyZV9nZXRfdXZzKHRleCk7CgkJdmFyIHVzcGFuID0gdGV4dXZzWzJdIC0gdGV4dXZzWzBdOwoJCXZhciB2c3BhbiA9IHRleHV2c1szXSAtIHRleHV2c1sxXTsKCQl2YXIgdWJhc2UgID0gdGV4dXZzWzBdOwoJCXZhciB2YmFzZSAgPSB0ZXh1dnNbMV07CgkKCQkKCQkvLyBDb3B5IGFuZCBzY2FsZVxiaWFzIHRoZSB1bm1vbGVzdGVkIFVWIGNvb3JkcyB0byBvdXIgYnVmZmVycwoJCXZhciBfX2k7CgkJCgkJaWYgKChtW2VfX1lZTS5Qb2ludEJdICE9IHVuZGVmaW5lZCkgJiYgKG1bZV9fWVlNLlBvaW50VVZCXSAhPSB1bmRlZmluZWQpKQoJCXsKCQkJdmFyIG51bXZlcnRzID0gYnVmZmVyX3RlbGwobVtlX19ZWU0uUG9pbnRVVkJdKSAvIDg7CgkJCQkJCgkJCWJ1ZmZlcl9zZWVrKG1bZV9fWVlNLlBvaW50VVZCXSwgYnVmZmVyX3NlZWtfc3RhcnQsIDApOwoJCQl2YXIgX191dnBvcyA9IHZlcnR1dm9mZnNldDsKCQkJdmFyIF9fc3JjID0gbVtlX19ZWU0uUG9pbnRVVkJdOwoJCQl2YXIgX19kZXN0ID0gbVtlX19ZWU0uUG9pbnRCXTsKCQkJZm9yKF9faSA9IDA7IF9faSA8IG51bXZlcnRzOyBfX2krKykKCQkJewoJCQkJdmFyIF9fdSA9IGJ1ZmZlcl9yZWFkKF9fc3JjLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX3YgPSBidWZmZXJfcmVhZChfX3NyYywgYnVmZmVyX2YzMik7CgkJCQkKCQkJCV9fdSA9IChfX3UgKiB1c3BhbikgKyB1YmFzZTsKCQkJCV9fdiA9IChfX3YgKiB2c3BhbikgKyB2YmFzZTsKCQkJCQkJCQoJCQkJYnVmZmVyX3Bva2UoX19kZXN0LCBfX3V2cG9zLCBidWZmZXJfZjMyLCBfX3UpOwoJCQkJYnVmZmVyX3Bva2UoX19kZXN0LCBfX3V2cG9zICsgNCwgYnVmZmVyX2YzMiwgX192KTsKCQkJCQoJCQkJX191dnBvcyArPSB2ZXJ0c2l6ZTsKCQkJfQoJCX0KCQkKCQlpZiAoKG1bZV9fWVlNLkxpbmVCXSAhPSB1bmRlZmluZWQpICYmIChtW2VfX1lZTS5MaW5lVVZCXSAhPSB1bmRlZmluZWQpKQoJCXsKCQkJdmFyIG51bXZlcnRzID0gYnVmZmVyX3RlbGwobVtlX19ZWU0uTGluZVVWQl0pIC8gODsKCQkJCQkKCQkJYnVmZmVyX3NlZWsobVtlX19ZWU0uTGluZVVWQl0sIGJ1ZmZlcl9zZWVrX3N0YXJ0LCAwKTsKCQkJdmFyIF9fdXZwb3MgPSB2ZXJ0dXZvZmZzZXQ7CgkJCXZhciBfX3NyYyA9IG1bZV9fWVlNLkxpbmVVVkJdOwoJCQl2YXIgX19kZXN0ID0gbVtlX19ZWU0uTGluZUJdOwoJCQlmb3IoX19pID0gMDsgX19pIDwgbnVtdmVydHM7IF9faSsrKQoJCQl7CgkJCQl2YXIgX191ID0gYnVmZmVyX3JlYWQoX19zcmMsIGJ1ZmZlcl9mMzIpOwoJCQkJdmFyIF9fdiA9IGJ1ZmZlcl9yZWFkKF9fc3JjLCBidWZmZXJfZjMyKTsKCQkJCQoJCQkJX191ID0gKF9fdSAqIHVzcGFuKSArIHViYXNlOwoJCQkJX192ID0gKF9fdiAqIHZzcGFuKSArIHZiYXNlOwoJCQkJCQkJCgkJCQlidWZmZXJfcG9rZShfX2Rlc3QsIF9fdXZwb3MsIGJ1ZmZlcl9mMzIsIF9fdSk7CgkJCQlidWZmZXJfcG9rZShfX2Rlc3QsIF9fdXZwb3MgKyA0LCBidWZmZXJfZjMyLCBfX3YpOwoJCQkJCgkJCQlfX3V2cG9zICs9IHZlcnRzaXplOwoJCQl9CgkJfQoJCQoJCWlmICgobVtlX19ZWU0uVHJpQl0gIT0gdW5kZWZpbmVkKSAmJiAobVtlX19ZWU0uVHJpVVZCXSAhPSB1bmRlZmluZWQpKQoJCXsKCQkJdmFyIG51bXZlcnRzID0gYnVmZmVyX3RlbGwobVtlX19ZWU0uVHJpVVZCXSkgLyA4OwoJCQkJCQoJCQlidWZmZXJfc2VlayhtW2VfX1lZTS5UcmlVVkJdLCBidWZmZXJfc2Vla19zdGFydCwgMCk7CgkJCXZhciBfX3V2cG9zID0gdmVydHV2b2Zmc2V0OwoJCQl2YXIgX19zcmMgPSBtW2VfX1lZTS5UcmlVVkJdOwoJCQl2YXIgX19kZXN0ID1tW2VfX1lZTS5UcmlCXTsKCQkJZm9yKF9faSA9IDA7IF9faSA8IG51bXZlcnRzOyBfX2krKykKCQkJewoJCQkJdmFyIF9fdSA9IGJ1ZmZlcl9yZWFkKF9fc3JjLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX3YgPSBidWZmZXJfcmVhZChfX3NyYywgYnVmZmVyX2YzMik7CgkJCQkKCQkJCV9fdSA9IChfX3UgKiB1c3BhbikgKyB1YmFzZTsKCQkJCV9fdiA9IChfX3YgKiB2c3BhbikgKyB2YmFzZTsKCQkJCQkJCQoJCQkJYnVmZmVyX3Bva2UoX19kZXN0LCBfX3V2cG9zLCBidWZmZXJfZjMyLCBfX3UpOwoJCQkJYnVmZmVyX3Bva2UoX19kZXN0LCBfX3V2cG9zICsgNCwgYnVmZmVyX2YzMiwgX192KTsKCQkJCQoJCQkJX191dnBvcyArPSB2ZXJ0c2l6ZTsKCQkJfQoJCX0KCQkKCQkKCQltW0BlX19ZWU0uVGV4dHVyZV0gPSB0ZXg7CgkKCQkvLyByZW1vdmUgdGhlIGN1cnJlbnQgVmVydGV4IEJ1ZmZlcnMgaWYgcHJlc2VudAoJCWlmIChtW2VfX1lZTS5Qb2ludFZCXSAhPSB1bmRlZmluZWQpIHsKCQkJdmVydGV4X2RlbGV0ZV9idWZmZXIobVtlX19ZWU0uUG9pbnRWQl0pOwoJCQltW0BlX19ZWU0uUG9pbnRWQl0gPSB1bmRlZmluZWQ7CgkJfSAvLyBlbmQgaWYKCQoJCWlmIChtW2VfX1lZTS5MaW5lVkJdICE9IHVuZGVmaW5lZCkgewoJCQl2ZXJ0ZXhfZGVsZXRlX2J1ZmZlcihtW2VfX1lZTS5MaW5lVkJdKTsKCQkJbVtAZV9fWVlNLkxpbmVWQl0gPSB1bmRlZmluZWQ7CgkJfSAvLyBlbmQgaWYKCQkKCQlpZiAobVtlX19ZWU0uVHJpVkJdICE9IHVuZGVmaW5lZCkgewoJCQl2ZXJ0ZXhfZGVsZXRlX2J1ZmZlcihtW2VfX1lZTS5UcmlWQl0pOwoJCQltW0BlX19ZWU0uVHJpVkJdID0gdW5kZWZpbmVkOwoJCX0gLy8gZW5kIGlmCgl9CgkKCQoJdmFyIGN1cnJDb2xvdXIgPSBkcmF3X2dldF9jb2xvdXIoKSB8ICgoZHJhd19nZXRfYWxwaGEoKSoyNTUuMCkgPDwgMjQpOwoJLy8gaWYgY29sb3VyIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBwcmV2aW91cyBjYWNoZWQgZW50cnkgdGhlbiByZWJ1aWxkIHRoZSBtb2RlbAoJaWYgKChjdXJyQ29sb3VyICE9IG1bZV9fWVlNLkNvbG91cl0pICYmICgobVtlX19ZWU0uTnVtUG9pbnRDb2xzXSA+IDApIHx8IChtW2VfX1lZTS5OdW1MaW5lQ29sc10gPiAwKSB8fCAobVtlX19ZWU0uTnVtVHJpQ29sc10gPiAwKSkpIHsKCQoJCXZhciBfX251bVBvaW50Q29scyA9IG1bZV9fWVlNLk51bVBvaW50Q29sc107CgkJdmFyIF9fbnVtTGluZUNvbHMgPSBtW2VfX1lZTS5OdW1MaW5lQ29sc107CgkJdmFyIF9fbnVtVHJpQ29scyA9IG1bZV9fWVlNLk51bVRyaUNvbHNdOwoJCgkJLy8gZ28gdGhyb3VnaCBhbmQgY2hhbmdlIGFsbCB0aGUgZW50cmllcyB3aXRoIG5vIGNvbG91ciBpbiB0aGVtIHRvIGJlIHRoZSBzYW1lIGFzIHRoZSBkcmF3IGNvbG91cgoJCXZhciBfX2k7CgkJCgkJaWYgKG1bZV9fWVlNLlBvaW50Ql0gIT0gdW5kZWZpbmVkKQoJCXsKCQkJdmFyIF9fb2Zmc2V0cyA9IG1bZV9fWVlNLlBvaW50Q29sc107CgkJCXZhciBfX2Rlc3QgPSBtW2VfX1lZTS5Qb2ludEJdOwoJCQlmb3IoX19pID0gMDsgX19pIDwgX19udW1Qb2ludENvbHM7IF9faSsrKQoJCQl7CgkJCQlidWZmZXJfcG9rZShfX2Rlc3QsIF9fb2Zmc2V0c1tfX2ldLCBidWZmZXJfdTMyLCBjdXJyQ29sb3VyKTsKCQkJfQoJCX0KCQkKCQlpZiAobVtlX19ZWU0uTGluZUJdICE9IHVuZGVmaW5lZCkKCQl7CgkJCXZhciBfX29mZnNldHMgPSBtW2VfX1lZTS5MaW5lQ29sc107CgkJCXZhciBfX2Rlc3QgPSBtW2VfX1lZTS5MaW5lQl07CgkJCWZvcihfX2kgPSAwOyBfX2kgPCBfX251bUxpbmVDb2xzOyBfX2krKykKCQkJewoJCQkJYnVmZmVyX3Bva2UoX19kZXN0LCBfX29mZnNldHNbX19pXSwgYnVmZmVyX3UzMiwgY3VyckNvbG91cik7CgkJCX0KCQl9CgkJCgkJaWYgKG1bZV9fWVlNLlRyaUJdICE9IHVuZGVmaW5lZCkKCQl7CgkJCXZhciBfX29mZnNldHMgPSBtW2VfX1lZTS5UcmlDb2xzXTsKCQkJdmFyIF9fZGVzdCA9IG1bZV9fWVlNLlRyaUJdOwoJCQlmb3IoX19pID0gMDsgX19pIDwgX19udW1UcmlDb2xzOyBfX2krKykKCQkJewoJCQkJYnVmZmVyX3Bva2UoX19kZXN0LCBfX29mZnNldHNbX19pXSwgYnVmZmVyX3UzMiwgY3VyckNvbG91cik7CgkJCX0KCQl9CgkKCQkvLyByZW1vdmUgdGhlIGN1cnJlbnQgVmVydGV4IEJ1ZmZlcnMgaWYgcHJlc2VudAoJCWlmIChtW2VfX1lZTS5Qb2ludFZCXSAhPSB1bmRlZmluZWQpIHsKCQkJdmVydGV4X2RlbGV0ZV9idWZmZXIobVtlX19ZWU0uUG9pbnRWQl0pOwoJCQltW0BlX19ZWU0uUG9pbnRWQl0gPSB1bmRlZmluZWQ7CgkJfSAvLyBlbmQgaWYKCQoJCWlmIChtW2VfX1lZTS5MaW5lVkJdICE9IHVuZGVmaW5lZCkgewoJCQl2ZXJ0ZXhfZGVsZXRlX2J1ZmZlcihtW2VfX1lZTS5MaW5lVkJdKTsKCQkJbVtAZV9fWVlNLkxpbmVWQl0gPSB1bmRlZmluZWQ7CgkJfSAvLyBlbmQgaWYKCQkKCQlpZiAobVtlX19ZWU0uVHJpVkJdICE9IHVuZGVmaW5lZCkgewoJCQl2ZXJ0ZXhfZGVsZXRlX2J1ZmZlcihtW2VfX1lZTS5UcmlWQl0pOwoJCQltW0BlX19ZWU0uVHJpVkJdID0gdW5kZWZpbmVkOwoJCX0gLy8gZW5kIGlmCgkJCgkJbVtAZV9fWVlNLkNvbG91cl0gPSBjdXJyQ29sb3VyOwoJfSAvLyBlbmQgaWYKCQoJLy8gc2V0IHRoZSB0cmFuc2xhdGlvbiB0byB0aGlzIChhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzKQoJdmFyIG1XID0gbWF0cml4X2dldCggbWF0cml4X3dvcmxkICk7Cgl2YXIgbVQgPSBtYXRyaXhfYnVpbGQoIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDMsIDAsIDAsIDAsIDEsIDEsIDEgKTsKCXZhciBtTmV3ID0gbWF0cml4X211bHRpcGx5KCBtVCwgbVcgKTsKCW1hdHJpeF9zZXQoIG1hdHJpeF93b3JsZCwgbU5ldyApOwoJCgl2YXIgX19vbGRyZXAgPSBncHVfZ2V0X3RleHJlcGVhdCgpOwoJZ3B1X3NldF90ZXhyZXBlYXQodHJ1ZSkJCgkKCS8vIGRyYXcgdGhlIHRyaSBsaXN0IGJ1ZmZlcgoJaWYgKG1bZV9fWVlNLlRyaUJdICE9IHVuZGVmaW5lZCkgewoJCgkJLy8gY29udmVydCB0byBhIHZlcnRleCBidWZmZXIgaWYgbmVlZCBiZQoJCWlmIChtW2VfX1lZTS5UcmlWQl0gPT0gdW5kZWZpbmVkKSB7CgkJCW1bQGVfX1lZTS5UcmlWQl0gPSB2ZXJ0ZXhfY3JlYXRlX2J1ZmZlcl9mcm9tX2J1ZmZlciggbVtlX19ZWU0uVHJpQl0sIGdsb2JhbC5fX2QzZFByaW1WRiApOwoJCQl2ZXJ0ZXhfZnJlZXplKG1bZV9fWVlNLlRyaVZCXSk7CQkKCQl9IC8vIGVuZCBpZgoJCQoJCXZlcnRleF9zdWJtaXQoIG1bZV9fWVlNLlRyaVZCXSwgcHJfdHJpYW5nbGVsaXN0LCBhcmd1bWVudDQgKTsKCX0gLy8gZW5kIGlmCgkKCS8vIGRyYXcgdGhlIGxpbmUgYnVmZmVyCglpZiAobVtlX19ZWU0uTGluZUJdICE9IHVuZGVmaW5lZCkgewoJCgkJLy8gY29udmVydCB0byBhIHZlcnRleCBidWZmZXIgaWYgbmVlZCBiZQoJCWlmIChtW2VfX1lZTS5MaW5lVkJdID09IHVuZGVmaW5lZCkgewoJCQltW0BlX19ZWU0uTGluZVZCXSA9IHZlcnRleF9jcmVhdGVfYnVmZmVyX2Zyb21fYnVmZmVyKCBtW2VfX1lZTS5MaW5lQl0sIGdsb2JhbC5fX2QzZFByaW1WRiApOwoJCQl2ZXJ0ZXhfZnJlZXplKG1bZV9fWVlNLkxpbmVWQl0pOwoJCX0gLy8gZW5kIGlmCgkJCgkJdmVydGV4X3N1Ym1pdCggbVtlX19ZWU0uTGluZVZCXSwgcHJfbGluZWxpc3QsIGFyZ3VtZW50NCApOwoJfSAvLyBlbmQgaWYKCQoJLy8gZHJhdyB0aGUgcG9pbnQgYnVmZmVyCglpZiAobVtlX19ZWU0uUG9pbnRCXSAhPSB1bmRlZmluZWQpIHsKCQoJCS8vIGNvbnZlcnQgdG8gYSB2ZXJ0ZXggYnVmZmVyIGlmIG5lZWQgYmUKCQlpZiAobVtlX19ZWU0uUG9pbnRWQl0gPT0gdW5kZWZpbmVkKSB7CgkJCW1bQGVfX1lZTS5Qb2ludFZCXSA9IHZlcnRleF9jcmVhdGVfYnVmZmVyX2Zyb21fYnVmZmVyKCBtW2VfX1lZTS5Qb2ludEJdLCBnbG9iYWwuX19kM2RQcmltVkYgKTsKCQkJdmVydGV4X2ZyZWV6ZShtW2VfX1lZTS5Qb2ludFZCXSk7CgkJfSAvLyBlbmQgaWYKCQkKCQl2ZXJ0ZXhfc3VibWl0KCBtW2VfX1lZTS5Qb2ludFZCXSwgcHJfcG9pbnRsaXN0LCAgYXJndW1lbnQ0ICk7Cgl9IC8vIGVuZCBpZgoJCgkvLyBSZXN0b3JlIHRoZSBtYXRyaXgKCW1hdHJpeF9zZXQoIG1hdHJpeF93b3JsZCwgbVcgKTsKCQoJZ3B1X3NldF90ZXhyZXBlYXQoX19vbGRyZXApOwoKfQoKZnVuY3Rpb24gZDNkX21vZGVsX2VsbGlwc29pZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gQWRkcyBhbiBlbGxpcHNvaWQgc2hhcGUgdG8gdGhlIG1vZGVsLgoJLy8vIEBwYXJhbSBpbmQgVGhlIG1vZGVsIGluZGV4IHRvIGFkZCB0aGUgZWxsaXBzb2lkIHRvLgoJLy8vIEBwYXJhbSB4MSBUaGUgaW5pdGlhbCB4IGNvb3JkaW5hdGUgb2YgdGhlIGVsbGlwc29pZC4KCS8vLyBAcGFyYW0geTEgVGhlIGluaXRpYWwgeSBjb29yZGluYXRlIG9mIHRoZSBlbGxpcHNvaWQuCgkvLy8gQHBhcmFtIHoxIFRoZSBpbml0aWFsIHogY29vcmRpbmF0ZSBvZiB0aGUgZWxsaXBzb2lkLgoJLy8vIEBwYXJhbSB4MiBUaGUgb3Bwb3NpdGUgeCBjb29yZGluYXRlIG9mIHRoZSBlbGxpcHNvaWQuCgkvLy8gQHBhcmFtIHkyIFRoZSBvcHBvc2l0ZSB5IGNvb3JkaW5hdGUgb2YgdGhlIGVsbGlwc29pZC4gCgkvLy8gQHBhcmFtIHoyIFRoZSBvcHBvc2l0ZSB6IGNvb3JkaW5hdGUgb2YgdGhlIGVsbGlwc29pZC4KCS8vLyBAcGFyYW0gaHJlcGVhdCBBbW91bnQgb2YgaG9yaXpvbnRhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHBhcmFtIHZyZXBlYXQgQW1vdW50IG9mIHZlcnRpY2FsIHJlcGV0aXRpb25zIGZvciB0aGUgdGV4dHVyZS4KCS8vLyBAcGFyYW0gc3RlcHMgSG93IG1hbnkgc3RlcHMgYXJlIHVzZWQgdG8gbWFrZSB0aGUgZWxsaXBzb2lkICJyb3VuZCIgKHR5cGljYWxseSAyNCkKCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9faW5kID0gYXJndW1lbnQwOwoJdmFyIF9feDEgPSBhcmd1bWVudDE7Cgl2YXIgX195MSA9IGFyZ3VtZW50MjsKCXZhciBfX3oxID0gYXJndW1lbnQzOwoJdmFyIF9feDIgPSBhcmd1bWVudDQ7Cgl2YXIgX195MiA9IGFyZ3VtZW50NTsKCXZhciBfX3oyID0gYXJndW1lbnQ2OwoJdmFyIF9faHJlcGVhdCA9IGFyZ3VtZW50NzsKCXZhciBfX3ZyZXBlYXQgPSBhcmd1bWVudDg7Cgl2YXIgX19zdGVwcyA9IGFyZ3VtZW50OTsKCQoJaWYgKF9fc3RlcHMgPCAzKQoJewoJCV9fc3RlcHMgPSAzOwoJfQoJCglpZiAoX19zdGVwcyA+IDEyOCkKCXsKCQlfX3N0ZXBzID0gMTI4OwoJfQoJCgkvLyBDcmVhdGUgc2luIGFuZCBjb3MgdGFibGVzCgl2YXIgX19jYzsKCXZhciBfX3NzOwoJCglfX2NjW19fc3RlcHNdID0gMDsKCV9fc3NbX19zdGVwc10gPSAwOwoJCgl2YXIgX19pOwoJZm9yKF9faSA9IDA7IF9faSA8PSBfX3N0ZXBzOyBfX2krKykKCXsKCQl2YXIgX19yYWQgPSAoX19pICogMi4wICogcGkpIC8gX19zdGVwczsKCQlfX2NjW19faV0gPSBjb3MoX19yYWQpOwoJCV9fc3NbX19pXSA9IHNpbihfX3JhZCk7Cgl9CgkKCXZhciBfX214ID0gKF9feDIgKyBfX3gxKSAvIDI7Cgl2YXIgX19teSA9IChfX3kyICsgX195MSkgLyAyOwoJdmFyIF9fbXogPSAoX196MiArIF9fejEpIC8gMjsKCXZhciBfX3J4ID0gKF9feDIgLSBfX3gxKSAvIDI7Cgl2YXIgX19yeSA9IChfX3kyIC0gX195MSkgLyAyOwoJdmFyIF9fcnogPSAoX196MiAtIF9fejEpIC8gMjsKCQoJdmFyIF9fcm93cyA9IChfX3N0ZXBzICsgMSkgLyAyOwoJdmFyIF9fajsKCQoJZm9yKF9faiA9IDA7IF9faiA8PSAoX19yb3dzIC0gMSk7IF9faisrKQoJewoJCXZhciBfX3JvdzFyYWQgPSAoX19qKnBpKS9fX3Jvd3M7CgkJdmFyIF9fcm93MnJhZCA9ICgoX19qKzEpKnBpKS9fX3Jvd3M7CgkJdmFyIF9fcmgxID0gY29zKF9fcm93MXJhZCk7CgkJdmFyIF9fcmQxID0gc2luKF9fcm93MXJhZCk7CgkJdmFyIF9fcmgyID0gY29zKF9fcm93MnJhZCk7CgkJdmFyIF9fcmQyID0gc2luKF9fcm93MnJhZCk7CgkJCgkJZDNkX21vZGVsX3ByaW1pdGl2ZV9iZWdpbihfX2luZCwgcHJfdHJpYW5nbGVzdHJpcCk7CgkJCgkJZm9yKF9faSA9IDA7IF9faSA8PSBfX3N0ZXBzOyBfX2krKykKCQl7CgkJCS8vIFNvbWUgY29tbW9uIHN1YmV4cHJlc3Npb25zIGhlcmUgdGhhdCBjb3VsZCBiZSBlbGltaW5hdGVkCgkJCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9fbXgrX19yeCpfX3JkMSpfX2NjW19faV0sIF9fbXkrX19yeSpfX3JkMSpfX3NzW19faV0sIF9fbXorX19yeipfX3JoMSxfX3JkMSpfX2NjW19faV0sIF9fcmQxKl9fc3NbX19pXSwgX19yaDEsIF9faHJlcGVhdCpfX2kvX19zdGVwcywgX19qKl9fdnJlcGVhdC9fX3Jvd3MpOwoJCQlkM2RfbW9kZWxfdmVydGV4X25vcm1hbF90ZXh0dXJlKF9faW5kLCBfX214K19fcngqX19yZDIqX19jY1tfX2ldLCBfX215K19fcnkqX19yZDIqX19zc1tfX2ldLCBfX216K19fcnoqX19yaDIsX19yZDIqX19jY1tfX2ldLCBfX3JkMipfX3NzW19faV0sIF9fcmgyLCBfX2hyZXBlYXQqX19pL19fc3RlcHMsIChfX2orMSkqX192cmVwZWF0L19fcm93cyk7CgkJfQoJCQoJCWQzZF9tb2RlbF9wcmltaXRpdmVfZW5kKF9faW5kKTsKCX0KCn0KCmZ1bmN0aW9uIGQzZF9tb2RlbF9mbG9vcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gQWRkcyBhIGZsb29yIHNoYXBlIHRvIHRoZSBtb2RlbC4KCS8vLyBAcGFyYW0gaW5kIFRoZSBtb2RlbCBpbmRleCB0byBhZGQgdGhlIGZsb29yIHRvLgoJLy8vIEBwYXJhbSB4MSBUaGUgaW5pdGlhbCB4IGNvb3JkaW5hdGUgb2YgdGhlIGZsb29yLgoJLy8vIEBwYXJhbSB5MSBUaGUgaW5pdGlhbCB5IGNvb3JkaW5hdGUgb2YgdGhlIGZsb29yLgoJLy8vIEBwYXJhbSB6MSBUaGUgaW5pdGlhbCB6IGNvb3JkaW5hdGUgb2YgdGhlIGZsb29yLgoJLy8vIEBwYXJhbSB4MiBUaGUgb3Bwb3NpdGUgeCBjb29yZGluYXRlIG9mIHRoZSBmbG9vci4KCS8vLyBAcGFyYW0geTIgVGhlIG9wcG9zaXRlIHkgY29vcmRpbmF0ZSBvZiB0aGUgZmxvb3IuIAoJLy8vIEBwYXJhbSB6MiBUaGUgb3Bwb3NpdGUgeiBjb29yZGluYXRlIG9mIHRoZSBmbG9vci4KCS8vLyBAcGFyYW0gaHJlcGVhdCBBbW91bnQgb2YgaG9yaXpvbnRhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHBhcmFtIHZyZXBlYXQgQW1vdW50IG9mIHZlcnRpY2FsIHJlcGV0aXRpb25zIGZvciB0aGUgdGV4dHVyZS4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9faW5kID0gYXJndW1lbnQwOwoJdmFyIF9feDEgPSBhcmd1bWVudDE7Cgl2YXIgX195MSA9IGFyZ3VtZW50MjsKCXZhciBfX3oxID0gYXJndW1lbnQzOwoJdmFyIF9feDIgPSBhcmd1bWVudDQ7Cgl2YXIgX195MiA9IGFyZ3VtZW50NTsKCXZhciBfX3oyID0gYXJndW1lbnQ2OwoJdmFyIF9faHJlcGVhdCA9IGFyZ3VtZW50NzsKCXZhciBfX3ZyZXBlYXQgPSBhcmd1bWVudDg7CgkKCXZhciBfX3hkaWZmID0gX194MiAtIF9feDE7Cgl2YXIgX196ZGlmZiA9IF9fejIgLSBfX3oxOwoJCgl2YXIgX19sc3F1YXJlZCA9IChfX3hkaWZmICogX194ZGlmZikgKyAoX196ZGlmZiAqIF9femRpZmYpOwoJaWYgKF9fbHNxdWFyZWQgPT0gMCkKCQlyZXR1cm4gMDsKCQkKCXZhciBfX2wgPSBzcXJ0KF9fbHNxdWFyZWQpOwoJCgl2YXIgX19ueCA9IC1fX3pkaWZmIC8gX19sOwoJdmFyIF9fbnogPSBfX3hkaWZmIC8gX19sOwoJCglkM2RfbW9kZWxfcHJpbWl0aXZlX2JlZ2luKF9faW5kLCBwcl90cmlhbmdsZWZhbik7CgkKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTEsIF9fejEsIF9fbngsIDAsIF9fbnosIDAsIDApOwoJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX2luZCwgX194MSwgX195MiwgX196MSwgX19ueCwgMCwgX19ueiwgMCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTIsIF9fejIsIF9fbngsIDAsIF9fbnosIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTEsIF9fejIsIF9fbngsIDAsIF9fbnosIF9faHJlcGVhdCwgMCk7CgkKCWQzZF9tb2RlbF9wcmltaXRpdmVfZW5kKF9faW5kKTsKfQoKZnVuY3Rpb24gZDNkX21vZGVsX2xvYWQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBMb2FkcyB0aGUgbW9kZWwgZnJvbSB0aGUgaW5kaWNhdGVkIGZpbGUgbmFtZS4KCS8vLyBAcGFyYW0gaW5kIFRoZSBpbmRleCBvZiB0aGUgbW9kZWwgdG8gYmUgbG9hZGVkLgoJLy8vIEBwYXJhbSBmbmFtZSBUaGUgbmFtZSBvZiB0aGUgZmlsZSB0byBsb2FkIHRoZSBtb2RlbCBmcm9tLgoJCgl2YXIgX19pbmQgPSBhcmd1bWVudDA7Cgl2YXIgX19mbmFtZSA9IGFyZ3VtZW50MTsKCQoJdmFyIF9fZmlsZSA9IGZpbGVfdGV4dF9vcGVuX3JlYWQoX19mbmFtZSk7CglpZiAoX19maWxlID09IC0xKQoJCXJldHVybiAtMTsKCQkKCS8vIEdldCB2ZXJzaW9uIG51bWJlcgoJdmFyIF9fdmVyc2lvbiA9IGZpbGVfdGV4dF9yZWFkX3JlYWwoX19maWxlKTsKCWlmIChfX3ZlcnNpb24gIT0gMTAwKQoJewoJCWZpbGVfdGV4dF9jbG9zZShfX2ZpbGUpOwoJCXJldHVybiAtIDE7IC8vIHdyb25nIHZlcnNpb24KCX0KCWZpbGVfdGV4dF9yZWFkbG4oX19maWxlKTsKCQoJLy8gR2V0IG51bWJlciBvZiBlbnRyaWVzCgl2YXIgX19udW10aGluZ3MgPSBmaWxlX3RleHRfcmVhZF9yZWFsKF9fZmlsZSk7CglmaWxlX3RleHRfcmVhZGxuKF9fZmlsZSk7CgkKCS8vIEF0IHRoaXMgcG9pbnQsIHNjcnViIHRoZSBjb250ZW50cyBvZiB0aGUgcGFzc2VkLWluIG1vZGVsCglkM2RfbW9kZWxfY2xlYXIoX19pbmQpOwoJCgkvLyBOb3cgcGFyc2UgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaWxlCgl2YXIgX19jdXJydGhpbmcgPSAwOwoJdmFyIF9faTsKCXdoaWxlKF9fY3VycnRoaW5nIDwgX19udW10aGluZ3MpCgl7CgkJLy8gRXZlcnkgZW50cnkgaXMgMTEgdmFsdWVzIC0gMSAnY29tbWFuZCcgYW5kIDEwIHBhcmFtZXRlcnMKCQl2YXIgX19raW5kID0gcm91bmQoZmlsZV90ZXh0X3JlYWRfcmVhbChfX2ZpbGUpKTsKCQl2YXIgX19hcmdzOwoJCWZvcihfX2kgPSAwOyBfX2kgPCAxMDsgX19pKyspCgkJewoJCQlfX2FyZ3NbX19pXSA9IGZpbGVfdGV4dF9yZWFkX3JlYWwoX19maWxlKTsKCQl9CgkJZmlsZV90ZXh0X3JlYWRsbihfX2ZpbGUpOwoJCQoJCXN3aXRjaChfX2tpbmQpCgkJewoJCQljYXNlIGVfX1lZTUtJTkQuUFJJTUlUSVZFX0JFR0lOOglkM2RfbW9kZWxfcHJpbWl0aXZlX2JlZ2luKF9faW5kLCByb3VuZChfX2FyZ3NbMF0pKTsgYnJlYWs7CgkJCWNhc2UgZV9fWVlNS0lORC5QUklNSVRJVkVfRU5EOgkJZDNkX21vZGVsX3ByaW1pdGl2ZV9lbmQoX19pbmQpOyBicmVhazsKCQkJY2FzZSBlX19ZWU1LSU5ELlZFUlRFWDoJCQkJZDNkX21vZGVsX3ZlcnRleChfX2luZCwgX19hcmdzWzBdLCBfX2FyZ3NbMV0sIF9fYXJnc1syXSk7IGJyZWFrOwoJCQljYXNlIGVfX1lZTUtJTkQuVkVSVEVYX0NPTE9SOgkJZDNkX21vZGVsX3ZlcnRleF9jb2xvcihfX2luZCwgX19hcmdzWzBdLCBfX2FyZ3NbMV0sIF9fYXJnc1syXSwgcm91bmQoX19hcmdzWzNdKSwgX19hcmdzWzRdKTsgYnJlYWs7CgkJCWNhc2UgZV9fWVlNS0lORC5WRVJURVhfVEVYOgkJCWQzZF9tb2RlbF92ZXJ0ZXhfdGV4dHVyZShfX2luZCwgX19hcmdzWzBdLCBfX2FyZ3NbMV0sIF9fYXJnc1syXSwgX19hcmdzWzNdLCBfX2FyZ3NbNF0pOyBicmVhazsKCQkJY2FzZSBlX19ZWU1LSU5ELlZFUlRFWF9URVhfQ09MT1I6CWQzZF9tb2RlbF92ZXJ0ZXhfdGV4dHVyZV9jb2xvcihfX2luZCwgX19hcmdzWzBdLCBfX2FyZ3NbMV0sIF9fYXJnc1syXSwgX19hcmdzWzNdLCBfX2FyZ3NbNF0sIHJvdW5kKF9fYXJnc1s1XSksIF9fYXJnc1s2XSk7IGJyZWFrOwoJCQljYXNlIGVfX1lZTUtJTkQuVkVSVEVYX046CQkJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWwoX19pbmQsIF9fYXJnc1swXSwgX19hcmdzWzFdLCBfX2FyZ3NbMl0sIF9fYXJnc1szXSwgX19hcmdzWzRdLCBfX2FyZ3NbNV0pOyBicmVhazsKCQkJY2FzZSBlX19ZWU1LSU5ELlZFUlRFWF9OX0NPTE9SOgkJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfY29sb3IoX19pbmQsIF9fYXJnc1swXSwgX19hcmdzWzFdLCBfX2FyZ3NbMl0sIF9fYXJnc1szXSwgX19hcmdzWzRdLCBfX2FyZ3NbNV0sIHJvdW5kKF9fYXJnc1s2XSksIF9fYXJnc1s3XSk7IGJyZWFrOwoJCQljYXNlIGVfX1lZTUtJTkQuVkVSVEVYX05fVEVYOgkJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX2luZCwgX19hcmdzWzBdLCBfX2FyZ3NbMV0sIF9fYXJnc1syXSwgX19hcmdzWzNdLCBfX2FyZ3NbNF0sIF9fYXJnc1s1XSwgX19hcmdzWzZdLCBfX2FyZ3NbN10pOyBicmVhazsKCQkJY2FzZSBlX19ZWU1LSU5ELlZFUlRFWF9OX1RFWF9DT0xPUjogZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZV9jb2xvcihfX2luZCwgX19hcmdzWzBdLCBfX2FyZ3NbMV0sIF9fYXJnc1syXSwgX19hcmdzWzNdLCBfX2FyZ3NbNF0sIF9fYXJnc1s1XSwgX19hcmdzWzZdLCBfX2FyZ3NbN10sIHJvdW5kKF9fYXJnc1s4XSksIF9fYXJnc1s5XSk7IGJyZWFrOwoJCQljYXNlIGVfX1lZTUtJTkQuU0hBUEVfQkxPQ0s6CQlkM2RfbW9kZWxfYmxvY2soX19pbmQsIF9fYXJnc1swXSwgX19hcmdzWzFdLCBfX2FyZ3NbMl0sIF9fYXJnc1szXSwgX19hcmdzWzRdLCBfX2FyZ3NbNV0sIF9fYXJnc1s2XSwgX19hcmdzWzddKTsgYnJlYWs7CgkJCWNhc2UgZV9fWVlNS0lORC5TSEFQRV9DWUxJTkRFUjoJCWQzZF9tb2RlbF9jeWxpbmRlcihfX2luZCwgX19hcmdzWzBdLCBfX2FyZ3NbMV0sIF9fYXJnc1syXSwgX19hcmdzWzNdLCBfX2FyZ3NbNF0sIF9fYXJnc1s1XSwgX19hcmdzWzZdLCBfX2FyZ3NbN10sIHJvdW5kKF9fYXJnc1s4XSksIHJvdW5kKF9fYXJnc1s5XSkpOyBicmVhazsKCQkJY2FzZSBlX19ZWU1LSU5ELlNIQVBFX0NPTkU6CQkJZDNkX21vZGVsX2NvbmUoX19pbmQsIF9fYXJnc1swXSwgX19hcmdzWzFdLCBfX2FyZ3NbMl0sIF9fYXJnc1szXSwgX19hcmdzWzRdLCBfX2FyZ3NbNV0sIF9fYXJnc1s2XSwgX19hcmdzWzddLCByb3VuZChfX2FyZ3NbOF0pLCByb3VuZChfX2FyZ3NbOV0pKTsgYnJlYWs7CgkJCWNhc2UgZV9fWVlNS0lORC5TSEFQRV9FTExJUFNPSUQ6CWQzZF9tb2RlbF9lbGxpcHNvaWQoX19pbmQsIF9fYXJnc1swXSwgX19hcmdzWzFdLCBfX2FyZ3NbMl0sIF9fYXJnc1szXSwgX19hcmdzWzRdLCBfX2FyZ3NbNV0sIF9fYXJnc1s2XSwgX19hcmdzWzddLCByb3VuZChfX2FyZ3NbOF0pKTsgYnJlYWs7CgkJCWNhc2UgZV9fWVlNS0lORC5TSEFQRV9XQUxMOgkJCWQzZF9tb2RlbF93YWxsKF9faW5kLCBfX2FyZ3NbMF0sIF9fYXJnc1sxXSwgX19hcmdzWzJdLCBfX2FyZ3NbM10sIF9fYXJnc1s0XSwgX19hcmdzWzVdLCBfX2FyZ3NbNl0sIF9fYXJnc1s3XSk7IGJyZWFrOwoJCQljYXNlIGVfX1lZTUtJTkQuU0hBUEVfRkxPT1I6CQlkM2RfbW9kZWxfZmxvb3IoX19pbmQsIF9fYXJnc1swXSwgX19hcmdzWzFdLCBfX2FyZ3NbMl0sIF9fYXJnc1szXSwgX19hcmdzWzRdLCBfX2FyZ3NbNV0sIF9fYXJnc1s2XSwgX19hcmdzWzddKTsgYnJlYWs7CQkKCQl9OwoJCQoJCV9fY3VycnRoaW5nKys7Cgl9CgkKCQkKCWZpbGVfdGV4dF9jbG9zZShfX2ZpbGUpOwp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfcHJpbWl0aXZlX2JlZ2luKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAgQmVnaW5zIHRoZSBwcm9jZXNzIG9mIGRlZmluaW5nIGEgcHJpbWl0aXZlIHRoYXQgaXMgdG8gYmUgYWRkZWQgdG8gYSBtb2RlbCBpbiAzRC4KCS8vLyBAcGFyYW0gaW5kIFRoZSBpbmRleCBvZiB0aGUgbW9kZWwgdG8gYWRkIHRoZSBwcmltaXRpdmUgdG8uCgkvLy8gQHBhcmFtIGtpbmQgVGhlIGtpbmQgb2YgcHJpbWl0aXZlIHlvdSBhcmUgZ29pbmcgdG8gZHJhdy4KCQoJdmFyIG0gPSBhcmd1bWVudDA7CgltW0AgZV9fWVlNLlByaW1LaW5kXSA9IGFyZ3VtZW50MTsKCQoKfQoKZnVuY3Rpb24gZDNkX21vZGVsX3ByaW1pdGl2ZV9lbmQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBFbmRzIHRoZSBwcm9jZXNzIG9mIGFkZGluZyBwcmltaXRpdmVzIHRvIGEgbW9kZWwgaW4gM0QuCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIG1vZGVsIHRvIGVuZCB0aGUgYWRkaXRpb24gb2YgcHJpbWl0aXZlcyB0by4KCQoJdmFyIG0gPSBhcmd1bWVudDA7CgltW0AgZV9fWVlNLlByaW1LaW5kXSA9IDA7CgltW0AgZV9fWVlNLk51bVZlcnRzXSA9IDA7CgkKCn0KCmZ1bmN0aW9uIGQzZF9tb2RlbF9zYXZlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAgU2F2ZXMgdGhlIG1vZGVsIHRvIHRoZSBpbmRpY2F0ZWQgZmlsZSBuYW1lLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBtb2RlbCB0byBiZSBzYXZlZC4KCS8vLyBAcGFyYW0gZm5hbWUgVGhlIG5hbWUgb2YgdGhlIGZpbGUgdG8gc2F2ZSB0aGUgbW9kZWwgdG8uCgkKCXZhciBfX2luZCA9IGFyZ3VtZW50MDsKCXZhciBfX2ZuYW1lID0gYXJndW1lbnQxOwoJCgl2YXIgX19maWxlID0gZmlsZV90ZXh0X29wZW5fd3JpdGUoX19mbmFtZSk7CglpZiAoX19maWxlID09IC0xKQoJCXJldHVybiAtMTsKCQkKCXZhciBfX3ZlcnRleHNpemUgPSAzNjsJCS8vIGNvbWJpbmVkIHNpemUgb2YgcG9zaXRpb24sIG5vcm1hbCwgY29sb3VyIGFuZCB1dgoJCQoJLy8gQ291bnQgdXAgdGhlIG51bWJlciBvZiAndGhpbmdzJyB3ZSBoYXZlIGluIHRoZSBtb2RlbAoJdmFyIF9fbnVtdGhpbmdzID0gMDsKCXZhciBfX251bXBvaW50dmVydHMgPSAwOwoJdmFyIF9fbnVtbGluZXZlcnRzID0gMDsKCXZhciBfX251bXRyaXZlcnRzID0gMDsKCQoJaWYgKF9faW5kW2VfX1lZTS5Qb2ludEJdICE9IHVuZGVmaW5lZCkKCXsKCQl2YXIgX19idWZmcG9zID0gYnVmZmVyX3RlbGwoX19pbmRbZV9fWVlNLlBvaW50Ql0pOwoJCWlmIChfX2J1ZmZwb3MgPiAwKQoJCXsKCQkJX19udW10aGluZ3MgKz0gMjsJCS8vIGluY2x1ZGUgcHJpbWl0aXZlIGJlZ2luXGVuZAoJCX0KCQkKCQkvLyBOb3cgYWRkIHRoZSBudW1iZXIgb2YgdmVydGljZXMKCQlfX251bXBvaW50dmVydHMgPSBfX2J1ZmZwb3MgLyBfX3ZlcnRleHNpemU7CgkJX19udW10aGluZ3MgKz0gX19udW1wb2ludHZlcnRzOwoJfQoJCglpZiAoX19pbmRbZV9fWVlNLkxpbmVCXSAhPSB1bmRlZmluZWQpCgl7CgkJdmFyIF9fYnVmZnBvcyA9IGJ1ZmZlcl90ZWxsKF9faW5kW2VfX1lZTS5MaW5lQl0pOwoJCWlmIChfX2J1ZmZwb3MgPiAwKQoJCXsKCQkJX19udW10aGluZ3MgKz0gMjsJCS8vIGluY2x1ZGUgcHJpbWl0aXZlIGJlZ2luXGVuZAoJCX0KCQkKCQkvLyBOb3cgYWRkIHRoZSBudW1iZXIgb2YgdmVydGljZXMKCQlfX251bWxpbmV2ZXJ0cyA9IF9fYnVmZnBvcyAvIF9fdmVydGV4c2l6ZTsKCQlfX251bXRoaW5ncyArPSBfX251bWxpbmV2ZXJ0czsKCX0KCQoJaWYgKF9faW5kW2VfX1lZTS5UcmlCXSAhPSB1bmRlZmluZWQpCgl7CgkJdmFyIF9fYnVmZnBvcyA9IGJ1ZmZlcl90ZWxsKF9faW5kW2VfX1lZTS5UcmlCXSk7CgkJaWYgKF9fYnVmZnBvcyA+IDApCgkJewoJCQlfX251bXRoaW5ncyArPSAyOwkJLy8gaW5jbHVkZSBwcmltaXRpdmUgYmVnaW5cZW5kCgkJfQoJCQoJCS8vIE5vdyBhZGQgdGhlIG51bWJlciBvZiB2ZXJ0aWNlcwoJCV9fbnVtdHJpdmVydHMgPSBfX2J1ZmZwb3MgLyBfX3ZlcnRleHNpemU7CgkJX19udW10aGluZ3MgKz0gX19udW10cml2ZXJ0czsKCX0KCQoJZmlsZV90ZXh0X3dyaXRlX3N0cmluZyhfX2ZpbGUsICIxMDAiKTsKCWZpbGVfdGV4dF93cml0ZWxuKF9fZmlsZSk7CglmaWxlX3RleHRfd3JpdGVfc3RyaW5nKF9fZmlsZSwgc3RyaW5nX2Zvcm1hdChfX251bXRoaW5ncywgMCwgMCkpOwoJZmlsZV90ZXh0X3dyaXRlbG4oX19maWxlKTsKCQoJaWYgKF9faW5kW2VfX1lZTS5Qb2ludEJdICE9IHVuZGVmaW5lZCkKCXsJCgkJdmFyIF9fYnVmID0gX19pbmRbZV9fWVlNLlBvaW50Ql07CgkJaWYgKF9fbnVtcG9pbnR2ZXJ0cyA+IDApCgkJewoJCQkvLyBQcmltaXRpdmUgYmVnaW4gKHBvaW50bGlzdCkKCQkJZmlsZV90ZXh0X3dyaXRlX3N0cmluZyhfX2ZpbGUsICIwICIgKyBzdHJpbmdfZm9ybWF0KHByX3BvaW50bGlzdCwgMTAsIDQpICsgIiAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCIpOwoJCQlmaWxlX3RleHRfd3JpdGVsbihfX2ZpbGUpOwoJCQkKCQkJLy8gVmVydGljZXMJCQoJCQlidWZmZXJfc2VlayhfX2J1ZiwgYnVmZmVyX3NlZWtfc3RhcnQsIDApOwkJLy8gYWZ0ZXIgcmVhZGluZyB0aHJvdWdoIHRoZSB3aG9sZSBidWZmZXIgd2Ugc2hvdWxkIGVuZCB1cCBiYWNrIGF0IHRoZSBlbmQKCQkJdmFyIF9faTsKCQkJZm9yKF9faSA9IDA7IF9faSA8IF9fbnVtcG9pbnR2ZXJ0czsgX19pKyspCgkJCXsJCQkKCQkJCXZhciBfX3ggPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQl2YXIgX195ID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl9mMzIpOwoJCQkJdmFyIF9feiA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX254ID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl9mMzIpOwoJCQkJdmFyIF9fbnkgPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQl2YXIgX19ueiA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX2NvbGFscGhhID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl91MzIpOwoJCQkJdmFyIF9fdSA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX3YgPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQkKCQkJCS8vIE5lZWQgdG8gc2VwYXJhdGUgY29sb3VyIGFuZCBhbHBoYQoJCQkJdmFyIF9fY29sID0gX19jb2xhbHBoYSAmICQwMGZmZmZmZjsKCQkJCXZhciBfX2FscGhhID0gKChfX2NvbGFscGhhID4+IDI0KSAmICRmZikgLyAyNTUuMDsKCQkJCQoJCQkJZmlsZV90ZXh0X3dyaXRlX3N0cmluZyhfX2ZpbGUsICI5IgoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9feCwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX195LCAxMCwgNCkKCQkJCQkJCQkJCSsgIiAiICsgc3RyaW5nX2Zvcm1hdChfX3osIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbngsIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbnksIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbnosIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fdSwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX192LCAxMCwgNCkKCQkJCQkJCQkJCSsgIiAiICsgc3RyaW5nX2Zvcm1hdChfX2NvbCwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX19hbHBoYSwgMTAsIDQpCgkJCQkJCQkJCQkpOwoJCQkJZmlsZV90ZXh0X3dyaXRlbG4oX19maWxlKTsKCQkJfQoJCQkKCQkJLy8gUHJpbWl0aXZlIGVuZAoJCQlmaWxlX3RleHRfd3JpdGVfc3RyaW5nKF9fZmlsZSwgIjEgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIik7CgkJCWZpbGVfdGV4dF93cml0ZWxuKF9fZmlsZSk7CgkJfQoJfQoJCglpZiAoX19pbmRbZV9fWVlNLkxpbmVCXSAhPSB1bmRlZmluZWQpCgl7CQoJCXZhciBfX2J1ZiA9IF9faW5kW2VfX1lZTS5MaW5lQl07CgkJaWYgKF9fbnVtbGluZXZlcnRzID4gMCkKCQl7CgkJCS8vIFByaW1pdGl2ZSBiZWdpbiAocG9pbnRsaXN0KQoJCQlmaWxlX3RleHRfd3JpdGVfc3RyaW5nKF9fZmlsZSwgIjAgIiArIHN0cmluZ19mb3JtYXQocHJfbGluZWxpc3QsIDEwLCA0KSArICIgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAiKTsKCQkJZmlsZV90ZXh0X3dyaXRlbG4oX19maWxlKTsKCQkJCgkJCS8vIFZlcnRpY2VzCQkKCQkJYnVmZmVyX3NlZWsoX19idWYsIGJ1ZmZlcl9zZWVrX3N0YXJ0LCAwKTsJCS8vIGFmdGVyIHJlYWRpbmcgdGhyb3VnaCB0aGUgd2hvbGUgYnVmZmVyIHdlIHNob3VsZCBlbmQgdXAgYmFjayBhdCB0aGUgZW5kCgkJCXZhciBfX2k7CgkJCWZvcihfX2kgPSAwOyBfX2kgPCBfX251bWxpbmV2ZXJ0czsgX19pKyspCgkJCXsJCQkKCQkJCXZhciBfX3ggPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQl2YXIgX195ID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl9mMzIpOwoJCQkJdmFyIF9feiA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX254ID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl9mMzIpOwoJCQkJdmFyIF9fbnkgPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQl2YXIgX19ueiA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX2NvbGFscGhhID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl91MzIpOwoJCQkJdmFyIF9fdSA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX3YgPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQkKCQkJCS8vIE5lZWQgdG8gc2VwYXJhdGUgY29sb3VyIGFuZCBhbHBoYQoJCQkJdmFyIF9fY29sID0gX19jb2xhbHBoYSAmICQwMGZmZmZmZjsKCQkJCXZhciBfX2FscGhhID0gKChfX2NvbGFscGhhID4+IDI0KSAmICRmZikgLyAyNTUuMDsKCQkJCQoJCQkJZmlsZV90ZXh0X3dyaXRlX3N0cmluZyhfX2ZpbGUsICI5IgoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9feCwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX195LCAxMCwgNCkKCQkJCQkJCQkJCSsgIiAiICsgc3RyaW5nX2Zvcm1hdChfX3osIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbngsIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbnksIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbnosIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fdSwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX192LCAxMCwgNCkKCQkJCQkJCQkJCSsgIiAiICsgc3RyaW5nX2Zvcm1hdChfX2NvbCwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX19hbHBoYSwgMTAsIDQpCgkJCQkJCQkJCQkpOwoJCQkJZmlsZV90ZXh0X3dyaXRlbG4oX19maWxlKTsKCQkJfQoJCQkKCQkJLy8gUHJpbWl0aXZlIGVuZAoJCQlmaWxlX3RleHRfd3JpdGVfc3RyaW5nKF9fZmlsZSwgIjEgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIik7CgkJCWZpbGVfdGV4dF93cml0ZWxuKF9fZmlsZSk7CgkJfQoJfQoJCglpZiAoX19pbmRbZV9fWVlNLlRyaUJdICE9IHVuZGVmaW5lZCkKCXsJCgkJdmFyIF9fYnVmID0gX19pbmRbZV9fWVlNLlRyaUJdOwoJCWlmIChfX251bXRyaXZlcnRzID4gMCkKCQl7CgkJCS8vIFByaW1pdGl2ZSBiZWdpbiAocG9pbnRsaXN0KQoJCQlmaWxlX3RleHRfd3JpdGVfc3RyaW5nKF9fZmlsZSwgIjAgIiArIHN0cmluZ19mb3JtYXQocHJfdHJpYW5nbGVsaXN0LCAxMCwgNCkgKyAiIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIik7CgkJCWZpbGVfdGV4dF93cml0ZWxuKF9fZmlsZSk7CgkJCQoJCQkvLyBWZXJ0aWNlcwkJCgkJCWJ1ZmZlcl9zZWVrKF9fYnVmLCBidWZmZXJfc2Vla19zdGFydCwgMCk7CQkvLyBhZnRlciByZWFkaW5nIHRocm91Z2ggdGhlIHdob2xlIGJ1ZmZlciB3ZSBzaG91bGQgZW5kIHVwIGJhY2sgYXQgdGhlIGVuZAoJCQl2YXIgX19pOwoJCQlmb3IoX19pID0gMDsgX19pIDwgX19udW10cml2ZXJ0czsgX19pKyspCgkJCXsJCQkKCQkJCXZhciBfX3ggPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQl2YXIgX195ID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl9mMzIpOwoJCQkJdmFyIF9feiA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX254ID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl9mMzIpOwoJCQkJdmFyIF9fbnkgPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQl2YXIgX19ueiA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX2NvbGFscGhhID0gYnVmZmVyX3JlYWQoX19idWYsIGJ1ZmZlcl91MzIpOwoJCQkJdmFyIF9fdSA9IGJ1ZmZlcl9yZWFkKF9fYnVmLCBidWZmZXJfZjMyKTsKCQkJCXZhciBfX3YgPSBidWZmZXJfcmVhZChfX2J1ZiwgYnVmZmVyX2YzMik7CgkJCQkKCQkJCS8vIE5lZWQgdG8gc2VwYXJhdGUgY29sb3VyIGFuZCBhbHBoYQoJCQkJdmFyIF9fY29sID0gX19jb2xhbHBoYSAmICQwMGZmZmZmZjsKCQkJCXZhciBfX2FscGhhID0gKChfX2NvbGFscGhhID4+IDI0KSAmICRmZikgLyAyNTUuMDsKCQkJCQoJCQkJZmlsZV90ZXh0X3dyaXRlX3N0cmluZyhfX2ZpbGUsICI5IgoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9feCwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX195LCAxMCwgNCkKCQkJCQkJCQkJCSsgIiAiICsgc3RyaW5nX2Zvcm1hdChfX3osIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbngsIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbnksIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fbnosIDEwLCA0KQoJCQkJCQkJCQkJKyAiICIgKyBzdHJpbmdfZm9ybWF0KF9fdSwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX192LCAxMCwgNCkKCQkJCQkJCQkJCSsgIiAiICsgc3RyaW5nX2Zvcm1hdChfX2NvbCwgMTAsIDQpCgkJCQkJCQkJCQkrICIgIiArIHN0cmluZ19mb3JtYXQoX19hbHBoYSwgMTAsIDQpCgkJCQkJCQkJCQkpOwoJCQkJZmlsZV90ZXh0X3dyaXRlbG4oX19maWxlKTsKCQkJfQoJCQkKCQkJLy8gUHJpbWl0aXZlIGVuZAoJCQlmaWxlX3RleHRfd3JpdGVfc3RyaW5nKF9fZmlsZSwgIjEgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIDAwMDAwMDAwMDAuMDAwMCAwMDAwMDAwMDAwLjAwMDAgMDAwMDAwMDAwMC4wMDAwIik7CgkJCWZpbGVfdGV4dF93cml0ZWxuKF9fZmlsZSk7CgkJfQoJfQoJCQoJZmlsZV90ZXh0X2Nsb3NlKF9fZmlsZSk7Cn0KCmZ1bmN0aW9uIGQzZF9tb2RlbF92ZXJ0ZXgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBBZGQgdmVydGV4ICh4LHkseikgdG8gdGhlIG1vZGVsLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBtb2RlbCB0byBhZGQgdGhlIHByaW1pdGl2ZSB0by4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LiAKCS8vLyBAcGFyYW0geiBUaGUgeiBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkKCV9fZDNkX21vZGVsX2FkZF92ZXJ0ZXgoIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MywgMCwgMCwgMCwgJDAwMDEwMDAwLCAwLCAwICk7Cn0KCmZ1bmN0aW9uIGQzZF9tb2RlbF92ZXJ0ZXhfY29sb3IoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBBZGQgdmVydGV4ICh4LHkseikgdG8gdGhlIG1vZGVsIHdpdGggY29sb3VyIHZhbHVlcy4KCS8vLyBAcGFyYW0gaW5kIFRoZSBpbmRleCBvZiB0aGUgbW9kZWwgdG8gYWRkIHRoZSBwcmltaXRpdmUgdG8uCgkvLy8gQHBhcmFtIHggVGhlIHggY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LgoJLy8vIEBwYXJhbSB5IFRoZSB5IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4gCgkvLy8gQHBhcmFtIHogVGhlIHogY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LgoJLy8vIEBwYXJhbSBjb2wgVGhlIGNvbG9yIHRvIGJsZW5kIHdpdGggdmVydGV4LgoJLy8vIEBwYXJhbSBhbHBoYSBUaGUgYWxwaGEgdmFsdWUgb2YgdGhlIHZlcnRleC4KCQoJX19kM2RfbW9kZWxfYWRkX3ZlcnRleCggYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCAwLCAwLCAwLCBhcmd1bWVudDQgKyAoKGFyZ3VtZW50NSoyNTUpPDwyNCksIDAsIDAgKTsKCn0KCmZ1bmN0aW9uIGQzZF9tb2RlbF92ZXJ0ZXhfY29sb3VyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAgQWRkIHZlcnRleCAoeCx5LHopIHRvIHRoZSBtb2RlbCB3aXRoIGNvbG91ciB2YWx1ZXMuCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIG1vZGVsIHRvIGFkZCB0aGUgcHJpbWl0aXZlIHRvLgoJLy8vIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguIAoJLy8vIEBwYXJhbSB6IFRoZSB6IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0gY29sIFRoZSBjb2xvdXIgdG8gYmxlbmQgd2l0aCB2ZXJ0ZXguCgkvLy8gQHBhcmFtIGFscGhhIFRoZSBhbHBoYSB2YWx1ZSBvZiB0aGUgdmVydGV4LgoJCglfX2QzZF9tb2RlbF9hZGRfdmVydGV4KCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDMsIDAsIDAsIDAsIGFyZ3VtZW50NCArICgoYXJndW1lbnQ1KjI1NSk8PDI0KSwgMCwgMCApOwp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfdmVydGV4X25vcm1hbCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gIERlZmluZXMgYSB2ZXJ0ZXggZm9yIGEgcHJpbWl0aXZlIGluIDNEIGFsb25nIHdpdGggaXRzIGNvcnJlc3BvbmRpbmcgbm9ybWFsLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBtb2RlbCB0byBhZGQgdGhlIHByaW1pdGl2ZSB0by4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LiAKCS8vLyBAcGFyYW0geiBUaGUgeiBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHhuIFRoZSB4IGNvbXBvbmVudCBvZiB0aGUgbm9ybWFsIHZlY3Rvci4KCS8vLyBAcGFyYW0geW4gVGhlIHkgY29tcG9uZW50IG9mIHRoZSBub3JtYWwgdmVjdG9yLgoJLy8vIEBwYXJhbSB6biBUaGUgeiBjb21wb25lbnQgb2YgdGhlIG5vcm1hbCB2ZWN0b3IuCgkKCV9fZDNkX21vZGVsX2FkZF92ZXJ0ZXgoIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MywgYXJndW1lbnQ0LCBhcmd1bWVudDUsIGFyZ3VtZW50NiwgJDAwMDEwMDAwLCAwLCAwICk7Cgp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfdmVydGV4X25vcm1hbF9jb2xvcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gIERlZmluZXMgYSBwcmltaXRpdmUgdmVydGV4IGZvciBhIG1vZGVsIGluIDNEIGFsb25nIHdpdGggaXRzIGNvcnJlc3BvbmRpbmcgbm9ybWFsLCBjb2xvdXIgYmxlbmRpbmcgYW5kIGFscGhhLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBtb2RlbCB0byBhZGQgdGhlIHByaW1pdGl2ZSB0by4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LiAKCS8vLyBAcGFyYW0geiBUaGUgeiBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHhuIFRoZSB4IGNvbXBvbmVudCBvZiB0aGUgbm9ybWFsIHZlY3Rvci4KCS8vLyBAcGFyYW0geW4gVGhlIHkgY29tcG9uZW50IG9mIHRoZSBub3JtYWwgdmVjdG9yLgoJLy8vIEBwYXJhbSB6biBUaGUgeiBjb21wb25lbnQgb2YgdGhlIG5vcm1hbCB2ZWN0b3IuCgkvLy8gQHBhcmFtIGNvbCBUaGUgY29sb3IgdG8gYmxlbmQgd2l0aCB0aGUgdmVydGV4IChjX3doaXRlIG9yIC0xIGlzIG5vIGJsZW5kKS4KCS8vLyBAcGFyYW0gYWxwaGEgVGhlIGFscGhhIG9mIHRoZSB2ZXJ0ZXggKDAgLSAxKS4KCQoJX19kM2RfbW9kZWxfYWRkX3ZlcnRleCggYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSwgYXJndW1lbnQ2LCBhcmd1bWVudDcgKyAoKGFyZ3VtZW50OCoyNTUpPDwyNCksIDAsIDAgKTsKCQoKfQoKZnVuY3Rpb24gZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfY29sb3VyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAgRGVmaW5lcyBhIHByaW1pdGl2ZSB2ZXJ0ZXggZm9yIGEgbW9kZWwgaW4gM0QgYWxvbmcgd2l0aCBpdHMgY29ycmVzcG9uZGluZyBub3JtYWwsIGNvbG91ciBibGVuZGluZyBhbmQgYWxwaGEuCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIG1vZGVsIHRvIGFkZCB0aGUgcHJpbWl0aXZlIHRvLgoJLy8vIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguIAoJLy8vIEBwYXJhbSB6IFRoZSB6IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geG4gVGhlIHggY29tcG9uZW50IG9mIHRoZSBub3JtYWwgdmVjdG9yLgoJLy8vIEBwYXJhbSB5biBUaGUgeSBjb21wb25lbnQgb2YgdGhlIG5vcm1hbCB2ZWN0b3IuCgkvLy8gQHBhcmFtIHpuIFRoZSB6IGNvbXBvbmVudCBvZiB0aGUgbm9ybWFsIHZlY3Rvci4KCS8vLyBAcGFyYW0gY29sIFRoZSBjb2xvdXIgdG8gYmxlbmQgd2l0aCB0aGUgdmVydGV4IChjX3doaXRlIG9yIC0xIGlzIG5vIGJsZW5kKS4KCS8vLyBAcGFyYW0gYWxwaGEgVGhlIGFscGhhIG9mIHRoZSB2ZXJ0ZXggKDAgLSAxKS4KCQoJX19kM2RfbW9kZWxfYWRkX3ZlcnRleCggYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSwgYXJndW1lbnQ2LCBhcmd1bWVudDcgKyAoKGFyZ3VtZW50OCoyNTUpPDwyNCksIDAsIDAgKTsKfQoKZnVuY3Rpb24gZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gIERlZmluZXMgYSBwcmltaXRpdmUgdmVydGV4IGZvciBhIHRleHR1cmVkIG1vZGVsIGluIDNEIGFsb25nIHdpdGggaXRzIGNvcnJlc3BvbmRpbmcgbm9ybWFsLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBtb2RlbCB0byBhZGQgdGhlIHByaW1pdGl2ZSB0by4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LiAKCS8vLyBAcGFyYW0geiBUaGUgeiBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHhuIFRoZSB4IGNvbXBvbmVudCBvZiB0aGUgbm9ybWFsIHZlY3Rvci4KCS8vLyBAcGFyYW0geW4gVGhlIHkgY29tcG9uZW50IG9mIHRoZSBub3JtYWwgdmVjdG9yLgoJLy8vIEBwYXJhbSB6biBUaGUgeiBjb21wb25lbnQgb2YgdGhlIG5vcm1hbCB2ZWN0b3IuCgkvLy8gQHBhcmFtIHh0ZXggU3RhcnRpbmcgeCBjb29yZGluYXRlIHdpdGhpbiB0aGUgdGV4dHVyZSAoMCAtIDEpLiAKCS8vLyBAcGFyYW0geXRleCBTdGFydGluZyB5IGNvb3JkaW5hdGUgd2l0aGluIHRoZSB0ZXh0dXJlICgwIC0gMSkuCgkKCV9fZDNkX21vZGVsX2FkZF92ZXJ0ZXgoIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MywgYXJndW1lbnQ0LCBhcmd1bWVudDUsIGFyZ3VtZW50NiwgJDAwMDEwMDAwLCBhcmd1bWVudDcsIGFyZ3VtZW50OCApOwoKfQoKZnVuY3Rpb24gZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZV9jb2xvcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gIERlZmluZXMgYSBwcmltaXRpdmUgdmVydGV4IGZvciBhIHRleHR1cmVkIG1vZGVsIGluIDNEIGFsb25nIHdpdGggaXRzIGNvcnJlc3BvbmRpbmcgbm9ybWFsLCBjb2xvciBibGVuZGluZyBhbmQgYWxwaGEuCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIG1vZGVsIHRvIGFkZCB0aGUgcHJpbWl0aXZlIHRvLgoJLy8vIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguIAoJLy8vIEBwYXJhbSB6IFRoZSB6IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geG4gVGhlIHggY29tcG9uZW50IG9mIHRoZSBub3JtYWwgdmVjdG9yLgoJLy8vIEBwYXJhbSB5biBUaGUgeSBjb21wb25lbnQgb2YgdGhlIG5vcm1hbCB2ZWN0b3IuCgkvLy8gQHBhcmFtIHpuIFRoZSB6IGNvbXBvbmVudCBvZiB0aGUgbm9ybWFsIHZlY3Rvci4KCS8vLyBAcGFyYW0geHRleCBTdGFydGluZyB4IGNvb3JkaW5hdGUgd2l0aGluIHRoZSB0ZXh0dXJlICgwIC0gMSkuIAoJLy8vIEBwYXJhbSB5dGV4IFN0YXJ0aW5nIHkgY29vcmRpbmF0ZSB3aXRoaW4gdGhlIHRleHR1cmUgKDAgLSAxKS4KCS8vLyBAcGFyYW0gY29sIFRoZSBjb2xvciB0byBibGVuZCB3aXRoIHRoZSB2ZXJ0ZXggKGNfd2hpdGUgb3IgLTEgaXMgbm8gYmxlbmQpLgoJLy8vIEBwYXJhbSBhbHBoYSBUaGUgYWxwaGEgb2YgdGhlIHZlcnRleCAoMCAtIDEpLgoJCglfX2QzZF9tb2RlbF9hZGRfdmVydGV4KCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1LCBhcmd1bWVudDYsIGFyZ3VtZW50OSArICgoYXJndW1lbnQxMCoyNTUpPDwyNCksIGFyZ3VtZW50NywgYXJndW1lbnQ4ICApOwoKfQoKZnVuY3Rpb24gZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZV9jb2xvdXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBEZWZpbmVzIGEgcHJpbWl0aXZlIHZlcnRleCBmb3IgYSB0ZXh0dXJlZCBtb2RlbCBpbiAzRCBhbG9uZyB3aXRoIGl0cyBjb3JyZXNwb25kaW5nIG5vcm1hbCwgY29sb3VyIGJsZW5kaW5nIGFuZCBhbHBoYS4KCS8vLyBAcGFyYW0gaW5kIFRoZSBpbmRleCBvZiB0aGUgbW9kZWwgdG8gYWRkIHRoZSBwcmltaXRpdmUgdG8uCgkvLy8gQHBhcmFtIHggVGhlIHggY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LgoJLy8vIEBwYXJhbSB5IFRoZSB5IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4gCgkvLy8gQHBhcmFtIHogVGhlIHogY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LgoJLy8vIEBwYXJhbSB4biBUaGUgeCBjb21wb25lbnQgb2YgdGhlIG5vcm1hbCB2ZWN0b3IuCgkvLy8gQHBhcmFtIHluIFRoZSB5IGNvbXBvbmVudCBvZiB0aGUgbm9ybWFsIHZlY3Rvci4KCS8vLyBAcGFyYW0gem4gVGhlIHogY29tcG9uZW50IG9mIHRoZSBub3JtYWwgdmVjdG9yLgoJLy8vIEBwYXJhbSB4dGV4IFN0YXJ0aW5nIHggY29vcmRpbmF0ZSB3aXRoaW4gdGhlIHRleHR1cmUgKDAgLSAxKS4gCgkvLy8gQHBhcmFtIHl0ZXggU3RhcnRpbmcgeSBjb29yZGluYXRlIHdpdGhpbiB0aGUgdGV4dHVyZSAoMCAtIDEpLgoJLy8vIEBwYXJhbSBjb2wgVGhlIGNvbG91ciB0byBibGVuZCB3aXRoIHRoZSB2ZXJ0ZXggKGNfd2hpdGUgb3IgLTEgaXMgbm8gYmxlbmQpLgoJLy8vIEBwYXJhbSBhbHBoYSBUaGUgYWxwaGEgb2YgdGhlIHZlcnRleCAoMCAtIDEpLgoJCglfX2QzZF9tb2RlbF9hZGRfdmVydGV4KCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1LCBhcmd1bWVudDYsIGFyZ3VtZW50OSArICgoYXJndW1lbnQxMCoyNTUpPDwyNCksIGFyZ3VtZW50NywgYXJndW1lbnQ4ICApOwp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfdmVydGV4X3RleHR1cmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBBZGQgdmVydGV4ICh4LHkseikgdG8gdGhlIG1vZGVsIHdpdGggdGV4dHVyZSB2YWx1ZXMuCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIG1vZGVsIHRvIGFkZCB0aGUgcHJpbWl0aXZlIHRvLgoJLy8vIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguIAoJLy8vIEBwYXJhbSB6IFRoZSB6IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geHRleCBTdGFydGluZyB4IGNvb3JkaW5hdGUgd2l0aGluIHRoZSB0ZXh0dXJlICgwIC0gMSkuIAoJLy8vIEBwYXJhbSB5dGV4IFN0YXJ0aW5nIHkgY29vcmRpbmF0ZSB3aXRoaW4gdGhlIHRleHR1cmUgKDAgLSAxKS4KCQoJX19kM2RfbW9kZWxfYWRkX3ZlcnRleCggYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCAwLCAwLCAwLCAkMDAwMTAwMDAsIGFyZ3VtZW50NCwgYXJndW1lbnQ1ICk7Cgp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfdmVydGV4X3RleHR1cmVfY29sb3IoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBBZGQgdmVydGV4ICh4LHkseikgdG8gdGhlIG1vZGVsIHdpdGggdGV4dHVyZSBhbmQgY29sb3IgdmFsdWVzLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBtb2RlbCB0byBhZGQgdGhlIHByaW1pdGl2ZSB0by4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgdmVydGV4LiAKCS8vLyBAcGFyYW0geiBUaGUgeiBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguCgkvLy8gQHBhcmFtIHh0ZXggU3RhcnRpbmcgeCBjb29yZGluYXRlIHdpdGhpbiB0aGUgdGV4dHVyZSAoMCAtIDEpLiAKCS8vLyBAcGFyYW0geXRleCBTdGFydGluZyB5IGNvb3JkaW5hdGUgd2l0aGluIHRoZSB0ZXh0dXJlICgwIC0gMSkuCgkvLy8gQHBhcmFtIGNvbCBUaGUgY29sb3IgdG8gYmxlbmQgd2l0aCB0aGUgdmVydGV4IChjX3doaXRlIG9yIC0xIGlzIG5vIGJsZW5kKS4KCS8vLyBAcGFyYW0gYWxwaGEgVGhlIGFscGhhIG9mIHRoZSB2ZXJ0ZXggKDAgLSAxKS4KCQoJX19kM2RfbW9kZWxfYWRkX3ZlcnRleCggYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCAwLCAwLCAwLCBhcmd1bWVudDYgKyAoKGFyZ3VtZW50NyoyNTUpPDwyNCksIGFyZ3VtZW50NCwgYXJndW1lbnQ1ICk7Cgp9CgpmdW5jdGlvbiBkM2RfbW9kZWxfdmVydGV4X3RleHR1cmVfY29sb3VyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAgQWRkIHZlcnRleCAoeCx5LHopIHRvIHRoZSBtb2RlbCB3aXRoIHRleHR1cmUgYW5kIGNvbG91ciB2YWx1ZXMuCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIG1vZGVsIHRvIGFkZCB0aGUgcHJpbWl0aXZlIHRvLgoJLy8vIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSB2ZXJ0ZXguIAoJLy8vIEBwYXJhbSB6IFRoZSB6IGNvb3JkaW5hdGUgb2YgdGhlIHZlcnRleC4KCS8vLyBAcGFyYW0geHRleCBTdGFydGluZyB4IGNvb3JkaW5hdGUgd2l0aGluIHRoZSB0ZXh0dXJlICgwIC0gMSkuIAoJLy8vIEBwYXJhbSB5dGV4IFN0YXJ0aW5nIHkgY29vcmRpbmF0ZSB3aXRoaW4gdGhlIHRleHR1cmUgKDAgLSAxKS4KCS8vLyBAcGFyYW0gY29sIFRoZSBjb2xvdXIgdG8gYmxlbmQgd2l0aCB0aGUgdmVydGV4IChjX3doaXRlIG9yIC0xIGlzIG5vIGJsZW5kKS4KCS8vLyBAcGFyYW0gYWxwaGEgVGhlIGFscGhhIG9mIHRoZSB2ZXJ0ZXggKDAgLSAxKS4KCQoJX19kM2RfbW9kZWxfYWRkX3ZlcnRleCggYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCAwLCAwLCAwLCBhcmd1bWVudDYgKyAoKGFyZ3VtZW50NyoyNTUpPDwyNCksIGFyZ3VtZW50NCwgYXJndW1lbnQ1ICk7Cn0KCmZ1bmN0aW9uIGQzZF9tb2RlbF93YWxsKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBBZGRzIGEgd2FsbCBzaGFwZSB0byB0aGUgbW9kZWwuCgkvLy8gQHBhcmFtIGluZCBUaGUgbW9kZWwgaW5kZXggdG8gYWRkIHRoZSB3YWxsIHRvLgoJLy8vIEBwYXJhbSB4MSBUaGUgaW5pdGlhbCB4IGNvb3JkaW5hdGUgb2YgdGhlIHdhbGwuCgkvLy8gQHBhcmFtIHkxIFRoZSBpbml0aWFsIHkgY29vcmRpbmF0ZSBvZiB0aGUgd2FsbC4KCS8vLyBAcGFyYW0gejEgVGhlIGluaXRpYWwgeiBjb29yZGluYXRlIG9mIHRoZSB3YWxsLgoJLy8vIEBwYXJhbSB4MiBUaGUgb3Bwb3NpdGUgeCBjb29yZGluYXRlIG9mIHRoZSB3YWxsLgoJLy8vIEBwYXJhbSB5MiBUaGUgb3Bwb3NpdGUgeSBjb29yZGluYXRlIG9mIHRoZSB3YWxsLiAKCS8vLyBAcGFyYW0gejIgVGhlIG9wcG9zaXRlIHogY29vcmRpbmF0ZSBvZiB0aGUgd2FsbC4KCS8vLyBAcGFyYW0gaHJlcGVhdCBBbW91bnQgb2YgaG9yaXpvbnRhbCByZXBldGl0aW9ucyBmb3IgdGhlIHRleHR1cmUuCgkvLy8gQHBhcmFtIHZyZXBlYXQgQW1vdW50IG9mIHZlcnRpY2FsIHJlcGV0aXRpb25zIGZvciB0aGUgdGV4dHVyZS4KCS8vLyBAcmV0dXJucyAKCQoJdmFyIF9faW5kID0gYXJndW1lbnQwOwoJdmFyIF9feDEgPSBhcmd1bWVudDE7Cgl2YXIgX195MSA9IGFyZ3VtZW50MjsKCXZhciBfX3oxID0gYXJndW1lbnQzOwoJdmFyIF9feDIgPSBhcmd1bWVudDQ7Cgl2YXIgX195MiA9IGFyZ3VtZW50NTsKCXZhciBfX3oyID0gYXJndW1lbnQ2OwoJdmFyIF9faHJlcGVhdCA9IGFyZ3VtZW50NzsKCXZhciBfX3ZyZXBlYXQgPSBhcmd1bWVudDg7CgkKCXZhciBfX3hkaWZmID0gX194MiAtIF9feDE7Cgl2YXIgX195ZGlmZiA9IF9feTIgLSBfX3kxOwoJCgl2YXIgX19sc3F1YXJlZCA9IChfX3hkaWZmICogX194ZGlmZikgKyAoX195ZGlmZiAqIF9feWRpZmYpOwoJaWYgKF9fbHNxdWFyZWQgPT0gMCkKCQlyZXR1cm4gMDsKCQkKCXZhciBfX2wgPSBzcXJ0KF9fbHNxdWFyZWQpOwoJCgl2YXIgX19ueCA9IF9feWRpZmYgLyBfX2w7Cgl2YXIgX19ueSA9IC1fX3hkaWZmIC8gX19sOwoJCglkM2RfbW9kZWxfcHJpbWl0aXZlX2JlZ2luKF9faW5kLCBwcl90cmlhbmdsZWZhbik7CgkKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTEsIF9fejEsIF9fbngsIF9fbnksIDAsIDAsIDApOwoJZDNkX21vZGVsX3ZlcnRleF9ub3JtYWxfdGV4dHVyZShfX2luZCwgX194MiwgX195MiwgX196MSwgX19ueCwgX19ueSwgMCwgX19ocmVwZWF0LCAwKTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDIsIF9feTIsIF9fejIsIF9fbngsIF9fbnksIDAsIF9faHJlcGVhdCwgX192cmVwZWF0KTsKCWQzZF9tb2RlbF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoX19pbmQsIF9feDEsIF9feTEsIF9fejIsIF9fbngsIF9fbnksIDAsIDAsIF9fdnJlcGVhdCk7CgkKCWQzZF9tb2RlbF9wcmltaXRpdmVfZW5kKF9faW5kKTsKCn0KCmZ1bmN0aW9uIGQzZF9wcmltaXRpdmVfYmVnaW4oKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBkM2QgLSBiZWdpbiBtYWtpbmcgYSBwcmltaXRpdmUgc3RyZWFtCgkvLy8gQHBhcmFtIGtpbmQgUHJpbWl0aXZlIGtpbmQKCQoJaWYgKGdsb2JhbC5fX2QzZFByaW1LaW5kICE9IC0xKSB7CgkJc2hvd19kZWJ1Z19tZXNzYWdlKCAiRVJST1IgOiBjYW5ub3QgYmVnaW4gYSBwcmltaXRpdmUgYmVmb3JlIGVuZCBjYWxsZWQgb24gcHJldmlvdXMiKQoJfQoJCglnbG9iYWwuX19kM2RQcmltS2luZCA9IGFyZ3VtZW50MDsKCWdsb2JhbC5fX2QzZFByaW1UZXggPSAtMTsKCXZlcnRleF9iZWdpbihnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBnbG9iYWwuX19kM2RQcmltVkYpOwoKfQoKZnVuY3Rpb24gZDNkX3ByaW1pdGl2ZV9iZWdpbl90ZXh0dXJlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAgZDNkIC0gYmVnaW4gbWFraW5nIGEgcHJpbWl0aXZlIHN0cmVhbQoJLy8vIEBwYXJhbSBraW5kIFByaW1pdGl2ZSBraW5kCgkvLy8gQHBhcmFtIHRleCBUZXh0dXJlIEluZGV4CgkKCWlmIChnbG9iYWwuX19kM2RQcmltS2luZCAhPSAtMSkgewoJCXNob3dfZGVidWdfbWVzc2FnZSggIkVSUk9SIDogY2Fubm90IGJlZ2luIGEgcHJpbWl0aXZlIGJlZm9yZSBlbmQgY2FsbGVkIG9uIHByZXZpb3VzIikKCX0KCQoJZ2xvYmFsLl9fZDNkUHJpbUtpbmQgPSBhcmd1bWVudDA7CglnbG9iYWwuX19kM2RQcmltVGV4ID0gYXJndW1lbnQxOwoJdmFyIF9fdXZzID0gdGV4dHVyZV9nZXRfdXZzKGdsb2JhbC5fX2QzZFByaW1UZXgpOwoJZ2xvYmFsLl9fZDNkUHJpbVRleFggPSBfX3V2c1swXTsKCWdsb2JhbC5fX2QzZFByaW1UZXhZID0gX191dnNbMV07CglnbG9iYWwuX19kM2RQcmltVGV4VyA9IF9fdXZzWzJdIC0gX191dnNbMF07CglnbG9iYWwuX19kM2RQcmltVGV4SCA9IF9fdXZzWzNdIC0gX191dnNbMV07Cgl2ZXJ0ZXhfYmVnaW4oIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGdsb2JhbC5fX2QzZFByaW1WRiApOwp9CgpmdW5jdGlvbiBkM2RfcHJpbWl0aXZlX2VuZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gZW5kIHRoZSBwcmltaXRpdmUgc3RyZWFtCgkKCWlmIChnbG9iYWwuX19kM2RQcmltS2luZCAhPSAtMSkgewoJCgkJdmVydGV4X2VuZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciApOwoJCXZlcnRleF9zdWJtaXQoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGdsb2JhbC5fX2QzZFByaW1LaW5kLCBnbG9iYWwuX19kM2RQcmltVGV4ICk7CgkKCQkvLyBtYXJrIHRoaXMgYXMgZmluaXNoZWQKCQlnbG9iYWwuX19kM2RQcmltS2luZCA9IC0xOwoJfSBlbHNlIHsKCQlzaG93X2RlYnVnX21lc3NhZ2UoICJkM2RfcHJpbWl0aXZlX2VuZCA6OiB3aXRoIG5vIGQzZF9wcmltaXRpdmVfYmVnaW4gIik7Cgl9Cgp9CgpmdW5jdGlvbiBkM2Rfc2V0X2N1bGxpbmcoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBkM2QgLSBiYWNrZmFjZSBjdWxsaW5nIG9uIG9yIG9mZgoJLy8vIEBwYXJhbSBlbmFibGUgdHJ1ZSBpZiBlbmFibGVkLCBmYWxzZSBpZiBkaXNhYmxlZAoJCgkvL2dwdV9zZXRfY3VsbG1vZGUoIGFyZ3VtZW50MCA/IGN1bGxfY2xvY2t3aXNlIDogY3VsbF9ub2N1bGxpbmcgKTsKCWdwdV9zZXRfY3VsbG1vZGUoIGFyZ3VtZW50MCA/IGN1bGxfY291bnRlcmNsb2Nrd2lzZSA6IGN1bGxfbm9jdWxsaW5nICk7Cn0KCmZ1bmN0aW9uIGQzZF9zZXRfZGVwdGgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIHNldCBkZXB0aAoJLy8vIEBwYXJhbSB2YWwgdmFsdWUgb2YgZGVwdGgKCWdsb2JhbC5fX2QzZERlcHRoPWFyZ3VtZW50MDsKfQoKZnVuY3Rpb24gZDNkX3NldF9mb2coKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBkM2QgLSBzZXQgZm9nIGVuYWJsZS9kaXNhYmxlIGFuZCBjb2xvdXIKCS8vLyBAcGFyYW0gZW5hYmxlIHRydWUgaWYgZW5hYmxlZCwgZmFsc2UgaWYgZGlzYWJsZWQKCS8vLyBAcGFyYW0gY29sb3VyCWNvbG91ciBvZiB0aGUgZm9nCgkvLy8gQHBhcmFtIG5lYXIJZGlzdGFuY2UgdG8gd2hlbiBmb2cgc3RhcnRzCgkvLy8gQHBhcmFtIGZhcglkaXN0YW5jZSB0byB3aGVuIGZvZyBiZWNvbWVzIGFic29sdXRlCgkKCWdwdV9zZXRfZm9nKGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MyApOwp9CgpmdW5jdGlvbiBkM2Rfc2V0X2hpZGRlbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gc2V0IGRlcHRoIHRlc3RpbmcKCS8vLyBAcGFyYW0gZW5hYmxlIHRydWUgaWYgZW5hYmxlZCwgZmFsc2UgaWYgZGlzYWJsZWQKCQoJZ3B1X3NldF96dGVzdGVuYWJsZSggYXJndW1lbnQwICk7Cn0KCmZ1bmN0aW9uIGQzZF9zZXRfbGlnaHRpbmcoKQp7CgkvLy8gQGRlc2NyaXB0aW9uICBkM2QgLSBzZXQgbGlnaHRpbmcKCS8vLyBAcGFyYW0gZW5hYmxlIHRydWUgaWYgZW5hYmxlZCwgZmFsc2UgaWYgZGlzYWJsZWQKCQoJZHJhd19zZXRfbGlnaHRpbmcoIGFyZ3VtZW50MCApOwp9CgpmdW5jdGlvbiBkM2Rfc2V0X3BlcnNwZWN0aXZlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBzZXQgcGVyc3BlY3RpdmUKCS8vLyBAcGFyYW0gZW5hYmxlIHRydWUgaWYgZW5hYmxlZCwgZmFsc2UgaWYgZGlzYWJsZWQKCQoJLy9jYW1lcmFfYXBwbHkoZ2xvYmFsLl9fZDNkQ2FtZXJhKTsKCQoJdmFyIF9fcGVyc3AgPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fZDNkID09IGZhbHNlKQoJCV9fcGVyc3AgPSBmYWxzZTsKCQkKCS8vIE5vdyBmaW5kIGFsbCBjYW1lcmFzIGV2ZXJ5d2hlcmUgLSB0aGUgZGVmYXVsdCBjYW1lcmEsIGFsbCB0aGUgdmlld3MgaW4gdGhlIGN1cnJlbnQgcm9vbSBhbmQgYWxsIHRoZSBjYW1lcmFzIGluIGV2ZXJ5IG90aGVyIHJvb20KCS8vIE5PVEU6IHRoaXMgY3VycmVudGx5IHdvbid0IGhhbmRsZSByb29tcyB0aGF0IGFyZSBjcmVhdGVkIGluIGNvZGUgKHVzaW5nIHJvb21fYWRkKCkpCgkKCS8vIFRoZSBkZWZhdWx0IGNhbWVyYSBpcyBhdXRvbWF0aWNhbGx5IHVwZGF0ZWQgYnkgdGhlIHJ1bm5lciBzbyB3ZSBqdXN0IG5lZWQgdG8gZ2l2ZSBpdCBhIGhpbnQgb2Ygd2hldGhlciBpdCBpcyBvcnRobyBvciBwZXJzcGVjdGl2ZQoJdmFyIF9fbWF0ID0gY2FtZXJhX2dldF9wcm9qX21hdChjYW1lcmFfZ2V0X2RlZmF1bHQoKSk7CgkKCWlmIChfX3BlcnNwKQoJewoJCV9fbWF0WzExXSA9IDEuMDsKCX0KCWVsc2UKCXsKCQlfX21hdFsxMV0gPSAwLjA7Cgl9CgkKCWNhbWVyYV9zZXRfcHJval9tYXQoY2FtZXJhX2dldF9kZWZhdWx0KCksIF9fbWF0KTsKCQoJCgkvLyBOb3cgbG9vcCB0aHJvdWdoIGFsbCB0aGUgb3RoZXJzCgl2YXIgX19udW1jYW1zID0gMDsKCXZhciBfX2NhbXMgPSBbXTsKCXZhciBfX2k7Cglmb3IoX19pID0gMDsgX19pIDwgODsgX19pKyspCgl7CgkJaWYgKHZpZXdfY2FtZXJhW19faV0gIT0gLTEpCgkJewoJCQlfX2NhbXNbX19udW1jYW1zKjNdID0gdmlld19jYW1lcmFbX19pXTsKCQkJX19jYW1zW19fbnVtY2FtcyozKzFdID0gdmlld19jYW1lcmFbX19pXTsKCQkJX19jYW1zW19fbnVtY2FtcyozKzJdID0gdmlld19jYW1lcmFbX19pXTsKCQkJX19udW1jYW1zKys7CgkJfQoJfQoJCgl2YXIgX19jdXJycm9vbSA9IHJvb21fZmlyc3Q7Cgl3aGlsZShfX2N1cnJyb29tICE9IC0xKQoJewoJCWZvcihfX2kgPSAwOyBfX2kgPCA4OyBfX2krKykKCQl7CgkJCXZhciBfX2NhbSA9IHJvb21fZ2V0X2NhbWVyYShfX2N1cnJyb29tLCBfX2kpOwoJCQlpZiAoX19jYW0gIT0gLTEpCgkJCXsKCQkJCV9fY2Ftc1tfX251bWNhbXNdID0gX19jYW07CgkJCQlfX251bWNhbXMrKzsKCQkJfQoJCX0KCQkKCQlfX2N1cnJyb29tID0gcm9vbV9uZXh0KF9fY3VycnJvb20pOwoJfQoJCgkvLyBOb3cgbG9vcCB0aHJvdWdoIGFsbCB0aGUgY2FtZXJhcwoJZm9yKF9faSA9IDA7IF9faSA8IF9fbnVtY2FtczsgX19pKyspCgl7CgkJdmFyIF9fY2FtID0gX19jYW1zW19faV07CgkJdmFyIF9fbWF0ID0gY2FtZXJhX2dldF9wcm9qX21hdChfX2NhbSk7CgkJdmFyIF9faXNwZXJzcCA9IChfX21hdFsxMV0gIT0gMC4wKSA/IHRydWUgOiBmYWxzZTsKCQkKCQlpZiAoX19pc3BlcnNwICE9IF9fcGVyc3ApCgkJewoJCQkvLyBPa2F5LCBJJ20gZ29pbmcgdG8gYXNzdW1lIHRoYXQsIGlmIHRoaXMgaXMgYW4gaW1wb3J0ZWQgcHJvamVjdCwgYWxsIHRoZSBjYW1lcmFzIHRoYXQgaGF2ZSBiZWVuIHNldCB1cCBhcmUgdmlldy1iYXNlZAoJCQkvLyBUaGlzIG1lYW5zIHRoYXQgdGhleSBzaG91bGQgaGF2ZSB2YWxpZCB2aWV3IHBhcmFtZXRlcnMKCQkJaWYgKGNhbWVyYV9nZXRfdmlld193aWR0aChfX2NhbSkgPiAwLjApCgkJCXsKCQkJCS8vIG9rYXksIHdlJ2xsIGFzc3VtZSB0aGlzIGlzIGEgY2FtZXJhIHRoYXQgaGFzIGJlZW4gcHJldmlvdXNseSBzZXQgdXAgd2l0aCBhIHZpZXcKCQkJCXZhciBfX3dpZHRoID0gY2FtZXJhX2dldF92aWV3X3dpZHRoKF9fY2FtKTsKCQkJCXZhciBfX2hlaWdodCA9IGNhbWVyYV9nZXRfdmlld19oZWlnaHQoX19jYW0pOwkJCQoJCQkJCgkJCQlpZiAoX19wZXJzcCkKCQkJCXsKCQkJCQl2YXIgX19wcm9qbWF0ID0gbWF0cml4X2J1aWxkX3Byb2plY3Rpb25fcGVyc3BlY3RpdmUoMS4wLCAtKF9faGVpZ2h0L19fd2lkdGgpLCAxLjAsIDMyMDAwLjApOwoJCQkJCWNhbWVyYV9zZXRfcHJval9tYXQoX19jYW0sIF9fcHJvam1hdCk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJdmFyIF9fcHJvam1hdCA9IG1hdHJpeF9idWlsZF9wcm9qZWN0aW9uX29ydGhvKF9fd2lkdGgsIF9faGVpZ2h0LCAtMTYwMDAuMCwgMTYwMDAuMCk7CgkJCQkJY2FtZXJhX3NldF9wcm9qX21hdChfX2NhbSwgX19wcm9qbWF0KTsKCQkJCX0KCQkJfQoJCX0KCX0KCQoJLy9jYW1lcmFfYXBwbHkoY2FtZXJhX2dldF9hY3RpdmUoKSk7CgkKCn0KCmZ1bmN0aW9uIGQzZF9zZXRfcHJvamVjdGlvbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gIEBkZXNjcmlwdGlvbiBkM2QgLSBzZXQgcHJvamVjdGlvbiAKCS8vLyBAcGFyYW0geEZyb20JeCBvZiBmcm9tIHBvc2l0aW9uCgkvLy8gQHBhcmFtIHlGcm9tCXkgb2YgZnJvbSBwb3NpdGlvbgoJLy8vIEBwYXJhbSB6RnJvbQl6IG9mIGZyb20gcG9zaXRpb24KCS8vLyBAcGFyYW0geFRvCQl4IG9mIHRvIHBvc2l0aW9uCgkvLy8gQHBhcmFtIHlUbwkJeSBvZiB0byBwb3NpdGlvbgoJLy8vIEBwYXJhbSB6VG8JCXogb2YgdG8gcG9zaXRpb24KCS8vLyBAcGFyYW0geFVwCQl4IG9mIHVwIHZlY3RvcgoJLy8vIEBwYXJhbSB5VXAJCXkgb2YgdXAgdmVjdG9yCgkvLy8gQHBhcmFtIHpVcAkJeiBvZiB1cCB2ZWN0b3IKCQoJdmFyIG0gPSBtYXRyaXhfYnVpbGRfbG9va2F0KCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyLCAKCQkJCQkJCQkgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSwKCQkJCQkJCQkgYXJndW1lbnQ2LCBhcmd1bWVudDcsIGFyZ3VtZW50OCApOwoJCgl2YXIgY2FtID0gY2FtZXJhX2dldF9hY3RpdmUoKTsKCWNhbWVyYV9zZXRfdmlld19tYXQoIGNhbSwgbSApOwoJaWYoICFnbG9iYWwuX19kM2QgKSB7CgkJLy9hcHBseSBkZWZhdWx0IG9ydGhvIHByb2plY3Rpb24KCQl2YXIgbXByb2ogPSBtYXRyaXhfYnVpbGRfcHJvamVjdGlvbl9vcnRobyhjYW1lcmFfZ2V0X3ZpZXdfd2lkdGgoY2FtKSxjYW1lcmFfZ2V0X3ZpZXdfaGVpZ2h0KGNhbSksMSwzMjAwMCk7CgkJY2FtZXJhX3NldF9wcm9qX21hdCggY2FtLCBtcHJvaik7Cgl9CgljYW1lcmFfYXBwbHkoY2FtKTsKfQoKZnVuY3Rpb24gZDNkX3NldF9wcm9qZWN0aW9uX2V4dCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gc2V0IHByb2plY3Rpb24gCgkvLy8gQHBhcmFtIHhGcm9tCXggb2YgZnJvbSBwb3NpdGlvbgoJLy8vIEBwYXJhbSB5RnJvbQl5IG9mIGZyb20gcG9zaXRpb24KCS8vLyBAcGFyYW0gekZyb20JeiBvZiBmcm9tIHBvc2l0aW9uCgkvLy8gQHBhcmFtIHhUbwkJeCBvZiB0byBwb3NpdGlvbgoJLy8vIEBwYXJhbSB5VG8JCXkgb2YgdG8gcG9zaXRpb24KCS8vLyBAcGFyYW0gelRvCQl6IG9mIHRvIHBvc2l0aW9uCgkvLy8gQHBhcmFtIHhVcAkJeCBvZiB1cCB2ZWN0b3IKCS8vLyBAcGFyYW0geVVwCQl5IG9mIHVwIHZlY3RvcgoJLy8vIEBwYXJhbSB6VXAJCXogb2YgdXAgdmVjdG9yCgkvLy8gQHBhcmFtIGZvdgkJZmllbGQgb2YgdmlldyBhbmdsZQoJLy8vIEBwYXJhbSBhc3BlY3QJYXNwZWN0IHJhdGlvbgoJLy8vIEBwYXJhbSB6bWluCQl6IGJ1ZmZlciBtaW4KCS8vLyBAcGFyYW0gem1heAkJeiBidWZmZXIgbWF4CgkKCXZhciBtViA9IG1hdHJpeF9idWlsZF9sb29rYXQoIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIAoJCQkJCQkJCSBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1LAoJCQkJCQkJCSBhcmd1bWVudDYsIGFyZ3VtZW50NywgYXJndW1lbnQ4ICk7Cgl2YXIgbVAgPSBtYXRyaXhfYnVpbGRfcHJvamVjdGlvbl9wZXJzcGVjdGl2ZV9mb3YoIC1hcmd1bWVudDksIC1hcmd1bWVudDEwLCBhcmd1bWVudDExLCBhcmd1bWVudDEyICk7CgkKCWNhbWVyYV9zZXRfdmlld19tYXQoIGNhbWVyYV9nZXRfYWN0aXZlKCksIG1WICk7CgljYW1lcmFfc2V0X3Byb2pfbWF0KCBjYW1lcmFfZ2V0X2FjdGl2ZSgpLCBtUCApOwoJY2FtZXJhX2FwcGx5KCBjYW1lcmFfZ2V0X2FjdGl2ZSgpICk7Cgp9CgpmdW5jdGlvbiBkM2Rfc2V0X3Byb2plY3Rpb25fb3J0aG8oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIHNldCBvcnRob2dyYXBoaWMgCgkvLy8gQHBhcmFtIHgJCXggb2YgdGwgY29ybmVyCgkvLy8gQHBhcmFtIHkJCXkgb2YgdGwgY29ybmVyCgkvLy8gQHBhcmFtIHcJCXcgb2YgdmlldwoJLy8vIEBwYXJhbSBoCQloIG9mIHZpZXcKCS8vLyBAcGFyYW0gYW5nbGUJcm90YXRpb24gYW5nbGUgb2YgdGhlIHByb2plY3Rpb24KCQoJdmFyIHh4ID0gYXJndW1lbnQwOwoJdmFyIHl5ID0gYXJndW1lbnQxOwoJdmFyIHd3ID0gYXJndW1lbnQyOwoJdmFyIGhoID0gYXJndW1lbnQzOwoJdmFyIGFuZ2xlID0gYXJndW1lbnQ0OwoJCgl2YXIgbVYgPSBtYXRyaXhfYnVpbGRfbG9va2F0KCB4eCt3dy8yLCB5eStoaC8yLCAtMTYwMDAsIAoJCQkJCQkJCSAgeHgrd3cvMiwgeXkraGgvMiwgMCwKCQkJCQkJCQkgZHNpbigtYW5nbGUpLCBkY29zKC1hbmdsZSksIDAgKTsKCXZhciBtUCA9IG1hdHJpeF9idWlsZF9wcm9qZWN0aW9uX29ydGhvKCB3dywgaGgsIDEsIDMyMDAwICk7CgkKCS8vY2FtZXJhX3NldF92aWV3X21hdCggZ2xvYmFsLl9fZDNkQ2FtZXJhLCBtViApOwoJLy9jYW1lcmFfc2V0X3Byb2pfbWF0KCBnbG9iYWwuX19kM2RDYW1lcmEsIG1QICk7CgkvL2NhbWVyYV9hcHBseSggZ2xvYmFsLl9fZDNkQ2FtZXJhICk7CgljYW1lcmFfc2V0X3ZpZXdfbWF0KCBjYW1lcmFfZ2V0X2FjdGl2ZSgpLCBtViApOwoJY2FtZXJhX3NldF9wcm9qX21hdCggY2FtZXJhX2dldF9hY3RpdmUoKSwgbVAgKTsKCWNhbWVyYV9hcHBseSggY2FtZXJhX2dldF9hY3RpdmUoKSApOwp9CgpmdW5jdGlvbiBkM2Rfc2V0X3Byb2plY3Rpb25fcGVyc3BlY3RpdmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIHNldCBwcm9qZWN0aW9uIHBlcnNwZWN0aXZlCgkvLy8gQHBhcmFtIHgJCXggb2YgdGwgY29ybmVyCgkvLy8gQHBhcmFtIHkJCXkgb2YgdGwgY29ybmVyCgkvLy8gQHBhcmFtIHcJCXcgb2YgdmlldwoJLy8vIEBwYXJhbSBoCQloIG9mIHZpZXcKCS8vLyBAcGFyYW0gYW5nbGUJcm90YXRpb24gYW5nbGUgb2YgdGhlIHByb2plY3Rpb24KCXZhciB4eCA9IGFyZ3VtZW50MDsKCXZhciB5eSA9IGFyZ3VtZW50MTsKCXZhciB3dyA9IGFyZ3VtZW50MjsKCXZhciBoaCA9IGFyZ3VtZW50MzsKCXZhciBhbmdsZSA9IGFyZ3VtZW50NDsKCQoJdmFyIG1WID0gbWF0cml4X2J1aWxkX2xvb2thdCggeHgrd3cvMiwgeXkraGgvMiwgLXd3LCAKCQkJCQkJCQkgIHh4K3d3LzIsIHl5K2hoLzIsIDAsCgkJCQkJCQkJIGRzaW4oLWFuZ2xlKSwgZGNvcygtYW5nbGUpLCAwICk7Cgl2YXIgbVAgPSBtYXRyaXhfYnVpbGRfcHJvamVjdGlvbl9wZXJzcGVjdGl2ZSggd3cvd3csIC1oaC93dywgMSwgMzIwMDAgKTsKCQoJY2FtZXJhX3NldF92aWV3X21hdCggY2FtZXJhX2dldF9hY3RpdmUoKSwgbVYgKTsKCWNhbWVyYV9zZXRfcHJval9tYXQoIGNhbWVyYV9nZXRfYWN0aXZlKCksIG1QICk7CgljYW1lcmFfYXBwbHkoIGNhbWVyYV9nZXRfYWN0aXZlKCkgKTsKfQoKZnVuY3Rpb24gZDNkX3NldF9zaGFkaW5nKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBzZXQgc2hhZGluZwoJLy8vIEBwYXJhbSBlbmFibGUJdHJ1ZSBpZiBlbmFibGVkLCBmYWxzZSBpZiBkaXNhYmxlZAoJCglpZiAoIWdsb2JhbC5fX2QzZERlcHJlY2F0ZWRNZXNzYWdlWzBdKSB7CgkJc2hvd19kZWJ1Z19tZXNzYWdlKCAiZDNkX3NldF9zaGFkaW5nIGlzIGRlcHJlY2F0ZWQgYXMgaXQgbmVlZHMgdG8gYmUgZG9uZSBpbiB0aGUgc2hhZGVyIG5vdyIgKTsKCQlnbG9iYWwuX19kM2REZXByZWNhdGVkTWVzc2FnZVswXSA9IHRydWU7Cgl9IAoKfQoKZnVuY3Rpb24gZDNkX3NldF96d3JpdGVlbmFibGUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIHNldCB6IHdyaXRlIGVuYWJsZQoJLy8vIEBwYXJhbSBlbmFibGUJdHJ1ZSBpZiBlbmFibGVkLCBmYWxzZSBpZiBkaXNhYmxlZAoJCglncHVfc2V0X3p3cml0ZWVuYWJsZSggYXJndW1lbnQwICk7Cgp9CgpmdW5jdGlvbiBkM2Rfc3RhcnQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIGVuYWJsZSAzZAoJCgl2YXIgcmV0ID0gZ2xvYmFsLl9fZDNkOwoJZ2xvYmFsLl9fZDNkID0gdHJ1ZTsKCS8vY2FtZXJhX2FwcGx5KGdsb2JhbC5fX2QzZENhbWVyYSk7CglncHVfc2V0X3p0ZXN0ZW5hYmxlKHRydWUpOwoJZ3B1X3NldF96d3JpdGVlbmFibGUodHJ1ZSk7CglyZXR1cm4gcmV0OwoKfQoKZnVuY3Rpb24gZDNkX3RyYW5zZm9ybV9hZGRfcm90YXRpb25fYXhpcygpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gU2V0cyB0aGUgdHJhbnNmb3JtYXRpb24gdG8gYSByb3RhdGlvbiBhcm91bmQgdGhlIGF4aXMgaW5kaWNhdGVkIGJ5IHRoZSB2ZWN0b3Igd2l0aCB0aGUgaW5kaWNhdGVkIGFtb3VudC4KCS8vLyBAcGFyYW0geGEgdGhlIHggY29tcG9uZW50IG9mIHRoZSB0cmFuc2Zvcm0gdmVjdG9yCgkvLy8gQHBhcmFtIHlhIHRoZSB5IGNvbXBvbmVudCBvZiB0aGUgdHJhbnNmb3JtIHZlY3RvcgoJLy8vIEBwYXJhbSB6YSB0aGUgeiBjb21wb25lbnQgb2YgdGhlIHRyYW5zZm9ybSB2ZWN0b3IKCS8vLyBAcGFyYW0gYW5nbGUgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgdHJhbnNmb3JtIHRocm91Z2ggdGhlIHZlY3RvcgoJCgkvLyBnZXQgdGhlIHNpbiBhbmQgY29zIG9mIHRoZSBhbmdsZSBwYXNzZWQgaW4KCXZhciBjID0gZGNvcygtYXJndW1lbnQzKTsKCXZhciBzID0gZHNpbigtYXJndW1lbnQzKTsKCXZhciBvbWMgPSAxIC0gYzsKCQoJLy8gbm9ybWFsaXNlIHRoZSBpbnB1dCB2ZWN0b3IKCXZhciB4eCA9IGFyZ3VtZW50MDsKCXZhciB5eSA9IGFyZ3VtZW50MTsKCXZhciB6eiA9IGFyZ3VtZW50MjsKCXZhciBsZW5ndGgyID0gc3FyKHh4KSArIHNxcih5eSkgKyBzcXIoenopOwoJdmFyIGxlbmd0aCA9IHNxcnQobGVuZ3RoMik7Cgl4eCAvPSBsZW5ndGg7Cgl5eSAvPSBsZW5ndGg7Cgl6eiAvPSBsZW5ndGg7CgkKCS8vIGJ1aWxkIHRoZSByb3RhdGlvbiBtYXRyaXgKCXZhciBtVDsKCW1UWzBdID0gb21jICogeHggKiB4eCArIGM7CgltVFsxXSA9IG9tYyAqIHh4ICogeXkgKyBzICogeno7CgltVFsyXSA9IG9tYyAqIHh4ICogenogLSBzICogeXk7CgltVFszXSA9IDA7CgkKCW1UWzRdID0gb21jICogeHggKiB5eSAtIHMgKiB6ejsKCW1UWzVdID0gb21jICogeXkgKiB5eSArIGM7CgltVFs2XSA9IG9tYyAqIHl5ICogenogKyBzICogeHg7CgltVFs3XSA9IDA7CgkKCW1UWzhdID0gb21jICogeHggKiB6eiArIHMgKiB5eTsKCW1UWzldID0gb21jICogeXkgKiB6eiAtIHMgKiB4eDsKCW1UWzEwXSA9IG9tYyAqIHp6ICogenogKyBjOwoJbVRbMTFdID0gMDsKCQoJbVRbMTJdID0gMDsKCW1UWzEzXSA9IDA7CgltVFsxNF0gPSAwOwoJbVRbMTVdID0gMTsKCQoJdmFyIG0gPSBtYXRyaXhfZ2V0KCBtYXRyaXhfd29ybGQgKTsKCXZhciBtUiA9IG1hdHJpeF9tdWx0aXBseSggbSwgbVQgKTsKCW1hdHJpeF9zZXQoIG1hdHJpeF93b3JsZCwgbVIgKTsKfQoKZnVuY3Rpb24gZDNkX3RyYW5zZm9ybV9hZGRfcm90YXRpb25feCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gU2V0cyB0aGUgdHJhbnNmb3JtYXRpb24gdG8gYSByb3RhdGlvbiBhcm91bmQgdGhlIHgtYXhpcyB3aXRoIHRoZSBpbmRpY2F0ZWQgYW1vdW50LgoJLy8vIEBwYXJhbSBhbmdsZSB0aGUgYW5nbGUgdG8gcm90YXRlCgkKCS8vIGdldCB0aGUgc2luIGFuZCBjb3Mgb2YgdGhlIGFuZ2xlIHBhc3NlZCBpbgoJdmFyIGMgPSBkY29zKGFyZ3VtZW50MCk7Cgl2YXIgcyA9IGRzaW4oYXJndW1lbnQwKTsKCQoJLy8gYnVpbGQgdGhlIHJvdGF0aW9uIG1hdHJpeAoJdmFyIG1UID0gbWF0cml4X2J1aWxkX2lkZW50aXR5KCk7CgltVFs1XSA9IGM7CgltVFs2XSA9IC1zOwoJCgltVFs5XSA9IHM7CgltVFsxMF0gPSBjOwoJCgl2YXIgbSA9IG1hdHJpeF9nZXQoIG1hdHJpeF93b3JsZCApOwoJdmFyIG1SID0gbWF0cml4X211bHRpcGx5KCBtLCBtVCApOwoJbWF0cml4X3NldCggbWF0cml4X3dvcmxkLCBtUiApOwp9CgpmdW5jdGlvbiBkM2RfdHJhbnNmb3JtX2FkZF9yb3RhdGlvbl95KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBBZGRzIGEgcm90YXRpb24gYXJvdW5kIHRoZSB5LWF4aXMgd2l0aCB0aGUgaW5kaWNhdGVkIGFtb3VudC4KCS8vLyBAcGFyYW0gYW5nbGUgdGhlIGFuZ2xlIHRvIHJvdGF0ZQoJCgkvLyBnZXQgdGhlIHNpbiBhbmQgY29zIG9mIHRoZSBhbmdsZSBwYXNzZWQgaW4KCXZhciBjID0gZGNvcyhhcmd1bWVudDApOwoJdmFyIHMgPSBkc2luKGFyZ3VtZW50MCk7CgkKCS8vIGJ1aWxkIHRoZSByb3RhdGlvbiBtYXRyaXgKCXZhciBtVCA9IG1hdHJpeF9idWlsZF9pZGVudGl0eSgpOwoJbVRbMF0gPSBjOwoJbVRbMl0gPSBzOwoJCgltVFs4XSA9IC1zOwoJbVRbMTBdID0gYzsKCQoJdmFyIG0gPSBtYXRyaXhfZ2V0KCBtYXRyaXhfd29ybGQgKTsKCXZhciBtUiA9IG1hdHJpeF9tdWx0aXBseSggbSwgbVQgKTsKCW1hdHJpeF9zZXQoIG1hdHJpeF93b3JsZCwgbVIgKTsKCn0KCmZ1bmN0aW9uIGQzZF90cmFuc2Zvcm1fYWRkX3JvdGF0aW9uX3ooKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIEFkZHMgYSByb3RhdGlvbiBhcm91bmQgdGhlIHotYXhpcyB3aXRoIHRoZSBpbmRpY2F0ZWQgYW1vdW50LgoJLy8vIEBwYXJhbSBhbmdsZSB0aGUgYW5nbGUgdG8gcm9yYXRlIHRoZSB0cmFuc2Zvcm0gdGhyb3VnaCB0aGUgdmVjdG9yCgkKCS8vIGdldCB0aGUgc2luIGFuZCBjb3Mgb2YgdGhlIGFuZ2xlIHBhc3NlZCBpbgoJdmFyIGMgPSBkY29zKGFyZ3VtZW50MCk7Cgl2YXIgcyA9IGRzaW4oYXJndW1lbnQwKTsKCQoJLy8gYnVpbGQgdGhlIHJvdGF0aW9uIG1hdHJpeAoJdmFyIG1UID0gbWF0cml4X2J1aWxkX2lkZW50aXR5KCk7CgltVFswXSA9IGM7CgltVFsxXSA9IC1zOwoJCgltVFs0XSA9IHM7CgltVFs1XSA9IGM7CgkKCXZhciBtID0gbWF0cml4X2dldCggbWF0cml4X3dvcmxkICk7Cgl2YXIgbVIgPSBtYXRyaXhfbXVsdGlwbHkoIG0sIG1UICk7CgltYXRyaXhfc2V0KCBtYXRyaXhfd29ybGQsIG1SICk7Cgp9CgpmdW5jdGlvbiBkM2RfdHJhbnNmb3JtX2FkZF9zY2FsaW5nKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSB0cmFuc2Zvcm1hdGlvbiB0byBhIHNjYWxpbmcgd2l0aCB0aGUgaW5kaWNhdGVkIGFtb3VudHMuCgkvLy8gQHBhcmFtIHhzIHRoZSB4IHNjYWxlIGFtb3VudAoJLy8vIEBwYXJhbSB5cyB0aGUgeSBzY2FsZSBhbW91bnQKCS8vLyBAcGFyYW0genMgdGhlIHogc2NhbGUgYW1vdW50CgkKCS8vIGJ1aWxkIHRoZSByb3RhdGlvbiBtYXRyaXgKCXZhciBtVCA9IG1hdHJpeF9idWlsZF9pZGVudGl0eSgpOwoJbVRbMF0gPSBhcmd1bWVudDA7CgltVFs1XSA9IGFyZ3VtZW50MTsKCW1UWzEwXSA9IGFyZ3VtZW50MjsKCXZhciBtID0gbWF0cml4X2dldCggbWF0cml4X3dvcmxkICk7Cgl2YXIgbVIgPSBtYXRyaXhfbXVsdGlwbHkoIG0sIG1UICk7CgltYXRyaXhfc2V0KCBtYXRyaXhfd29ybGQsIG1SICk7CgkKCn0KCmZ1bmN0aW9uIGQzZF90cmFuc2Zvcm1fYWRkX3RyYW5zbGF0aW9uKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSB0cmFuc2Zvcm1hdGlvbiB0byBhIHRyYW5zbGF0aW9uIG92ZXIgdGhlIGluZGljYXRlZCB2ZWN0b3IuCgkvLy8gQHBhcmFtIHh0IHggdmFsdWUKCS8vLyBAcGFyYW0geXQgeSB2YWx1ZQoJLy8vIEBwYXJhbSB6dCB6IHZhbHVlCgkKCS8vIGJ1aWxkIHRoZSByb3RhdGlvbiBtYXRyaXgKCXZhciBtVCA9IG1hdHJpeF9idWlsZF9pZGVudGl0eSgpOwoJbVRbMTJdID0gYXJndW1lbnQwOwoJbVRbMTNdID0gYXJndW1lbnQxOwoJbVRbMTRdID0gYXJndW1lbnQyOwoJCgl2YXIgbSA9IG1hdHJpeF9nZXQoIG1hdHJpeF93b3JsZCApOwoJdmFyIG1SID0gbWF0cml4X211bHRpcGx5KCBtLCBtVCApOwoJbWF0cml4X3NldCggbWF0cml4X3dvcmxkLCBtUiApOwoKfQoKZnVuY3Rpb24gZDNkX3RyYW5zZm9ybV9zZXRfaWRlbnRpdHkoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIHNldCB0cmFuc2Zvcm0gaWRlbnRpeSBtYXRyaXgKCQoJdmFyIGkgPSBtYXRyaXhfYnVpbGRfaWRlbnRpdHkoKTsKCW1hdHJpeF9zZXQoIG1hdHJpeF93b3JsZCwgaSkKCn0KCmZ1bmN0aW9uIGQzZF90cmFuc2Zvcm1fc2V0X3JvdGF0aW9uX2F4aXMoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIFNldHMgdGhlIHRyYW5zZm9ybWF0aW9uIHRvIGEgcm90YXRpb24gYXJvdW5kIHRoZSBheGlzIGluZGljYXRlZCBieSB0aGUgdmVjdG9yIHdpdGggdGhlIGluZGljYXRlZCBhbW91bnQuCgkvLy8gQHBhcmFtIHhhIHRoZSB4IGNvbXBvbmVudCBvZiB0aGUgdHJhbnNmb3JtIHZlY3RvcgoJLy8vIEBwYXJhbSB5YSB0aGUgeSBjb21wb25lbnQgb2YgdGhlIHRyYW5zZm9ybSB2ZWN0b3IKCS8vLyBAcGFyYW0gemEgdGhlIHogY29tcG9uZW50IG9mIHRoZSB0cmFuc2Zvcm0gdmVjdG9yCgkvLy8gQHBhcmFtIGFuZ2xlIHRoZSBhbmdsZSB0byByb3RhdGUgdGhlIHRyYW5zZm9ybSB0aHJvdWdoIHRoZSB2ZWN0b3IKCQoJLy8gZ2V0IHRoZSBzaW4gYW5kIGNvcyBvZiB0aGUgYW5nbGUgcGFzc2VkIGluCgl2YXIgYyA9IGRjb3MoLWFyZ3VtZW50Myk7Cgl2YXIgcyA9IGRzaW4oLWFyZ3VtZW50Myk7Cgl2YXIgb21jID0gMSAtIGM7CgkKCS8vIG5vcm1hbGlzZSB0aGUgaW5wdXQgdmVjdG9yCgl2YXIgeHggPSBhcmd1bWVudDA7Cgl2YXIgeXkgPSBhcmd1bWVudDE7Cgl2YXIgenogPSBhcmd1bWVudDI7Cgl2YXIgbGVuZ3RoMiA9IHNxcih4eCkgKyBzcXIoeXkpICsgc3FyKHp6KTsKCXZhciBsZW5ndGggPSBzcXJ0KGxlbmd0aDIpOwoJeHggLz0gbGVuZ3RoOwoJeXkgLz0gbGVuZ3RoOwoJenogLz0gbGVuZ3RoOwoJCgkvLyBidWlsZCB0aGUgcm90YXRpb24gbWF0cml4Cgl2YXIgbTsKCW1bMF0gPSBvbWMgKiB4eCAqIHh4ICsgYzsKCW1bMV0gPSBvbWMgKiB4eCAqIHl5ICsgcyAqIHp6OwoJbVsyXSA9IG9tYyAqIHh4ICogenogLSBzICogeXk7CgltWzNdID0gMDsKCQoJbVs0XSA9IG9tYyAqIHh4ICogeXkgLSBzICogeno7CgltWzVdID0gb21jICogeXkgKiB5eSArIGM7CgltWzZdID0gb21jICogeXkgKiB6eiArIHMgKiB4eDsKCW1bN10gPSAwOwoJCgltWzhdID0gb21jICogeHggKiB6eiArIHMgKiB5eTsKCW1bOV0gPSBvbWMgKiB5eSAqIHp6IC0gcyAqIHh4OwoJbVsxMF0gPSBvbWMgKiB6eiAqIHp6ICsgYzsKCW1bMTFdID0gMDsKCQoJbVsxMl0gPSAwOwoJbVsxM10gPSAwOwoJbVsxNF0gPSAwOwoJbVsxNV0gPSAxOwoJCgltYXRyaXhfc2V0KCBtYXRyaXhfd29ybGQsIG0pOwoKfQoKZnVuY3Rpb24gZDNkX3RyYW5zZm9ybV9zZXRfcm90YXRpb25feCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gU2V0cyB0aGUgdHJhbnNmb3JtYXRpb24gdG8gYSByb3RhdGlvbiBhcm91bmQgdGhlIHgtYXhpcyB3aXRoIHRoZSBpbmRpY2F0ZWQgYW1vdW50LgoJLy8vIEBwYXJhbSBhbmdsZSB0aGUgYW5nbGUgdG8gcm90YXRlCgkKCS8vIGdldCB0aGUgc2luIGFuZCBjb3Mgb2YgdGhlIGFuZ2xlIHBhc3NlZCBpbgoJdmFyIGMgPSBkY29zKGFyZ3VtZW50MCk7Cgl2YXIgcyA9IGRzaW4oYXJndW1lbnQwKTsKCQoJLy8gYnVpbGQgdGhlIHJvdGF0aW9uIG1hdHJpeAoJdmFyIG0gPSBtYXRyaXhfYnVpbGRfaWRlbnRpdHkoKTsKCW1bNV0gPSBjOwoJbVs2XSA9IC1zOwoJCgltWzldID0gczsKCW1bMTBdID0gYzsKCQoJbWF0cml4X3NldCggbWF0cml4X3dvcmxkLCBtKTsKCn0KCmZ1bmN0aW9uIGQzZF90cmFuc2Zvcm1fc2V0X3JvdGF0aW9uX3koKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIFNldHMgdGhlIHRyYW5zZm9ybWF0aW9uIHRvIGEgcm90YXRpb24gYXJvdW5kIHRoZSB5LWF4aXMgd2l0aCB0aGUgaW5kaWNhdGVkIGFtb3VudC4KCS8vLyBAcGFyYW0gYW5nbGUgdGhlIGFuZ2xlIHRvIHJvdGF0ZQoJCgkvLyBnZXQgdGhlIHNpbiBhbmQgY29zIG9mIHRoZSBhbmdsZSBwYXNzZWQgaW4KCXZhciBjID0gZGNvcyhhcmd1bWVudDApOwoJdmFyIHMgPSBkc2luKGFyZ3VtZW50MCk7CgkKCS8vIGJ1aWxkIHRoZSByb3RhdGlvbiBtYXRyaXgKCXZhciBtID0gbWF0cml4X2J1aWxkX2lkZW50aXR5KCk7CgltWzBdID0gYzsKCW1bMl0gPSBzOwoJCgltWzhdID0gLXM7CgltWzEwXSA9IGM7CgkKCW1hdHJpeF9zZXQoIG1hdHJpeF93b3JsZCwgbSk7Cgp9CgpmdW5jdGlvbiBkM2RfdHJhbnNmb3JtX3NldF9yb3RhdGlvbl96KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSB0cmFuc2Zvcm1hdGlvbiB0byBhIHJvdGF0aW9uIGFyb3VuZCB0aGUgei1heGlzIHdpdGggdGhlIGluZGljYXRlZCBhbW91bnQuCgkvLy8gQHBhcmFtIGFuZ2xlIHRoZSBhbmdsZSB0byByb3JhdGUgdGhlIHRyYW5zZm9ybSB0aHJvdWdoIHRoZSB2ZWN0b3IKCQoJLy8gZ2V0IHRoZSBzaW4gYW5kIGNvcyBvZiB0aGUgYW5nbGUgcGFzc2VkIGluCgl2YXIgYyA9IGRjb3MoYXJndW1lbnQwKTsKCXZhciBzID0gZHNpbihhcmd1bWVudDApOwoJCgkvLyBidWlsZCB0aGUgcm90YXRpb24gbWF0cml4Cgl2YXIgbSA9IG1hdHJpeF9idWlsZF9pZGVudGl0eSgpOwoJbVswXSA9IGM7CgltWzFdID0gLXM7CgkKCW1bNF0gPSBzOwoJbVs1XSA9IGM7CgkKCW1hdHJpeF9zZXQoIG1hdHJpeF93b3JsZCwgbSk7Cgp9CgpmdW5jdGlvbiBkM2RfdHJhbnNmb3JtX3NldF9zY2FsaW5nKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSB0cmFuc2Zvcm1hdGlvbiB0byBhIHNjYWxpbmcgd2l0aCB0aGUgaW5kaWNhdGVkIGFtb3VudHMuCgkvLy8gQHBhcmFtIHhzIHRoZSB4IHNjYWxlIGFtb3VudAoJLy8vIEBwYXJhbSB5cyB0aGUgeSBzY2FsZSBhbW91bnQKCS8vLyBAcGFyYW0genMgdGhlIHogc2NhbGUgYW1vdW50CgkKCS8vIGJ1aWxkIHRoZSByb3RhdGlvbiBtYXRyaXgKCXZhciBtID0gbWF0cml4X2J1aWxkX2lkZW50aXR5KCk7CgltWzBdID0gYXJndW1lbnQwOwoJbVs1XSA9IGFyZ3VtZW50MTsKCW1bMTBdID0gYXJndW1lbnQyOwoJbWF0cml4X3NldCggbWF0cml4X3dvcmxkLCBtKTsKCn0KCmZ1bmN0aW9uIGQzZF90cmFuc2Zvcm1fc2V0X3RyYW5zbGF0aW9uKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSB0cmFuc2Zvcm1hdGlvbiB0byBhIHRyYW5zbGF0aW9uIG92ZXIgdGhlIGluZGljYXRlZCB2ZWN0b3IuCgkvLy8gQHBhcmFtIHh0IHggdmFsdWUKCS8vLyBAcGFyYW0geXQgeSB2YWx1ZQoJLy8vIEBwYXJhbSB6dCB6IHZhbHVlCgkKCS8vIGJ1aWxkIHRoZSByb3RhdGlvbiBtYXRyaXgKCXZhciBtID0gbWF0cml4X2J1aWxkX2lkZW50aXR5KCk7CgltWzEyXSA9IGFyZ3VtZW50MDsKCW1bMTNdID0gYXJndW1lbnQxOwoJbVsxNF0gPSBhcmd1bWVudDI7CgltYXRyaXhfc2V0KCBtYXRyaXhfd29ybGQsIG0pOwoKfQoKZnVuY3Rpb24gZDNkX3RyYW5zZm9ybV9zdGFja19jbGVhcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gQ2xlYXJzIHRoZSBzdGFjayBvZiB0cmFuc2Zvcm1hdGlvbnMuCgltYXRyaXhfc3RhY2tfY2xlYXIoKTsKfQoKZnVuY3Rpb24gZDNkX3RyYW5zZm9ybV9zdGFja19kaXNjYXJkKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBSZW1vdmVzIHRoZSB0b3AgdHJhbnNmb3JtYXRpb24gZnJvbSB0aGUgc3RhY2suCgltYXRyaXhfc3RhY2tfcG9wKCk7Cn0KCmZ1bmN0aW9uIGQzZF90cmFuc2Zvcm1fc3RhY2tfZW1wdHkoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIFJldHVybnMgd2hldGhlciB0aGUgdHJhbnNmb3JtYXRpb24gc3RhY2sgaXMgZW1wdHkuCglyZXR1cm4gbWF0cml4X3N0YWNrX2lzX2VtcHR5KCk7Cn0KCmZ1bmN0aW9uIGQzZF90cmFuc2Zvcm1fc3RhY2tfcG9wKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBQb3BzIHRoZSB0b3AgdHJhbnNmb3JtYXRpb24gZnJvbSB0aGUgc3RhY2sgYW5kIG1ha2VzIGl0IHRoZSBjdXJyZW50IG9uZS4KCXZhciBtID0gbWF0cml4X3N0YWNrX3RvcCgpOwoJbWF0cml4X3N0YWNrX3BvcCgpOwoJbWF0cml4X3NldCggbWF0cml4X3dvcmxkLCBtKTsKCn0KCmZ1bmN0aW9uIGQzZF90cmFuc2Zvcm1fc3RhY2tfcHVzaCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gUHVzaGVzIHRoZSBjdXJyZW50IHRyYW5zZm9ybWF0aW9uIG9udG8gdGhlIHN0YWNrLgoJdmFyIG0gPSBtYXRyaXhfZ2V0KCBtYXRyaXhfd29ybGQgKTsKCW1hdHJpeF9zdGFja19wdXNoKCk7CgltYXRyaXhfc3RhY2tfc2V0KCBtICk7CglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gZDNkX3RyYW5zZm9ybV9zdGFja190b3AoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIE1ha2VzIHRoZSB0b3AgdHJhbnNmb3JtYXRpb24gdGhlIGN1cnJlbnQgb25lLgoJdmFyIG0gPSBtYXRyaXhfc3RhY2tfdG9wKCk7CgltYXRyaXhfc2V0KCBtYXRyaXhfd29ybGQsIG0pOwoKfQoKZnVuY3Rpb24gZDNkX3RyYW5zZm9ybV92ZXJ0ZXgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIFNldHMgdGhlIHRyYW5zZm9ybWF0aW9uIHRvIGEgc2NhbGluZyB3aXRoIHRoZSBpbmRpY2F0ZWQgYW1vdW50cy4KCS8vLyBAcGFyYW0geHMgdGhlIHggc2NhbGUgYW1vdW50CgkvLy8gQHBhcmFtIHlzIHRoZSB5IHNjYWxlIGFtb3VudAoJLy8vIEBwYXJhbSB6cyB0aGUgeiBzY2FsZSBhbW91bnQKCXZhciBtID0gbWF0cml4X2dldCggbWF0cml4X3dvcmxkICk7CglyZXR1cm4gbWF0cml4X3RyYW5zZm9ybV92ZXJ0ZXgoIG0sIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIgKTsKfQoKZnVuY3Rpb24gZDNkX3ZlcnRleCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gU2V0cyB0aGUgcHJpbWl0aXZlIHZlcnRleAoJLy8vIEBwYXJhbSB4IHRoZSB4IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHkgdGhlIHkgcG9zaXRpb24KCS8vLyBAcGFyYW0geiB0aGUgeiBwb3NpdGlvbgoJCgl2ZXJ0ZXhfcG9zaXRpb25fM2QoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIgKTsKCXZlcnRleF9ub3JtYWwoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIDAsIDAsIDAgKTsKCXZlcnRleF9jb2xvdXIoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGRyYXdfZ2V0X2NvbG91cigpLCBkcmF3X2dldF9hbHBoYSgpKTsKCXZlcnRleF90ZXhjb29yZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgMCwgMCApOwoJCgkKCQoKfQoKZnVuY3Rpb24gZDNkX3ZlcnRleF9jb2xvcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gU2V0cyB0aGUgcHJpbWl0aXZlIHZlcnRleCBhbmQgY29sb3VyCgkvLy8gQHBhcmFtIHggdGhlIHggcG9zaXRpb24KCS8vLyBAcGFyYW0geSB0aGUgeSBwb3NpdGlvbgoJLy8vIEBwYXJhbSB6IHRoZSB6IHBvc2l0aW9uCgkvLy8gQHBhcmFtIGNvbCB0aGUgY29sb3VyCgkvLy8gQHBhcmFtIGFscGhhIHRoZSBhbHBoYQoJCgl2ZXJ0ZXhfcG9zaXRpb25fM2QoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIgKTsKCXZlcnRleF9ub3JtYWwoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIDAsIDAsIDAgKTsKCXZlcnRleF9jb2xvdXIoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGFyZ3VtZW50MywgYXJndW1lbnQ0ICk7Cgl2ZXJ0ZXhfdGV4Y29vcmQoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIDAsIDAgKTsKCQoJCgkKCn0KCmZ1bmN0aW9uIGQzZF92ZXJ0ZXhfY29sb3VyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSBwcmltaXRpdmUgdmVydGV4IGFuZCBjb2xvdXIKCS8vLyBAcGFyYW0geCB0aGUgeCBwb3NpdGlvbgoJLy8vIEBwYXJhbSB5IHRoZSB5IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHogdGhlIHogcG9zaXRpb24KCS8vLyBAcGFyYW0gY29sIHRoZSBjb2xvdXIKCS8vLyBAcGFyYW0gYWxwaGEgdGhlIGFscGhhCgkKCXZlcnRleF9wb3NpdGlvbl8zZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiApOwoJdmVydGV4X25vcm1hbCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgMCwgMCwgMCApOwoJdmVydGV4X2NvbG91ciggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQzLCBhcmd1bWVudDQgKTsKCXZlcnRleF90ZXhjb29yZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgMCwgMCApOwoJCgkKCn0KCmZ1bmN0aW9uIGQzZF92ZXJ0ZXhfbm9ybWFsKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSBwcmltaXRpdmUgdmVydGV4IGFuZCBub3JtYWwKCS8vLyBAcGFyYW0geCB0aGUgeCBwb3NpdGlvbgoJLy8vIEBwYXJhbSB5IHRoZSB5IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHogdGhlIHogcG9zaXRpb24KCS8vLyBAcGFyYW0gbnggdGhlIG5vcm1hbCB4CgkvLy8gQHBhcmFtIG55IHRoZSBub3JtYWwgeQoJLy8vIEBwYXJhbSBueiB0aGUgbm9ybWFsIHoKCQoJdmVydGV4X3Bvc2l0aW9uXzNkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyICk7Cgl2ZXJ0ZXhfbm9ybWFsKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1ICk7Cgl2ZXJ0ZXhfY29sb3VyKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBkcmF3X2dldF9jb2xvdXIoKSwgZHJhd19nZXRfYWxwaGEoKSApOwoJdmVydGV4X3RleGNvb3JkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCAwLCAwICk7CgkKCQoKfQoKZnVuY3Rpb24gZDNkX3ZlcnRleF9ub3JtYWxfY29sb3IoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIFNldHMgdGhlIHByaW1pdGl2ZSB2ZXJ0ZXggYW5kIG5vcm1hbAoJLy8vIEBwYXJhbSB4IHRoZSB4IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHkgdGhlIHkgcG9zaXRpb24KCS8vLyBAcGFyYW0geiB0aGUgeiBwb3NpdGlvbgoJLy8vIEBwYXJhbSBueCB0aGUgbm9ybWFsIHgKCS8vLyBAcGFyYW0gbnkgdGhlIG5vcm1hbCB5CgkvLy8gQHBhcmFtIG56IHRoZSBub3JtYWwgegoJLy8vIEBwYXJhbSBjb2wgdGhlIGNvbG91cgoJLy8vIEBwYXJhbSBhbHBoYSB0aGUgYWxwaGEKCQoJdmVydGV4X3Bvc2l0aW9uXzNkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyICk7Cgl2ZXJ0ZXhfbm9ybWFsKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1ICk7Cgl2ZXJ0ZXhfY29sb3VyKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDYsIGFyZ3VtZW50NyApOwoJdmVydGV4X3RleGNvb3JkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCAwLCAwICk7CgkKCQoKfQoKZnVuY3Rpb24gZDNkX3ZlcnRleF9ub3JtYWxfY29sb3VyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSBwcmltaXRpdmUgdmVydGV4IGFuZCBub3JtYWwKCS8vLyBAcGFyYW0geCB0aGUgeCBwb3NpdGlvbgoJLy8vIEBwYXJhbSB5IHRoZSB5IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHogdGhlIHogcG9zaXRpb24KCS8vLyBAcGFyYW0gbnggdGhlIG5vcm1hbCB4CgkvLy8gQHBhcmFtIG55IHRoZSBub3JtYWwgeQoJLy8vIEBwYXJhbSBueiB0aGUgbm9ybWFsIHoKCS8vLyBAcGFyYW0gY29sIHRoZSBjb2xvdXIKCS8vLyBAcGFyYW0gYWxwaGEgdGhlIGFscGhhCgkKCXZlcnRleF9wb3NpdGlvbl8zZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiApOwoJdmVydGV4X25vcm1hbCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSApOwoJdmVydGV4X2NvbG91ciggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQ2LCBhcmd1bWVudDcgKTsKCXZlcnRleF90ZXhjb29yZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgMCwgMCApOwoJCgkKCn0KCmZ1bmN0aW9uIGQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIERlZmluZXMgYSB2ZXJ0ZXggZm9yIGEgdGV4dHVyZWQgcHJpbWl0aXZlIGluIDNEIGFsb25nIHdpdGggaXRzIGNvcnJlc3BvbmRpbmcgbm9ybWFsLgoJLy8vIEBwYXJhbSB4IHRoZSB4IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHkgdGhlIHkgcG9zaXRpb24KCS8vLyBAcGFyYW0geiB0aGUgeiBwb3NpdGlvbgoJLy8vIEBwYXJhbSBueCB0aGUgbm9ybWFsIHgKCS8vLyBAcGFyYW0gbnkgdGhlIG5vcm1hbCB5CgkvLy8gQHBhcmFtIG56IHRoZSBub3JtYWwgegoJLy8vIEBwYXJhbSB1IHRoZSBub3JtYWwgdQoJLy8vIEBwYXJhbSB2IHRoZSBub3JtYWwgdgoJCgl2ZXJ0ZXhfcG9zaXRpb25fM2QoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIgKTsKCXZlcnRleF9ub3JtYWwoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGFyZ3VtZW50MywgYXJndW1lbnQ0LCBhcmd1bWVudDUgKTsKCXZlcnRleF9jb2xvdXIoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIGRyYXdfZ2V0X2NvbG91cigpLCBkcmF3X2dldF9hbHBoYSgpICk7Cgl2ZXJ0ZXhfdGV4Y29vcmQoIGdsb2JhbC5fX2QzZFByaW1CdWZmZXIsIChhcmd1bWVudDYgKiBnbG9iYWwuX19kM2RQcmltVGV4VykgKyBnbG9iYWwuX19kM2RQcmltVGV4WCwgKGFyZ3VtZW50NyAqIGdsb2JhbC5fX2QzZFByaW1UZXhIKSArIGdsb2JhbC5fX2QzZFByaW1UZXhZICk7Cn0KCmZ1bmN0aW9uIGQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmVfY29sb3IoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIFNldHMgdGhlIHByaW1pdGl2ZSB2ZXJ0ZXggYW5kIG5vcm1hbAoJLy8vIEBwYXJhbSB4IHRoZSB4IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHkgdGhlIHkgcG9zaXRpb24KCS8vLyBAcGFyYW0geiB0aGUgeiBwb3NpdGlvbgoJLy8vIEBwYXJhbSBueCB0aGUgbm9ybWFsIHgKCS8vLyBAcGFyYW0gbnkgdGhlIG5vcm1hbCB5CgkvLy8gQHBhcmFtIG56IHRoZSBub3JtYWwgegoJLy8vIEBwYXJhbSB1IHRoZSBub3JtYWwgdQoJLy8vIEBwYXJhbSB2IHRoZSBub3JtYWwgdgoJLy8vIEBwYXJhbSBjb2wgdGhlIGNvbG91cgoJLy8vIEBwYXJhbSBhbHBoYSB0aGUgYWxwaGEKCQoJdmVydGV4X3Bvc2l0aW9uXzNkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyICk7Cgl2ZXJ0ZXhfbm9ybWFsKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1ICk7Cgl2ZXJ0ZXhfY29sb3VyKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDgsIGFyZ3VtZW50OSApOwoJdmVydGV4X3RleGNvb3JkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCAoYXJndW1lbnQ2ICogZ2xvYmFsLl9fZDNkUHJpbVRleFcpICsgZ2xvYmFsLl9fZDNkUHJpbVRleFgsIChhcmd1bWVudDcgKiBnbG9iYWwuX19kM2RQcmltVGV4SCkgKyBnbG9iYWwuX19kM2RQcmltVGV4WSApOwoJCgkKCn0KCmZ1bmN0aW9uIGQzZF92ZXJ0ZXhfbm9ybWFsX3RleHR1cmVfY29sb3VyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBkM2QgLSBTZXRzIHRoZSBwcmltaXRpdmUgdmVydGV4IGFuZCBub3JtYWwKCS8vLyBAcGFyYW0geCB0aGUgeCBwb3NpdGlvbgoJLy8vIEBwYXJhbSB5IHRoZSB5IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHogdGhlIHogcG9zaXRpb24KCS8vLyBAcGFyYW0gbnggdGhlIG5vcm1hbCB4CgkvLy8gQHBhcmFtIG55IHRoZSBub3JtYWwgeQoJLy8vIEBwYXJhbSBueiB0aGUgbm9ybWFsIHoKCS8vLyBAcGFyYW0gdSB0aGUgbm9ybWFsIHUKCS8vLyBAcGFyYW0gdiB0aGUgbm9ybWFsIHYKCS8vLyBAcGFyYW0gY29sIHRoZSBjb2xvdXIKCS8vLyBAcGFyYW0gYWxwaGEgdGhlIGFscGhhCgkKCXZlcnRleF9wb3NpdGlvbl8zZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiApOwoJdmVydGV4X25vcm1hbCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSApOwoJdmVydGV4X2NvbG91ciggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQ4LCBhcmd1bWVudDkgKTsKCXZlcnRleF90ZXhjb29yZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgKGFyZ3VtZW50NiAqIGdsb2JhbC5fX2QzZFByaW1UZXhXKSArIGdsb2JhbC5fX2QzZFByaW1UZXhYLCAoYXJndW1lbnQ3ICogZ2xvYmFsLl9fZDNkUHJpbVRleEgpICsgZ2xvYmFsLl9fZDNkUHJpbVRleFkgKTsKCQoJCgp9CgpmdW5jdGlvbiBkM2RfdmVydGV4X3RleHR1cmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIFNldHMgdGhlIHByaW1pdGl2ZSB2ZXJ0ZXgKCS8vLyBAcGFyYW0geCB0aGUgeCBwb3NpdGlvbgoJLy8vIEBwYXJhbSB5IHRoZSB5IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHogdGhlIHogcG9zaXRpb24KCS8vLyBAcGFyYW0gdSB0aGUgbm9ybWFsIHUKCS8vLyBAcGFyYW0gdiB0aGUgbm9ybWFsIHYKCQoJdmVydGV4X3Bvc2l0aW9uXzNkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyICk7Cgl2ZXJ0ZXhfbm9ybWFsKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCAwLCAwLCAwICk7Cgl2ZXJ0ZXhfY29sb3VyKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBkcmF3X2dldF9jb2xvdXIoKSwgZHJhd19nZXRfYWxwaGEoKSApOwoJdmVydGV4X3RleGNvb3JkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCAoYXJndW1lbnQzICogZ2xvYmFsLl9fZDNkUHJpbVRleFcpICsgZ2xvYmFsLl9fZDNkUHJpbVRleFgsIChhcmd1bWVudDQgKiBnbG9iYWwuX19kM2RQcmltVGV4SCkgKyBnbG9iYWwuX19kM2RQcmltVGV4WSApOwoJCgkKCn0KCmZ1bmN0aW9uIGQzZF92ZXJ0ZXhfdGV4dHVyZV9jb2xvcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gZDNkIC0gU2V0cyB0aGUgcHJpbWl0aXZlIHZlcnRleAoJLy8vIEBwYXJhbSB4IHRoZSB4IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHkgdGhlIHkgcG9zaXRpb24KCS8vLyBAcGFyYW0geiB0aGUgeiBwb3NpdGlvbgoJLy8vIEBwYXJhbSB1IHRoZSBub3JtYWwgdQoJLy8vIEBwYXJhbSB2IHRoZSBub3JtYWwgdgoJLy8vIEBwYXJhbSBjb2wgdGhlIGNvbG91cgoJLy8vIEBwYXJhbSBhbHBoYSB0aGUgYWxwaGEKCQoJdmVydGV4X3Bvc2l0aW9uXzNkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyICk7Cgl2ZXJ0ZXhfbm9ybWFsKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCAwLCAwLCAwICk7Cgl2ZXJ0ZXhfY29sb3VyKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCBhcmd1bWVudDUsIGFyZ3VtZW50NiApOwoJdmVydGV4X3RleGNvb3JkKCBnbG9iYWwuX19kM2RQcmltQnVmZmVyLCAoYXJndW1lbnQzICogZ2xvYmFsLl9fZDNkUHJpbVRleFcpICsgZ2xvYmFsLl9fZDNkUHJpbVRleFgsIChhcmd1bWVudDQgKiBnbG9iYWwuX19kM2RQcmltVGV4SCkgKyBnbG9iYWwuX19kM2RQcmltVGV4WSApOwoJCgkKCn0KCmZ1bmN0aW9uIGQzZF92ZXJ0ZXhfdGV4dHVyZV9jb2xvdXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGQzZCAtIFNldHMgdGhlIHByaW1pdGl2ZSB2ZXJ0ZXgKCS8vLyBAcGFyYW0geCB0aGUgeCBwb3NpdGlvbgoJLy8vIEBwYXJhbSB5IHRoZSB5IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHogdGhlIHogcG9zaXRpb24KCS8vLyBAcGFyYW0gdSB0aGUgbm9ybWFsIHUKCS8vLyBAcGFyYW0gdiB0aGUgbm9ybWFsIHYKCS8vLyBAcGFyYW0gY29sIHRoZSBjb2xvdXIKCS8vLyBAcGFyYW0gYWxwaGEgdGhlIGFscGhhCgkKCXZlcnRleF9wb3NpdGlvbl8zZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiApOwoJdmVydGV4X25vcm1hbCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgMCwgMCwgMCApOwoJdmVydGV4X2NvbG91ciggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgYXJndW1lbnQ1LCBhcmd1bWVudDYgKTsKCXZlcnRleF90ZXhjb29yZCggZ2xvYmFsLl9fZDNkUHJpbUJ1ZmZlciwgKGFyZ3VtZW50MyAqIGdsb2JhbC5fX2QzZFByaW1UZXhXKSArIGdsb2JhbC5fX2QzZFByaW1UZXhYLCAoYXJndW1lbnQ0ICogZ2xvYmFsLl9fZDNkUHJpbVRleEgpICsgZ2xvYmFsLl9fZDNkUHJpbVRleFkgKTsKCQoJCgp9CgpmdW5jdGlvbiBfX2QzZF9tb2RlbF9hZGRfdmVydGV4KCkKewoJCgkJdmFyIG0gPSBhcmd1bWVudDA7CgkJdmFyIGkgPSBlX19ZWU0uVHJpQjsKCQl2YXIgdXZfaSA9IGVfX1lZTS5UcmlVVkI7CgkJdmFyIGNvbGFycmF5aSA9IGVfX1lZTS5UcmlDb2xzOwoJCXZhciBjb2xudW0gPSBlX19ZWU0uTnVtVHJpQ29sczsKCQlzd2l0Y2gobVtlX19ZWU0uUHJpbUtpbmRdKQoJCXsKCQljYXNlIHByX3BvaW50bGlzdDoKCQkJaSA9IGVfX1lZTS5Qb2ludEI7CgkJCXV2X2kgPSBlX19ZWU0uUG9pbnRVVkI7CgkJCWNvbGFycmF5aSA9IGVfX1lZTS5Qb2ludENvbHM7CgkJCWNvbG51bSA9IGVfX1lZTS5OdW1Qb2ludENvbHM7CgkJCWJyZWFrOwoJCWNhc2UgcHJfbGluZWxpc3Q6CgkJY2FzZSBwcl9saW5lc3RyaXA6CgkJCWkgPSBlX19ZWU0uTGluZUI7CgkJCXV2X2kgPSBlX19ZWU0uTGluZVVWQjsKCQkJY29sYXJyYXlpID0gZV9fWVlNLkxpbmVDb2xzOwoJCQljb2xudW0gPSBlX19ZWU0uTnVtTGluZUNvbHM7CgkJCWJyZWFrOwoJCX0KCQoJCXZhciBjb2xhcnJheSA9IG1bY29sYXJyYXlpXTsKCQoJCS8vIGNyZWF0ZSB0aGUgYnVmZmVyIGlmIHdlIG5lZWQgdG8KCQl2YXIgYiA9IG1baV07CgkJaWYgKGIgPT0gdW5kZWZpbmVkKSB7CgkJCWIgPSBidWZmZXJfY3JlYXRlKCAzNiwgYnVmZmVyX2dyb3csIDEgKTsKCQkJbVtAaV0gPSBiOwoJCX0gLy8gZW5kIGlmCgkKCQkvLyBjcmVhdGUgdGhlIHV2IGJ1ZmZlciBpZiB3ZSBuZWVkIHRvCgkJdmFyIHV2YiA9IG1bdXZfaV07CgkJaWYgKHV2YiA9PSB1bmRlZmluZWQpCgkJewoJCQl1dmIgPSBidWZmZXJfY3JlYXRlKDgsIGJ1ZmZlcl9ncm93LCAxKTsKCQkJbVtAdXZfaV0gPSB1dmI7CgkJfQoJCgkJdmFyIGdsb2JhbGNvbCA9IGZhbHNlOwoJCWlmIChhcmd1bWVudDcgPT0gJDAwMDEwMDAwKQoJCXsKCQkJZ2xvYmFsY29sID0gdHJ1ZTsKCQl9CgkKCQkvLyBhZGQgdGhlIHZlcnRleCBpbgoJCXZhciBjID0gbVtlX19ZWU0uTnVtVmVydHNdOwoJCXN3aXRjaChtW2VfX1lZTS5QcmltS2luZF0pCgkJewoJCWNhc2UgcHJfcG9pbnRsaXN0OgoJCWNhc2UgcHJfbGluZWxpc3Q6CgkJY2FzZSBwcl90cmlhbmdsZWxpc3Q6CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQxICk7CQkvLyB4CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQyICk7CQkvLyB5CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQzICk7CQkvLyB6CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ0ICk7CQkvLyBueAoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50NSApOwkJLy8gbnkKCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBhcmd1bWVudDYgKTsJCS8vIG56CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX3UzMiwgYXJndW1lbnQ3ICk7CQkvLyBjb2xvdXIKCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBhcmd1bWVudDggKTsJCS8vIHUKCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBhcmd1bWVudDkgKTsJCS8vIHYJCQoJCQoJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ4ICk7CgkJCWJ1ZmZlcl93cml0ZSggdXZiLCBidWZmZXJfZjMyLCBhcmd1bWVudDkgKTsKCQkJKytjOwoJCQoJCQlpZiAoZ2xvYmFsY29sKQoJCQl7CgkJCQljb2xhcnJheVsgbVtjb2xudW1dXSA9IGJ1ZmZlcl90ZWxsKGIpIC0gMTI7CgkJCQltW0AgY29sbnVtXSsrOwoJCQl9CgkJCWJyZWFrOwoJCWNhc2UgcHJfbGluZXN0cmlwOgoJCQkvLyBhZGQgdGhlIHByZXZpb3VzIGlmIHdlIGFyZSBvbiB2ZXJ0ZXggMSBvciBhYm92ZQoJCQlpZiAoYyA+PSAyKSB7CgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVggXSApOwkJLy8geAoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFZIF0gKTsJCS8vIHkKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxWiBdICk7CQkvLyB6CgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMU5YIF0gKTsJLy8gbngKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxTlkgXSApOwkvLyBueQoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFOWiBdICk7CS8vIG56CgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl91MzIsIG1bIGVfX1lZTS5WMUMgXSApOwkJLy8gY29sb3VyCgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVUgXSApOwkJLy8gdQoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFWIF0gKTsJCS8vIHYKCQkJCgkJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxVSBdICk7CgkJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxViBdICk7CQoJCQkJKytjOwoJCQkKCQkJCWlmIChnbG9iYWxjb2wpCgkJCQl7CgkJCQkJY29sYXJyYXlbIG1bY29sbnVtXV0gPSBidWZmZXJfdGVsbChiKSAtIDEyOwoJCQkJCW1bQCBjb2xudW1dKys7CgkJCQl9CgkJCX0gLy8gZW5kIGlmCQoJCQoJCQltW0AgZV9fWVlNLlYxWCBdID0gYXJndW1lbnQxOwoJCQltW0AgZV9fWVlNLlYxWSBdID0gYXJndW1lbnQyOwoJCQltW0AgZV9fWVlNLlYxWiBdID0gYXJndW1lbnQzOwoJCQltW0AgZV9fWVlNLlYxTlggXSA9IGFyZ3VtZW50NDsKCQkJbVtAIGVfX1lZTS5WMU5ZIF0gPSBhcmd1bWVudDU7CgkJCW1bQCBlX19ZWU0uVjFOWiBdID0gYXJndW1lbnQ2OwoJCQltW0AgZV9fWVlNLlYxQyBdID0gYXJndW1lbnQ3OwoJCQltW0AgZV9fWVlNLlYxVSBdID0gYXJndW1lbnQ4OwoJCQltW0AgZV9fWVlNLlYxViBdID0gYXJndW1lbnQ5OwoJCQoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50MSApOwkJLy8geAoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50MiApOwkJLy8geQoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50MyApOwkJLy8gegoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50NCApOwkJLy8gbngKCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBhcmd1bWVudDUgKTsJCS8vIG55CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ2ICk7CQkvLyBuegoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl91MzIsIGFyZ3VtZW50NyApOwkJLy8gY29sb3VyCgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ4ICk7CQkvLyB1CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ5ICk7CQkvLyB2CQoJCQoJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ4ICk7CgkJCWJ1ZmZlcl93cml0ZSggdXZiLCBidWZmZXJfZjMyLCBhcmd1bWVudDkgKTsKCQkJKytjOwoJCQoJCQlpZiAoZ2xvYmFsY29sKQoJCQl7CgkJCQljb2xhcnJheVsgbVtjb2xudW1dXSA9IGJ1ZmZlcl90ZWxsKGIpIC0gMTI7CgkJCQltW0AgY29sbnVtXSsrOwoJCQl9CQoJCQlicmVhazsKCQljYXNlIHByX3RyaWFuZ2xlc3RyaXA6CgkJCS8vIGFkZCB0aGUgcHJldmlvdXMgaWYgd2UgYXJlIG9uIHZlcnRleCAxIG9yIGFib3ZlCgkJCXZhciBmbGlwID0gKChjICYgMSkgPT0gMSkgPyB0cnVlIDogZmFsc2U7CgkJCWlmIChjID49IDMpIHsKCQkJCWlmIChmbGlwKQoJCQkJewkJCQkJCQoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyWCBdICk7CQkvLyB4CgkJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjJZIF0gKTsJCS8vIHkKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMlogXSApOwkJLy8gegoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyTlggXSApOwkvLyBueAoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyTlkgXSApOwkvLyBueQoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyTlogXSApOwkvLyBuegoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX3UzMiwgbVsgZV9fWVlNLlYyQyBdICk7CQkvLyBjb2xvdXIKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMlUgXSApOwkJLy8gdQoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyViBdICk7CQkvLyB2CgkJCQoJCQkJCWJ1ZmZlcl93cml0ZSggdXZiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjJVIF0gKTsKCQkJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyViBdICk7CgkJCQkJKytjOwoJCQkJCQoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxWCBdICk7CQkvLyB4CgkJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFZIF0gKTsJCS8vIHkKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVogXSApOwkJLy8gegoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxTlggXSApOwkvLyBueAoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxTlkgXSApOwkvLyBueQoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxTlogXSApOwkvLyBuegoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX3UzMiwgbVsgZV9fWVlNLlYxQyBdICk7CQkvLyBjb2xvdXIKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVUgXSApOwkJLy8gdQoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxViBdICk7CQkvLyB2CgkJCQoJCQkJCWJ1ZmZlcl93cml0ZSggdXZiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFVIF0gKTsKCQkJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxViBdICk7CgkJCQkJKytjOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxWCBdICk7CQkvLyB4CgkJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFZIF0gKTsJCS8vIHkKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVogXSApOwkJLy8gegoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxTlggXSApOwkvLyBueAoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxTlkgXSApOwkvLyBueQoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxTlogXSApOwkvLyBuegoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX3UzMiwgbVsgZV9fWVlNLlYxQyBdICk7CQkvLyBjb2xvdXIKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVUgXSApOwkJLy8gdQoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxViBdICk7CQkvLyB2CgkJCQoJCQkJCWJ1ZmZlcl93cml0ZSggdXZiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFVIF0gKTsKCQkJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxViBdICk7CgkJCQkJKytjOwoJCQkKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMlggXSApOwkJLy8geAoJCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyWSBdICk7CQkvLyB5CgkJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjJaIF0gKTsJCS8vIHoKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMk5YIF0gKTsJLy8gbngKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMk5ZIF0gKTsJLy8gbnkKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMk5aIF0gKTsJLy8gbnoKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl91MzIsIG1bIGVfX1lZTS5WMkMgXSApOwkJLy8gY29sb3VyCgkJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjJVIF0gKTsJCS8vIHUKCQkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMlYgXSApOwkJLy8gdgoJCQkKCQkJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyVSBdICk7CgkJCQkJYnVmZmVyX3dyaXRlKCB1dmIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMlYgXSApOwoJCQkJCSsrYzsKCQkJCX0JCQkJCQoJCQkKCQkJCWlmIChnbG9iYWxjb2wpCgkJCQl7CgkJCQkJY29sYXJyYXlbIG1bY29sbnVtXV0gPSBidWZmZXJfdGVsbChiKSAtICgxMiArIDM2KSA7CgkJCQkJbVtAIGNvbG51bV0rKzsKCQkJCQoJCQkJCWNvbGFycmF5WyBtW2NvbG51bV1dID0gYnVmZmVyX3RlbGwoYikgLSAxMjsKCQkJCQltW0AgY29sbnVtXSsrOwoJCQkJfQkKCQkJfSAvLyBlbmQgaWYJCgkJCgkJCW1bQCBlX19ZWU0uVjFYIF0gPSBtWyBlX19ZWU0uVjJYIF07CgkJCW1bQCBlX19ZWU0uVjFZIF0gPSBtWyBlX19ZWU0uVjJZIF07CgkJCW1bQCBlX19ZWU0uVjFaIF0gPSBtWyBlX19ZWU0uVjJaIF07CgkJCW1bQCBlX19ZWU0uVjFOWCBdID0gbVsgZV9fWVlNLlYyTlggXTsKCQkJbVtAIGVfX1lZTS5WMU5ZIF0gPSBtWyBlX19ZWU0uVjJOWSBdOwoJCQltW0AgZV9fWVlNLlYxTlogXSA9IG1bIGVfX1lZTS5WMk5aIF07CgkJCW1bQCBlX19ZWU0uVjFDIF0gPSBtWyBlX19ZWU0uVjJDIF07CgkJCW1bQCBlX19ZWU0uVjFVIF0gPSBtWyBlX19ZWU0uVjJVIF07CgkJCW1bQCBlX19ZWU0uVjFWIF0gPSBtWyBlX19ZWU0uVjJWIF07CgkJCgkJCW1bQCBlX19ZWU0uVjJYIF0gPSBhcmd1bWVudDE7CgkJCW1bQCBlX19ZWU0uVjJZIF0gPSBhcmd1bWVudDI7CgkJCW1bQCBlX19ZWU0uVjJaIF0gPSBhcmd1bWVudDM7CgkJCW1bQCBlX19ZWU0uVjJOWCBdID0gYXJndW1lbnQ0OwoJCQltW0AgZV9fWVlNLlYyTlkgXSA9IGFyZ3VtZW50NTsKCQkJbVtAIGVfX1lZTS5WMk5aIF0gPSBhcmd1bWVudDY7CgkJCW1bQCBlX19ZWU0uVjJDIF0gPSBhcmd1bWVudDc7CgkJCW1bQCBlX19ZWU0uVjJVIF0gPSBhcmd1bWVudDg7CgkJCW1bQCBlX19ZWU0uVjJWIF0gPSBhcmd1bWVudDk7CgkJCgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQxICk7CQkvLyB4CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQyICk7CQkvLyB5CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQzICk7CQkvLyB6CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ0ICk7CQkvLyBueAoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50NSApOwkJLy8gbnkKCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBhcmd1bWVudDYgKTsJCS8vIG56CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX3UzMiwgYXJndW1lbnQ3ICk7CQkvLyBjb2xvdXIKCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBhcmd1bWVudDggKTsJCS8vIHUKCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBhcmd1bWVudDkgKTsJCS8vIHYKCQkKCQkJYnVmZmVyX3dyaXRlKCB1dmIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50OCApOwoJCQlidWZmZXJfd3JpdGUoIHV2YiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ5ICk7CgkJCgkJCWlmIChnbG9iYWxjb2wpCgkJCXsKCQkJCWNvbGFycmF5WyBtW2NvbG51bV1dID0gYnVmZmVyX3RlbGwoYikgLSAxMjsKCQkJCW1bQCBjb2xudW1dKys7CgkJCX0JCgkJCSsrYzsKCQkJYnJlYWs7CgkJY2FzZSBwcl90cmlhbmdsZWZhbjoKCQkJaWYgKGM9PTApIHsKCQkJCW1bQCBlX19ZWU0uVjFYIF0gPSBhcmd1bWVudDE7CgkJCQltW0AgZV9fWVlNLlYxWSBdID0gYXJndW1lbnQyOwoJCQkJbVtAIGVfX1lZTS5WMVogXSA9IGFyZ3VtZW50MzsKCQkJCW1bQCBlX19ZWU0uVjFOWCBdID0gYXJndW1lbnQ0OwoJCQkJbVtAIGVfX1lZTS5WMU5ZIF0gPSBhcmd1bWVudDU7CgkJCQltW0AgZV9fWVlNLlYxTlogXSA9IGFyZ3VtZW50NjsKCQkJCW1bQCBlX19ZWU0uVjFDIF0gPSBhcmd1bWVudDc7CgkJCQltW0AgZV9fWVlNLlYxVSBdID0gYXJndW1lbnQ4OwoJCQkJbVtAIGVfX1lZTS5WMVYgXSA9IGFyZ3VtZW50OTsKCQkJfSAvLyBlbmQgaWYKCQkKCQkJaWYgKGMgPj0gMykgewoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFYIF0gKTsJCS8vIHgKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxWSBdICk7CQkvLyB5CgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVogXSApOwkJLy8gegoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFOWCBdICk7CS8vIG54CgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMU5ZIF0gKTsJLy8gbnkKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxTlogXSApOwkvLyBuegoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfdTMyLCBtWyBlX19ZWU0uVjFDIF0gKTsJCS8vIGNvbG91cgoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjFVIF0gKTsJCS8vIHUKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYxViBdICk7CQkvLyB2CgkJCQoJCQkJYnVmZmVyX3dyaXRlKCB1dmIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVUgXSApOwoJCQkJYnVmZmVyX3dyaXRlKCB1dmIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMVYgXSApOwoJCQkJKytjOwoJCQkKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyWCBdICk7CQkvLyB4CgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMlkgXSApOwkJLy8geQoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjJaIF0gKTsJCS8vIHoKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyTlggXSApOwkvLyBueAoJCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjJOWSBdICk7CS8vIG55CgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMk5aIF0gKTsJLy8gbnoKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX3UzMiwgbVsgZV9fWVlNLlYyQyBdICk7CQkvLyBjb2xvdXIKCQkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgbVsgZV9fWVlNLlYyVSBdICk7CQkvLyB1CgkJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIG1bIGVfX1lZTS5WMlYgXSApOwkJLy8gdgoJCQkKCQkJCWJ1ZmZlcl93cml0ZSggdXZiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjJVIF0gKTsKCQkJCWJ1ZmZlcl93cml0ZSggdXZiLCBidWZmZXJfZjMyLCBtWyBlX19ZWU0uVjJWIF0gKTsKCQkJCSsrYzsKCQkJCgkJCQlpZiAoZ2xvYmFsY29sKQoJCQkJewoJCQkJCWNvbGFycmF5WyBtW2NvbG51bV1dID0gYnVmZmVyX3RlbGwoYikgLSAoMTIgKyAzNikgOwoJCQkJCW1bQCBjb2xudW1dKys7CgkJCQkKCQkJCQljb2xhcnJheVsgbVtjb2xudW1dXSA9IGJ1ZmZlcl90ZWxsKGIpIC0gMTI7CgkJCQkJbVtAIGNvbG51bV0rKzsKCQkJCX0JCgkJCX0gLy8gZW5kIGlmCQoJCQoJCQltW0AgZV9fWVlNLlYyWCBdID0gYXJndW1lbnQxOwoJCQltW0AgZV9fWVlNLlYyWSBdID0gYXJndW1lbnQyOwoJCQltW0AgZV9fWVlNLlYyWiBdID0gYXJndW1lbnQzOwoJCQltW0AgZV9fWVlNLlYyTlggXSA9IGFyZ3VtZW50NDsKCQkJbVtAIGVfX1lZTS5WMk5ZIF0gPSBhcmd1bWVudDU7CgkJCW1bQCBlX19ZWU0uVjJOWiBdID0gYXJndW1lbnQ2OwoJCQltW0AgZV9fWVlNLlYyQyBdID0gYXJndW1lbnQ3OwoJCQltW0AgZV9fWVlNLlYyVSBdID0gYXJndW1lbnQ4OwoJCQltW0AgZV9fWVlNLlYyViBdID0gYXJndW1lbnQ5OwoJCQoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50MSApOwkJLy8geAoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50MiApOwkJLy8geQoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50MyApOwkJLy8gegoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50NCApOwkJLy8gbngKCQkJYnVmZmVyX3dyaXRlKCBiLCBidWZmZXJfZjMyLCBhcmd1bWVudDUgKTsJCS8vIG55CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ2ICk7CQkvLyBuegoJCQlidWZmZXJfd3JpdGUoIGIsIGJ1ZmZlcl91MzIsIGFyZ3VtZW50NyApOwkJLy8gY29sb3VyCgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ4ICk7CQkvLyB1CgkJCWJ1ZmZlcl93cml0ZSggYiwgYnVmZmVyX2YzMiwgYXJndW1lbnQ5ICk7CQkvLyB2CgkJCgkJCWJ1ZmZlcl93cml0ZSggdXZiLCBidWZmZXJfZjMyLCBhcmd1bWVudDggKTsKCQkJYnVmZmVyX3dyaXRlKCB1dmIsIGJ1ZmZlcl9mMzIsIGFyZ3VtZW50OSApOwoJCQkrK2M7CgkJCgkJCWlmIChnbG9iYWxjb2wpCgkJCXsKCQkJCWNvbGFycmF5WyBtW2NvbG51bV1dID0gYnVmZmVyX3RlbGwoYikgLSAxMjsKCQkJCW1bQCBjb2xudW1dKys7CgkJCX0JCgkJCWJyZWFrOwoJCX0gCgkJbVtAIGVfX1lZTS5OdW1WZXJ0cyBdID0gYzsKCQltW0AgY29sYXJyYXlpXSA9IGNvbGFycmF5OwkvLyB0aGlzIGlzIHByb2JhYmx5IHN1cGVyLWJhZCAtIG1heSBzd2l0Y2ggb3ZlciB0byB1c2luZyBidWZmZXJzIGZvciB0aGUgY29sb3VyIG9mZnNldCB0YWJsZXMgcmF0aGVyIHRoYW4gYXJyYXlzIHRvIGF2b2lkIGNvcGllcwp9CgpmdW5jdGlvbiBfX2luaXRfZDNkKCkKewoJZ21sX3ByYWdtYSggImdsb2JhbCIsICJfX2luaXRfZDNkKCk7Iik7CgkvLyBzZXR1cCB0aGUgZGVwdGggdmFyaWFibGUgdG8gYSBzZW5zaWJsZSBkZWZhdWx0CglnbG9iYWwuX19kM2Q9ZmFsc2U7CglnbG9iYWwuX19kM2REZXB0aD0wOwoJZ2xvYmFsLl9fZDNkQ2FtZXJhPWNhbWVyYV9jcmVhdGUoKTsKCWdsb2JhbC5fX2QzZFByaW1LaW5kID0gLTE7CglnbG9iYWwuX19kM2RQcmltVGV4ID0gLTE7CglnbG9iYWwuX19kM2RQcmltQnVmZmVyPXZlcnRleF9jcmVhdGVfYnVmZmVyKCk7Cgl2ZXJ0ZXhfZm9ybWF0X2JlZ2luKCk7CgkJdmVydGV4X2Zvcm1hdF9hZGRfcG9zaXRpb25fM2QoKTsKCQl2ZXJ0ZXhfZm9ybWF0X2FkZF9ub3JtYWwoKTsKCQl2ZXJ0ZXhfZm9ybWF0X2FkZF9jb2xvdXIoKTsKCQl2ZXJ0ZXhfZm9ybWF0X2FkZF90ZXhjb29yZCgpOyAKCWdsb2JhbC5fX2QzZFByaW1WRj12ZXJ0ZXhfZm9ybWF0X2VuZCgpOwoJZ2xvYmFsLl9fZDNkRGVwcmVjYXRlZE1lc3NhZ2UgPSBbIGZhbHNlIF07CgkKCWVudW0gZV9fWVlNCgl7CgkJUG9pbnRCLAoJCUxpbmVCLAoJCVRyaUIsCgkJUG9pbnRVVkIsCgkJTGluZVVWQiwKCQlUcmlVVkIsCgkJUG9pbnRWQiwKCQlMaW5lVkIsCgkJVHJpVkIsCgkJVGV4dHVyZSwKCQlDb2xvdXIsCgkJTnVtVmVydHMsCgkJUHJpbUtpbmQsCgkJTnVtUG9pbnRDb2xzLAoJCU51bUxpbmVDb2xzLAoJCU51bVRyaUNvbHMsCgkJUG9pbnRDb2xzLAoJCUxpbmVDb2xzLAoJCVRyaUNvbHMsCgkKCQkvLyB0aGVzZSBhcmUgdXNlZCB3aGVuIGJ1aWxkaW5nIG1vZGVsIHByaW1pdGl2ZXMKCQlWMVgsCgkJVjFZLAoJCVYxWiwKCQlWMU5YLAoJCVYxTlksCgkJVjFOWiwKCQlWMUMsCgkJVjFVLAoJCVYxViwKCQoJCVYyWCwKCQlWMlksCgkJVjJaLAoJCVYyTlgsCgkJVjJOWSwKCQlWMk5aLAoJCVYyQywKCQlWMlUsCgkJVjJWLAoJfTsKCQoJZW51bSBlX19ZWU1LSU5ECgl7CgkJUFJJTUlUSVZFX0JFR0lOLAoJCVBSSU1JVElWRV9FTkQsCgkJVkVSVEVYLAoJCVZFUlRFWF9DT0xPUiwKCQlWRVJURVhfVEVYLAoJCVZFUlRFWF9URVhfQ09MT1IsCgkJVkVSVEVYX04sCgkJVkVSVEVYX05fQ09MT1IsCgkJVkVSVEVYX05fVEVYLAoJCVZFUlRFWF9OX1RFWF9DT0xPUiwKCQlTSEFQRV9CTE9DSywKCQlTSEFQRV9DWUxJTkRFUiwKCQlTSEFQRV9DT05FLAoJCVNIQVBFX0VMTElQU09JRCwKCQlTSEFQRV9XQUxMLAoJCVNIQVBFX0ZMT09SLAoJfTsKCn0KCiNlbmRyZWdpb24KI3JlZ2lvbiBiYWNrZ3JvdW5kCgpmdW5jdGlvbiBiYWNrZ3JvdW5kX2FkZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gQWRkcyBhbiBpbWFnZSBmcm9tIGEgZmlsZSB0byB0aGUgc2V0IG9mIGJhY2tncm91bmQgcmVzb3VyY2VzLgoJLy8vIEBwYXJhbSBmbmFtZSBUaGUgbmFtZSAoc3RyaW5nKSBvZiB0aGUgZmlsZSB0byBhZGQuCgkvLy8gQHBhcmFtIHJlbW92ZWJhY2sgSW5kaWNhdGVzIHdoZXRoZXIgdG8gbWFrZSBhbGwgcGl4ZWxzIHdpdGggdGhlIHNlbGVjdGVkIGNvbG91ciAobGVmdC1ib3R0b20gcGl4ZWwpIHRyYW5zcGFyZW50LgoJLy8vIEBwYXJhbSBzbW9vdGggSW5kaWNhdGVzIHdoZXRoZXIgdG8gc21vb3RoIHRoZSBlZGdlcyBpZiB0cmFuc3BhcmVudC4KCS8vLyBAcmV0dXJucyB7bnVtYmVyfSByZXNvdXJjZSBuYW1lIGZvciB0aGUgbmV3IGJhY2tncm91bmQKCQoJcmV0dXJuIHNwcml0ZV9hZGQoYXJndW1lbnQwLCAwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgMCwgMCk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfYWRkX2FscGhhKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBBZGRzIGFuIGltYWdlICh3aXRoIGFscGhhKSBmcm9tIGEgZmlsZSB0byB0aGUgc2V0IG9mIGJhY2tncm91bmQgcmVzb3VyY2VzLgoJLy8vIEBwYXJhbSBmbmFtZSBUaGUgbmFtZSAoc3RyaW5nKSBvZiB0aGUgZmlsZSB0byBhZGQuCgkvLy8gQHJldHVybnMge251bWJlcn0gcmVzb3VyY2UgbmFtZSBmb3IgdGhlIG5ldyBiYWNrZ3JvdW5kCgl2YXIgX19kdW1teSA9IGFyZ3VtZW50MTsKCXJldHVybiBzcHJpdGVfYWRkKGFyZ3VtZW50MCwgMCwgZmFsc2UsIGZhbHNlLCAwLCAwKTsKCn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfYXNzaWduKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBBc3NpZ25zIG9uZSBiYWNrZ3JvdW5kIHRvIGFub3RoZXIgYmFja2dyb3VuZCBpbmRleC4KCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIGJlIGNvcGllZCB0byAoaWU6IG92ZXItd3JpdHRlbikuCgkvLy8gQHBhcmFtIGJhY2tncm91bmQgVGhlIGJhY2tncm91bmQgdG8gYmUgY29waWVkIGZyb20uCgkvLy8gQHJldHVybnMKCQoJc3ByaXRlX2Fzc2lnbihhcmd1bWVudDAsIGFyZ3VtZW50MSk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfY3JlYXRlX2NvbG9yKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBDcmVhdGVzIGEgbmV3IGJhY2tncm91bmQgb2YgYSBnaXZlbiBzaXplIGFuZCBjb2xvdXIuCgkvLy8gQHBhcmFtIHcgVGhlIHdpZHRoIG9mIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSBoIFRoZSBoZWlnaHQgb2YgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIGNvbCBUaGUgY29sb3VyIHRvIGNsZWFyIHRoZSBiYWNrZ3JvdW5kIHRvLgoJLy8vIEByZXR1cm5zIHtudW1iZXJ9IHJlc291cmNlIG5hbWUgZm9yIHRoZSBuZXcgYmFja2dyb3VuZAoJCgkvLyBGaXJzdC1wYXNzIGltcGxlbWVudGF0aW9uIC0gbWF5IG5lZWQgdG8gYWRkIGVuZ2luZSBzdXBwb3J0IGlmIHRoaXMgY2F1c2VzIHByb2JsZW1zCgl2YXIgX193ID0gYXJndW1lbnQwOwoJdmFyIF9faCA9IGFyZ3VtZW50MTsKCXZhciBfX2NvbCA9IGFyZ3VtZW50MjsKCQoJdmFyIF9fQ29tcFRlbXBTdXJmID0gc3VyZmFjZV9jcmVhdGUoX193LCBfX2gpOwoJaWYgKHN1cmZhY2VfZXhpc3RzKF9fQ29tcFRlbXBTdXJmKSkKCXsKCQlzdXJmYWNlX3NldF90YXJnZXQoX19Db21wVGVtcFN1cmYpOwoJCWRyYXdfY2xlYXIoX19jb2wpOwoJCXN1cmZhY2VfcmVzZXRfdGFyZ2V0KCk7CgkJCgkJdmFyIF9fc3ByaWQgPSBzcHJpdGVfY3JlYXRlX2Zyb21fc3VyZmFjZShfX0NvbXBUZW1wU3VyZiwgMCwgMCwgX193LCBfX2gsIGZhbHNlLCBmYWxzZSwgMCwgMCk7CgkJc3VyZmFjZV9mcmVlKF9fQ29tcFRlbXBTdXJmKTsKCQlyZXR1cm4gX19zcHJpZDsKCX0KCWVsc2UKCXsKCQlyZXR1cm4gLTE7Cgl9Cgp9CgpmdW5jdGlvbiBiYWNrZ3JvdW5kX2NyZWF0ZV9jb2xvdXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIENyZWF0ZXMgYSBuZXcgYmFja2dyb3VuZCBvZiBhIGdpdmVuIHNpemUgYW5kIGNvbG91ci4KCS8vLyBAcGFyYW0gdyBUaGUgd2lkdGggb2YgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIGggVGhlIGhlaWdodCBvZiB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0gY29sIFRoZSBjb2xvdXIgdG8gY2xlYXIgdGhlIGJhY2tncm91bmQgdG8uCgkvLy8gQHJldHVybnMge251bWJlcn0gcmVzb3VyY2UgbmFtZSBmb3IgdGhlIG5ldyBiYWNrZ3JvdW5kCgkKCS8vIEZpcnN0LXBhc3MgaW1wbGVtZW50YXRpb24gLSBtYXkgbmVlZCB0byBhZGQgZW5naW5lIHN1cHBvcnQgaWYgdGhpcyBjYXVzZXMgcHJvYmxlbXMKCXZhciBfX3cgPSBhcmd1bWVudDA7Cgl2YXIgX19oID0gYXJndW1lbnQxOwoJdmFyIF9fY29sID0gYXJndW1lbnQyOwoJCgl2YXIgX19Db21wVGVtcFN1cmYgPSBzdXJmYWNlX2NyZWF0ZShfX3csIF9faCk7CglpZiAoc3VyZmFjZV9leGlzdHMoX19Db21wVGVtcFN1cmYpKQoJewoJCXN1cmZhY2Vfc2V0X3RhcmdldChfX0NvbXBUZW1wU3VyZik7CgkJZHJhd19jbGVhcihfX2NvbCk7CgkJc3VyZmFjZV9yZXNldF90YXJnZXQoKTsKCQkKCQl2YXIgX19zcHJpZCA9IHNwcml0ZV9jcmVhdGVfZnJvbV9zdXJmYWNlKF9fQ29tcFRlbXBTdXJmLCAwLCAwLCBfX3csIF9faCwgZmFsc2UsIGZhbHNlLCAwLCAwKTsKCQlzdXJmYWNlX2ZyZWUoX19Db21wVGVtcFN1cmYpOwoJCXJldHVybiBfX3NwcmlkOwoJfQoJZWxzZQoJewoJCXJldHVybiAtMTsKCX0KCn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfY3JlYXRlX2Zyb21fc3VyZmFjZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gQ3JlYXRlcyBhIGJhY2tncm91bmQgYnkgY29weWluZyBhbiBhcmVhIGZyb20gYSBzdXJmYWNlLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIHN1cmZhY2UgdG8gY3JlYXRlIGZyb20uCgkvLy8gQHBhcmFtIHggVGhlIHggcG9zaXRpb24gdG8gY29weSBmcm9tLgoJLy8vIEBwYXJhbSB5IFRoZSB5IHBvc2l0aW9uIHRvIGNvcHkgZnJvbS4KCS8vLyBAcGFyYW0gdyBUaGUgd2lkdGggb2YgdGhlIGFyZWEgdG8gYmUgY29waWVkIChmcm9tIHRoZSB4IHBvc2l0aW9uKS4KCS8vLyBAcGFyYW0gaCBUaGUgaGVpZ2h0IG9mIHRoZSBhcmVhIHRvIGJlIGNvcGllZCAoZnJvbSB0aGUgeSBwb3NpdGlvbikuCgkvLy8gQHBhcmFtIHJlbW92ZWJhY2sgSW5kaWNhdGVzIHdoZXRoZXIgdG8gbWFrZSBhbGwgcGl4ZWxzIHdpdGggdGhlIHNhbWUgY29sb3VyIChsZWZ0LWJvdHRvbSBwaXhlbCkgdHJhbnNwYXJlbnQuCgkvLy8gQHBhcmFtIHNtb290aCBJbmRpY2F0ZXMgd2hldGhlciB0byBzbW9vdGggdGhlIGVkZ2VzLgoJLy8vIEByZXR1cm5zIHtudW1iZXJ9IHJlc291cmNlIG5hbWUgZm9yIHRoZSBuZXcgYmFja2dyb3VuZAoJCglyZXR1cm4gc3ByaXRlX2NyZWF0ZV9mcm9tX3N1cmZhY2UoYXJndW1lbnQwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSwgYXJndW1lbnQ2LCAwLCAwKTsKfQoKZnVuY3Rpb24gYmFja2dyb3VuZF9jcmVhdGVfZ3JhZGllbnQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIENyZWF0ZXMgYSBuZXcgYmFja2dyb3VuZCB3aXRoIGEgY29sb3VyZWQgZ3JhZGllbnQuCgkvLy8gQHBhcmFtIHcgVGhlIHdpZHRoIG9mIHRoZSBuZXcgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0gaCBUaGUgaGVpZ2h0IG9mIHRoZSBuZXcgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0gY29sb3VyMSBUaGUgZmlyc3QgY29sb3VyIG9mIHRoZSBncmFkaWVudC4KCS8vLyBAcGFyYW0gY29sb3VyMiBUaGUgc2Vjb25kIGNvbG91ciBvZiB0aGUgZ3JhZGllbnQuCgkvLy8gQHBhcmFtIGtpbmQgIFRoZSB0eXBlIG9mIGdyYWRpZW50ICgwIC0gNSkuIAoJLy8vIEByZXR1cm5zIHtudW1iZXJ9IHJlc291cmNlIG5hbWUgZm9yIHRoZSBuZXcgYmFja2dyb3VuZAoJCgkvLyBGaXJzdC1wYXNzIGltcGxlbWVudGF0aW9uIC0gbWF5IG5lZWQgdG8gYWRkIGVuZ2luZSBzdXBwb3J0IGlmIHRoaXMgY2F1c2VzIHByb2JsZW1zCgl2YXIgX193ID0gYXJndW1lbnQwOwoJdmFyIF9faCA9IGFyZ3VtZW50MTsKCXZhciBfX2NvbDEgPSBhcmd1bWVudDI7Cgl2YXIgX19jb2wyID0gYXJndW1lbnQzOwoJdmFyIF9fa2luZCA9IGFyZ3VtZW50NDsKCQoJdmFyIF9faGFsZncgPSBfX3cgLyAyOwoJdmFyIF9faGFsZmggPSBfX2ggLyAyOwoJCgl2YXIgX19Db21wVGVtcFN1cmYgPSBzdXJmYWNlX2NyZWF0ZShfX3csIF9faCk7CglpZiAoc3VyZmFjZV9leGlzdHMoX19Db21wVGVtcFN1cmYpKQoJewoJCXN1cmZhY2Vfc2V0X3RhcmdldChfX0NvbXBUZW1wU3VyZik7CgkJCgkJc3dpdGNoKF9fa2luZCkKCQl7CgkJCWNhc2UgMDoKCQkJewoJCQkJLy8gSG9yaXpvbnRhbCBncmFkaWVudAoJCQkJZHJhd19yZWN0YW5nbGVfY29sb3VyKDAsIDAsIF9fdywgX19oLCBfX2NvbDEsIF9fY29sMiwgX19jb2wyLCBfX2NvbDEsIGZhbHNlKTsKCQkJfSBicmVhazsKCQkJCgkJCWNhc2UgMToKCQkJewoJCQkJLy8gVmVydGljYWwgZ3JhZGllbnQKCQkJCWRyYXdfcmVjdGFuZ2xlX2NvbG91cigwLCAwLCBfX3csIF9faCwgX19jb2wyLCBfX2NvbDIsIF9fY29sMSwgX19jb2wxLCBmYWxzZSk7CgkJCX0gYnJlYWs7CgkJCQoJCQljYXNlIDI6CgkJCXsKCQkJCS8vIFJlY3Rhbmd1bGFyIGdyYWRpZW50CQkJCgkJCQkvLyBDYW4ndCBqdXN0IHVzZSBmb3VyIHJlY3RhbmdsZXMgZHVlIHRvIHRyaWFuZ3VsYXRpb24gYXJ0aWZhY3RzCgkJCQkvLyBBbHNvIGNhbid0IHVzZSBhIHRyaWFuZ2xlIGZhbiBiZWNhdXNlIHRoZXkgYXJlbid0IHN1cHBvcnRlZCBvbiBhbGwgcGxhdGZvcm1zCQkJCgkJCQlkcmF3X3ByaW1pdGl2ZV9iZWdpbihwcl90cmlhbmdsZWxpc3QpOwoJCQkJCgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoX19oYWxmdywgX19oYWxmaCwgX19jb2wxLCAxKTsKCQkJCWRyYXdfdmVydGV4X2NvbG91cigwLCBfX2hhbGZoLCBfX2NvbDIsIDEpOwoJCQkJZHJhd192ZXJ0ZXhfY29sb3VyKDAsIDAsIF9fY29sMiwgMSk7CgkJCQkKCQkJCWRyYXdfdmVydGV4X2NvbG91cihfX2hhbGZ3LCBfX2hhbGZoLCBfX2NvbDEsIDEpOwoJCQkJZHJhd192ZXJ0ZXhfY29sb3VyKDAsIDAsIF9fY29sMiwgMSk7CgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoX19oYWxmdywgMCwgX19jb2wyLCAxKTsKCQkJCQoJCQkJZHJhd192ZXJ0ZXhfY29sb3VyKF9faGFsZncsIF9faGFsZmgsIF9fY29sMSwgMSk7CgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoX19oYWxmdywgMCwgX19jb2wyLCAxKTsKCQkJCWRyYXdfdmVydGV4X2NvbG91cihfX3csIDAsIF9fY29sMiwgMSk7CgkJCQkKCQkJCWRyYXdfdmVydGV4X2NvbG91cihfX2hhbGZ3LCBfX2hhbGZoLCBfX2NvbDEsIDEpOwoJCQkJZHJhd192ZXJ0ZXhfY29sb3VyKF9fdywgMCwgX19jb2wyLCAxKTsKCQkJCWRyYXdfdmVydGV4X2NvbG91cihfX3csIF9faGFsZmgsIF9fY29sMiwgMSk7CgkJCQkKCQkJCWRyYXdfdmVydGV4X2NvbG91cihfX2hhbGZ3LCBfX2hhbGZoLCBfX2NvbDEsIDEpOwoJCQkJZHJhd192ZXJ0ZXhfY29sb3VyKF9fdywgX19oYWxmaCwgX19jb2wyLCAxKTsKCQkJCWRyYXdfdmVydGV4X2NvbG91cihfX3csIF9faCwgX19jb2wyLCAxKTsKCQkJCQoJCQkJZHJhd192ZXJ0ZXhfY29sb3VyKF9faGFsZncsIF9faGFsZmgsIF9fY29sMSwgMSk7CgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoX193LCBfX2gsIF9fY29sMiwgMSk7CgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoX19oYWxmdywgX19oLCBfX2NvbDIsIDEpOwoJCQkJCgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoX19oYWxmdywgX19oYWxmaCwgX19jb2wxLCAxKTsKCQkJCWRyYXdfdmVydGV4X2NvbG91cihfX2hhbGZ3LCBfX2gsIF9fY29sMiwgMSk7CgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoMCwgX19oLCBfX2NvbDIsIDEpOwoJCQkJCgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoX19oYWxmdywgX19oYWxmaCwgX19jb2wxLCAxKTsKCQkJCWRyYXdfdmVydGV4X2NvbG91cigwLCBfX2gsIF9fY29sMiwgMSk7CgkJCQlkcmF3X3ZlcnRleF9jb2xvdXIoMCwgX19oYWxmaCwgX19jb2wyLCAxKTsKCQkJCQoJCQkJZHJhd19wcmltaXRpdmVfZW5kKCk7CgkJCX0gYnJlYWs7CgkJCQoJCQljYXNlIDM6CgkJCXsKCQkJCS8vIEVsbGlwdGljYWwgZ3JhZGllbnQKCQkJCWRyYXdfY2xlYXIoX19jb2wyKTsJCQkKCQkJCWRyYXdfZWxsaXBzZV9jb2xvdXIoMCwgMCwgX193LCBfX2gsIF9fY29sMSwgX19jb2wyLCBmYWxzZSk7CgkJCX0gYnJlYWs7CgkJCQoJCQljYXNlIDQ6CgkJCXsKCQkJCS8vIFN5bW1ldHJpY2FsIGhvcml6b250YWwgZ3JhZGllbnQKCQkJCWRyYXdfcmVjdGFuZ2xlX2NvbG91cigwLCAwLCBfX2hhbGZ3LCBfX2gsIF9fY29sMiwgX19jb2wxLCBfX2NvbDEsIF9fY29sMiwgZmFsc2UpOwoJCQkJZHJhd19yZWN0YW5nbGVfY29sb3VyKF9faGFsZncsIDAsIF9fdywgX19oLCBfX2NvbDEsIF9fY29sMiwgX19jb2wyLCBfX2NvbDEsIGZhbHNlKTsKCQkJfSBicmVhazsKCQkJCgkJCWNhc2UgNToKCQkJewoJCQkJLy8gU3ltbWV0cmljYWwgdmVydGljYWwgZ3JhZGllbnQKCQkJCWRyYXdfcmVjdGFuZ2xlX2NvbG91cigwLCAwLCBfX3csIF9faGFsZmgsIF9fY29sMiwgX19jb2wyLCBfX2NvbDEsIF9fY29sMSwgZmFsc2UpOwoJCQkJZHJhd19yZWN0YW5nbGVfY29sb3VyKDAsIF9faGFsZmgsIF9fdywgX19oLCBfX2NvbDEsIF9fY29sMSwgX19jb2wyLCBfX2NvbDIsIGZhbHNlKTsKCQkJfSBicmVhazsKCQl9CgkJCgkJc3VyZmFjZV9yZXNldF90YXJnZXQoKTsKCQkKCQl2YXIgX19zcHJpZCA9IHNwcml0ZV9jcmVhdGVfZnJvbV9zdXJmYWNlKF9fQ29tcFRlbXBTdXJmLCAwLCAwLCBfX3csIF9faCwgZmFsc2UsIGZhbHNlLCAwLCAwKTsKCQlzdXJmYWNlX2ZyZWUoX19Db21wVGVtcFN1cmYpOwoJCXJldHVybiBfX3NwcmlkOwoJfQoJZWxzZQoJewoJCXJldHVybiAtMTsKCX0KCn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfZGVsZXRlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEZWxldGVzIHRoZSBiYWNrZ3JvdW5kIGZyb20gbWVtb3J5LCBmcmVlaW5nIHRoZSBtZW1vcnkgdXNlZC4KCS8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIGJlIGRlbGV0ZWQuCgkvLy8gQHJldHVybnMgCgkKCXNwcml0ZV9kZWxldGUoYXJndW1lbnQwKTsKfQoKZnVuY3Rpb24gYmFja2dyb3VuZF9kdXBsaWNhdGUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIENyZWF0ZXMgYSBkdXBsaWNhdGUgb2YgdGhlIGJhY2tncm91bmQgd2l0aCB0aGUgZ2l2ZW4gaW5kZXguCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCB0byBkdXBsaWNhdGUuCgkvLy8gQHJldHVybnMge251bWJlcn0gcmVzb3VyY2UgbmFtZSBmb3IgdGhlIG5ldyBiYWNrZ3JvdW5kCgkKCXJldHVybiBzcHJpdGVfZHVwbGljYXRlKGFyZ3VtZW50MCk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfZXhpc3RzKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEZXRlcm1pbmVzIHdoZXRoZXIgYSBiYWNrZ3JvdW5kIGV4aXN0cyBvciBub3QuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCB0byBjaGVjay4KCS8vLyBAcmV0dXJucyB7Ym9vbGVhbn0gd2hldGhlciB0aGUgYmFja2dyb3VuZCBleGlzdHMgb3Igbm90CgkKCXJldHVybiBzcHJpdGVfZXhpc3RzKGFyZ3VtZW50MCk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfZ2V0X2hlaWdodCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRmluZHMgdGhlIGhlaWdodCBvZiBhIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCB0byBmaW5kIHRoZSBoZWlnaHQgb2YuCgkvLy8gQHJldHVybnMge251bWJlcn0gdGhlIGhlaWdodCBvZiB0aGUgYmFja2dyb3VuZAoJCglyZXR1cm4gc3ByaXRlX2dldF9oZWlnaHQoYXJndW1lbnQwKTsKfQoKZnVuY3Rpb24gYmFja2dyb3VuZF9nZXRfbmFtZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gR2V0cyB0aGUgbmFtZSBvZiBhIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBiYWNrZ3JvdW5kIGltYWdlIGFzc2V0IHRvIGdldCB0aGUgbmFtZSBvZi4KCS8vLyBAcmV0dXJucyB7c3RyaW5nfSB0aGUgbmFtZSBvZiB0aGUgYmFja2dyb3VuZAoJCglyZXR1cm4gc3ByaXRlX2dldF9uYW1lKGFyZ3VtZW50MCk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfZ2V0X3ByZWxvYWQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIEdldHMgd2hldGhlciBhIGJhY2tncm91bmQgaXMgcHJlbG9hZGVkCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBiYWNrZ3JvdW5kIGltYWdlIGFzc2V0LgoJLy8vIEByZXR1cm5zIHtib29sZWFufSB0aGUgcHJlbG9hZCBzdGF0dXMKCQoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBiYWNrZ3JvdW5kX2dldF9zbW9vdGgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIEdldHMgd2hldGhlciBhIGJhY2tncm91bmQgaXMgc21vb3RoCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBiYWNrZ3JvdW5kIGltYWdlIGFzc2V0LgoJLy8vIEByZXR1cm5zIHtib29sZWFufSB3aGV0aGVyIHRoZSBiYWNrZ3JvdW5kIGlzIHNtb290aAoJCglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfZ2V0X3RleHR1cmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHRleHR1cmUgaWQgZm9yIHRoZSBnaXZlbiBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSBiYWNrIFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCB0byB1c2UuCgkvLy8gQHJldHVybnMge3BvaW50ZXJ9IGEgcG9pbnRlciB0byB0aGUgYmFja2dyb3VuZCB0ZXh0dXJlCgkKCXJldHVybiBzcHJpdGVfZ2V0X3RleHR1cmUoYXJndW1lbnQwLCAwKTsKfQoKZnVuY3Rpb24gYmFja2dyb3VuZF9nZXRfdHJhbnNwYXJlbnQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIEdldHMgd2hldGhlciBhIGJhY2tncm91bmQgaXMgdHJhbnNwYXJlbnQKCS8vLyBAcGFyYW0gaW5kZXggVGhlIGJhY2tncm91bmQgaW1hZ2UgYXNzZXQuCgkvLy8gQHJldHVybnMge2Jvb2xlYW59IHdoZXRoZXIgdGhlIGJhY2tncm91bmQgaXMgdHJhbnNwYXJlbnQKCQoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBiYWNrZ3JvdW5kX2dldF91dnMoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFJldHVybnMgdGhlIHRleHR1cmUgY29vcmRpbmF0ZXMgb2YgdGhlIGJhY2tncm91bmQgd2l0aGluIHRoZSB0ZXh0dXJlIHBhZ2UgYXMgYW4gYXJyYXkuCgkvLy8gQHBhcmFtIGJhY2sgVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIHVzZS4KCS8vLyBAcmV0dXJucyB7YXJyYXl9IGFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIHV2IGNvb3JkaW5hdGVzIG9mIHRoZSBiYWNrZ3JvdW5kIG9uIHRoZSB0ZXh0dXJlIHBhZ2UKCQoJcmV0dXJuIHNwcml0ZV9nZXRfdXZzKGFyZ3VtZW50MCwgMCk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfZ2V0X3dpZHRoKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBGaW5kcyB0aGUgd2lkdGggb2YgYSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgdGhlIGJhY2tncm91bmQgdG8gZmluZCB0aGUgd2lkdGggb2YuCgkvLy8gQHJldHVybnMge251bWJlcn0gdGhlIHdpZHRoIG9mIHRoZSBiYWNrZ3JvdW5kCgkKCXJldHVybiBzcHJpdGVfZ2V0X3dpZHRoKGFyZ3VtZW50MCk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfbmFtZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gR2V0cyB0aGUgbmFtZSBvZiBhIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIGluZGV4IFRoZSBiYWNrZ3JvdW5kIGltYWdlIGFzc2V0IHRvIGdldCB0aGUgbmFtZSBvZi4KCS8vLyBAcmV0dXJucyB7c3RyaW5nfSB0aGUgbmFtZSBvZiB0aGUgYmFja2dyb3VuZAoJCglyZXR1cm4gc3ByaXRlX2dldF9uYW1lKGFyZ3VtZW50MCk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfcHJlZmV0Y2goKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFByZWZldGNoZXMgdGhlIHNwZWNpZmllZCBiYWNrZ3JvdW5kCgkvLy8gQHBhcmFtIGJhY2sgVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIHByZWZldGNoLgoJLy8vIEByZXR1cm5zIAoJCglzcHJpdGVfcHJlZmV0Y2goYXJndW1lbnQwKTsKfQoKZnVuY3Rpb24gYmFja2dyb3VuZF9wcmVmZXRjaF9tdWx0aSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUHJlZmV0Y2hlcyB0aGUgc3BlY2lmaWVkIGJhY2tncm91bmRzCgkvLy8gQHBhcmFtIGJhY2tfYXJyYXkgQW4gYXJyYXkgb2YgYmFja2dyb3VuZHMgdG8gcHJlZmV0Y2gKCS8vLyBAcmV0dXJucyAKCQoJc3ByaXRlX3ByZWZldGNoX211bHRpKGFyZ3VtZW50MCk7Cn0KCmZ1bmN0aW9uIGJhY2tncm91bmRfcmVwbGFjZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gUmVwbGFjZSBhIGJhY2tncm91bmQgcmVzb3VyY2Ugd2l0aCBhbm90aGVyIG9uZS4KCS8vLyBAcGFyYW0gaW5kIFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCB0byBwZXJtYW5lbnRseSByZXBsYWNlLgoJLy8vIEBwYXJhbSBmbmFtZSBUaGUgZmlsZW5hbWUgb2YgdGhlIGltYWdlIHRvIG1ha2UgdGhlIG5ldyBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSByZW1vdmViYWNrIEluZGljYXRlcyB3aGV0aGVyIHRvIG1ha2UgYWxsIHBpeGVscyB3aXRoIHRoZSBzYW1lIGNvbG91ciAobGVmdC1ib3R0b20gcGl4ZWwpIHRyYW5zcGFyZW50LgoJLy8vIEBwYXJhbSBzbW9vdGggSW5kaWNhdGVzIHdoZXRoZXIgdG8gc21vb3RoIHRoZSBlZGdlcy4KCS8vLyBAcmV0dXJucyAKCQoJc3ByaXRlX3JlcGxhY2UoYXJndW1lbnQwLCBhcmd1bWVudDEsIDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCAwLCAwKTsKfQoKZnVuY3Rpb24gYmFja2dyb3VuZF9yZXBsYWNlX2FscGhhKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBSZXBsYWNlIGEgYmFja2dyb3VuZCByZXNvdXJjZSB3aXRoIGFub3RoZXIgb25lLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIHBlcm1hbmVudGx5IHJlcGxhY2UuCgkvLy8gQHBhcmFtIGZuYW1lIFRoZSBmaWxlbmFtZSBvZiB0aGUgaW1hZ2UgdG8gbWFrZSB0aGUgbmV3IGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHByZWxvYWQgSW5kaWNhdGVzIHdoZXRoZXIgdG8gbWFrZSBhbGwgcGl4ZWxzIHdpdGggdGhlIHNhbWUgY29sb3VyIChsZWZ0LWJvdHRvbSBwaXhlbCkgdHJhbnNwYXJlbnQuCgkvLy8gQHJldHVybnMgCgkKCXNwcml0ZV9yZXBsYWNlKGFyZ3VtZW50MCwgYXJndW1lbnQxLCAxLCBmYWxzZSwgZmFsc2UsIDAsIDApOwp9CgpmdW5jdGlvbiBiYWNrZ3JvdW5kX3NhdmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIFNhdmUgYSBiYWNrZ3JvdW5kIHRvIGRpc2MuCgkvLy8gQHBhcmFtIGJhY2sgVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIHNhdmUuCgkvLy8gQHBhcmFtIGZuYW1lIFRoZSBmaWxlbmFtZSBmb3IgdGhlIHNhdmVkIGJhY2tncm91bmQuCgkvLy8gQHJldHVybnMgCgkKCXNwcml0ZV9zYXZlKGFyZ3VtZW50MCwgMCwgYXJndW1lbnQxKTsKfQoKZnVuY3Rpb24gYmFja2dyb3VuZF9zZXRfYWxwaGFfZnJvbV9iYWNrZ3JvdW5kKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBDaGFuZ2VzIHRoZSBhbHBoYSAodHJhbnNwYXJlbmN5KSBvZiBvbmUgZ2l2ZW4gYmFja2dyb3VuZCBiYXNlZCBvbiB0aGUgaW50ZW5zaXR5L3ZhbHVlIG1hcCBvZiBhbm90aGVyLgoJLy8vIEBwYXJhbSBpbmQgVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIGNoYW5nZSB0aGUgdHJhbnNwYXJlbmN5IG1hcCBvZi4KCS8vLyBAcGFyYW0gYmFjayBUaGUgaW5kZXggb2YgdGhlIGJhY2tncm91bmQgdG8gdGFrZSB0aGUgdHJhbnNwYXJlbmN5IG1hcCBkYXRhIGZyb20uCgkvLy8gQHJldHVybnMgCgkKCXNwcml0ZV9zZXRfYWxwaGFfZnJvbV9zcHJpdGUoYXJndW1lbnQwLCBhcmd1bWVudDEpOwp9CgpmdW5jdGlvbiBkcmF3X2JhY2tncm91bmQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIERyYXcgYSBiYWNrZ3JvdW5kIHdpdGhvdXQgY29sb3VyIGJsZW5kaW5nIG9yIHRyYW5zcGFyZW5jeQoJLy8vIEBwYXJhbSBiYWNrIFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCB0byBkcmF3LgoJLy8vIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2Ygd2hlcmUgdG8gZHJhdyB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHdoZXJlIHRvIGRyYXcgdGhlIGJhY2tncm91bmQuCgkvLy8gQHJldHVybnMgCgkKCWRyYXdfc3ByaXRlKGFyZ3VtZW50MCwgMCwgYXJndW1lbnQxLCBhcmd1bWVudDIpOwp9CgpmdW5jdGlvbiBkcmF3X2JhY2tncm91bmRfZXh0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEcmF3cyBhIGJhY2tncm91bmQgYXQgYSBnaXZlbiBwb3NpdGlvbiwgd2l0aCBjdXN0b21pemFibGUgc2NhbGluZywgcm90YXRpb24sIGJsZW5kIGFuZCBhbHBoYS4KCS8vLyBAcGFyYW0gYmFjayBUaGUgaW5kZXggb2YgdGhlIGJhY2tncm91bmQgdG8gZHJhdy4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHdoZXJlIHRvIGRyYXcgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB3aGVyZSB0byBkcmF3IHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSB4c2NhbGUgVGhlIGhvcml6b250YWwgc2NhbGluZyBvZiB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0geXNjYWxlIFRoZSB2ZXJ0aWNhbCBzY2FsaW5nIG9mIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSByb3QgVGhlIHJvdGF0aW9uIG9mIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSBjb2xvdXIgVGhlIGNvbG91ciB3aXRoIHdoaWNoIHRvIGJsZW5kIHRoZSBiYWNrZ3JvdW5kICh1c2UgLTEgb3IgY193aGl0ZSB0byBkaXNwbGF5IGl0IG5vcm1hbGx5KS4KCS8vLyBAcGFyYW0gYWxwaGEgIFRoZSBhbHBoYSBvZiB0aGUgYmFja2dyb3VuZCAoZnJvbSAwIHRvIDEgd2hlcmUgMCBpcyB0cmFuc3BhcmVudCBhbmQgMSBvcGFxdWUpLiAKCS8vLyBAcmV0dXJucyAKCQoJZHJhd19zcHJpdGVfZXh0KGFyZ3VtZW50MCwgMCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MywgYXJndW1lbnQ0LCBhcmd1bWVudDUsIGFyZ3VtZW50NiwgYXJndW1lbnQ3KTsKfQoKZnVuY3Rpb24gZHJhd19iYWNrZ3JvdW5kX2dlbmVyYWwoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIERyYXdzIHBhcnQgb2YgYSBiYWNrZ3JvdW5kIGF0IGEgZ2l2ZW4gcG9zaXRpb24gd2l0aCBzY2FsaW5nLCByb3RhdGluZywgZm91ci1jb3JuZXIgYmxlbmRpbmcgYW5kIGFscGhhIG9wdGlvbnMuCgkvLy8gQHBhcmFtIGJhY2sgVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIGRyYXcuCgkvLy8gQHBhcmFtIGxlZnQgVGhlIHggcG9zaXRpb24gb24gdGhlIGJhY2tncm91bmQgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgYXJlYSB0byBkcmF3LgoJLy8vIEBwYXJhbSB0b3AgIFRoZSB5IHBvc2l0aW9uIG9uIHRoZSBiYWNrZ3JvdW5kIG9mIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIGFyZWEgdG8gZHJhdy4KCS8vLyBAcGFyYW0gd2lkdGggIFRoZSB3aWR0aCBvZiB0aGUgYXJlYSB0byBkcmF3LgoJLy8vIEBwYXJhbSBoZWlnaHQgIFRoZSBoZWlnaHQgb2YgdGhlIGFyZWEgdG8gZHJhdy4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHdoZXJlIHRvIGRyYXcgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB3aGVyZSB0byBkcmF3IHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSB4c2NhbGUgVGhlIGhvcml6b250YWwgc2NhbGluZyBvZiB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0geXNjYWxlIFRoZSB2ZXJ0aWNhbCBzY2FsaW5nIG9mIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSByb3QgVGhlIHJvdGF0aW9uIG9mIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSBjMSBUaGUgY29sb3VyIHdpdGggd2hpY2ggdG8gYmxlbmQgdGhlIHRvcCBsZWZ0IGFyZWEgb2YgdGhlIGJhY2tncm91bmQuIAoJLy8vIEBwYXJhbSBjMiBUaGUgY29sb3VyIHdpdGggd2hpY2ggdG8gYmxlbmQgdGhlIHRvcCByaWdodCBhcmVhIG9mIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSBjMyBUaGUgY29sb3VyIHdpdGggd2hpY2ggdG8gYmxlbmQgdGhlIGJvdHRvbSByaWdodCBhcmVhIG9mIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSBjNCAgVGhlIGNvbG91ciB3aXRoIHdoaWNoIHRvIGJsZW5kIHRoZSBib3R0b20gbGVmdCBhcmVhIG9mIHRoZSBiYWNrZ3JvdW5kLiAKCS8vLyBAcGFyYW0gYWxwaGEgIFRoZSBhbHBoYSBvZiB0aGUgYmFja2dyb3VuZCAoZnJvbSAwIHRvIDEgd2hlcmUgMCBpcyB0cmFuc3BhcmVudCBhbmQgMSBvcGFxdWUpLiAKCS8vLyBAcmV0dXJucyAKCQoJZHJhd19zcHJpdGVfZ2VuZXJhbChhcmd1bWVudDAsIDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1LCBhcmd1bWVudDYsIGFyZ3VtZW50NywgYXJndW1lbnQ4LCBhcmd1bWVudDksIGFyZ3VtZW50MTAsIGFyZ3VtZW50MTEsIGFyZ3VtZW50MTIsIGFyZ3VtZW50MTMsIGFyZ3VtZW50MTQpOwp9CgpmdW5jdGlvbiBkcmF3X2JhY2tncm91bmRfcGFydCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRHJhd3MgcGFydCBvZiBhIGJhY2tncm91bmQgYXQgYSBnaXZlbiBwb3NpdGlvbi4KCS8vLyBAcGFyYW0gYmFjayBUaGUgaW5kZXggb2YgdGhlIGJhY2tncm91bmQgdG8gZHJhdy4KCS8vLyBAcGFyYW0gbGVmdCBUaGUgeCBwb3NpdGlvbiBvbiB0aGUgYmFja2dyb3VuZCBvZiB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSBhcmVhIHRvIGRyYXcuCgkvLy8gQHBhcmFtIHRvcCAgVGhlIHkgcG9zaXRpb24gb24gdGhlIGJhY2tncm91bmQgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgYXJlYSB0byBkcmF3LgoJLy8vIEBwYXJhbSB3aWR0aCAgVGhlIHdpZHRoIG9mIHRoZSBhcmVhIHRvIGRyYXcuCgkvLy8gQHBhcmFtIGhlaWdodCAgVGhlIGhlaWdodCBvZiB0aGUgYXJlYSB0byBkcmF3LgoJLy8vIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2Ygd2hlcmUgdG8gZHJhdyB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHdoZXJlIHRvIGRyYXcgdGhlIGJhY2tncm91bmQuCgkvLy8gQHJldHVybnMgCgkKCWRyYXdfc3ByaXRlX3BhcnQoYXJndW1lbnQwLCAwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSwgYXJndW1lbnQ2KTsKfQoKZnVuY3Rpb24gZHJhd19iYWNrZ3JvdW5kX3BhcnRfZXh0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBEcmF3cyBwYXJ0IG9mIGEgYmFja2dyb3VuZCBhdCBhIGdpdmVuIHBvc2l0aW9uIHdpdGggc2NhbGluZywgYmxlbmRpbmcgYW5kIGFscGhhIG9wdGlvbnMuCgkvLy8gQHBhcmFtIGJhY2sgVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIGRyYXcuCgkvLy8gQHBhcmFtIGxlZnQgVGhlIHggcG9zaXRpb24gb24gdGhlIGJhY2tncm91bmQgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgYXJlYSB0byBkcmF3LgoJLy8vIEBwYXJhbSB0b3AgIFRoZSB5IHBvc2l0aW9uIG9uIHRoZSBiYWNrZ3JvdW5kIG9mIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIGFyZWEgdG8gZHJhdy4KCS8vLyBAcGFyYW0gd2lkdGggIFRoZSB3aWR0aCBvZiB0aGUgYXJlYSB0byBkcmF3LgoJLy8vIEBwYXJhbSBoZWlnaHQgIFRoZSBoZWlnaHQgb2YgdGhlIGFyZWEgdG8gZHJhdy4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHdoZXJlIHRvIGRyYXcgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB3aGVyZSB0byBkcmF3IHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSB4c2NhbGUgIFRoZSBob3Jpem9udGFsIHNjYWxpbmcgb2YgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHlzY2FsZSAgVGhlIHZlcnRpY2FsIHNjYWxpbmcgb2YgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIGNvbG91ciAgIFRoZSBjb2xvdXIgd2l0aCB3aGljaCB0byBibGVuZCB0aGUgYmFja2dyb3VuZCAodXNlIC0xIG9yIGNfd2hpdGUgdG8gZGlzcGxheSBpdCBub3JtYWxseSkuIAoJLy8vIEBwYXJhbSBhbHBoYSAgVGhlIGFscGhhIG9mIHRoZSBiYWNrZ3JvdW5kIChmcm9tIDAgdG8gMSB3aGVyZSAwIGlzIHRyYW5zcGFyZW50IGFuZCAxIG9wYXF1ZSkuCgkvLy8gQHJldHVybnMgCgkKCWRyYXdfc3ByaXRlX3BhcnRfZXh0KGFyZ3VtZW50MCwgMCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MywgYXJndW1lbnQ0LCBhcmd1bWVudDUsIGFyZ3VtZW50NiwgYXJndW1lbnQ3LCBhcmd1bWVudDgsIGFyZ3VtZW50OSwgYXJndW1lbnQxMCk7Cn0KCmZ1bmN0aW9uIGRyYXdfYmFja2dyb3VuZF9zdHJldGNoZWQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIERyYXdzIGEgYmFja2dyb3VuZCBhdCBhIGdpdmVuIHBvc2l0aW9uLCBzdHJldGNoZWQuCgkvLy8gQHBhcmFtIGJhY2sgVGhlIGluZGV4IG9mIHRoZSBiYWNrZ3JvdW5kIHRvIGRyYXcuCgkvLy8gQHBhcmFtIHggVGhlIHggY29vcmRpbmF0ZSBvZiB3aGVyZSB0byBkcmF3IHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSB5IFRoZSB5IGNvb3JkaW5hdGUgb2Ygd2hlcmUgdG8gZHJhdyB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0gdyBUaGUgd2lkdGggb2YgdGhlIGFyZWEgdGhlIHN0cmV0Y2hlZCBiYWNrZ3JvdW5kIHdpbGwgb2NjdXB5LgoJLy8vIEBwYXJhbSBoIFRoZSBoZWlnaHQgb2YgdGhlIGFyZWEgdGhlIHN0cmV0Y2hlZCBiYWNrZ3JvdW5kIHdpbGwgb2NjdXB5LgoJLy8vIEByZXR1cm5zIAoJCglkcmF3X3Nwcml0ZV9zdHJldGNoZWQoYXJndW1lbnQwLCAwLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgYXJndW1lbnQzLCBhcmd1bWVudDQpOwp9CgpmdW5jdGlvbiBkcmF3X2JhY2tncm91bmRfc3RyZXRjaGVkX2V4dCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRHJhd3MgYSBiYWNrZ3JvdW5kIGF0IGEgZ2l2ZW4gcG9zaXRpb24sIHN0cmV0Y2hlZCwgYW5kIGFsbG93cyBmb3IgYSBjdXN0b20gYmxlbmQgYW5kIGFscGhhLgoJLy8vIEBwYXJhbSBiYWNrIFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCB0byBkcmF3LgoJLy8vIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2Ygd2hlcmUgdG8gZHJhdyB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHdoZXJlIHRvIGRyYXcgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHcgVGhlIHdpZHRoIG9mIHRoZSBhcmVhIHRoZSBzdHJldGNoZWQgYmFja2dyb3VuZCB3aWxsIG9jY3VweS4KCS8vLyBAcGFyYW0gaCBUaGUgaGVpZ2h0IG9mIHRoZSBhcmVhIHRoZSBzdHJldGNoZWQgYmFja2dyb3VuZCB3aWxsIG9jY3VweS4KCS8vLyBAcGFyYW0gY29sb3VyIFRoZSBjb2xvdXIgd2l0aCB3aGljaCB0byBibGVuZCB0aGUgYmFja2dyb3VuZCAodXNlIC0xIG9yIGNfd2hpdGUgdG8gZGlzcGxheSBpdCBub3JtYWxseSkuCgkvLy8gQHBhcmFtIGFscGhhIFRoZSBhbHBoYSBvZiB0aGUgYmFja2dyb3VuZCAoZnJvbSAwIHRvIDEgd2hlcmUgMCBpcyB0cmFuc3BhcmVudCBhbmQgMSBvcGFxdWUpLgoJLy8vIEByZXR1cm5zIAoJCglkcmF3X3Nwcml0ZV9zdHJldGNoZWRfZXh0KGFyZ3VtZW50MCwgMCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MywgYXJndW1lbnQ0LCBhcmd1bWVudDUsIGFyZ3VtZW50Nik7Cn0KCmZ1bmN0aW9uIGRyYXdfYmFja2dyb3VuZF90aWxlZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRHJhd3MgYSBiYWNrZ3JvdW5kIGF0IGEgZ2l2ZW4gcG9zaXRpb24sIGFuZCB0aWxlcyBpdCB0byBmaWxsIHRoZSBlbnRpcmUgdmlldy4KCS8vLyBAcGFyYW0gYmFjayBUaGUgaW5kZXggb2YgdGhlIGJhY2tncm91bmQgdG8gZHJhdy4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHdoZXJlIHRvIGRyYXcgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB3aGVyZSB0byBkcmF3IHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEByZXR1cm5zIAoJCglkcmF3X3Nwcml0ZV90aWxlZChhcmd1bWVudDAsIDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyKTsKfQoKZnVuY3Rpb24gZHJhd19iYWNrZ3JvdW5kX3RpbGVkX2V4dCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gRHJhd3MgYSBiYWNrZ3JvdW5kIGF0IGEgZ2l2ZW4gcG9zaXRpb24gd2l0aCBzY2FsaW5nLCBibGVuZGluZyBhbmQgYWxwaGEsIGFuZCB0aWxlcyBpdCB0byBmaWxsIHRoZSBlbnRpcmUgdmlldy4KCS8vLyBAcGFyYW0gYmFjayBUaGUgaW5kZXggb2YgdGhlIGJhY2tncm91bmQgdG8gZHJhdy4KCS8vLyBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIG9mIHdoZXJlIHRvIGRyYXcgdGhlIGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB3aGVyZSB0byBkcmF3IHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSB4c2NhbGUgVGhlIGhvcml6b250YWwgc2NhbGluZyBvZiB0aGUgYmFja2dyb3VuZC4KCS8vLyBAcGFyYW0geXNjYWxlIFRoZSB2ZXJ0aWNhbCBzY2FsaW5nIG9mIHRoZSBiYWNrZ3JvdW5kLgoJLy8vIEBwYXJhbSBjb2xvdXIgVGhlIGNvbG91ciB3aXRoIHdoaWNoIHRvIGJsZW5kIHRoZSBiYWNrZ3JvdW5kICh1c2UgLTEgb3IgY193aGl0ZSB0byBkaXNwbGF5IGl0IG5vcm1hbGx5KS4KCS8vLyBAcGFyYW0gYWxwaGEgVGhlIGFscGhhIG9mIHRoZSBiYWNrZ3JvdW5kIChmcm9tIDAgdG8gMSB3aGVyZSAwIGlzIHRyYW5zcGFyZW50IGFuZCAxIG9wYXF1ZSkuCgkvLy8gQHJldHVybnMgCgkKCWRyYXdfc3ByaXRlX3RpbGVkX2V4dChhcmd1bWVudDAsIDAsIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgYXJndW1lbnQ1LCBhcmd1bWVudDYpOwp9CgpmdW5jdGlvbiByb29tX3NldF9iYWNrZ3JvdW5kKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBTZXRzIGEgYmFja2dyb3VuZCBhbmQgaXRzIHJlbGF0ZWQgYXR0cmlidXRlcyBvZiBhIGdpdmVuIHJvb20uCgkvLy8gQHBhcmFtIGluZCBUaGUgaW5kZXggb2YgdGhlIHJvb20gdG8gc2V0IHRoZSBiYWNrZ3JvdW5kIG9mLgoJLy8vIEBwYXJhbSBiaW5kIFRoZSBpbmRleCBvZiB0aGUgYmFja2dyb3VuZCAnc2xvdCcgdG8gc2V0IChiZXR3ZWVuIDAgYW5kIDcpLgoJLy8vIEBwYXJhbSB2aXMgV2hldGhlciB0aGUgbmV3IGJhY2tncm91bmQgaXMgdmlzaWJsZSAodHJ1ZSkgb3Igbm90IChmYWxzZSkuCgkvLy8gQHBhcmFtIGZvcmUgV2hldGhlciB0aGUgYmFja2dyb3VuZCBpcyBhY3R1YWxseSBhIGZvcmVncm91bmQgKHRydWUpIG9yIGEgYmFja2dyb3VuZCAoZmFsc2UpLgoJLy8vIEBwYXJhbSBiYWNrIFRoZSBpbmRleCBvZiB0aGUgbmV3IGJhY2tncm91bmQuCgkvLy8gQHBhcmFtIHggVGhlIHggcG9zaXRpb24gb2YgdGhlIGJhY2tncm91bmQgKGlmIGh0aWxlZCBpcyB0cnVlLCB0aGUgeCBvZiBvbmUgb2YgdGhlIGJhY2tncm91bmRzKS4KCS8vLyBAcGFyYW0geSBUaGUgeSBwb3NpdGlvbiBvZiB0aGUgYmFja2dyb3VuZCAoaWYgdnRpbGVkIGlzIHRydWUsIHRoZSB5IG9mIG9uZSBvZiB0aGUgYmFja2dyb3VuZHMpLgoJLy8vIEBwYXJhbSBodGlsZWQgV2hldGhlciB0aGUgYmFja2dyb3VuZCBpcyB0aWxlZCBob3Jpem9udGFsbHkgKHRydWUpIG9yIG5vdCAoZmFsc2UpLgoJLy8vIEBwYXJhbSB2dGlsZWQgV2hldGhlciB0aGUgYmFja2dyb3VuZCBpcyB0aWxlZCB2ZXJ0aWNhbGx5ICh0cnVlKSBvciBub3QgKGZhbHNlKS4KCS8vLyBAcGFyYW0gaHNwZWVkIFRoZSBob3Jpem9udGFsIHNwZWVkIG9mIHRoZSBiYWNrZ3JvdW5kIGluIHBpeGVscyBwZXIgc3RlcC4KCS8vLyBAcGFyYW0gdnNwZWVkIFRoZSB2ZXJ0aWNhbCBzcGVlZCBvZiB0aGUgYmFja2dyb3VuZCBpbiBwaXhlbHMgcGVyIHN0ZXAuCgkvLy8gQHBhcmFtIGFscGhhIFRoZSBhbHBoYSAodHJhbnNwYXJlbmN5KSBvZiB0aGUgYmFja2dyb3VuZC4gMT1vcGFxdWUsIDA9aW52aXNpYmxlLCAwLjU9dHJhbnNsdWNlbnQgZXRjCgkvLy8gQHJldHVybnMgCgkKCS8vIE5PVEU6IHRoaXMgc2NyaXB0IHdpbGwgb25seSB3b3JrIHByb3Blcmx5IGlmIHlvdSdyZSB1c2luZyB0aGUgc3RhbmRhcmQgZGVwdGggcmFuZ2UgKC0xNjAwMCB0byAxNjAwMCkKCQoJdmFyIF9faW5kID0gYXJndW1lbnQwOwoJdmFyIF9fYmluZCA9IGFyZ3VtZW50MTsKCXZhciBfX3ZpcyA9IGFyZ3VtZW50MjsKCXZhciBfX2ZvcmUgPSBhcmd1bWVudDM7Cgl2YXIgX19iYWNrID0gYXJndW1lbnQ0OwoJdmFyIF9feCA9IGFyZ3VtZW50NTsKCXZhciBfX3kgPSBhcmd1bWVudDY7Cgl2YXIgX19odGlsZWQgPSBhcmd1bWVudDc7Cgl2YXIgX192dGlsZWQgPSBhcmd1bWVudDg7Cgl2YXIgX19oc3BlZWQgPSBhcmd1bWVudDk7Cgl2YXIgX192c3BlZWQgPSBhcmd1bWVudDEwOwoJdmFyIF9fYWxwaGEgPSBhcmd1bWVudDExOwoJCgkvLyBGaXJzdCBjaGVjayB0byBzZWUgaWYgdGhlIHRhcmdldCByb29tIGFjdHVhbGx5IGV4aXN0cwoJaWYgKHJvb21fZXhpc3RzKF9faW5kKSA9PSBmYWxzZSkKCXsKCQlyZXR1cm4gLTE7Cgl9CgkKCS8vIFNhdmUgdGhlIGN1cnJlbnQgdGFyZ2V0IHJvb20gYW5kIHN3aXRjaCB0byB0aGUgbmV3IG9uZQoJdmFyIF9fY3VycnJvb20gPSBsYXllcl9nZXRfdGFyZ2V0X3Jvb20oKTsKCWxheWVyX3NldF90YXJnZXRfcm9vbShfX2luZCk7CgkKCV9fYmFja2dyb3VuZF9zZXRfZWxlbWVudChfX2JpbmQsIF9fdmlzLCBfX2ZvcmUsIF9fYmFjaywgX194LCBfX3ksIF9faHRpbGVkLCBfX3Z0aWxlZCwgMSwxLGZhbHNlLCBfX2hzcGVlZCwgX192c3BlZWQsICRmZmZmZmYsIF9fYWxwaGEpOwoJCgkvLyBGaW5hbGx5LCByZXN0b3JlIG91ciBvcmlnaW5hbCByb29tIHRhcmdldAoJbGF5ZXJfc2V0X3RhcmdldF9yb29tKF9fY3VycnJvb20pOwp9CgpmdW5jdGlvbiBfX2JhY2tncm91bmRfZ2V0KCkKewoJdmFyIF9fcHJvcCA9IGFyZ3VtZW50MDsKCXZhciBfX2JpbmQgPSBhcmd1bWVudDE7CgkKCXZhciBfX2JhY2tpbmZvID0gX19iYWNrZ3JvdW5kX2dldF9lbGVtZW50KF9fYmluZCk7CgkKCXJldHVybiBfX2JhY2tncm91bmRfZ2V0X2ludGVybmFsKF9fcHJvcCwgX19iaW5kLCBfX2JhY2tpbmZvKTsKCn0KCmZ1bmN0aW9uIF9fYmFja2dyb3VuZF9nZXRfY29sb3VyKCkKewoJdmFyIF9fY29saW5mbyA9IF9fYmFja2dyb3VuZF9nZXRfY29sb3VyX2VsZW1lbnQoKTsKCQoJaWYgKF9fY29saW5mb1swXSA9PSAtMSkKCQlyZXR1cm4gMDsKCQkKCXZhciBfX2NvbCA9IGxheWVyX2JhY2tncm91bmRfZ2V0X2JsZW5kKF9fY29saW5mb1swXSk7CglyZXR1cm4gX19jb2w7Cn0KCmZ1bmN0aW9uIF9fYmFja2dyb3VuZF9nZXRfY29sb3VyX2VsZW1lbnQoKQp7CgkvLyBOT1RFOiB0aGlzIHNjcmlwdCB3aWxsIG9ubHkgd29yayBwcm9wZXJseSBpZiB5b3UncmUgdXNpbmcgdGhlIHN0YW5kYXJkIGRlcHRoIHJhbmdlICgtMTYwMDAgdG8gMTYwMDApCgl2YXIgX19uZWFyZXN0ZGVwdGggPSAtMTUwMDA7Cgl2YXIgX19mYXJ0aGVzdGRlcHRoID0gMTU5OTk7Cgl2YXIgX19kZXB0aGluYyA9IDEwMDsKCQoJdmFyIF9fcmVzdWx0OwoJX19yZXN1bHRbMF0gPSAtMTsKCV9fcmVzdWx0WzFdID0gLTE7CgkKCQoJLy8gTm93IGxvb2sgYXQgdGhlIGV4aXN0aW5nIGxheWVycyBpbiB0aGUgcm9vbSB0byBzZWUgaWYgd2UgaGF2ZSBhbnkgZm9yZWdyb3VuZHMgb3IgYmFja2dyb3VuZHMKCXZhciBfX2NvbHN0cmluZyA9ICJDb21wYXRpYmlsaXR5X0NvbG91ciI7Cgl2YXIgX19sYXllcmxpc3QgPSBsYXllcl9nZXRfYWxsKCk7Cgl2YXIgX19sYXllcmxpc3RsZW5ndGggPSBhcnJheV9sZW5ndGhfMWQoX19sYXllcmxpc3QpOwoJdmFyIF9faTsKCQoJdmFyIF9fbGF5ZXJpZCA9IC0xOwoJdmFyIF9faXNmb3JlZ3JvdW5kID0gZmFsc2U7CgkKCS8vIFRyeSBhbmQgZmluZCB0aGUgYXBwcm9wcmlhdGUgYmFja2dyb3VuZCBpbiB0aGUgbGlzdCBvZiBsYXllcnMKCWZvcihfX2kgPSAwOyBfX2kgPCBfX2xheWVybGlzdGxlbmd0aDsgX19pKyspCgl7CgkJdmFyIF9fbGF5ZXJuYW1lID0gbGF5ZXJfZ2V0X25hbWUoX19sYXllcmxpc3RbX19pXSk7CQoJCWlmIChzdHJpbmdfcG9zKF9fY29sc3RyaW5nLCBfX2xheWVybmFtZSkgPiAwKQoJCXsKCQkJX19sYXllcmlkID0gX19sYXllcmxpc3RbX19pXTsJCQoJCQkJCgkJCWJyZWFrOwkJCgkJfQkKCX0KCQoJaWYgKF9fbGF5ZXJpZCAhPSAtMSkKCXsKCQkvLyBXZSBoYXZlIGEgd2lubmVyIQoJCS8vIEdldCBpZCBvZiBiYWNrZ3JvdW5kIGVsZW1lbnQgb24gdGhpcyBsYXllcgoJCXZhciBfX2VscyA9IGxheWVyX2dldF9hbGxfZWxlbWVudHMoX19sYXllcmlkKTsKCQl2YXIgX19lbHNsZW5ndGggPSBhcnJheV9sZW5ndGhfMWQoX19lbHMpOwoJCWZvcihfX2kgPSAwOyBfX2kgPCBfX2Vsc2xlbmd0aDsgX19pKyspCgkJewoJCQlpZiAobGF5ZXJfZ2V0X2VsZW1lbnRfdHlwZShfX2Vsc1tfX2ldKSA9PSBsYXllcmVsZW1lbnR0eXBlX2JhY2tncm91bmQpCgkJCXsJCQkJCgkJCQlfX3Jlc3VsdFswXSA9IF9fZWxzW19faV07CgkJCQlfX3Jlc3VsdFsxXSA9IF9fbGF5ZXJpZDsKCQkJfQoJCX0JCQkKCX0KCWVsc2UKCXsKCQkvLyBOZWVkIHRvIGNvbnN0cnVjdCBhIG5ldyBsYXllciB3aXRoIGEgbmV3IGJhY2tncm91bmQKCQl2YXIgX19uZXdiYWNrID0gX19iYWNrZ3JvdW5kX3NldF9lbGVtZW50KC0xLCBmYWxzZSwgZmFsc2UsIC0xLCAwLCAwLCB0cnVlLCB0cnVlLDEsMSwgdHJ1ZSwgMCwgMCwgJDAsIDEpOwoJCV9fcmVzdWx0WzBdID0gX19uZXdiYWNrWzBdOwoJCV9fcmVzdWx0WzFdID0gX19uZXdiYWNrWzFdOwkKCX0KCQoJcmV0dXJuIF9fcmVzdWx0Owp9CgpmdW5jdGlvbiBfX2JhY2tncm91bmRfZ2V0X2VsZW1lbnQoKQp7Cgl2YXIgX19iaW5kID0gYXJndW1lbnQwOwoJCgl2YXIgX19yZXN1bHQ7CglfX3Jlc3VsdFswXSA9IC0xOwoJX19yZXN1bHRbMV0gPSAtMTsKCV9fcmVzdWx0WzJdID0gLTE7CgkKCQoJLy8gTG9vayBhdCB0aGUgZXhpc3RpbmcgbGF5ZXJzIGluIHRoZSByb29tIHRvIHNlZSBpZiB3ZSBoYXZlIGFueSBmb3JlZ3JvdW5kcyBvciBiYWNrZ3JvdW5kcwoJdmFyIF9fZmdzdHJpbmcgPSAiQ29tcGF0aWJpbGl0eV9Gb3JlZ3JvdW5kXyI7Cgl2YXIgX19iZ3N0cmluZyA9ICJDb21wYXRpYmlsaXR5X0JhY2tncm91bmRfIjsKCXZhciBfX2ZnbGVuID0gc3RyaW5nX2xlbmd0aChfX2Znc3RyaW5nKTsKCXZhciBfX2JnbGVuID0gc3RyaW5nX2xlbmd0aChfX2Jnc3RyaW5nKTsKCXZhciBfX2xheWVybGlzdCA9IGxheWVyX2dldF9hbGwoKTsKCXZhciBfX2xheWVybGlzdGxlbmd0aCA9IGFycmF5X2xlbmd0aF8xZChfX2xheWVybGlzdCk7Cgl2YXIgX19pOwoJCgl2YXIgX19sYXllcmlkID0gLTE7Cgl2YXIgX19pc2ZvcmVncm91bmQgPSBmYWxzZTsKCQoJLy8gVHJ5IGFuZCBmaW5kIHRoZSBhcHByb3ByaWF0ZSBiYWNrZ3JvdW5kIGluIHRoZSBsaXN0IG9mIGxheWVycwoJZm9yKF9faSA9IDA7IF9faSA8IF9fbGF5ZXJsaXN0bGVuZ3RoOyBfX2krKykKCXsKCQl2YXIgX19sYXllcm5hbWUgPSBsYXllcl9nZXRfbmFtZShfX2xheWVybGlzdFtfX2ldKTsJCgkJaWYgKHN0cmluZ19wb3MoX19mZ3N0cmluZywgX19sYXllcm5hbWUpID4gMCkKCQl7CgkJCXZhciBfX3Nsb3RjaHIgPSBzdHJpbmdfY2hhcl9hdChfX2xheWVybmFtZSwgX19mZ2xlbiArIDEpOwoJCQlpZiAoX19zbG90Y2hyID09ICIiKQoJCQkJY29udGludWU7CgkJCQkKCQkJdmFyIF9fc2xvdCA9IHJlYWwoIF9fc2xvdGNociApOwoJCQkKCQkJaWYgKF9fc2xvdCA9PSBfX2JpbmQpCgkJCXsKCQkJCV9fbGF5ZXJpZCA9IF9fbGF5ZXJsaXN0W19faV07CgkJCQlfX2lzZm9yZWdyb3VuZCA9IHRydWU7CgkJCQkKCQkJCWJyZWFrOwoJCQl9CQkKCQl9CgkJZWxzZSBpZiAoc3RyaW5nX3BvcyhfX2Jnc3RyaW5nLCBfX2xheWVybmFtZSkgPiAwKQoJCXsKCQkJdmFyIF9fc2xvdGNociA9IHN0cmluZ19jaGFyX2F0KF9fbGF5ZXJuYW1lLCBfX2JnbGVuICsgMSk7CgkJCWlmIChfX3Nsb3RjaHIgPT0gIiIpCgkJCQljb250aW51ZTsKCQkJCQoJCQl2YXIgX19zbG90ID0gcmVhbCggX19zbG90Y2hyICk7CgkJCQoJCQlpZiAoX19zbG90ID09IF9fYmluZCkKCQkJewoJCQkJX19sYXllcmlkID0gX19sYXllcmxpc3RbX19pXTsKCQkJCV9faXNmb3JlZ3JvdW5kID0gZmFsc2U7CgkJCQkKCQkJCWJyZWFrOwoJCQl9CQkKCQl9CQoJfQoJCglpZiAoX19sYXllcmlkICE9IC0xKQoJewoJCS8vIFdlIGhhdmUgYSB3aW5uZXIhCgkJLy8gR2V0IGlkIG9mIGJhY2tncm91bmQgZWxlbWVudCBvbiB0aGlzIGxheWVyCgkJdmFyIF9fZWxzID0gbGF5ZXJfZ2V0X2FsbF9lbGVtZW50cyhfX2xheWVyaWQpOwoJCXZhciBfX2Vsc2xlbmd0aCA9IGFycmF5X2xlbmd0aF8xZChfX2Vscyk7CgkJZm9yKF9faSA9IDA7IF9faSA8IF9fZWxzbGVuZ3RoOyBfX2krKykKCQl7CgkJCWlmIChsYXllcl9nZXRfZWxlbWVudF90eXBlKF9fZWxzW19faV0pID09IGxheWVyZWxlbWVudHR5cGVfYmFja2dyb3VuZCkKCQkJewkJCQkKCQkJCV9fcmVzdWx0WzBdID0gX19lbHNbX19pXTsKCQkJCV9fcmVzdWx0WzFdID0gX19sYXllcmlkOwoJCQkJX19yZXN1bHRbMl0gPSBfX2lzZm9yZWdyb3VuZDsKCQkJfQoJCX0JCQkKCX0KCWVsc2UKCXsKCQkvLyBOZWVkIHRvIGNvbnN0cnVjdCBhIG5ldyBsYXllciB3aXRoIGEgbmV3IGJhY2tncm91bmQKCQl2YXIgX19uZXdiYWNrID0gX19iYWNrZ3JvdW5kX3NldF9lbGVtZW50KF9fYmluZCwgZmFsc2UsIGZhbHNlLCAtMSwgMCwgMCwgdHJ1ZSwgdHJ1ZSwxLDEsIGZhbHNlLCAwLCAwLCAkZmZmZmZmLCAxKTsKCQlfX3Jlc3VsdFswXSA9IF9fbmV3YmFja1swXTsKCQlfX3Jlc3VsdFsxXSA9IF9fbmV3YmFja1sxXTsKCQlfX3Jlc3VsdFsyXSA9IGZhbHNlOwoJfQoJCglyZXR1cm4gX19yZXN1bHQ7Cn0KCmZ1bmN0aW9uIF9fYmFja2dyb3VuZF9nZXRfaW50ZXJuYWwoKQp7Cgl2YXIgX19wcm9wID0gYXJndW1lbnQwOwoJdmFyIF9fYmluZCA9IGFyZ3VtZW50MTsKCXZhciBfX2JhY2tpbmZvID0gYXJndW1lbnQyOwoJCglpZiAoKF9fYmFja2luZm9bMF0gPT0gLTEpCgkJfHwgKGxheWVyX2JhY2tncm91bmRfZXhpc3RzKF9fYmFja2luZm9bMV0sIF9fYmFja2luZm9bMF0pID09IGZhbHNlKSkJLy8gdGhpcyBjYW4gaGFwcGVuIHdoZW4gd2UgY2hhbmdlIGJldHdlZW4gYmFja2dyb3VuZHMgYW5kIGZvcmVncm91bmRzIChiZWNhdXNlIGxheWVycyBhbmQgZWxlbWVudHMgZ2V0IGRlc3Ryb3llZCkKCXsKCQkvLyBUcnkgZ2V0dGluZyB0aGUgYmFja2dyb3VuZCBpbmZvIGFnYWluIGZyb20gdGhlIGJpbmQgaW5kZXgKCQlfX2JhY2tpbmZvID0gX19iYWNrZ3JvdW5kX2dldF9lbGVtZW50KF9fYmluZCk7CgkKCQlpZiAoX19iYWNraW5mb1swXSA9PSAtMSkKCQkJcmV0dXJuIC0xOwkvLyBlcm0KCX0KCQoJCgkKCXZhciBfX3JlcyA9IC0xOwoJCgl2YXIgX19iYWNraWQgPSBfX2JhY2tpbmZvWzBdOwoJdmFyIF9fbGF5ZXJpZCA9IF9fYmFja2luZm9bMV07Cgl2YXIgX19pc2ZvcmUgPSBfX2JhY2tpbmZvWzJdOwoJCglzd2l0Y2goX19wcm9wKQoJewoJY2FzZSBlX19CRy5WaXNpYmxlOiBfX3JlcyA9IGxheWVyX2dldF92aXNpYmxlKF9fbGF5ZXJpZCk7IGJyZWFrOwoJY2FzZSBlX19CRy5Gb3JlZ3JvdW5kOiBfX3JlcyA9IF9faXNmb3JlOyBicmVhazsKCWNhc2UgZV9fQkcuSW5kZXg6IF9fcmVzID0gbGF5ZXJfYmFja2dyb3VuZF9nZXRfc3ByaXRlKF9fYmFja2lkKSAgYnJlYWs7CgljYXNlIGVfX0JHLlg6IF9fcmVzID0gbGF5ZXJfZ2V0X3goX19sYXllcmlkKTsgYnJlYWs7CgljYXNlIGVfX0JHLlk6IF9fcmVzID0gbGF5ZXJfZ2V0X3koX19sYXllcmlkKTsgYnJlYWs7CgljYXNlIGVfX0JHLldpZHRoOiBfX3JlcyA9IHNwcml0ZV9nZXRfd2lkdGgobGF5ZXJfYmFja2dyb3VuZF9nZXRfaW5kZXgoX19iYWNraWQpKTsgYnJlYWs7CgljYXNlIGVfX0JHLkhlaWdodDogX19yZXMgPSBzcHJpdGVfZ2V0X2hlaWdodChsYXllcl9iYWNrZ3JvdW5kX2dldF9pbmRleChfX2JhY2tpZCkpOyBicmVhazsKCWNhc2UgZV9fQkcuSFRpbGVkOiBfX3JlcyA9IGxheWVyX2JhY2tncm91bmRfZ2V0X2h0aWxlZChfX2JhY2tpZCk7IGJyZWFrOwoJY2FzZSBlX19CRy5WVGlsZWQ6IF9fcmVzID0gbGF5ZXJfYmFja2dyb3VuZF9nZXRfdnRpbGVkKF9fYmFja2lkKTsgYnJlYWs7CgljYXNlIGVfX0JHLlhTY2FsZTogX19yZXMgPSBsYXllcl9iYWNrZ3JvdW5kX2dldF94c2NhbGUoX19iYWNraWQpOyBicmVhazsKCWNhc2UgZV9fQkcuWVNjYWxlOiBfX3JlcyA9IGxheWVyX2JhY2tncm91bmRfZ2V0X3lzY2FsZShfX2JhY2tpZCk7IGJyZWFrOwoJY2FzZSBlX19CRy5IU3BlZWQ6IF9fcmVzID0gbGF5ZXJfZ2V0X2hzcGVlZChfX2xheWVyaWQpOyBicmVhazsKCWNhc2UgZV9fQkcuVlNwZWVkOiBfX3JlcyA9IGxheWVyX2dldF92c3BlZWQoX19sYXllcmlkKTsgYnJlYWs7CgljYXNlIGVfX0JHLkJsZW5kOiBfX3JlcyA9IGxheWVyX2JhY2tncm91bmRfZ2V0X2JsZW5kKF9fYmFja2lkKTsgYnJlYWs7CgljYXNlIGVfX0JHLkFscGhhOiBfX3JlcyA9IGxheWVyX2JhY2tncm91bmRfZ2V0X2FscGhhKF9fYmFja2lkKTsgYnJlYWs7CglkZWZhdWx0OiBicmVhazsKCX07CgkKCXJldHVybiBfX3JlczsKCn0KCmZ1bmN0aW9uIF9fYmFja2dyb3VuZF9nZXRfc2hvd2NvbG91cigpCnsKCXZhciBfX2NvbGluZm8gPSBfX2JhY2tncm91bmRfZ2V0X2NvbG91cl9lbGVtZW50KCk7CgkKCWlmIChfX2NvbGluZm9bMF0gPT0gLTEpCgkJcmV0dXJuIDA7CgkJCgl2YXIgX192aXNpYmxlID0gbGF5ZXJfYmFja2dyb3VuZF9nZXRfdmlzaWJsZShfX2NvbGluZm9bMF0pOwoJcmV0dXJuIF9fdmlzaWJsZTsKfQoKZnVuY3Rpb24gX19iYWNrZ3JvdW5kX3NldCgpCnsKCXZhciBfX3Byb3AgPSBhcmd1bWVudDA7Cgl2YXIgX19iaW5kID0gYXJndW1lbnQxOwoJdmFyIF9fdmFsID0gYXJndW1lbnQyOwoJCgl2YXIgX19iYWNraW5mbyA9IF9fYmFja2dyb3VuZF9nZXRfZWxlbWVudChfX2JpbmQpOwoJCglfX2JhY2tncm91bmRfc2V0X2ludGVybmFsKF9fcHJvcCwgX19iaW5kLCBfX3ZhbCwgX19iYWNraW5mbyk7CgkKCXZhciBfX3JlcyA9IF9fYmFja2dyb3VuZF9nZXRfaW50ZXJuYWwoX19wcm9wLCBfX2JpbmQsIF9fYmFja2luZm8pOwoJcmV0dXJuIF9fcmVzOwp9CgpmdW5jdGlvbiBfX2JhY2tncm91bmRfc2V0X2NvbG91cigpCnsKCXZhciBfX25ld2NvbCA9IGFyZ3VtZW50MDsKCQoJdmFyIF9fY29saW5mbyA9IF9fYmFja2dyb3VuZF9nZXRfY29sb3VyX2VsZW1lbnQoKTsKCQoJaWYgKF9fY29saW5mb1swXSA9PSAtMSkKCQlyZXR1cm4gMDsKCQkKCWxheWVyX2JhY2tncm91bmRfYmxlbmQoX19jb2xpbmZvWzBdLCBfX25ld2NvbCk7CglyZXR1cm4gX19uZXdjb2w7Cn0KCmZ1bmN0aW9uIF9fYmFja2dyb3VuZF9zZXRfY29sb3VyX3BwKCkKewoJdmFyIF9fbmV3Y29sID0gYXJndW1lbnQwOwoJCgl2YXIgX19jb2xpbmZvID0gX19iYWNrZ3JvdW5kX2dldF9jb2xvdXJfZWxlbWVudCgpOwoJCglpZiAoX19jb2xpbmZvWzBdID09IC0xKQoJCXJldHVybiAwOwoJCQoJdmFyIF9fY29sID0gbGF5ZXJfYmFja2dyb3VuZF9nZXRfYmxlbmQoX19jb2xpbmZvWzBdKTsKCWxheWVyX2JhY2tncm91bmRfYmxlbmQoX19jb2xpbmZvWzBdLCBfX25ld2NvbCk7CglyZXR1cm4gX19jb2w7Cn0KCmZ1bmN0aW9uIF9fYmFja2dyb3VuZF9zZXRfZWxlbWVudCgpCnsKCS8vIE5PVEU6IHRoaXMgc2NyaXB0IHdpbGwgb25seSB3b3JrIHByb3Blcmx5IGlmIHlvdSdyZSB1c2luZyB0aGUgc3RhbmRhcmQgZGVwdGggcmFuZ2UgKC0xNjAwMCB0byAxNjAwMCkKCXZhciBfX2JpbmQgPSBhcmd1bWVudDA7Cgl2YXIgX192aXMgPSBhcmd1bWVudDE7Cgl2YXIgX19mb3JlID0gYXJndW1lbnQyOwoJdmFyIF9fYmFjayA9IGFyZ3VtZW50MzsKCXZhciBfX3ggPSBhcmd1bWVudDQ7Cgl2YXIgX195ID0gYXJndW1lbnQ1OwoJdmFyIF9faHRpbGVkID0gYXJndW1lbnQ2OwoJdmFyIF9fdnRpbGVkID0gYXJndW1lbnQ3OwoJdmFyIF9feHNjYWxlID0gYXJndW1lbnQ4OwoJdmFyIF9feXNjYWxlID0gYXJndW1lbnQ5OwoJdmFyIF9fc3RyZXRjaCA9IGFyZ3VtZW50MTA7Cgl2YXIgX19oc3BlZWQgPSBhcmd1bWVudDExOwoJdmFyIF9fdnNwZWVkID0gYXJndW1lbnQxMjsKCXZhciBfX2JsZW5kID0gYXJndW1lbnQxMzsKCXZhciBfX2FscGhhID0gYXJndW1lbnQxNDsKCQoJLy92YXIgX19uZWFyZXN0ZGVwdGggPSAtMTUwMDA7CgkvL3ZhciBfX2ZhcnRoZXN0ZGVwdGggPSAxNTk5OTsKCXZhciBfX25lYXJlc3RkZXB0aCA9IDEwMDAwMDAwMDA7Cgl2YXIgX19mYXJ0aGVzdGRlcHRoID0gLTEwMDAwMDAwMDA7Cgl2YXIgX19kZXB0aGluYyA9IDEwMDsKCQoJdmFyIF9fcmVzdWx0OwoJX19yZXN1bHRbMF0gPSAtMTsKCV9fcmVzdWx0WzFdID0gLTE7CgkKCQoJLy8gTm93IGxvb2sgYXQgdGhlIGV4aXN0aW5nIGxheWVycyBpbiB0aGUgcm9vbSB0byBzZWUgaWYgd2UgaGF2ZSBhbnkgZm9yZWdyb3VuZHMgb3IgYmFja2dyb3VuZHMKCXZhciBfX2Znc3RyaW5nID0gIkNvbXBhdGliaWxpdHlfRm9yZWdyb3VuZF8iOwoJdmFyIF9fYmdzdHJpbmcgPSAiQ29tcGF0aWJpbGl0eV9CYWNrZ3JvdW5kXyI7Cgl2YXIgX19jb2xzdHJpbmcgPSAiQ29tcGF0aWJpbGl0eV9Db2xvdXIiOwoJdmFyIF9fZmdsZW4gPSBzdHJpbmdfbGVuZ3RoKF9fZmdzdHJpbmcpOwoJdmFyIF9fYmdsZW4gPSBzdHJpbmdfbGVuZ3RoKF9fYmdzdHJpbmcpOwoJdmFyIF9fbGF5ZXJsaXN0ID0gbGF5ZXJfZ2V0X2FsbCgpOwoJdmFyIF9fbGF5ZXJsaXN0bGVuZ3RoID0gYXJyYXlfbGVuZ3RoXzFkKF9fbGF5ZXJsaXN0KTsKCXZhciBfX2NvbGxheWVyID0gLTE7Cgl2YXIgX19zbG90czsKCXZhciBfX2lzZm9yZWdyb3VuZDsKCXZhciBfX2k7Cglmb3IoX19pID0gMDsgX19pIDwgODsgX19pKyspCgl7CgkJX19zbG90c1tfX2ldID0gLTE7CgkJX19pc2ZvcmVncm91bmRbX19pXSA9IGZhbHNlOwoJfQoJCgkKCWZvcihfX2kgPSAwOyBfX2kgPCBfX2xheWVybGlzdGxlbmd0aDsgX19pKyspCgl7CgkJdmFyIF9fbGF5ZXJuYW1lID0gbGF5ZXJfZ2V0X25hbWUoX19sYXllcmxpc3RbX19pXSk7CQoJCWlmIChzdHJpbmdfcG9zKF9fZmdzdHJpbmcsIF9fbGF5ZXJuYW1lKSA+IDApCgkJewoJCQl2YXIgX19zbG90Y2hyID0gc3RyaW5nX2NoYXJfYXQoX19sYXllcm5hbWUsIF9fZmdsZW4gKyAxKTsKCQkJaWYgKF9fc2xvdGNociA9PSAiIikKCQkJCWNvbnRpbnVlOwoJCQkJCgkJCXZhciBfX3Nsb3QgPSByZWFsKCBfX3Nsb3RjaHIgKTsKCQkJX19zbG90c1tfX3Nsb3RdID0gX19sYXllcmxpc3RbX19pXTsKCQkJCgkJCV9faXNmb3JlZ3JvdW5kW19fc2xvdF0gPSB0cnVlOwoJCQkKCQkJLy8gQ291bGQgY2hlY2sgdGhlIGNvbnRlbnRzIG9mIHRoaXMgbGF5ZXIgdG8gc2VlIGlmIGl0IGhhcyBhIHNpbmdsZSBiYWNrZ3JvdW5kIGVsZW1lbnQgb24gaXQgYnV0IHRoYXQncyBwcm9iYWJseSBvdmVya2lsbAkJCgkJfQoJCWVsc2UgaWYgKHN0cmluZ19wb3MoX19iZ3N0cmluZywgX19sYXllcm5hbWUpID4gMCkKCQl7CgkJCXZhciBfX3Nsb3RjaHIgPSBzdHJpbmdfY2hhcl9hdChfX2xheWVybmFtZSwgX19iZ2xlbiArIDEpOwoJCQlpZiAoX19zbG90Y2hyID09ICIiKQoJCQkJY29udGludWU7CgkJCQkKCQkJdmFyIF9fc2xvdCA9IHJlYWwoIF9fc2xvdGNociApOwoJCQlfX3Nsb3RzW19fc2xvdF0gPSBfX2xheWVybGlzdFtfX2ldOwoJCQkKCQkJX19pc2ZvcmVncm91bmRbX19zbG90XSA9IGZhbHNlOwoJCQkKCQkJLy8gQ291bGQgY2hlY2sgdGhlIGNvbnRlbnRzIG9mIHRoaXMgbGF5ZXIgdG8gc2VlIGlmIGl0IGhhcyBhIHNpbmdsZSBiYWNrZ3JvdW5kIGVsZW1lbnQgb24gaXQgYnV0IHRoYXQncyBwcm9iYWJseSBvdmVya2lsbAkJCgkJfQoJCWVsc2UgaWYgKHN0cmluZ19wb3MoX19jb2xzdHJpbmcsIF9fbGF5ZXJuYW1lKSA+IDApCgkJewoJCQkvLyBNYWtlIHN1cmUgY29sb3VyIGlzIGFzIGRlZXAgYXMgaXQgY2FuIGJlCgkJCV9fY29sbGF5ZXIgPSBfX2xheWVybGlzdFtfX2ldOwoJCQlsYXllcl9kZXB0aChfX2xheWVybGlzdFtfX2ldLCBfX2ZhcnRoZXN0ZGVwdGgpOwoJCX0KCQllbHNlCgkJewoJCQl2YXIgX19jdXJyZGVwdGggPSBsYXllcl9nZXRfZGVwdGgoX19sYXllcmxpc3RbX19pXSk7CgkJCQoJCQlpZiAoX19jdXJyZGVwdGggPCBfX25lYXJlc3RkZXB0aCkKCQkJCV9fbmVhcmVzdGRlcHRoID0gX19jdXJyZGVwdGg7CgkJCQkKCQkJaWYgKF9fY3VycmRlcHRoID4gX19mYXJ0aGVzdGRlcHRoKQoJCQkJX19mYXJ0aGVzdGRlcHRoID0gX19jdXJyZGVwdGg7CgkJfQoJfQoJCgkvLyBSZWFzc2lnbiBkZXB0aHMKCV9fZmFydGhlc3RkZXB0aCArPSBfX2RlcHRoaW5jICsgMTAwMDsJCS8vIGFkZCBzb21lIG1hcmdpbiBmb3IgdGhlIGJhY2tncm91bmQgbGF5ZXJzCglfX25lYXJlc3RkZXB0aCAtPSBfX2RlcHRoaW5jOwoJCgkvL19fZmFydGhlc3RkZXB0aCA9IG1heChfX2ZhcnRoZXN0ZGVwdGgsIDE1OTk5KTsKCS8vX19uZWFyZXN0ZGVwdGggPSBtaW4oX19uZWFyZXN0ZGVwdGgsIC0xNTAwMCk7CglfX2ZhcnRoZXN0ZGVwdGggPSBtYXgoX19mYXJ0aGVzdGRlcHRoLCAyMTQ3NDgzNjAwKTsKCV9fbmVhcmVzdGRlcHRoID0gbWluKF9fbmVhcmVzdGRlcHRoLCAtMjE0NzQ4MjAwMCk7CgkKCWZvcihfX2kgPSAwOyBfX2kgPCA4OyBfX2krKykKCXsKCQlpZiAoX19zbG90c1tfX2ldICE9IC0xKQoJCXsKCQkJdmFyIF9fZGVwdGggPSAwOwoJCQlpZiAoX19pc2ZvcmVncm91bmRbX19pXSA9PSB0cnVlKQoJCQl7CgkJCQlfX2RlcHRoID0gX19uZWFyZXN0ZGVwdGggLSAoX19pICogX19kZXB0aGluYyk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfX2RlcHRoID0gKF9fZmFydGhlc3RkZXB0aCAtIF9fZGVwdGhpbmMpIC0gKF9fc2xvdCAqIF9fZGVwdGhpbmMpOwoJCQl9CgkJCQoJCQlsYXllcl9kZXB0aChfX3Nsb3RzW19faV0sIF9fZGVwdGgpOwoJCX0KCX0KCQoJaWYgKF9fY29sbGF5ZXIgIT0gLTEpCgl7CgkJbGF5ZXJfZGVwdGgoX19jb2xsYXllciwgX19mYXJ0aGVzdGRlcHRoKTsKCX0KCQoJCgkvLyBDb25zdHJ1Y3Qgb3VyIGxheWVyIG5hbWUgYW5kIGRlcHRoCgl2YXIgX19sYXllcm5hbWU7Cgl2YXIgX19sYXllcmRlcHRoOwoJaWYgKF9fYmluZCA9PSAtMSkKCXsKCQkvLyBUaGlzIGlzIHRoZSBiYWNrZ3JvdW5kIGNvbG91ciBsYXllcgoJCV9fbGF5ZXJuYW1lID0gX19jb2xzdHJpbmc7CgkJX19sYXllcmRlcHRoID0gX19mYXJ0aGVzdGRlcHRoOwoJfQoJZWxzZQoJewoJCWlmIChfX2ZvcmUgPT0gdHJ1ZSkKCQl7CgkJCV9fbGF5ZXJuYW1lID0gX19mZ3N0cmluZyArIHN0cmluZyhfX2JpbmQpOwoJCQlfX2xheWVyZGVwdGggPSBfX25lYXJlc3RkZXB0aCAtIChfX2JpbmQgKiBfX2RlcHRoaW5jKTsKCQl9CgkJZWxzZQoJCXsKCQkJX19sYXllcm5hbWUgPSBfX2Jnc3RyaW5nICsgc3RyaW5nKF9fYmluZCk7CgkJCV9fbGF5ZXJkZXB0aCA9IChfX2ZhcnRoZXN0ZGVwdGggLSBfX2RlcHRoaW5jKSAtIChfX2JpbmQgKiBfX2RlcHRoaW5jKTsJLy8gcmVzZXJ2ZSAxNjAwMCBmb3IgaW1wb3J0ZWQgY29sb3VyCgkJfQoJfQoJCgkvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgYSBiYWNrZ3JvdW5kIGluIHRoaXMgc2xvdCwgbnVrZSBpdAoJdmFyIF9fbGF5ZXJpZDsKCWlmIChfX2JpbmQgPT0gLTEpCgl7CgkJX19sYXllcmlkID0gX19jb2xsYXllcjsKCX0KCWVsc2UKCXsKCQlfX2xheWVyaWQgPSBfX3Nsb3RzW19fYmluZF07Cgl9CgkJCglpZiAoX19sYXllcmlkICE9IC0xKQoJewoJCWxheWVyX2Rlc3Ryb3koX19sYXllcmlkKTsKCX0KCV9fbGF5ZXJpZCA9IGxheWVyX2NyZWF0ZShfX2xheWVyZGVwdGgsIF9fbGF5ZXJuYW1lKTsKCQoJLy8gU2V0IG91ciBsYXllciBwcm9wZXJ0aWVzCglsYXllcl94KF9fbGF5ZXJpZCwgX194KTsKCWxheWVyX3koX19sYXllcmlkLCBfX3kpOwoJbGF5ZXJfaHNwZWVkKF9fbGF5ZXJpZCwgX19oc3BlZWQpOwoJbGF5ZXJfdnNwZWVkKF9fbGF5ZXJpZCwgX192c3BlZWQpOwoJCgkvLyBDb25zdHJ1Y3Qgb3VyIG5ldyBiYWNrZ3JvdW5kIGVsZW1lbnQKCXZhciBfX2JhY2tlbCA9IGxheWVyX2JhY2tncm91bmRfY3JlYXRlKF9fbGF5ZXJpZCwgX19iYWNrKTsKCWxheWVyX2JhY2tncm91bmRfdmlzaWJsZShfX2JhY2tlbCwgX192aXMpOwoJbGF5ZXJfYmFja2dyb3VuZF9odGlsZWQoX19iYWNrZWwsIF9faHRpbGVkKTsKCWxheWVyX2JhY2tncm91bmRfdnRpbGVkKF9fYmFja2VsLCBfX3Z0aWxlZCk7CglsYXllcl9iYWNrZ3JvdW5kX3hzY2FsZShfX2JhY2tlbCwgX194c2NhbGUpOwoJbGF5ZXJfYmFja2dyb3VuZF95c2NhbGUoX19iYWNrZWwsIF9feXNjYWxlKTsKCWxheWVyX2JhY2tncm91bmRfc3RyZXRjaChfX2JhY2tlbCwgX19zdHJldGNoKTsKCWxheWVyX2JhY2tncm91bmRfYmxlbmQoX19iYWNrZWwsIF9fYmxlbmQpOwoJbGF5ZXJfYmFja2dyb3VuZF9hbHBoYShfX2JhY2tlbCwgX19hbHBoYSk7CgkKCV9fcmVzdWx0WzBdID0gX19iYWNrZWw7CglfX3Jlc3VsdFsxXSA9IF9fbGF5ZXJpZDsKCQoJcmV0dXJuIF9fcmVzdWx0Owp9CgpmdW5jdGlvbiBfX2JhY2tncm91bmRfc2V0X2ludGVybmFsKCkKewoJdmFyIF9fcHJvcCA9IGFyZ3VtZW50MDsKCXZhciBfX2JpbmQgPSBhcmd1bWVudDE7Cgl2YXIgX192YWwgPSBhcmd1bWVudDI7Cgl2YXIgX19iYWNraW5mbyA9IGFyZ3VtZW50MzsKCQoJaWYgKF9fYmFja2luZm9bMF0gPT0gLTEpCgl7CgkJcmV0dXJuIC0xOwkvLyBlcm0KCX0KCQoJdmFyIF9fYmFja2lkID0gX19iYWNraW5mb1swXTsKCXZhciBfX2xheWVyaWQgPSBfX2JhY2tpbmZvWzFdOwoJdmFyIF9faXNmb3JlID0gX19iYWNraW5mb1syXTsKCQoJaWYgKF9fcHJvcCA9PSBlX19CRy5Gb3JlZ3JvdW5kKQoJewoJCS8vIFRoaXMgcmVxdWlyZXMgcXVpdGUgYSBiaXQgb2YgZXh0cmEgbG9naWMgKHdlIG5lZWQgdG8gbW9kaWZ5IG91ciBsYXllciBsaXN0KQoJCWlmIChyb3VuZChfX3ZhbCkgIT0gcm91bmQoX19pc2ZvcmUpKQoJCXsKCQkJLy8gb2theSwgd2UgaGF2ZSBhIG1pc21hdGNoCgkJCS8vIEdldCBhbGwgcHJvcGVydGllcywgdGhlbiBzZXQgdGhlIGJhY2tncm91bmQgYWdhaW4gYW5kIGNvcHkgdGhlIHByb3BlcnRpZXMKCQkJdmFyIF9fdmlzaWJsZSA9IGxheWVyX2dldF92aXNpYmxlKF9fbGF5ZXJpZCk7CgkJCXZhciBfX2luZGV4ID0gbGF5ZXJfYmFja2dyb3VuZF9nZXRfc3ByaXRlKF9fYmFja2lkKTsKCQkJdmFyIF9faHRpbGVkID0gbGF5ZXJfYmFja2dyb3VuZF9nZXRfaHRpbGVkKF9fYmFja2lkKTsKCQkJdmFyIF9fdnRpbGVkID0gbGF5ZXJfYmFja2dyb3VuZF9nZXRfdnRpbGVkKF9fYmFja2lkKTsKCQkJdmFyIF9fc3RyZXRjaCA9IGxheWVyX2JhY2tncm91bmRfZ2V0X3N0cmV0Y2goX19iYWNraWQpOwoJCQl2YXIgX19ibGVuZCA9IGxheWVyX2JhY2tncm91bmRfZ2V0X2JsZW5kKF9fYmFja2lkKTsKCQkJdmFyIF9fYWxwaGEgPSBsYXllcl9iYWNrZ3JvdW5kX2dldF9hbHBoYShfX2JhY2tpZCk7CgkJCXZhciBfX3hzY2FsZSA9IGxheWVyX2JhY2tncm91bmRfZ2V0X3hzY2FsZShfX2JhY2tpZCk7CgkJCXZhciBfX3lzY2FsZSA9IGxheWVyX2JhY2tncm91bmRfZ2V0X3lzY2FsZShfX2JhY2tpZCk7CgkKCQkJdmFyIF9feCA9IGxheWVyX2dldF94KF9fbGF5ZXJpZCk7CgkJCXZhciBfX3kgPSBsYXllcl9nZXRfeShfX2xheWVyaWQpOwoJCQl2YXIgX19oc3BlZWQgPSBsYXllcl9nZXRfaHNwZWVkKF9fbGF5ZXJpZCk7CgkJCXZhciBfX3ZzcGVlZCA9IGxheWVyX2dldF92c3BlZWQoX19sYXllcmlkKTsKCQoJCQlfX2JhY2tncm91bmRfc2V0X2VsZW1lbnQoX19iaW5kLCBfX3Zpc2libGUsIF9fdmFsLCBfX2luZGV4LCBfX3gsIF9feSwgX19odGlsZWQsIF9fdnRpbGVkLF9feHNjYWxlLF9feXNjYWxlLCBfX3N0cmV0Y2gsIF9faHNwZWVkLCBfX3ZzcGVlZCwgX19ibGVuZCwgX19hbHBoYSk7CgkJfQoJfQoJZWxzZQoJewoJCXN3aXRjaChfX3Byb3ApCgkJewoJCWNhc2UgZV9fQkcuVmlzaWJsZTogbGF5ZXJfc2V0X3Zpc2libGUoX19sYXllcmlkLCBfX3ZhbCk7IGxheWVyX2JhY2tncm91bmRfdmlzaWJsZShfX2JhY2tpZCwgX192YWwpOyBicmVhazsJCgkJY2FzZSBlX19CRy5JbmRleDogCQkKCQkJbGF5ZXJfYmFja2dyb3VuZF9jaGFuZ2UoX19iYWNraWQsIF9fdmFsKTsgIAoJCQkvLyBSSyA6OiBpZiB3ZSBhcmUgc2V0dGluZyBhIHNwcml0ZSB0aGVuIHNldCB0aGUgYmFja2dyb3VuZCBjb2xvdXIgdG8gd2hpdGUgc28gaXQgaXMgYmxlbmRpbmcgY29ycmVjdGx5CgkJCWlmIChzcHJpdGVfZXhpc3RzKF9fdmFsKSkgeyAKCQkJCWxheWVyX2JhY2tncm91bmRfYmxlbmQoX19iYWNraWQsIGNfd2hpdGUgKTsgCgkJCQlsYXllcl9iYWNrZ3JvdW5kX2FscGhhKF9fYmFja2lkLCAxICk7IAoJCQl9IC8vIGVuZCBpZgoJCQlicmVhazsKCQljYXNlIGVfX0JHLlg6IGxheWVyX3goX19sYXllcmlkLCBfX3ZhbCk7IGJyZWFrOwoJCWNhc2UgZV9fQkcuWTogbGF5ZXJfeShfX2xheWVyaWQsIF9fdmFsKTsgYnJlYWs7CgkJY2FzZSBlX19CRy5IVGlsZWQ6IGxheWVyX2JhY2tncm91bmRfaHRpbGVkKF9fYmFja2lkLCBfX3ZhbCk7IGJyZWFrOwoJCWNhc2UgZV9fQkcuVlRpbGVkOiBsYXllcl9iYWNrZ3JvdW5kX3Z0aWxlZChfX2JhY2tpZCwgX192YWwpOyBicmVhazsKCQljYXNlIGVfX0JHLlhTY2FsZTogbGF5ZXJfYmFja2dyb3VuZF94c2NhbGUoX19iYWNraWQsIF9fdmFsKTsgYnJlYWs7CgkJY2FzZSBlX19CRy5ZU2NhbGU6IGxheWVyX2JhY2tncm91bmRfeXNjYWxlKF9fYmFja2lkLCBfX3ZhbCk7IGJyZWFrOwoJCWNhc2UgZV9fQkcuSFNwZWVkOiBsYXllcl9oc3BlZWQoX19sYXllcmlkLCBfX3ZhbCk7IGJyZWFrOwoJCWNhc2UgZV9fQkcuVlNwZWVkOiBsYXllcl92c3BlZWQoX19sYXllcmlkLCBfX3ZhbCk7IGJyZWFrOwoJCWNhc2UgZV9fQkcuQmxlbmQ6IGxheWVyX2JhY2tncm91bmRfYmxlbmQoX19iYWNraWQsIF9fdmFsKTsgYnJlYWs7CgkJY2FzZSBlX19CRy5BbHBoYTogbGF5ZXJfYmFja2dyb3VuZF9hbHBoYShfX2JhY2tpZCwgX192YWwpOyBicmVhazsKCQlkZWZhdWx0OiBicmVhazsKCQl9OwoJfQoJCglyZXR1cm4gLTE7Cgp9CgpmdW5jdGlvbiBfX2JhY2tncm91bmRfc2V0X3BwKCkKewoJdmFyIF9fcHJvcCA9IGFyZ3VtZW50MDsKCXZhciBfX2JpbmQgPSBhcmd1bWVudDE7Cgl2YXIgX192YWwgPSBhcmd1bWVudDI7CgkKCXZhciBfX2JhY2tpbmZvID0gX19iYWNrZ3JvdW5kX2dldF9lbGVtZW50KF9fYmluZCk7Cgl2YXIgX19yZXMgPSBfX2JhY2tncm91bmRfZ2V0X2ludGVybmFsKF9fcHJvcCwgX19iaW5kLCBfX2JhY2tpbmZvKTsKCQoJX19iYWNrZ3JvdW5kX3NldF9pbnRlcm5hbChfX3Byb3AsIF9fYmluZCwgX192YWwsIF9fYmFja2luZm8pOwoJCglyZXR1cm4gX19yZXM7Cn0KCmZ1bmN0aW9uIF9fYmFja2dyb3VuZF9zZXRfc2hvd2NvbG91cigpCnsKCXZhciBfX25ld3ZpcyA9IGFyZ3VtZW50MDsKCQoJdmFyIF9fY29saW5mbyA9IF9fYmFja2dyb3VuZF9nZXRfY29sb3VyX2VsZW1lbnQoKTsKCQoJaWYgKF9fY29saW5mb1swXSA9PSAtMSkKCQlyZXR1cm4gMDsKCQkKCWxheWVyX2JhY2tncm91bmRfdmlzaWJsZShfX2NvbGluZm9bMF0sIF9fbmV3dmlzKTsKCXJldHVybiBfX25ld3ZpczsKfQoKZnVuY3Rpb24gX19iYWNrZ3JvdW5kX3NldF9zaG93Y29sb3VyX3BwKCkKewoJdmFyIF9fbmV3dmlzID0gYXJndW1lbnQwOwoJCgl2YXIgX19jb2xpbmZvID0gX19iYWNrZ3JvdW5kX2dldF9jb2xvdXJfZWxlbWVudCgpOwoJCglpZiAoX19jb2xpbmZvWzBdID09IC0xKQoJCXJldHVybiAwOwoJCQoJdmFyIF9fdmlzID0gbGF5ZXJfYmFja2dyb3VuZF9nZXRfdmlzaWJsZShfX2NvbGluZm9bMF0pOwoJbGF5ZXJfYmFja2dyb3VuZF92aXNpYmxlKF9fY29saW5mb1swXSwgX19uZXd2aXMpOwoJcmV0dXJuIF9fdmlzOwp9CgpmdW5jdGlvbiBfX2luaXRfYmFja2dyb3VuZCgpCnsKCWVudW0gZV9fQkcKCXsKCQlWaXNpYmxlLAoJCUZvcmVncm91bmQsCgkJSW5kZXgsCgkJWCwKCQlZLAoJCVdpZHRoLAoJCUhlaWdodCwKCQlIVGlsZWQsCgkJVlRpbGVkLAoJCVhTY2FsZSwKCQlZU2NhbGUsCgkJSFNwZWVkLAoJCVZTcGVlZCwKCQlCbGVuZCwKCQlBbHBoYSwKCX07CgkKCn0KCiNlbmRyZWdpb24KI3JlZ2lvbiBhY3Rpb24KCmZ1bmN0aW9uIGFjdGlvbl9hbm90aGVyX3Jvb20oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIG1vdmUgdG8gYW5vdGhlciByb29tCgkvLy8gQHBhcmFtIHJvb21JbmRleCByb29tIGluZGV4IHRvIGdvIHRvLgoJcm9vbV9nb3RvKCBhcmd1bWVudDAgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9ib3VuY2UoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIEFsbG93cyBib3VuY2luZyBvZiB0aGUgY2FsbGluZyBpbnN0YW5jZQoJLy8vIEBwYXJhbSBhZHZhbmNlZCBXaGV0aGVyIHRvIGVuYWJsZSBhZHZhbmNlZCBib3VuY2luZyAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCS8vLyBAcGFyYW0gdXNlYWxsIHRydWUgaWYgYm91bmNpbmcgb2ZmIG5vbi1zb2xpZCBhbmQgc29saWQKCXZhciBfX3VzZWFsbCA9IGFyZ3VtZW50MTsKCWlmICghX191c2VhbGwpIHsKCQltb3ZlX2JvdW5jZV9zb2xpZChhcmd1bWVudDApOwoJfSBlbHNlIHsKCQltb3ZlX2JvdW5jZV9hbGwoYXJndW1lbnQwKTsKCX0KCn0KCmZ1bmN0aW9uIGFjdGlvbl9jZF9wYXVzZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gYWN0aW9uX2NkX3BhdXNlIC0gZGVwcmVjYXRlZCBmdW5jdGlvbgoJc2hvd19kZWJ1Z19tZXNzYWdlKCAiYWN0aW9uX2NkX3BhdXNlIGlzIGEgZGVwcmVjYXRlZCBmdW5jdGlvbiIgKTsKCXJldHVybiAwOwp9CgpmdW5jdGlvbiBhY3Rpb25fY2RfcGxheSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gYWN0aW9uX2NkX3BsYXkgLSBkZXByZWNhdGVkIGZ1bmN0aW9uCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25fY2RfcGxheSBpcyBhIGRlcHJlY2F0ZWQgZnVuY3Rpb24iICk7CglyZXR1cm4gMDsKfQoKZnVuY3Rpb24gYWN0aW9uX2NkX3BsYXlpbmcoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGFjdGlvbl9jZF9wbGF5aW5nIC0gZGVwcmVjYXRlZCBmdW5jdGlvbgoJc2hvd19kZWJ1Z19tZXNzYWdlKCAiYWN0aW9uX2NkX3BsYXlpbmcgaXMgYSBkZXByZWNhdGVkIGZ1bmN0aW9uIiApOwoJcmV0dXJuIDA7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9jZF9wcmVzZW50KCkKewoJLy8vIEBkZXNjcmlwdGlvbiBhY3Rpb25fY2RfcHJlc2VudCAtIGRlcHJlY2F0ZWQgZnVuY3Rpb24KCXNob3dfZGVidWdfbWVzc2FnZSggImFjdGlvbl9jZF9wcmVzZW50IGlzIGEgZGVwcmVjYXRlZCBmdW5jdGlvbiIgKTsKCXJldHVybiAwOwp9CgpmdW5jdGlvbiBhY3Rpb25fY2RfcmVzdW1lKCkKewoJLy8vIEBkZXNjcmlwdGlvbiBhY3Rpb25fY2RfcmVzdW1lIC0gZGVwcmVjYXRlZCBmdW5jdGlvbgoJc2hvd19kZWJ1Z19tZXNzYWdlKCAiYWN0aW9uX2NkX3Jlc3VtZSBpcyBhIGRlcHJlY2F0ZWQgZnVuY3Rpb24iICk7CglyZXR1cm4gMDsKfQoKZnVuY3Rpb24gYWN0aW9uX2NkX3N0b3AoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIGFjdGlvbl9jZF9zdG9wIC0gZGVwcmVjYXRlZCBmdW5jdGlvbgoJc2hvd19kZWJ1Z19tZXNzYWdlKCAiYWN0aW9uX2NkX3N0b3AgaXMgYSBkZXByZWNhdGVkIGZ1bmN0aW9uIiApOwoJcmV0dXJuIDA7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fY2hhbmdlX29iamVjdCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gQ2hhbmdlcyB0aGUgY2FsbGluZyBpbnN0YW5jZSB0byBhbiBpbnN0YW5jZSBvZiBhIGRpZmZlcmVudCBvYmplY3QKCS8vLyBAcGFyYW0gb2JqSW5kIFRoZSBuZXcgb2JqZWN0IHRoZSBjYWxsaW5nIG9iamVjdCB3aWxsIGNoYW5nZSBpbnRvLgoJLy8vIEBwYXJhbSBwZXJmb3JtRXZlbnRzIFdoZXRoZXIgdG8gcGVyZm9ybSB0aGF0IG5ldyBvYmplY3QncyBjcmVhdGUgYW5kIGRlc3Ryb3kgZXZlbnRzICh0cnVlKSBvciBub3QgKGZhbHNlKS4KCWluc3RhbmNlX2NoYW5nZSggYXJndW1lbnQwLCBhcmd1bWVudDEgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9jb2xvcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gU2V0cyB0aGUgYmFzZSBjb2xvciBmb3IgdGhlIGRyYXcgZnVuY3Rpb25zCgkvLy8gQHBhcmFtIGNvbCBUaGUgY29sb3IgdG8gc2V0IGZvciBkcmF3aW5nLgoJZHJhd19zZXRfY29sb3IoIGFyZ3VtZW50MCApOwp9CgpmdW5jdGlvbiBhY3Rpb25fY29sb3VyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBTZXRzIHRoZSBiYXNlIGNvbG91ciBmb3IgdGhlIGRyYXcgZnVuY3Rpb25zCgkvLy8gQHBhcmFtIGNvbCBUaGUgY29sb3VyIHRvIHNldCBmb3IgZHJhd2luZy4KCWRyYXdfc2V0X2NvbG9yKCBhcmd1bWVudDAgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9jcmVhdGVfb2JqZWN0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBjcmVhdGVzIGFuIGluc3RhbmNlIG9mIGFuIG9iamVjdCBhdCBhIHBvc2l0aW9uCgkvLy8gQHBhcmFtIG9iakluZCBvYmplY3QgdG8gY3JlYXRlCgkvLy8gQHBhcmFtIHhQb3MJCVggcG9zaXRpb24gdG8gY3JlYXRlIGF0CgkvLy8gQHBhcmFtIHlQb3MJCVkgcG9zaXRpb24gdG8gY3JlYXRlIGF0CgkKCWlmICghb2JqZWN0X2V4aXN0cyhhcmd1bWVudDApKSB7CgkJc2hvd19tZXNzYWdlKCAiY3JlYXRpbmcgaW5zdGFuY2UgZm9yIG5vbi1leGlzdGVudCBvYmplY3QiICsgc3RyaW5nKGlkKSApOwoJCXJldHVybiAwOwoJfQoJCglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpCgl7CgkJaW5zdGFuY2VfY3JlYXRlKCB4K2FyZ3VtZW50MSwgeSthcmd1bWVudDIsIGFyZ3VtZW50MCk7Cgl9IGVsc2UgewoJCWluc3RhbmNlX2NyZWF0ZSggYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MCk7Cgl9Cn0KCmZ1bmN0aW9uIGFjdGlvbl9jcmVhdGVfb2JqZWN0X21vdGlvbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gY3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBhbiBvYmplY3QgYXQgYSBwb3NpdGlvbiB3aXRoIHNwZWNpZmllZCBtb3Rpb24KCS8vLyBAcGFyYW0gb2JqSW5kIG9iamVjdCB0byBjcmVhdGUKCS8vLyBAcGFyYW0geFBvcwkJWCBwb3NpdGlvbiB0byBjcmVhdGUgYXQKCS8vLyBAcGFyYW0geVBvcwkJWSBwb3NpdGlvbiB0byBjcmVhdGUgYXQKCS8vLyBAcGFyYW0gc3BlZWQgCWluaXRpYWwgc3BlZWQgb2YgaW5zdGFuY2UKCS8vLyBAcGFyYW0gc3BlZWQgCWluaXRpYWwgZGlyZWN0aW9uIG9mIGluc3RhbmNlCglpZiAoIW9iamVjdF9leGlzdHMoYXJndW1lbnQwKSkgewoJCXNob3dfbWVzc2FnZSggImNyZWF0aW5nIGluc3RhbmNlIGZvciBub24tZXhpc3RlbnQgb2JqZWN0IiArIHN0cmluZyhpZCkgKTsKCQlyZXR1cm4gMDsKCX0KCQoJdmFyIGkgPSAtMTsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkKCXsKCQlpID0gaW5zdGFuY2VfY3JlYXRlKCB4K2FyZ3VtZW50MSwgeSthcmd1bWVudDIsIGFyZ3VtZW50MCk7Cgl9IGVsc2UgewoJCWkgPSBpbnN0YW5jZV9jcmVhdGUoIGFyZ3VtZW50MSwgYXJndW1lbnQyLCBhcmd1bWVudDApOwoJfQoJaS5zcGVlZCA9IGFyZ3VtZW50MzsKCWkuZGlyZWN0aW9uID0gYXJndW1lbnQ0Owp9CgpmdW5jdGlvbiBhY3Rpb25fY3JlYXRlX29iamVjdF9yYW5kb20oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGNyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYW4gb2JqZWN0IChmcm9tIGEgY2hvaWNlIG9mIDQpIGF0IGEgcG9zaXRpb24KCS8vLyBAcGFyYW0gb2JqSW5kMCAJcG9zc2libGUgb2JqZWN0IHRvIGNyZWF0ZQoJLy8vIEBwYXJhbSBvYmpJbmQxIAlwb3NzaWJsZSBvYmplY3QgdG8gY3JlYXRlCgkvLy8gQHBhcmFtIG9iakluZDIgCXBvc3NpYmxlIG9iamVjdCB0byBjcmVhdGUKCS8vLyBAcGFyYW0gb2JqSW5kMyAJcG9zc2libGUgb2JqZWN0IHRvIGNyZWF0ZQoJLy8vIEBwYXJhbSB4UG9zCQlYIHBvc2l0aW9uIHRvIGNyZWF0ZSBhdAoJLy8vIEBwYXJhbSB5UG9zCQlZIHBvc2l0aW9uIHRvIGNyZWF0ZSBhdAoJCgl2YXIgb2IgPSBjaG9vc2UoIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MyApOwoJCglpZiAoIW9iamVjdF9leGlzdHMob2IpKSB7CgkJcmV0dXJuIDA7Cgl9IC8vIGVuZCBpZgoJCglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpCXsKCQlpID0gaW5zdGFuY2VfY3JlYXRlKCB4K2FyZ3VtZW50NCwgeSthcmd1bWVudDUsIG9iKTsKCX0gZWxzZSB7CgkJaSA9IGluc3RhbmNlX2NyZWF0ZSggYXJndW1lbnQ0LCBhcmd1bWVudDUsIG9iKTsKCX0gLy8gZW5kIGlmCgkKCn0KCmZ1bmN0aW9uIGFjdGlvbl9jdXJyZW50X3Jvb20oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHJlc3RhcnQgdGhlIGN1cnJlbnQgcm9vbQoJcm9vbV9yZXN0YXJ0KCk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fZHJhd19hcnJvdygpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZHJhdyBhbmQgYXJyb3cKCS8vLyBAcGFyYW0geDEJeCBwb3NpdGlvbiBvZiBzdGFydCBwb2ludAoJLy8vIEBwYXJhbSB5MQl5IHBvc2l0aW9uIG9mIHN0YXJ0IHBvaW50CgkvLy8gQHBhcmFtIHgyCXggcG9zaXRpb24gb2YgZW5kIHBvaW50CgkvLy8gQHBhcmFtIHkyCXkgcG9zaXRpb24gb2YgZW5kIHBvaW50CgkvLy8gQHBhcmFtIHNpemUgc2l6ZSBvZiB0aGUgYXJyb3cgaGVhZAoJCgl2YXIgeDEgPSBhcmd1bWVudDA7Cgl2YXIgeTEgPSBhcmd1bWVudDE7Cgl2YXIgeDIgPSBhcmd1bWVudDI7Cgl2YXIgeTIgPSBhcmd1bWVudDM7Cgl2YXIgc2l6ZSA9IGFyZ3VtZW50NDsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCWRyYXdfYXJyb3coIHgreDEsIHkreTEsIHgreDIsIHkreTIsIHNpemUgKTsKCX0gZWxzZSB7CgkJZHJhd19hcnJvdyggeDEsIHkxLCB4MiwgeTIsIHNpemUgKTsJCgl9IC8vIGVuZCBpZgp9CgpmdW5jdGlvbiBhY3Rpb25fZHJhd19iYWNrZ3JvdW5kKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBkcmF3IGJhY2tncm91bmQKCS8vLyBAcGFyYW0gaW5kZXggcmVzb3VyY2UgaW5kZXgKCS8vLyBAcGFyYW0geAl4IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHkJeSBwb3NpdGlvbgoJLy8vIEBwYXJhbSB0aWxlZAl0cnVlIGlmIHRpbGVkCgkKCXZhciB4eCA9IGFyZ3VtZW50MTsKCXZhciB5eSA9IGFyZ3VtZW50MjsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXh4ICs9IHg7CgkJeXkgKz0geTsKCX0gIC8vIGVuZCBpZgoJCgkvLyBkcmF3IHRpbGVkIGlmIGFyZ3VtZW50MyBpcyB0cnVlCglpZiAoYXJndW1lbnQzKSB7CgkJZHJhd19zcHJpdGVfdGlsZWQoIGFyZ3VtZW50MCwgMCwgeHgsIHl5ICkKCX0gZWxzZSB7CgkJZHJhd19zcHJpdGUoIGFyZ3VtZW50MCwgMCwgeHgsIHl5ICk7Cgl9IC8vIGVuZCBpZgp9CgpmdW5jdGlvbiBhY3Rpb25fZHJhd19lbGxpcHNlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBkcmF3IGVsbGlwc2UKCS8vLyBAcGFyYW0geDEJeCBwb3NpdGlvbiBvZiBzdGFydCBwb2ludAoJLy8vIEBwYXJhbSB5MQl5IHBvc2l0aW9uIG9mIHN0YXJ0IHBvaW50CgkvLy8gQHBhcmFtIHgyCXggcG9zaXRpb24gb2YgZW5kIHBvaW50CgkvLy8gQHBhcmFtIHkyCXkgcG9zaXRpb24gb2YgZW5kIHBvaW50CgkvLy8gQHBhcmFtIG91dGxpbmUJdHJ1ZSBpZiBvdXRsaW5lCgkKCXZhciB4eDEgPSBhcmd1bWVudDA7Cgl2YXIgeXkxID0gYXJndW1lbnQxOwoJdmFyIHh4MiA9IGFyZ3VtZW50MjsKCXZhciB5eTIgPSBhcmd1bWVudDM7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eDEgKz0geDsKCQl5eTEgKz0geTsKCQl4eDIgKz0geDsKCQl5eTIgKz0geTsKCX0gIC8vIGVuZCBpZgoJCglkcmF3X2VsbGlwc2UoIHh4MSwgeXkxLCB4eDIsIHl5MiwgYXJndW1lbnQ0ICk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fZHJhd19lbGxpcHNlX2dyYWRpZW50KCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBkcmF3IGVsbGlwc2Ugd2l0aCBncmFkaWVudAoJLy8vIEBwYXJhbSB4MQl4IHBvc2l0aW9uIG9mIHN0YXJ0IHBvaW50CgkvLy8gQHBhcmFtIHkxCXkgcG9zaXRpb24gb2Ygc3RhcnQgcG9pbnQKCS8vLyBAcGFyYW0geDIJeCBwb3NpdGlvbiBvZiBlbmQgcG9pbnQKCS8vLyBAcGFyYW0geTIJeSBwb3NpdGlvbiBvZiBlbmQgcG9pbnQKCS8vLyBAcGFyYW0gYzEgICBjb2xvdXIgMQoJLy8vIEBwYXJhbSBjMiAgIGNvbG91ciAyCgkKCXZhciB4eDEgPSBhcmd1bWVudDA7Cgl2YXIgeXkxID0gYXJndW1lbnQxOwoJdmFyIHh4MiA9IGFyZ3VtZW50MjsKCXZhciB5eTIgPSBhcmd1bWVudDM7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eDEgKz0geDsKCQl5eTEgKz0geTsKCQl4eDIgKz0geDsKCQl5eTIgKz0geTsKCX0gIC8vIGVuZCBpZgoJCglkcmF3X2VsbGlwc2VfZXh0KCB4eDEsIHl5MSwgeHgyLCB5eTIsIGFyZ3VtZW50NCwgYXJndW1lbnQ1LCBmYWxzZSApOwoKfQoKZnVuY3Rpb24gYWN0aW9uX2RyYXdfZm9udCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZGVwcmVjYXRlZAoJc2hvd19kZWJ1Z19tZXNzYWdlKCAiYWN0aW9uX2RyYXdfZm9udCBkZXByZWNhdGVkIik7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9kcmF3X2ZvbnRfb2xkKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBkZXByZWNhdGVkCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25fZHJhd19mb250X29sZCBkZXByZWNhdGVkIik7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9kcmF3X2dyYWRpZW50X2hvcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZHJhdyBncmFkaWVudCBob3Jpem9udGFsCgkvLy8gQHBhcmFtIHgxCXggcG9zaXRpb24gb2Ygc3RhcnQgcG9pbnQKCS8vLyBAcGFyYW0geTEJeSBwb3NpdGlvbiBvZiBzdGFydCBwb2ludAoJLy8vIEBwYXJhbSB4Mgl4IHBvc2l0aW9uIG9mIGVuZCBwb2ludAoJLy8vIEBwYXJhbSB5Mgl5IHBvc2l0aW9uIG9mIGVuZCBwb2ludAoJLy8vIEBwYXJhbSBjMSAgIGNvbG91ciAxCgkvLy8gQHBhcmFtIGMyICAgY29sb3VyIDIKCQoJdmFyIHh4MSA9IGFyZ3VtZW50MDsKCXZhciB5eTEgPSBhcmd1bWVudDE7Cgl2YXIgeHgyID0gYXJndW1lbnQyOwoJdmFyIHl5MiA9IGFyZ3VtZW50MzsKCXZhciBjMSA9IGFyZ3VtZW50NDsKCXZhciBjMiA9IGFyZ3VtZW50NTsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXh4MSArPSB4OwoJCXl5MSArPSB5OwoJCXh4MiArPSB4OwoJCXl5MiArPSB5OwoJfSAgLy8gZW5kIGlmCgkKCWRyYXdfcmVjdGFuZ2xlX2V4dCggeHgxLCB5eTEsIHh4MiwgeXkyLCBjMSwgYzIsIGMyLCBjMSwgZmFsc2UgKTsKfQoKZnVuY3Rpb24gYWN0aW9uX2RyYXdfZ3JhZGllbnRfdmVydCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZHJhdyBncmFkaWVudCB2ZXJ0aWNhbAoJLy8vIEBwYXJhbSB4MQl4IHBvc2l0aW9uIG9mIHN0YXJ0IHBvaW50CgkvLy8gQHBhcmFtIHkxCXkgcG9zaXRpb24gb2Ygc3RhcnQgcG9pbnQKCS8vLyBAcGFyYW0geDIJeCBwb3NpdGlvbiBvZiBlbmQgcG9pbnQKCS8vLyBAcGFyYW0geTIJeSBwb3NpdGlvbiBvZiBlbmQgcG9pbnQKCS8vLyBAcGFyYW0gYzEgICBjb2xvdXIgMQoJLy8vIEBwYXJhbSBjMiAgIGNvbG91ciAyCgkKCXZhciB4eDEgPSBhcmd1bWVudDA7Cgl2YXIgeXkxID0gYXJndW1lbnQxOwoJdmFyIHh4MiA9IGFyZ3VtZW50MjsKCXZhciB5eTIgPSBhcmd1bWVudDM7Cgl2YXIgYzEgPSBhcmd1bWVudDQ7Cgl2YXIgYzIgPSBhcmd1bWVudDU7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eDEgKz0geDsKCQl5eTEgKz0geTsKCQl4eDIgKz0geDsKCQl5eTIgKz0geTsKCX0gIC8vIGVuZCBpZgoJCglkcmF3X3JlY3RhbmdsZV9leHQoIHh4MSwgeXkxLCB4eDIsIHl5MiwgYzEsIGMxLCBjMiwgYzIsIGZhbHNlICk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fZHJhd19oZWFsdGgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGRyYXcgaGVhbHRoCgkvLy8gQHBhcmFtIHgxCXggcG9zaXRpb24gb2Ygc3RhcnQgcG9pbnQKCS8vLyBAcGFyYW0geTEJeSBwb3NpdGlvbiBvZiBzdGFydCBwb2ludAoJLy8vIEBwYXJhbSB4Mgl4IHBvc2l0aW9uIG9mIGVuZCBwb2ludAoJLy8vIEBwYXJhbSB5Mgl5IHBvc2l0aW9uIG9mIGVuZCBwb2ludAoJLy8vIEBwYXJhbSBjMSAgIGNvbG91ciAxCgkvLy8gQHBhcmFtIGMyICAgY29sb3VyIDIKCQoJdmFyIHh4MSA9IGFyZ3VtZW50MDsKCXZhciB5eTEgPSBhcmd1bWVudDE7Cgl2YXIgeHgyID0gYXJndW1lbnQyOwoJdmFyIHl5MiA9IGFyZ3VtZW50MzsKCXZhciBjMVR5cGUgPSBhcmd1bWVudDQ7Cgl2YXIgYzJUeXBlPSBhcmd1bWVudDU7Cgl2YXIgc2hvd0JhY2sgPSBhcmd1bWVudDQ7Cgl2YXIgYzE9MCwgYzI9MCwgYzM9MDsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXh4MSArPSB4OwoJCXl5MSArPSB5OwoJCXh4MiArPSB4OwoJCXl5MiArPSB5OwoJfSAgLy8gZW5kIGlmCgkKCXN3aXRjaCggYzFUeXBlICkgewoJCWNhc2UgMDogYzE9Y19ibGFjazsgYnJlYWs7CgkJY2FzZSAxOiBjMT1jX2JsYWNrOyBicmVhazsKCQljYXNlIDI6IGMxPWNfZ3JheTsgYnJlYWs7CgkJY2FzZSAzOiBjMT1jX3NpbHZlcjsgYnJlYWs7CgkJY2FzZSA0OiBjMT1jX3doaXRlOyBicmVhazsKCQljYXNlIDU6IGMxPWNfbWFyb29uOyBicmVhazsKCQljYXNlIDY6IGMxPWNfZ3JlZW47IGJyZWFrOwoJCWNhc2UgNzogYzE9Y19vbGl2ZTsgYnJlYWs7CgkJY2FzZSA4OiBjMT1jX25hdnk7IGJyZWFrOwoJCWNhc2UgOTogYzE9Y19wdXJwbGU7IGJyZWFrOwoJCWNhc2UgMTA6IGMxPWNfdGVhbDsgYnJlYWs7CgkJY2FzZSAxMTogYzE9Y19yZWQ7IGJyZWFrOwoJCWNhc2UgMTI6IGMxPWNfbGltZTsgYnJlYWs7CgkJY2FzZSAxMzogYzE9Y195ZWxsb3c7IGJyZWFrOwoJCWNhc2UgMTQ6IGMxPWNfYmx1ZTsgYnJlYWs7CgkJY2FzZSAxNTogYzE9Y19mdWNoc2lhOyBicmVhazsKCQljYXNlIDE2OiBjMT1jX2FxdWE7IGJyZWFrOwoJfSAvLyBlbmQgc3dpdGNoCgkKCXN3aXRjaCggYzJUeXBlICkgewoJCWNhc2UgMDogeyBjMj1jX3JlZDsgYzM9Y19saW1lOyB9IGJyZWFrOwoJCWNhc2UgMTogeyBjMj1jX2JsYWNrOyBjMz1jX3doaXRlOyB9IGJyZWFrOwoJCWNhc2UgMjogYzI9Y19ibGFjazsgYnJlYWs7CgkJY2FzZSAzOiBjMj1jX2dyYXk7IGJyZWFrOwoJCWNhc2UgNDogYzI9Y19zaWx2ZXI7IGJyZWFrOwoJCWNhc2UgNTogYzI9Y193aGl0ZTsgYnJlYWs7CgkJY2FzZSA2OiBjMj1jX21hcm9vbjsgYnJlYWs7CgkJY2FzZSA3OiBjMj1jX2dyZWVuOyBicmVhazsKCQljYXNlIDg6IGMyPWNfb2xpdmU7IGJyZWFrOwoJCWNhc2UgOTogYzI9Y19uYXZ5OyBicmVhazsKCQljYXNlIDEwOiBjMj1jX3B1cnBsZTsgYnJlYWs7CgkJY2FzZSAxMTogYzI9Y190ZWFsOyBicmVhazsKCQljYXNlIDEyOiBjMj1jX3JlZDsgYnJlYWs7CgkJY2FzZSAxMzogYzI9Y19saW1lOyBicmVhazsKCQljYXNlIDE0OiBjMj1jX3llbGxvdzsgYnJlYWs7CgkJY2FzZSAxNTogYzI9Y19ibHVlOyBicmVhazsKCQljYXNlIDE2OiBjMj1jX2Z1Y2hzaWE7IGJyZWFrOwoJCWNhc2UgMTc6IGMyPWNfYXF1YTsgYnJlYWs7Cgl9IC8vIGVuZCBzd2l0Y2gKCQoJaWYgKGMyVHlwZT4xKSB7IGMzPWMyOyB9CglkcmF3X2hlYWx0aGJhciggeHgxLCB5eTEsIHh4MiwgeXkyLCBoZWFsdGgsIGMxLCBjMiwgYzMsIDAsIHNob3dCYWNrLCB0cnVlICk7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9kcmF3X2xpZmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGRyYXcgbGlmZQoJLy8vIEBwYXJhbSB4CXggcG9zaXRpb24gCgkvLy8gQHBhcmFtIHkJeSBwb3NpdGlvbiAKCS8vLyBAcGFyYW0gbXNnCW1lc3NhZ2UgdG8gZGlzcGx5IGJlZm9yZSBsaXZlcwoJCgl2YXIgeHggPSBhcmd1bWVudDA7Cgl2YXIgeXkgPSBhcmd1bWVudDE7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCQoJZHJhd190ZXh0KCB4eCwgeXksIHN0cmluZ19oYXNoX3RvX25ld2xpbmUoYXJndW1lbnQyKStzdHJpbmcobGl2ZXMpKTsKCQoKfQoKZnVuY3Rpb24gYWN0aW9uX2RyYXdfbGlmZV9pbWFnZXMoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGRyYXcgbGlmZSB3aXRoIGltYWdlcwoJLy8vIEBwYXJhbSB4CXggcG9zaXRpb24gCgkvLy8gQHBhcmFtIHkJeSBwb3NpdGlvbiAKCS8vLyBAcGFyYW0gaW5kZXggc3ByaXRlIGluZGV4IHRvIHVzZQoJCgl2YXIgeHggPSBhcmd1bWVudDA7Cgl2YXIgeXkgPSBhcmd1bWVudDE7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCQoJdmFyIHcgPSBzcHJpdGVfZ2V0X3dpZHRoKCBhcmd1bWVudDIgKTsKCWZvciggdmFyIGk9MDsgaTxsaXZlczsgKytpKSB7CgkJZHJhd19zcHJpdGUoIGFyZ3VtZW50MiwgMCwgeHgrKGkqdyksIHl5KTsKCX0gLy8gZW5kIGZvcgoJCgp9CgpmdW5jdGlvbiBhY3Rpb25fZHJhd19saW5lKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBkcmF3IGxpbmUKCS8vLyBAcGFyYW0geDEJeCBwb3NpdGlvbiBvZiBzdGFydCBwb2ludAoJLy8vIEBwYXJhbSB5MQl5IHBvc2l0aW9uIG9mIHN0YXJ0IHBvaW50CgkvLy8gQHBhcmFtIHgyCXggcG9zaXRpb24gb2YgZW5kIHBvaW50CgkvLy8gQHBhcmFtIHkyCXkgcG9zaXRpb24gb2YgZW5kIHBvaW50Cgl2YXIgeHgxID0gYXJndW1lbnQwOwoJdmFyIHl5MSA9IGFyZ3VtZW50MTsKCXZhciB4eDIgPSBhcmd1bWVudDI7Cgl2YXIgeXkyID0gYXJndW1lbnQzOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJeHgxICs9IHg7CgkJeXkxICs9IHk7CgkJeHgyICs9IHg7CgkJeXkyICs9IHk7Cgl9ICAvLyBlbmQgaWYKCQoJZHJhd19saW5lKCB4eDEsIHl5MSwgeHgyLCB5eTIgKTsKfQoKZnVuY3Rpb24gYWN0aW9uX2RyYXdfcmVjdGFuZ2xlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBkcmF3IHJlY3RhbmdsZQoJLy8vIEBwYXJhbSB4MQl4IHBvc2l0aW9uIG9mIHN0YXJ0IHBvaW50CgkvLy8gQHBhcmFtIHkxCXkgcG9zaXRpb24gb2Ygc3RhcnQgcG9pbnQKCS8vLyBAcGFyYW0geDIJeCBwb3NpdGlvbiBvZiBlbmQgcG9pbnQKCS8vLyBAcGFyYW0geTIJeSBwb3NpdGlvbiBvZiBlbmQgcG9pbnQKCS8vLyBAcGFyYW0gb3V0bGluZQl0cnVlIGlmIG91dGxpbmUKCQoJdmFyIHh4MSA9IGFyZ3VtZW50MDsKCXZhciB5eTEgPSBhcmd1bWVudDE7Cgl2YXIgeHgyID0gYXJndW1lbnQyOwoJdmFyIHl5MiA9IGFyZ3VtZW50MzsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXh4MSArPSB4OwoJCXl5MSArPSB5OwoJCXh4MiArPSB4OwoJCXl5MiArPSB5OwoJfSAgLy8gZW5kIGlmCgkKCWRyYXdfcmVjdGFuZ2xlKCB4eDEsIHl5MSwgeHgyLCB5eTIsIGFyZ3VtZW50NCApOwp9CgpmdW5jdGlvbiBhY3Rpb25fZHJhd19zY29yZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZHJhdyBzY29yZQoJLy8vIEBwYXJhbSB4CXggcG9zaXRpb24gCgkvLy8gQHBhcmFtIHkJeSBwb3NpdGlvbiAKCS8vLyBAcGFyYW0gbXNnCW1lc3NhZ2UgdG8gZGlzcGxheSBiZWZvcmUgc2NvcmUKCQoJdmFyIHh4ID0gYXJndW1lbnQwOwoJdmFyIHl5ID0gYXJndW1lbnQxOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJeHggKz0geDsKCQl5eSArPSB5OwoJfSAgLy8gZW5kIGlmCgkKCWRyYXdfdGV4dCggeHgsIHl5LCBzdHJpbmdfaGFzaF90b19uZXdsaW5lKGFyZ3VtZW50Mikrc3RyaW5nKHNjb3JlKSk7CgkKCn0KCmZ1bmN0aW9uIGFjdGlvbl9kcmF3X3Nwcml0ZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZHJhdyBzcHJpdGUKCS8vLyBAcGFyYW0gaW5kZXgJc3ByaXRlIGluZGV4CgkvLy8gQHBhcmFtIHgJeCBwb3NpdGlvbiAKCS8vLyBAcGFyYW0geQl5IHBvc2l0aW9uIAoJLy8vIEBwYXJhbSBzdWJpbWcJc3ViIGltYWdlIG51bWJlcgoJCgl2YXIgaW5kZXggPWFyZ3VtZW50MDsKCXZhciB4eCA9IGFyZ3VtZW50MTsKCXZhciB5eSA9IGFyZ3VtZW50MjsKCXZhciBzdWJpbWcgPSBhcmd1bWVudDM7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCWlmIChzdWJpbWc8MCkgc3ViaW1nPWltYWdlX2luZGV4OwoJZHJhd19zcHJpdGUoaW5kZXgsc3ViaW1nLCB4eCwgeXkpOwoJCgp9CgpmdW5jdGlvbiBhY3Rpb25fZHJhd190ZXh0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBkcmF3IHRleHQKCS8vLyBAcGFyYW0gbXNnCXRleHQgdG8gZGlzcGxheQoJLy8vIEBwYXJhbSB4CXggcG9zaXRpb24gCgkvLy8gQHBhcmFtIHkJeSBwb3NpdGlvbiAKCQoJdmFyIG1zZyA9YXJndW1lbnQwOwoJdmFyIHh4ID0gYXJndW1lbnQxOwoJdmFyIHl5ID0gYXJndW1lbnQyOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJeHggKz0geDsKCQl5eSArPSB5OwoJfSAgLy8gZW5kIGlmCglkcmF3X3RleHQoIHh4LCB5eSwgc3RyaW5nX2hhc2hfdG9fbmV3bGluZShtc2cpKTsKfQoKZnVuY3Rpb24gYWN0aW9uX2RyYXdfdGV4dF90cmFuc2Zvcm1lZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZHJhdyB0ZXh0IHRyYW5zZm9ybWVkCgkvLy8gQHBhcmFtIG1zZwl0ZXh0IHRvIGRpc3BsYXkKCS8vLyBAcGFyYW0geAl4IHBvc2l0aW9uIAoJLy8vIEBwYXJhbSB5CXkgcG9zaXRpb24gCgkvLy8gQHBhcmFtIHhzY2FsZQl4IHNjYWxlCgkvLy8gQHBhcmFtIHlzY2FsZQl5IHNjYWxlCgkvLy8gQHBhcmFtIGFuZ2xlCWFuZ2xlCgkKCXZhciBtc2cgPSBhcmd1bWVudDA7Cgl2YXIgeHggPSBhcmd1bWVudDE7Cgl2YXIgeXkgPSBhcmd1bWVudDI7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCWRyYXdfdGV4dF90cmFuc2Zvcm1lZCggeHgsIHl5LCBzdHJpbmdfaGFzaF90b19uZXdsaW5lKG1zZyksIGFyZ3VtZW50MywgYXJndW1lbnQ0LCBhcmd1bWVudDUgKTsKfQoKZnVuY3Rpb24gYWN0aW9uX2RyYXdfdmFyaWFibGUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGRyYXcgdmFyaWFibGUKCS8vLyBAcGFyYW0gdiAgICB2YXJpYWJsZSB0byBkaXNwbGF5CgkvLy8gQHBhcmFtIHgJeCBwb3NpdGlvbiAKCS8vLyBAcGFyYW0geQl5IHBvc2l0aW9uIAoJCgl2YXIgeHggPSBhcmd1bWVudDE7Cgl2YXIgeXkgPSBhcmd1bWVudDI7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCWRyYXdfdGV4dCggeHgsIHl5LCBzdHJpbmdfaGFzaF90b19uZXdsaW5lKHN0cmluZyhhcmd1bWVudDApKSk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fZWZmZWN0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBjcmVhdGUgYSBwYXJ0aWNsZSBlZmZlY3QKCS8vLyBAcGFyYW0ga2luZCBwYXJ0aWNsZSBraW5kCgkvLy8gQHBhcmFtIHgJeCBwb3NpdGlvbiAKCS8vLyBAcGFyYW0geQl5IHBvc2l0aW9uIAoJLy8vIEBwYXJhbSBzaXplCXNpemUKCS8vLyBAcGFyYW0gY29sCWNvbG91cgoJLy8vIEBwYXJhbSBiZWxvdyB0cnVlIGlmIGJlbG93LCBmYWxzZSBpZiBhYm92ZQoJCgl2YXIgeHggPSBhcmd1bWVudDE7Cgl2YXIgeXkgPSBhcmd1bWVudDI7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCQoJCglpZiAoYXJndW1lbnQ1KSB7CgkJZWZmZWN0X2NyZWF0ZV9iZWxvdyggYXJndW1lbnQwLCB4eCwgeXksIGFyZ3VtZW50MywgYXJndW1lbnQ0ICk7Cgl9IGVsc2UgewkKCQllZmZlY3RfY3JlYXRlX2Fib3ZlKCBhcmd1bWVudDAsIHh4LCB5eSwgYXJndW1lbnQzLCBhcmd1bWVudDQgKTsKCX0gLy8gZW5kIGlmCn0KCmZ1bmN0aW9uIGFjdGlvbl9lbmRfZ2FtZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZW5kIHRoZSBnYW1lCglnYW1lX2VuZCgpOwp9CgpmdW5jdGlvbiBhY3Rpb25fZW5kX3NvdW5kKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBlbmQgdGhlIHNvdW5kCgkvLy8gQHBhcmFtIHNvdW5kaWQgc291bmQgaWQKCWF1ZGlvX3N0b3Bfc291bmQoIGFyZ3VtZW50MCApOwp9CgpmdW5jdGlvbiBhY3Rpb25fZXhlY3V0ZV9zY3JpcHQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGV4ZWN1dGUgc2NyaXB0CglzY3JpcHRfZXhlY3V0ZSggYXJndW1lbnRbMF0sIGFyZ3VtZW50WzFdLCBhcmd1bWVudFsyXSwgYXJndW1lbnRbM10sIGFyZ3VtZW50WzRdICk7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9maWxsX2NvbG9yKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBmaWxsIGNvbG9yCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25fZmlsbF9jb2xvciBpcyBkZXByZWNhdGVkIik7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fZmlsbF9jb2xvdXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGZpbGwgY29sb3VyCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25fZmlsbF9jb2xvdXIgaXMgZGVwcmVjYXRlZCIpOwp9CgpmdW5jdGlvbiBhY3Rpb25fZm9udCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc2V0IHRoZSBmb250IGFuZCBob3Jpem9udGFsIGFsaWdubWVudAoJLy8vIEBwYXJhbSBmb250aWQJZm9udCBpZAoJLy8vIEBwYXJhbSBoYWxpZ2ggICBob3Jpem9udGFsIGFsaWdubWVudAoJZHJhd19zZXRfZm9udCggYXJndW1lbnQwICk7CglkcmF3X3NldF9oYWxpZ24oIGFyZ3VtZW50MSApOwp9CgpmdW5jdGlvbiBhY3Rpb25fZnVsbHNjcmVlbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZnVsbHNjcmVlbgoJLy8vIEBwYXJhbSB0eXBlIHR5cGUgb2YgZnVsbHNjcmVlbiAoMSA9PSBub3QgZnVsbHNjcmVlbiwgMiA9PSBmdWxsc2NyZWVuLCBhbnl0aGluZyBlbHNlIGNoYW5nZSB3aGF0IHlvdSBhcmUgKQoJc3dpdGNoKCBhcmd1bWVudDAgKSB7CgljYXNlIDE6IAoJCXdpbmRvd19zZXRfZnVsbHNjcmVlbiggdHJ1ZSApOyAKCQlicmVhazsKCWNhc2UgMjogCgkJd2luZG93X3NldF9mdWxsc2NyZWVuKCBmYWxzZSApOyAKCQlicmVhazsKCWRlZmF1bHQ6CgkJd2luZG93X3NldF9mdWxsc2NyZWVuKCB3aW5kb3dfZ2V0X2Z1bGxzY3JlZW4oKSA/IGZhbHNlIDogdHJ1ZSApOwoJCWJyZWFrOwoJfSAvLyBlbmQgc3dpdGNoCgp9CgpmdW5jdGlvbiBhY3Rpb25faGlnaHNjb3JlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBoaWdoc2NvcmUgKGRlcHJlY2F0ZWQpCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25faGlnaHNjb3JlIGlzIGRlcHJlY2F0ZWQiKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9oaWdoc2NvcmVfY2xlYXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGhpZ2hzY29yZSBjbGVhcgoJaGlnaHNjb3JlX2NsZWFyKCk7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9oaWdoc2NvcmVfc2hvdygpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gaGlnaHNjb3JlIHNob3cKCXZhciBydyA9IHJvb21fd2lkdGgoKTsKCXZhciByaCA9IHJvb21faGVpZ2h0KCk7Cgl2YXIgeHggPSBydy8yIC0gMTAwOwoJdmFyIHl5ID0gcmgvMiAtIDEwMAoJZHJhd19oaWdoc2NvcmUoIHh4LCB5eSwgeHgrMjAwLCB5eSsyMDAgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9pZigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gaWYgZXZhbHVhdGlvbgoJcmV0dXJuIGFyZ3VtZW50MDsKfQoKZnVuY3Rpb24gYWN0aW9uX2lmX2FsaWduZWQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGlmIGFsaWduZWQgZXZhdWF0aW9uCgkvLy8gQHBhcmFtIHh4RyAJeCBhbGlnbm1lbnQgdmFsdWUKCS8vLyBAcGFyYW0geXlHIAl5IGFsaWdubWVudCB2YWx1ZQoJdmFyIHh4RyA9IGFyZ3VtZW50MDsKCXZhciB5eUcgPSBhcmd1bWVudDE7Cgl2YXIgcmV0ID0gZmFsc2U7CglpZiAoKHh4Rz4wKSAmJiAoKHggJSB4eEcpPT0wKSAmJiAoeXlHPjApICYmICgoeSAlIHl5Ryk9PTApKSB7CgkJcmV0ID0gdHJ1ZTsKCX0gLy8gZW5kIGlmCglyZXR1cm4gcmV0OwoKfQoKZnVuY3Rpb24gYWN0aW9uX2lmX2NvbGxpc2lvbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gaWYgY29sbGlzaW9uIGV2YXVhdGlvbgoJLy8vIEBwYXJhbSB4eEcgCXggdmFsdWUKCS8vLyBAcGFyYW0geXlHIAl5IHZhbHVlCgkvLy8gQHBhcmFtIGZsYWcgZmFsc2UgZm9yIGZyZWUsIHRydWUgZm9yIGVtcHR5IGNoZWNrCgl2YXIgeHggPSBhcmd1bWVudDA7Cgl2YXIgeXkgPSBhcmd1bWVudDE7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCQoJaWYgKGFyZ3VtZW50MikgewoJCXJldHVybiAhcGxhY2VfZW1wdHkoIHh4LCB5eSk7Cgl9IGVsc2UgewoJCXJldHVybiAhcGxhY2VfZnJlZSggeHgsIHl5ICk7Cgl9IC8vIGVuZCBpZgoKfQoKZnVuY3Rpb24gYWN0aW9uX2lmX2RpY2UoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGlmIGRpY2UgZXZhdWF0aW9uCgkvLy8gQHBhcmFtIHYgbnVtYmVyIG9mIHNpZGVzIG9mIHRoZSBkaWNlCgl2YXIgcmV0ID0gdHJ1ZTsKCXZhciB2ID0gYXJndW1lbnQwOwoJaWYgKHYgPiAxKSB7CgkJcmV0ID0gcmFuZG9tKCAxMDAwKnYgKSA8PSAxMDAwOwoJfSAvLyBlbmRpZgoJcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gYWN0aW9uX2lmX2VtcHR5KCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBpZiBlbXB0eSBldmF1YXRpb24KCS8vLyBAcGFyYW0geHgJeCB2YWx1ZQoJLy8vIEBwYXJhbSB5eSAJeSB2YWx1ZQoJLy8vIEBwYXJhbSBmbGFnIHRydWUgZm9yIGVtcHR5LCBmYWxzZSBmb3IgZnJlZSBjaGVjawoJdmFyIHh4ID0gYXJndW1lbnQwOwoJdmFyIHl5ID0gYXJndW1lbnQxOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJeHggKz0geDsKCQl5eSArPSB5OwoJfSAgLy8gZW5kIGlmCgkKCWlmIChhcmd1bWVudDIpIHsKCQlyZXR1cm4gcGxhY2VfZW1wdHkoIHh4LCB5eSApOwoJfSBlbHNlIHsKCQlyZXR1cm4gcGxhY2VfZnJlZSggeHgsIHl5KTsKCX0gLy8gZW5kIGlmCgp9CgpmdW5jdGlvbiBhY3Rpb25faWZfaGVhbHRoKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBpZiBoZWFsdGggZXZhdWF0aW9uCgkvLy8gQHBhcmFtIHZhbCAgdmFsdWUgdG8gY2hlY2sgYWdhaW5zdAoJLy8vIEBwYXJhbSB0eXBlCXR5cGUgb2YgY2hlY2sgKDE9PTwsIDI9PT4sIGFueXRoaW5nIGVsc2UgaXMgPT0pCgl2YXIgcmV0ID0gZmFsc2U7Cglzd2l0Y2goIGFyZ3VtZW50MSApCgl7CgkJY2FzZSAxOglyZXQgPSAoaGVhbHRoIDwgYXJndW1lbnQwKTsgYnJlYWs7CQoJCWNhc2UgMjoJcmV0ID0gKGhlYWx0aCA+IGFyZ3VtZW50MCk7IGJyZWFrOwkKCQlkZWZhdWx0OnJldCA9IChoZWFsdGggPT0gYXJndW1lbnQwKTsgYnJlYWs7CQoJfQoJcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gYWN0aW9uX2lmX2xpZmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGlmIGxpZmUgZXZhdWF0aW9uCgkvLyBAcGFyYW0gdmFsICB2YWx1ZSB0byBjaGVjayBhZ2FpbnN0CgkvLy8gQHBhcmFtIHR5cGUJdHlwZSBvZiBjaGVjayAoMT09PCwgMj09PiwgYW55dGhpbmcgZWxzZSBpcyA9PSkKCXZhciByZXQgPSBmYWxzZTsKCXN3aXRjaCggYXJndW1lbnQxICkKCXsKCQljYXNlIDE6CXJldCA9IChsaXZlcyA8IGFyZ3VtZW50MCk7IGJyZWFrOwkKCQljYXNlIDI6CXJldCA9IChsaXZlcyA+IGFyZ3VtZW50MCk7IGJyZWFrOwkKCQlkZWZhdWx0OnJldCA9IChsaXZlcyA9PSBhcmd1bWVudDApOyBicmVhazsJCgl9CglyZXR1cm4gcmV0Owp9CgpmdW5jdGlvbiBhY3Rpb25faWZfbW91c2UoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGlmIG1vdXNlIGV2YXVhdGlvbgoJLy8vIEBwYXJhbSBidXR0b24JYnV0dG9uIHRvIGNoZWNrCgl2YXIgcmV0ID0gbW91c2VfYnV0dG9uX2Rvd24oYXJndW1lbnQwKSB8fCBtb3VzZV9idXR0b25fcmVsZWFzZWQoYXJndW1lbnQwKTsKCXN3aXRjaCggYXJndW1lbnQwICkKCXsKCQljYXNlIDE6CQoJCWNhc2UgMjoJCgkJY2FzZSAzOgoJCQlyZXQgPSBtb3VzZV9idXR0b25fZG93bihhcmd1bWVudDApIHx8IG1vdXNlX2J1dHRvbl9yZWxlYXNlZChhcmd1bWVudDApOwoJCQlicmVhazsKCQlkZWZhdWx0OgoJCQlyZXQgPSAobW91c2VfYnV0dG9uID09IDApOwoJCQlicmVhazsJCgl9IC8vIGVuZCBzd2l0Y2gKCXJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9pZl9uZXh0X3Jvb20oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGlmIG5leHQgcm9vbSBldmF1YXRpb24KCXJldHVybiAocm9vbSAhPSByb29tX2xhc3QpOwp9CgpmdW5jdGlvbiBhY3Rpb25faWZfbnVtYmVyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBpZiBudW1iZXIgZXZhdWF0aW9uCgkvLy8gQHBhcmFtIGluZGV4ICBpbnN0YW5jZSBpbmRleCB0byBjaGVjayBhZ2FpbnN0CgkvLy8gQHBhcmFtIHZhbHVlIHZhbHVlIHRvIGNvbXBhcmUgYWdhaW5zdAoJLy8vIEBwYXJhbSB0eXBlCXR5cGUgb2YgY2hlY2sgKDE9PTwsIDI9PT4sIGFueXRoaW5nIGVsc2UgaXMgPT0pCgl2YXIgcmV0ID0gZmFsc2U7Cgl2YXIgbiA9IGluc3RhbmNlX251bWJlcihhcmd1bWVudDApOwoJc3dpdGNoKCBhcmd1bWVudDIgKQoJewoJCWNhc2UgMToJcmV0ID0gKG4gPCBhcmd1bWVudDEpOyBicmVhazsJCgkJY2FzZSAyOglyZXQgPSAobiA+IGFyZ3VtZW50MSk7IGJyZWFrOwkKCQlkZWZhdWx0OnJldCA9IChuID09IGFyZ3VtZW50MSk7IGJyZWFrOwkKCX0KCXJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9pZl9vYmplY3QoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGlmIG9iamVjdCBldmF1YXRpb24KCS8vLyBAcGFyYW0geHggCXggdmFsdWUKCS8vLyBAcGFyYW0geXkgCXkgdmFsdWUKCS8vLyBAcGFyYW0gZmxhZyBmYWxzZSBmb3IgZnJlZSwgdHJ1ZSBmb3IgZW1wdHkgY2hlY2sKCXZhciB4eCA9IGFyZ3VtZW50MTsKCXZhciB5eSA9IGFyZ3VtZW50MjsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXh4ICs9IHg7CgkJeXkgKz0geTsKCX0gIC8vIGVuZCBpZgoJCglyZXR1cm4gcGxhY2VfbWVldGluZyggeHgsIHl5LCBhcmd1bWVudDApOwoKfQoKZnVuY3Rpb24gYWN0aW9uX2lmX3ByZXZpb3VzX3Jvb20oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGlmIG5leHQgcm9vbSBldmF1YXRpb24KCXJldHVybiAocm9vbSAhPSByb29tX2ZpcnN0KTsKfQoKZnVuY3Rpb24gYWN0aW9uX2lmX3F1ZXN0aW9uKCkKewoJLy8gaW5zZXJ0IGNvZGUgaGVyZSAKCXZhciByZXQgPSBzaG93X3F1ZXN0aW9uKCBhcmd1bWVudDAgKTsKCWlvX2NsZWFyKCk7CglyZXR1cm4gcmV0Owp9CgpmdW5jdGlvbiBhY3Rpb25faWZfc2NvcmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGlmIHNjb3JlIGV2YXVhdGlvbgoJLy8vIEBwYXJhbSB2YWwgIHZhbHVlIHRvIGNoZWNrIGFnYWluc3QKCS8vLyBAcGFyYW0gdHlwZQl0eXBlIG9mIGNoZWNrICgxPT08LCAyPT0+LCBhbnl0aGluZyBlbHNlIGlzID09KQoJdmFyIHJldCA9IGZhbHNlOwoJc3dpdGNoKCBhcmd1bWVudDEgKQoJewoJCWNhc2UgMToJcmV0ID0gKHNjb3JlIDwgYXJndW1lbnQwKTsgYnJlYWs7CQoJCWNhc2UgMjoJcmV0ID0gKHNjb3JlID4gYXJndW1lbnQwKTsgYnJlYWs7CQoJCWRlZmF1bHQ6cmV0ID0gKHNjb3JlID09IGFyZ3VtZW50MCk7IGJyZWFrOwkKCX0KCXJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9pZl9zb3VuZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gaWYgc291bmQgZXZhdWF0aW9uCgkvLy8gQHBhcmFtIGluZGV4IHNvdW5kIGluZGV4IHRvIGNoZWNrCglyZXR1cm4gYXVkaW9faXNfcGxheWluZyggYXJndW1lbnQwICk7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9pZl92YXJpYWJsZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gaWYgdmFyaWFibGUgZXZhdWF0aW9uCgkvLy8gQHBhcmFtIHZhbDEgIHZhbHVlIHRvIGNoZWNrIGFnYWluc3QKCS8vLyBAcGFyYW0gdmFsMiAgdmFsdWUyIHRvIGNoZWNrIGFnYWluc3QKCS8vLyBAcGFyYW0gdHlwZQl0eXBlIG9mIGNoZWNrICgxPT0nPCcsIDI9PSc+JywgMz09Jzw9JywgND09Jz49J2FueXRoaW5nIGVsc2UgaXMgPT0pCgl2YXIgcmV0ID0gZmFsc2U7Cglzd2l0Y2goIGFyZ3VtZW50MiApCgl7CgkJY2FzZSAxOglyZXQgPSAoYXJndW1lbnQwIDwgYXJndW1lbnQxKTsgYnJlYWs7CQoJCWNhc2UgMjoJcmV0ID0gKGFyZ3VtZW50MCA+IGFyZ3VtZW50MSk7IGJyZWFrOwkKCQljYXNlIDM6CXJldCA9IChhcmd1bWVudDAgPD0gYXJndW1lbnQxKTsgYnJlYWs7CQoJCWNhc2UgNDoJcmV0ID0gKGFyZ3VtZW50MCA+PSBhcmd1bWVudDEpOyBicmVhazsJCgkJZGVmYXVsdDpyZXQgPSAoYXJndW1lbnQwID09IGFyZ3VtZW50MSk7IGJyZWFrOwkKCX0KCXJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9pbmhlcml0ZWQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBlcmZvcm0gdGhlIGluaGVyaXRlZCBldmVudAoJZXZlbnRfaW5oZXJpdGVkKCk7CgkKCn0KCmZ1bmN0aW9uIGFjdGlvbl9raWxsX29iamVjdCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gZGVzdHJveSB0aGUgc2VsZiBvYmplY3QKCWluc3RhbmNlX2Rlc3Ryb3koKTsKfQoKZnVuY3Rpb24gYWN0aW9uX2tpbGxfcG9zaXRpb24oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGRlc3Ryb3kgaW5zdGFuY2VzIGF0IHBvc2l0aW9uCgkvLy8gQHBhcmFtIHgJeCBwb3NpdGlvbiAKCS8vLyBAcGFyYW0geQl5IHBvc2l0aW9uIAoJCgl2YXIgeHggPSBhcmd1bWVudDA7Cgl2YXIgeXkgPSBhcmd1bWVudDE7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCXBvc2l0aW9uX2Rlc3Ryb3koIHh4LCB5eSApOwp9CgpmdW5jdGlvbiBhY3Rpb25fbGluZWFyX3N0ZXAoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGxpbmVhciBzdGVwCgkvLy8gQHBhcmFtIHgJeCBwb3NpdGlvbiAKCS8vLyBAcGFyYW0geQl5IHBvc2l0aW9uIAoJLy8vIEBwYXJhbSBzcGVlZAlzcGVlZAoJLy8vIEBwYXJhbSBjaGVja2FsbAl0cnVlIGlmIGNoZWNraW5nIGFsbAoJCgl2YXIgeHggPSBhcmd1bWVudDA7Cgl2YXIgeXkgPSBhcmd1bWVudDE7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl4eCArPSB4OwoJCXl5ICs9IHk7Cgl9ICAvLyBlbmQgaWYKCW1wX2xpbmVhcl9zdGVwKCB4eCwgeXksIGFyZ3VtZW50MiwgYXJndW1lbnQzICk7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9saW5lX2NvbG9yKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBsaW5lIGNvbG9yCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25fbGluZV9jb2xvciBpcyBkZXByZWNhdGVkIik7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fbGluZV9jb2xvdXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIGxpbmUgY29sb3VyCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25fbGluZV9jb2xvdXIgaXMgZGVwcmVjYXRlZCIpOwoKfQoKZnVuY3Rpb24gYWN0aW9uX2xvYWRfZ2FtZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gbG9hZCBhIGdhbWUKCS8vLyBAcGFyYW0gZmlsZW5hbWUgZmlsZW5hbWUKCWdhbWVfbG9hZCggYXJndW1lbnQwICk7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9tZXNzYWdlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzaG93IGEgbWVzc2FnZSBpbiBhIGRpYWxvZyBib3gKCS8vLyBAcGFyYW0gbXNnIG1lc3NhZ2UKCXNob3dfbWVzc2FnZSggYXJndW1lbnQwICk7Cglpb19jbGVhcigpOwp9CgpmdW5jdGlvbiBhY3Rpb25fbW92ZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gbW92ZSB0aGUgY3VycmVudCBpbnN0YW5jZSBpbiBhIGRpcmVjdGlvbgoJLy8vIEBwYXJhbSBkaXIgc3RyaW5nIG9mIDAncyBhbmQgMSdzIHRoYXQgaW5kaWNhdGVzIGEgdmFsaWQgZGlyZWN0aW9uCgkvLy8gQHBhcmFtIHNwZWVkIHNwZWVkIHRvIG1vdmUKCWlmIChhcmd1bWVudDAgPT0gIjAwMDAwMDAwMCIpIHJldHVybjsKCQoJdmFyIHNwZCA9IGFyZ3VtZW50MTsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXNwZCArPSBzcGVlZDsKCX0gIC8vIGVuZCBpZgoJCglzcGVlZCA9IHNwZDsKCQoJLy8gZmluZCBhIHZhbGlkIGRpcmVjdGlvbgoJdmFyIGQgPSBpcmFuZG9tKDkpOwoJd2hpbGUoIHN0cmluZ19jaGFyX2F0KGFyZ3VtZW50MCwgZCsxKSAhPSAiMSIgKSB7CgkJZCA9IGlyYW5kb20oOSk7Cgl9IC8vIGVuZCB3aGlsZQoJCglzd2l0Y2goZCkKCXsKCQljYXNlIDA6IGRpcmVjdGlvbiA9IDIyNTsgYnJlYWs7CgkJY2FzZSAxOiBkaXJlY3Rpb24gPSAyNzA7IGJyZWFrOwoJCWNhc2UgMjogZGlyZWN0aW9uID0gMzE1OyBicmVhazsKCQljYXNlIDM6IGRpcmVjdGlvbiA9IDE4MDsgYnJlYWs7CgkJY2FzZSA0OiBkaXJlY3Rpb24gPSAwOyBzcGVlZCA9IDA7IGJyZWFrOwoJCWNhc2UgNTogZGlyZWN0aW9uID0gMDsgYnJlYWs7CgkJY2FzZSA2OiBkaXJlY3Rpb24gPSAxMzU7IGJyZWFrOwoJCWNhc2UgNzogZGlyZWN0aW9uID0gOTA7IGJyZWFrOwoJCWNhc2UgODogZGlyZWN0aW9uID0gNDU7IGJyZWFrOwoJfQoKfQoKZnVuY3Rpb24gYWN0aW9uX21vdmVfY29udGFjdCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gbW92ZSB0aGUgY3VycmVudCBpbnN0YW5jZSB1bnRpbCBjb250YWN0CgkvLy8gQHBhcmFtIGRpciBkaXJlY3Rpb24KCS8vLyBAcGFyYW0gbWF4ZGlzdCBtYXhpbXVtIGRpc3RhbmNlCgkvLy8gQHBhcmFtIHVzZWFsbCB0cnVlIGlmIHVzaW5nIGFsbAoJaWYgKGFyZ3VtZW50MikgewoJCW1vdmVfY29udGFjdF9hbGwoIGFyZ3VtZW50MCwgYXJndW1lbnQxICk7Cgl9IGVsc2UgewoJCW1vdmVfY29udGFjdF9zb2xpZCggYXJndW1lbnQwLCBhcmd1bWVudDEgKTsKCX0KCQoKfQoKZnVuY3Rpb24gYWN0aW9uX21vdmVfcG9pbnQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIG1vdmUgdG93YXJkcyBwb2ludAoJLy8vIEBwYXJhbSB4CXggcG9zaXRpb24gCgkvLy8gQHBhcmFtIHkJeSBwb3NpdGlvbiAKCS8vLyBAcGFyYW0gc3BlZWQJc3BlZWQKCQoJdmFyIHh4ID0gYXJndW1lbnQwOwoJdmFyIHl5ID0gYXJndW1lbnQxOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJeHggKz0geDsKCQl5eSArPSB5OwoJfSAgLy8gZW5kIGlmCgltb3ZlX3Rvd2FyZHNfcG9pbnQoIHh4LCB5eSwgYXJndW1lbnQyKTsKfQoKZnVuY3Rpb24gYWN0aW9uX21vdmVfcmFuZG9tKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBtb3ZlIHJhbmRvbQoJLy8vIEBwYXJhbSB4CXggZ3JpZAoJLy8vIEBwYXJhbSB5CXkgZ3JpZAoJCgl2YXIgeG1pbj0wLCB4bWF4PXJvb21fd2lkdGg7Cgl2YXIgeW1pbj0wLCB5bWF4PXJvb21faGVpZ2h0OwoJaWYgKHNwcml0ZV9leGlzdHMoc3ByaXRlX2luZGV4KSB8fCBzcHJpdGVfZXhpc3RzKG1hc2tfaW5kZXgpKSB7CgkJeG1pbiA9IHJvdW5kKHggLSBiYm94X2xlZnQpOwoJCXhtYXggPSByb3VuZCh4bWF4ICsgeCAtIGJib3hfcmlnaHQpOwoJCXltaW4gPSByb3VuZCh5IC0gYmJveF90b3ApOwoJCXltYXggPSByb3VuZCh5bWF4ICsgeSAtIGJib3hfYm90dG9tKTsKCX0KCQoJdmFyIHN4ID0gYXJndW1lbnQwOwoJdmFyIHN5ID0gYXJndW1lbnQxOwoJZm9yKCB2YXIgaT0wOyBpPDEwMDsgKytpKSB7CgkJdmFyIHh4ID0geG1pbiArIGlyYW5kb20oIHhtYXgteG1pbiApOwoJCWlmIChzeCA+IDApIHh4ID0gc3ggKiBmbG9vcih4eC9zeCk7CgkJdmFyIHl5ID0geW1pbiArIGlyYW5kb20oIHltYXggLSB5bWluICk7CgkJaWYgKHN5ID4gMCkgeXkgPSBzeSAqIGZsb29yKHl5L3N5KTsKCQlpZiAocGxhY2VfZnJlZSggeHgsIHl5KSkgewoJCQl4ID0geHg7CgkJCXkgPSB5eTsKCQkJcmV0dXJuOwoJCX0gLy8gZW5kIGlmCgl9IC8vIGVuZCBmb3IKCn0KCmZ1bmN0aW9uIGFjdGlvbl9tb3ZlX3N0YXJ0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBtb3ZlIHN0YXJ0Cgl4ID0geHN0YXJ0OwoJeSA9IHlzdGFydDsKCQoKfQoKZnVuY3Rpb24gYWN0aW9uX21vdmVfdG8oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIG1vdmUgdG8KCS8vLyBAcGFyYW0geAl4IHBvc2l0aW9uIAoJLy8vIEBwYXJhbSB5CXkgcG9zaXRpb24gCgkKCXZhciB4eCA9IGFyZ3VtZW50MDsKCXZhciB5eSA9IGFyZ3VtZW50MTsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXh4ICs9IHg7CgkJeXkgKz0geTsKCX0gIC8vIGVuZCBpZgoJeCA9IHh4OwoJeSA9IHl5Owp9CgpmdW5jdGlvbiBhY3Rpb25fbmV4dF9yb29tKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBuZXh0IHJvb20KCXJvb21fZ290b19uZXh0KCk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fcGFydGVtaXRfYnVyc3QoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhcnRpY2xlIHN5c3RlbSBlbWl0dGVyIGJ1cnN0CgkvLy8gQHBhcmFtIGluZGV4IGVtaXR0ZXIgaW5kZXgKCS8vLyBAcGFyYW0gcHR5cGUgcGFydGljbGUgdHlwZQoJLy8vIEBwYXJhbSBudW0gbnVtYmVyCgkKCWlmIChnbG9iYWwuX19wYXJ0X3N5c3QgPCAwKSB7IGdsb2JhbC5fX3BhcnRfc3lzdCA9IHBhcnRfc3lzdGVtX2NyZWF0ZSgpOyB9Cgl2YXIgaW5kZXggPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fcGFydF9lbWl0W2luZGV4XSA8IDApIHsKCQlzaG93X21lc3NhZ2UoICJUaGUgcGFydGljbGUgZW1pdHRlciBtdXN0IGZpcnN0IGJlIGNyZWF0ZWQiICk7CgkJcmV0dXJuOwoJfSAvLyBlbmQgaWYKCXZhciBwdHlwZSA9IGFyZ3VtZW50MTsKCXZhciBudW0gPSBhcmd1bWVudDI7CglwYXJ0X2VtaXR0ZXJfYnVyc3QoZ2xvYmFsLl9fcGFydF9zeXN0LCAgZ2xvYmFsLl9fcGFydF9lbWl0W2luZGV4XSwgcHR5cGUsIG51bSApCn0KCmZ1bmN0aW9uIGFjdGlvbl9wYXJ0ZW1pdF9jcmVhdGUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhcnRpY2xlIHN5c3RlbSBlbWl0dGVyIGNyZWF0ZSBpbiBhIHJlZ2lvbgoJLy8vIEBwYXJhbSBpbmRleCBlbWl0dGVyIGluZGV4CgkvLy8gQHBhcmFtIHNoYXBlIHNoYXBlIHRvIHVzZQoJLy8vIEBwYXJhbSB4TWluCXggbWluCgkvLy8gQHBhcmFtIHhNYXgJeCBtYXgKCS8vLyBAcGFyYW0geU1pbgl5IG1pbgoJLy8vIEBwYXJhbSB5TWF4CXkgbWF4CglpZiAoZ2xvYmFsLl9fcGFydF9zeXN0IDwgMCkgeyBnbG9iYWwuX19wYXJ0X3N5c3QgPSBwYXJ0X3N5c3RlbV9jcmVhdGUoKTsgfQoJdmFyIGluZGV4ID0gYXJndW1lbnQwOwoJaWYgKGdsb2JhbC5fX3BhcnRfZW1pdFtpbmRleF0gPCAwKSB7CgkJZ2xvYmFsLl9fcGFydF9lbWl0W2luZGV4XSA9IHBhcnRfZW1pdHRlcl9jcmVhdGUoZ2xvYmFsLl9fcGFydF9zeXN0KTsKCX0gLy8gZW5kIGlmCglwYXJ0X2VtaXR0ZXJfcmVnaW9uKCBnbG9iYWwuX19wYXJ0X3N5c3QsIGdsb2JhbC5fX3BhcnRfZW1pdFtpbmRleF0sIGFyZ3VtZW50MiwgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSwgYXJndW1lbnQxLCAwKTsKfQoKZnVuY3Rpb24gYWN0aW9uX3BhcnRlbWl0X2Rlc3Ryb3koKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhcnRpY2xlIHN5c3RlbSBlbWl0dGVyIGRlc3Ryb3kKCS8vLyBAcGFyYW0gaW5kZXggZW1pdHRlciBpbmRleAoJaWYgKGdsb2JhbC5fX3BhcnRfc3lzdCA8IDApIHsgZ2xvYmFsLl9fcGFydF9zeXN0ID0gcGFydF9zeXN0ZW1fY3JlYXRlKCk7IH0KCXZhciBpbmRleCA9IGFyZ3VtZW50MDsKCWlmIChnbG9iYWwuX19wYXJ0X2VtaXRbaW5kZXhdIDwgMCkgewoJCXJldHVybjsKCX0gLy8gZW5kIGlmCglwYXJ0X2VtaXR0ZXJfZGVzdHJveSggZ2xvYmFsLl9fcGFydF9zeXN0LCBnbG9iYWwuX19wYXJ0X2VtaXRbaW5kZXhdKTsKfQoKZnVuY3Rpb24gYWN0aW9uX3BhcnRlbWl0X3N0cmVhbSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcGFydGljbGUgc3lzdGVtIGVtaXR0ZXIgc3RyZWFtCgkvLy8gQHBhcmFtIGluZGV4IGVtaXR0ZXIgaW5kZXgKCS8vLyBAcGFyYW0gcHR5cGUgcGFydGljbGUgdHlwZQoJLy8vIEBwYXJhbSBudW0gbnVtYmVyCglpZiAoZ2xvYmFsLl9fcGFydF9zeXN0IDwgMCkgeyBnbG9iYWwuX19wYXJ0X3N5c3QgPSBwYXJ0X3N5c3RlbV9jcmVhdGUoKTsgfQoJdmFyIGluZGV4ID0gYXJndW1lbnQwOwoJaWYgKGdsb2JhbC5fX3BhcnRfZW1pdFtpbmRleF0gPCAwKSB7CgkJc2hvd19tZXNzYWdlKCAiVGhlIHBhcnRpY2xlIGVtaXR0ZXIgbXVzdCBmaXJzdCBiZSBjcmVhdGVkIiApOwoJCXJldHVybjsKCX0gLy8gZW5kIGlmCgl2YXIgcHR5cGUgPSBhcmd1bWVudDE7Cgl2YXIgbnVtID0gYXJndW1lbnQyOwoJcGFydF9lbWl0dGVyX3N0cmVhbShnbG9iYWwuX19wYXJ0X3N5c3QsICBnbG9iYWwuX19wYXJ0X2VtaXRbaW5kZXhdLCBwdHlwZSwgbnVtICkKfQoKZnVuY3Rpb24gYWN0aW9uX3BhcnRzeXN0X2NsZWFyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBwYXJ0aWNsZSBzeXN0ZW0gY2xlYXIKCWlmIChnbG9iYWwuX19wYXJ0X3N5c3QgPj0gMCkgeyAKCQlwYXJ0X3N5c3RlbV9jbGVhciggZ2xvYmFsLl9fcGFydF9zeXN0ICk7IAoJfQoKfQoKZnVuY3Rpb24gYWN0aW9uX3BhcnRzeXN0X2NyZWF0ZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcGFydGljbGUgc3lzdGVtIGNyZWF0ZQoJLy8vIEBwYXJhbSBkZXB0aCAKCWlmIChnbG9iYWwuX19wYXJ0X3N5c3QgPCAwKSB7IGdsb2JhbC5fX3BhcnRfc3lzdCA9IHBhcnRfc3lzdGVtX2NyZWF0ZSgpOyB9CglwYXJ0X3N5c3RlbV9jbGVhcihnbG9iYWwuX19wYXJ0X3N5c3QpOwoJcGFydF9zeXN0ZW1fZGVwdGgoZ2xvYmFsLl9fcGFydF9zeXN0LCBhcmd1bWVudDApOwoJZm9yKCB2YXIgaT0wOyBpPD0xNTsgKytpKSB7CgkJZ2xvYmFsLl9fcGFydF90eXBlW2ldID0gLTE7CgkJZ2xvYmFsLl9fcGFydF9lbWl0W2ldID0gLTE7Cgl9IC8vIGVuZCBmb3IKCn0KCmZ1bmN0aW9uIGFjdGlvbl9wYXJ0c3lzdF9kZXN0cm95KCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBwYXJ0aWNsZSBzeXN0ZW0gZGVzdHJveQoJaWYgKGdsb2JhbC5fX3BhcnRfc3lzdCA+PSAwKSB7IAoJCXBhcnRfc3lzdGVtX2Rlc3Ryb3koZ2xvYmFsLl9fcGFydF9zeXN0KTsKCX0KCWdsb2JhbC5fX3BhcnRfc3lzdCA9IC0xOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3BhcnR0eXBlX2NvbG9yKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBwYXJ0aWNsZSB0eXBlIHNldCBjb2xvcgoJLy8vIEBwYXJhbSBpbmRleCB0eXBlIGluZGV4CgkvLy8gQHBhcmFtIHR5cGUgcGFydGljbGUgdHlwZQoJLy8vIEBwYXJhbSBjb2wxIGNvbG91ciAxCgkvLy8gQHBhcmFtIGNvbDIgY29sb3VyIDIKCS8vLyBAcGFyYW0gYWxwaGExIGFscGhhIDEKCS8vLyBAcGFyYW0gYWxwaGEyIGFscGhhIDIKCWlmIChnbG9iYWwuX19wYXJ0X3N5c3QgPCAwKSB7IGdsb2JhbC5fX3BhcnRfc3lzdCA9IHBhcnRfc3lzdGVtX2NyZWF0ZSgpOyB9Cgl2YXIgaW5kZXggPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSA8IDApIHsKCQlnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdID0gcGFydF90eXBlX2NyZWF0ZSgpOwoJfSAvLyBlbmQgaWYKCWlmIChhcmd1bWVudDEgPT0gMCkgewoJCXBhcnRfdHlwZV9jb2xvcl9taXgoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSwgYXJndW1lbnQyLCBhcmd1bWVudDMpOwoJfSBlbHNlIHsKCQlwYXJ0X3R5cGVfY29sb3IyKGdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0sIGFyZ3VtZW50MiwgYXJndW1lbnQzKTsKCX0KCXBhcnRfdHlwZV9hbHBoYTIoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSwgYXJndW1lbnQ0LCBhcmd1bWVudDUgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9wYXJ0dHlwZV9jb2xvdXIoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhcnRpY2xlIHR5cGUgc2V0IGNvbG91cgoJLy8vIEBwYXJhbSBpbmRleCB0eXBlIGluZGV4CgkvLy8gQHBhcmFtIHR5cGUgcGFydGljbGUgdHlwZQoJLy8vIEBwYXJhbSBjb2wxIGNvbG91ciAxCgkvLy8gQHBhcmFtIGNvbDIgY29sb3VyIDIKCS8vLyBAcGFyYW0gYWxwaGExIGFscGhhIDEKCS8vLyBAcGFyYW0gYWxwaGEyIGFscGhhIDIKCWlmIChnbG9iYWwuX19wYXJ0X3N5c3QgPCAwKSB7IGdsb2JhbC5fX3BhcnRfc3lzdCA9IHBhcnRfc3lzdGVtX2NyZWF0ZSgpOyB9Cgl2YXIgaW5kZXggPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSA8IDApIHsKCQlnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdID0gcGFydF90eXBlX2NyZWF0ZSgpOwoJfSAvLyBlbmQgaWYKCWlmIChhcmd1bWVudDEgPT0gMCkgewoJCXBhcnRfdHlwZV9jb2xvdXJfbWl4KGdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0sIGFyZ3VtZW50MiwgYXJndW1lbnQzKTsKCX0gZWxzZSB7CgkJcGFydF90eXBlX2NvbG91cjIoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSwgYXJndW1lbnQyLCBhcmd1bWVudDMpOwoJfQoJcGFydF90eXBlX2FscGhhMihnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdLCBhcmd1bWVudDQsIGFyZ3VtZW50NSApOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3BhcnR0eXBlX2NyZWF0ZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcGFydGljbGUgdHlwZSBjcmVhdGUKCS8vLyBAcGFyYW0gaW5kZXggdHlwZSBpbmRleAoJLy8vIEBwYXJhbSBzaGFwZQoJLy8vIEBwYXJhbSBzcHJpdGUgc3ByaXRlIGluZGV4CgkvLy8gQHBhcmFtIHNpemVNaW4gbWluaW11bSBzaXplCgkvLy8gQHBhcmFtIHNpemVNYXggbWF4aW11bSBzaXplCgkvLy8gQHBhcmFtIHNpemVJbmNyIHNpemUgaW5jcmVtZW50cwoJaWYgKGdsb2JhbC5fX3BhcnRfc3lzdCA8IDApIHsgZ2xvYmFsLl9fcGFydF9zeXN0ID0gcGFydF9zeXN0ZW1fY3JlYXRlKCk7IH0KCXZhciBpbmRleCA9IGFyZ3VtZW50MDsKCWlmIChnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdIDwgMCkgewoJCWdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0gPSBwYXJ0X3R5cGVfY3JlYXRlKCk7Cgl9IC8vIGVuZCBpZgoJcGFydF90eXBlX3NoYXBlKGdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0sIGFyZ3VtZW50MSApOwoJcGFydF90eXBlX3Nwcml0ZShnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdLCBhcmd1bWVudDIsIHRydWUsIGZhbHNlLCBmYWxzZSApOwoJcGFydF90eXBlX3NpemUoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSwgYXJndW1lbnQzLCBhcmd1bWVudDQsIGFyZ3VtZW50NSwgMCApOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3BhcnR0eXBlX2NyZWF0ZV9vbGQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhcnRpY2xlIHR5cGUgY3JlYXRlIChvbGRlciB2ZXJzaW9uKQoJLy8vIEBwYXJhbSBpbmRleCB0eXBlIGluZGV4CgkvLy8gQHBhcmFtIHNoYXBlCgkvLy8gQHBhcmFtIHNpemVNaW4gbWluaW11bSBzaXplCgkvLy8gQHBhcmFtIHNpemVNYXggbWF4aW11bSBzaXplCgkvLy8gQHBhcmFtIGNvbFN0YXJ0IGNvbG91ciBhdCBzdGFydAoJLy8vIEBwYXJhbSBjb2xFbmQgY29sb3VyIGF0IGVuZAoJaWYgKGdsb2JhbC5fX3BhcnRfc3lzdCA8IDApIHsgZ2xvYmFsLl9fcGFydF9zeXN0ID0gcGFydF9zeXN0ZW1fY3JlYXRlKCk7IH0KCXZhciBpbmRleCA9IGFyZ3VtZW50MDsKCWlmIChnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdIDwgMCkgewoJCWdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0gPSBwYXJ0X3R5cGVfY3JlYXRlKCk7Cgl9IC8vIGVuZCBpZgoJcGFydF90eXBlX3NoYXBlKGdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0sIGFyZ3VtZW50MSApOwoJcGFydF90eXBlX3NpemUoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSwgYXJndW1lbnQyLCBhcmd1bWVudDMsIDAsIDAgKTsKCXBhcnRfdHlwZV9jb2xvdXIyKGdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0sIGFyZ3VtZW50NCwgYXJndW1lbnQ1ICk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fcGFydHR5cGVfZ3Jhdml0eSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcGFydGljbGUgdHlwZSBncmF2aXR5CgkvLy8gQHBhcmFtIGluZGV4IHR5cGUgaW5kZXgKCS8vLyBAcGFyYW0gZ3Jhdml0eSBtYWduaXR1ZGUgb2YgZ3Jhdml0eQoJLy8vIEBwYXJhbSBkaXJlY3Rpb24gZGlyZWN0aW9uIG9mIGdyYXZpdHkKCWlmIChnbG9iYWwuX19wYXJ0X3N5c3QgPCAwKSB7IGdsb2JhbC5fX3BhcnRfc3lzdCA9IHBhcnRfc3lzdGVtX2NyZWF0ZSgpOyB9Cgl2YXIgaW5kZXggPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSA8IDApIHsKCQlnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdID0gcGFydF90eXBlX2NyZWF0ZSgpOwoJfSAvLyBlbmQgaWYKCXBhcnRfdHlwZV9ncmF2aXR5KGdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0sIGFyZ3VtZW50MSwgYXJndW1lbnQyICk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fcGFydHR5cGVfbGlmZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcGFydGljbGUgdHlwZSBsaWZlCgkvLy8gQHBhcmFtIGluZGV4IHR5cGUgaW5kZXgKCS8vLyBAcGFyYW0gbGlmZU1pbiBtaW5pbXVtIGxpZmV0aW1lCgkvLy8gQHBhcmFtIGxpZmVNYXggbWF4aW11bSBsaWZldGltZQoJaWYgKGdsb2JhbC5fX3BhcnRfc3lzdCA8IDApIHsgZ2xvYmFsLl9fcGFydF9zeXN0ID0gcGFydF9zeXN0ZW1fY3JlYXRlKCk7IH0KCXZhciBpbmRleCA9IGFyZ3VtZW50MDsKCWlmIChnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdIDwgMCkgewoJCWdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0gPSBwYXJ0X3R5cGVfY3JlYXRlKCk7Cgl9IC8vIGVuZCBpZgoJcGFydF90eXBlX2xpZmUoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSwgYXJndW1lbnQxLCBhcmd1bWVudDIgKTsKfQoKZnVuY3Rpb24gYWN0aW9uX3BhcnR0eXBlX3NlY29uZGFyeSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcGFydGljbGUgdHlwZSBzZWNvbmRhcnkKCS8vLyBAcGFyYW0gaW5kZXggdHlwZSBpbmRleAoJLy8vIEBwYXJhbSBzdGVwVHlwZQoJLy8vIEBwYXJhbSBzdGVwTnVtYmVyIAoJLy8vIEBwYXJhbSBkZWF0aFR5cGUKCS8vLyBAcGFyYW0gZGVhdGhOdW1iZXIKCWlmIChnbG9iYWwuX19wYXJ0X3N5c3QgPCAwKSB7IGdsb2JhbC5fX3BhcnRfc3lzdCA9IHBhcnRfc3lzdGVtX2NyZWF0ZSgpOyB9Cgl2YXIgaW5kZXggPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSA8IDApIHsKCQlnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdID0gcGFydF90eXBlX2NyZWF0ZSgpOwoJfSAvLyBlbmQgaWYKCXBhcnRfdHlwZV9zdGVwKGdsb2JhbC5fX3BhcnRfdHlwZVtpbmRleF0sIGFyZ3VtZW50MiwgZ2xvYmFsLl9fcGFydF90eXBlW2FyZ3VtZW50MV0gKTsKCXBhcnRfdHlwZV9kZWF0aChnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdLCBhcmd1bWVudDQsIGdsb2JhbC5fX3BhcnRfdHlwZVthcmd1bWVudDNdICk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fcGFydHR5cGVfc3BlZWQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhcnRpY2xlIHR5cGUgc3BlZWQKCS8vLyBAcGFyYW0gaW5kZXggdHlwZSBpbmRleAoJLy8vIEBwYXJhbSBzcGVlZE1pbgoJLy8vIEBwYXJhbSBzcGVlZE1heAoJLy8vIEBwYXJhbSBkaXJNaW4KCS8vLyBAcGFyYW0gZGlyTWF4CgkvLy8gQHBhcmFtIHN0ZXBJbmMKCWlmIChnbG9iYWwuX19wYXJ0X3N5c3QgPCAwKSB7IGdsb2JhbC5fX3BhcnRfc3lzdCA9IHBhcnRfc3lzdGVtX2NyZWF0ZSgpOyB9Cgl2YXIgaW5kZXggPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fcGFydF90eXBlW2luZGV4XSA8IDApIHsKCQlnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdID0gcGFydF90eXBlX2NyZWF0ZSgpOwoJfSAvLyBlbmQgaWYKCXBhcnRfdHlwZV9zcGVlZChnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdLCBhcmd1bWVudDEsIGFyZ3VtZW50MiwgLWFyZ3VtZW50NSwgMCApOwoJcGFydF90eXBlX2RpcmVjdGlvbihnbG9iYWwuX19wYXJ0X3R5cGVbaW5kZXhdLCBhcmd1bWVudDMsIGFyZ3VtZW50NCwgMCwgMCApOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3BhdGgoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhdGggc3RhcnQKCS8vLyBAcGFyYW0gaW5kZXggcGF0aCBpbmRleAoJLy8vIEBwYXJhbSBzcGVlZAoJLy8vIEBwYXJhbSBlbmRBY3QKCS8vLyBAcGFyYW0gcmVsYXRpdmUKCXBhdGhfc3RhcnQoIGFyZ3VtZW50MCwgYXJndW1lbnQxLCBhcmd1bWVudDIsIGFyZ3VtZW50MyApOwp9CgpmdW5jdGlvbiBhY3Rpb25fcGF0aF9lbmQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhdGggZW5kCglwYXRoX2VuZCgpOwp9CgpmdW5jdGlvbiBhY3Rpb25fcGF0aF9vbGQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHBhdGggb2xkCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25fcGF0aF9vbGQgaXMgZGVwcmVjYXRlZCIpOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3BhdGhfcG9zaXRpb24oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCBwYXRoIHBvc2l0aW9uCgkvLy8gQHBhcmFtIHBvc2l0aW9uIG5ldyBwb3NpdGlvbgoJdmFyIHBvcyA9IGFyZ3VtZW50MDsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXBvcyArPSBwYXRoX3Bvc2l0aW9uOwoJfSAgLy8gZW5kIGlmCglwYXRoX3Bvc2l0aW9uID0gcG9zOwp9CgpmdW5jdGlvbiBhY3Rpb25fcGF0aF9zcGVlZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc2V0IHBhdGggc3BlZWQKCS8vLyBAcGFyYW0gc3BlZWQgbmV3IHNwZWVkCgl2YXIgc3BkID0gYXJndW1lbnQwOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJc3BkICs9IHBhdGhfc3BlZWQ7Cgl9ICAvLyBlbmQgaWYKCXBhdGhfc3BlZWQgPSBzcGQ7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9wb3RlbnRpYWxfc3RlcCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcG90ZW50aWFsIHN0ZXAKCS8vLyBAcGFyYW0geAl4IHBvc2l0aW9uIAoJLy8vIEBwYXJhbSB5CXkgcG9zaXRpb24gCgkvLy8gQHBhcmFtIHNwZWVkCXNwZWVkCgkvLy8gQHBhcmFtIGNoZWNrYWxsCXRydWUgaWYgY2hlY2tpbmcgYWxsCgkKCXZhciB4eCA9IGFyZ3VtZW50MDsKCXZhciB5eSA9IGFyZ3VtZW50MTsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXh4ICs9IHg7CgkJeXkgKz0geTsKCX0gIC8vIGVuZCBpZgoJbXBfcG90ZW50aWFsX3N0ZXAoIHh4LCB5eSwgYXJndW1lbnQyLCBhcmd1bWVudDMgKTsKfQoKZnVuY3Rpb24gYWN0aW9uX3ByZXZpb3VzX3Jvb20oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHByZXZpb3VzIHJvb20KCXJvb21fZ290b19wcmV2aW91cygpOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3JlcGxhY2VfYmFja2dyb3VuZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcmVwbGFjZSBiYWNrZ3JvdW5kCgkvLy8gQHBhcmFtIGluZGV4IHNwcml0ZSBpbmRleAoJLy8vIEBwYXJhbSBmaWxlbmFtZSBmaWxlbmFtZSB0byByZXBsYWNlCgkvL3Nwcml0ZV9yZXBsYWNlKCBhcmd1bWVudDAsIGFyZ3VtZW50MSApOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3JlcGxhY2Vfc291bmQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHJlcGxhY2Ugc291bmQgKGRlcHJlY2F0ZWQpCgkvLy8gQHBhcmFtIGluZGV4IHNvdW5kIGluZGV4CgkvLy8gQHBhcmFtIGZpbGVuYW1lIGZpbGVuYW1lIHRvIHJlcGxhY2UKCXNob3dfZGVidWdfbWVzc2FnZSggImFjdGlvbl9yZXBsYWNlX3NvdW5kIGlzIGRlcHJlY2F0ZWQiKQoKfQoKZnVuY3Rpb24gYWN0aW9uX3JlcGxhY2Vfc3ByaXRlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSByZXBsYWNlIHNwcml0ZQoJLy8vIEBwYXJhbSBpbmRleCBzcHJpdGUgaW5kZXgKCS8vLyBAcGFyYW0gZmlsZW5hbWUgZmlsZW5hbWUgdG8gcmVwbGFjZQoJLy9zcHJpdGVfcmVwbGFjZSggYXJndW1lbnQwLCBhcmd1bWVudDEgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9yZXN0YXJ0X2dhbWUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHJlc3RhcnQgZ2FtZQoJZ2FtZV9yZXN0YXJ0KCk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fcmV2ZXJzZV94ZGlyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSByZXZlcnNlIHggZGlyZWN0aW9uCgloc3BlZWQgPSAtaHNwZWVkOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3JldmVyc2VfeWRpcigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcmV2ZXJzZSB5IGRpcmVjdGlvbgoJdnNwZWVkID0gLXZzcGVlZDsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zYXZlX2dhbWUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNhdmUgZ2FtZQoJLy8vIEBwYXJhbSBmaWxlbmFtZSBmaWxlbmFtZSB0byBzYXZlIHRvCglnYW1lX3NhdmUoIGFyZ3VtZW50MCApOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3NldF9hbGFybSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc2V0IGFsYXJtCgkvLy8gQHBhcmFtIGluZGV4IGFsYXJtIGluZGV4CgkvLy8gQHBhcmFtIHZhbCB2YWx1ZSB0byBzZXQgdG8KCWFsYXJtX3NldCggYXJndW1lbnQxLCBhcmd1bWVudDAgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zZXRfY2FwdGlvbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc2V0IGNhcHRpb24KCS8vLyBAcGFyYW0gZW5hYmxlU2NvcmVDYXB0aW9uCXRydWUgaWYgc2NvcmUgY2FwdGlvbiBlbmFibGVkCgkvLy8gQHBhcmFtIFNjb3JlQ2FwdGlvbgltZXNzYWdlIG9mIHNjb3JlIGNhcHRpb24KCS8vLyBAcGFyYW0gZW5hYmxlTGl2ZXNDYXB0aW9uCXRydWUgaWYgbGl2ZXMgY2FwdGlvbiBlbmFibGVkCgkvLy8gQHBhcmFtIExpdmVzQ2FwdGlvbgltZXNzYWdlIG9mIGxpdmVzIGNhcHRpb24KCS8vLyBAcGFyYW0gZW5hYmxlSGVhbHRoQ2FwdGlvbgl0cnVlIGlmIGhlYWx0aCBjYXB0aW9uIGVuYWJsZWQKCS8vLyBAcGFyYW0gSGVhbHRoQ2FwdGlvbgltZXNzYWdlIG9mIGhlYWx0aCBjYXB0aW9uCglzaG93X3Njb3JlID0gYXJndW1lbnQwOwoJY2FwdGlvbl9zY29yZSA9IGFyZ3VtZW50MTsKCXNob3dfbGl2ZXMgPSBhcmd1bWVudDI7CgljYXB0aW9uX2xpdmVzID0gYXJndW1lbnQzOwoJc2hvd19oZWFsdGggPSBhcmd1bWVudDQ7CgljYXB0aW9uX2hlYWx0aCA9IGFyZ3VtZW50NTsKfQoKZnVuY3Rpb24gYWN0aW9uX3NldF9jdXJzb3IoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCBjdXJzb3IKCS8vLyBAcGFyYW0gc3BySW5kZXggc3ByaXRlIGluZGV4IHRvIHVzZSBmb3IgY3Vyc29yCgkvLy8gQHBhcmFtIHNob3dDdXJzb3IgdHJ1ZSBpZiBjdXJzb3IgdG8gYmUgc2hvd2luCgljdXJzb3Jfc3ByaXRlID0gYXJndW1lbnQwOwoJaWYgKGFyZ3VtZW50MSkgewoJCXdpbmRvd19zZXRfY3Vyc29yKCAwICk7Cgl9IGVsc2UgewoJCXdpbmRvd19zZXRfY3Vyc29yKCAtMSApOwoJfSAvLyBlbmQgaWYKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zZXRfZnJpY3Rpb24oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCBmcmljdGlvbgoJLy8vIEBwYXJhbSB2YWwgdmFsdWUgdG8gc2V0IGZyaWN0aW9uCgl2YXIgdmFsID0gYXJndW1lbnQwOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJdmFsICs9IGZyaWN0aW9uOwoJfSAgLy8gZW5kIGlmCglmcmljdGlvbiA9IHZhbDsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zZXRfZ3Jhdml0eSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc2V0IGdyYXZpdHkKCS8vLyBAcGFyYW0gZGlyIGRpcmVjdGlvbiBmb3IgZ3Jhdml0eQoJLy8vIEBwYXJhbSB2YWwgdmFsdWUgdG8gc2V0IGdyYXZpdHkKCXZhciBkaXIgPSBhcmd1bWVudDA7Cgl2YXIgdmFsID0gYXJndW1lbnQxOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJZGlyICs9IGdyYXZpdHlfZGlyZWN0aW9uOwoJCXZhbCArPSBncmF2aXR5OwoJfSAgLy8gZW5kIGlmCglncmF2aXR5ID0gdmFsOwoJZ3Jhdml0eV9kaXJlY3Rpb24gPSBkaXI7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fc2V0X2hlYWx0aCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc2V0IGhlYWx0aAoJLy8vIEBwYXJhbSB2YWwgdmFsdWUgdG8gc2V0IGhlYWx0aAoJdmFyIHZhbCA9IGFyZ3VtZW50MDsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXZhbCArPSBoZWFsdGg7Cgl9ICAvLyBlbmQgaWYKCWhlYWx0aCA9IHZhbDsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zZXRfaHNwZWVkKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzZXQgaHNwZWVkCgkvLy8gQHBhcmFtIHZhbCB2YWx1ZSB0byBzZXQgaHNwZWVkCgl2YXIgdmFsID0gYXJndW1lbnQwOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJdmFsICs9IGhzcGVlZDsKCX0gIC8vIGVuZCBpZgoJaHNwZWVkID0gdmFsOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3NldF9saWZlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzZXQgbGl2ZXMKCS8vLyBAcGFyYW0gdmFsIHZhbHVlIHRvIHNldCBsaXZlcwoJdmFyIHZhbCA9IGFyZ3VtZW50MDsKCWlmIChnbG9iYWwuX19hcmd1bWVudF9yZWxhdGl2ZSkgewoJCXZhbCArPSBsaXZlczsKCX0gIC8vIGVuZCBpZgoJbGl2ZXMgPSB2YWw7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fc2V0X21vdGlvbigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc2V0IG1vdGlvbgoJLy8vIEBwYXJhbSBkaXIgZGlyZWN0aW9uCgkvLy8gQHBhcmFtIHNwZCBzcGVlZAoJdmFyIGRpciA9IGFyZ3VtZW50MDsKCXZhciBzcGQgPSBhcmd1bWVudDE7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQlkaXIgKz0gZGlyZWN0aW9uOwoJCXNwZCArPSBzcGVlZDsKCX0gIC8vIGVuZCBpZgoJZGlyZWN0aW9uID0gZGlyOwoJc3BlZWQgPSBzcGQ7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fc2V0X3JlbGF0aXZlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzZXQgYXJndW1lbnQgcmVsYXRpdmUKCS8vLyBAcGFyYW0gdmFsIHZhbHVlIHRvIHNldCBhcmd1bWVudCByZWxhdGl2ZSB2YXJpYWJsZQoJZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUgPSBhcmd1bWVudDA7CgkKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zZXRfc2NvcmUoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCBzY29yZQoJLy8vIEBwYXJhbSB2YWwgdmFsdWUgdG8gc2V0IHNjb3JlCgl2YXIgdmFsID0gYXJndW1lbnQwOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJdmFsICs9IHNjb3JlOwoJfSAgLy8gZW5kIGlmCglzY29yZSA9IHZhbDsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zZXRfc3ByaXRlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzZXQgc3ByaXRlCgkvLy8gQHBhcmFtIGluZGV4IHNwcml0ZSBpbmRleAoJLy8vIEBwYXJhbSBzY2FsZSBzY2FsZQoJaW1hZ2VfaW5kZXggPSBhcmd1bWVudDA7CglpZiAoYXJndW1lbnQxID4gMCkgewoJCWltYWdlX3hzY2FsZSA9IGFyZ3VtZW50MTsJCgkJaW1hZ2VfeXNjYWxlID0gYXJndW1lbnQxOwkKCX0gLy8gZW5kIGlmCgp9CgpmdW5jdGlvbiBhY3Rpb25fc2V0X3RpbWVsaW5lKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzZXQgdGltZWxpbmUKCS8vLyBAcGFyYW0gaW5kZXggc3ByaXRlIGluZGV4CgkvLy8gQHBhcmFtIHBvcyAgdGltZWxpbmUgcG9zaXRpb24KCXRpbWVsaW5lX2luZGV4ID0gYXJndW1lbnQwOwoJdGltZWxpbmVfcG9zaXRpb24gPSBhcmd1bWVudDE7Cgl0aW1lbGluZV9ydW5uaW5nID0gdHJ1ZTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zZXRfdGltZWxpbmVfcG9zaXRpb24oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCB0aW1lbGluZSBwb3NpdGlvbgoJLy8vIEBwYXJhbSBwb3MgIHRpbWVsaW5lIHBvc2l0aW9uCgl2YXIgdmFsID0gYXJndW1lbnQwOwoJaWYgKGdsb2JhbC5fX2FyZ3VtZW50X3JlbGF0aXZlKSB7CgkJdmFsICs9IHRpbWVsaW5lX3Bvc2l0aW9uOwoJfSAgLy8gZW5kIGlmCgl0aW1lbGluZV9wb3NpdGlvbiA9IHZhbDsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zZXRfdGltZWxpbmVfc3BlZWQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCB0aW1lbGluZSBzcGVlZAoJLy8vIEBwYXJhbSB2YWwgdGltZWxpbmUgc3BlZWQKCXZhciB2YWwgPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl2YWwgKz0gdGltZWxpbmVfc3BlZWQ7Cgl9ICAvLyBlbmQgaWYKCXRpbWVsaW5lX3NwZWVkID0gdmFsOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3NldF92c3BlZWQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCB2c3BlZWQKCS8vLyBAcGFyYW0gdmFsIHZhbHVlIHRvIHNldCB2c3BlZWQKCXZhciB2YWwgPSBhcmd1bWVudDA7CglpZiAoZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmUpIHsKCQl2YWwgKz0gdnNwZWVkOwoJfSAgLy8gZW5kIGlmCgl2c3BlZWQgPSB2YWw7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fc2hvd19pbmZvKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzaG93IGluZm8gKGRlcHJlY2F0ZWQpCglpb19jbGVhcigpOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3Nob3dfdmlkZW8oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNob3cgdmlkZW8gKGRlcHJlY2F0ZWQpCglpb19jbGVhcigpOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3NsZWVwKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzbGVlcCAoZGVwcmVjYXRlZCkKCXNsZWVwKCBhcmd1bWVudDAgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zbmFwKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBtb3ZlIHNuYXAKCS8vLyBAcGFyYW0gaHNuYXAgaG9yaXpvbnRhbCBzbmFwIHZhbHVlCgkvLy8gQHBhcmFtIHZzbmFwIHZlcnRpY2FsIHNuYXAgdmFsdWUKCW1vdmVfc25hcCggYXJndW1lbnQwLCBhcmd1bWVudDEgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zbmFwc2hvdCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc25hcHNob3QKCS8vLyBAcGFyYW0gZmlsZW5hbWUgZmlsZW5hbWUgZm9yIHNhdmUgZmlsZQoJc3VyZmFjZV9zYXZlKCBhcHBsaWNhdGlvbl9zdXJmYWNlLCBhcmd1bWVudDAgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zb3VuZCgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gcGxheSBzb3VuZAoJLy8vIEBwYXJhbSBpbmRleCBzb3VuZCBpbmRleAoJLy8vIEBwYXJhbSBsb29wIHRydWUgaWYgcGxheWluZyBhIGxvb3AKCWF1ZGlvX3BsYXlfc291bmQoIGFyZ3VtZW50MCwgMSwgYXJndW1lbnQxICk7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fc3BsYXNoX3dlYigpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gYWN0aW9uIHNwbGFzaCB3ZWIgKGRlcHJlY2F0ZWQpCglzaG93X2RlYnVnX21lc3NhZ2UoICJhY3Rpb25fc3BsYXNoX3dlYiBpcyBkZXByZWNhdGVkIik7Cn0KCmZ1bmN0aW9uIGFjdGlvbl9zcHJpdGVfY29sb3IoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCBzcHJpdGUgY29sb3IgKGFuZCBhbHBoYSkKCS8vLyBAcGFyYW0gY29sb3IgY29sb3IKCS8vLyBAcGFyYW0gYWxwaGEgYWxwaGEKCWltYWdlX2JsZW5kID0gYXJndW1lbnQwOwoJaW1hZ2VfYWxwaGEgPSBhcmd1bWVudDE7CgkKCn0KCmZ1bmN0aW9uIGFjdGlvbl9zcHJpdGVfY29sb3VyKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzZXQgc3ByaXRlIGNvbG91ciAoYW5kIGFscGhhKQoJLy8vIEBwYXJhbSBjb2xvdXIgY29sb3VyCgkvLy8gQHBhcmFtIGFscGhhIGFscGhhCglpbWFnZV9ibGVuZCA9IGFyZ3VtZW50MDsKCWltYWdlX2FscGhhID0gYXJndW1lbnQxOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3Nwcml0ZV9zZXQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCBzcHJpdGUgc2V0CgkvLy8gQHBhcmFtIGluZGV4IHNwcml0ZSBpbmRleAoJLy8vIEBwYXJhbSBpbWFnZSBpbWFnZSBudW1iZXIKCS8vLyBAcGFyYW0gc3BlZWQgaW1hZ2Ugc3BlZWQKCXNwcml0ZV9pbmRleCA9IGFyZ3VtZW50MDsKCWlmIChhcmd1bWVudDEgPj0gMCkgaW1hZ2VfaW5kZXggPSBhcmd1bWVudDE7CglpbWFnZV9zcGVlZCA9IGFyZ3VtZW50MjsKfQoKZnVuY3Rpb24gYWN0aW9uX3Nwcml0ZV90cmFuc2Zvcm0oKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCBzcHJpdGUgdHJhbnNmb3JtCgkvLy8gQHBhcmFtIHNjYWxlWCB4IHNjYWxlIG9mIHNwcml0ZQoJLy8vIEBwYXJhbSBzY2FsZVkgeSBzY2FsZSBvZiBzcHJpdGUKCS8vLyBAcGFyYW0gYW5nbGUgYW5nbGUgb2Ygc3ByaXRlCgkvLy8gQHBhcmFtIHRoaXJkID8/Pz8gcXVhZHJhbnQgPz8/PwoJaW1hZ2VfeHNjYWxlID0gYXJndW1lbnQwOwoJaW1hZ2VfeXNjYWxlID0gYXJndW1lbnQxOwoJaW1hZ2VfYW5nbGUgPSBhcmd1bWVudDI7CglpZiAoKGFyZ3VtZW50MyA9PSAxKSB8fCAoYXJndW1lbnQzID09IDMpKSBpbWFnZV94c2NhbGU9LWltYWdlX3hzY2FsZTsKCWlmICgoYXJndW1lbnQzID09IDIpIHx8IChhcmd1bWVudDMgPT0gMykpIGltYWdlX3lzY2FsZT0taW1hZ2VfeXNjYWxlOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3RpbWVsaW5lX3BhdXNlKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzZXQgdGltZWxpbmUgcGF1c2UKCXRpbWVsaW5lX3J1bm5pbmcgPSBmYWxzZTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl90aW1lbGluZV9zZXQoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCB0aW1lbGluZQoJLy8vIEBwYXJhbSBpbmRleCB0aW1lbGluZSBpbmRleAoJLy8vIEBwYXJhbSBwb3MgdGltZWxpbmUgcG9zaXRpb24KCS8vLyBAcGFyYW0gcnVubmluZyB0aW1lbGluZSBydW5uaW5nICgwL2ZhbHNlID0geWVzKQoJLy8vIEBwYXJhbSBsb29wIHRpbWVsaW5lIGxvb3BpbmcgKHRydWUgPSB5ZXMpCgl0aW1lbGluZV9pbmRleCA9IGFyZ3VtZW50MDsKCXRpbWVsaW5lX3Bvc2l0aW9uID0gYXJndW1lbnQxOwoJdGltZWxpbmVfcnVubmluZyA9ICFhcmd1bWVudDI7Cgl0aW1lbGluZV9sb29wID0gYXJndW1lbnQzOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3RpbWVsaW5lX3N0YXJ0KCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBzZXQgdGltZWxpbmUgc3RhcnQKCXRpbWVsaW5lX3J1bm5pbmcgPSB0cnVlOwoKfQoKZnVuY3Rpb24gYWN0aW9uX3RpbWVsaW5lX3N0b3AoKQp7CgkvLy8gQGRlc2NyaXB0aW9uIChPbGQgRG5EKSAtIHNldCB0aW1lbGluZSBzdG9wCgl0aW1lbGluZV9wb3NpdGlvbiA9IDA7Cgl0aW1lbGluZV9ydW5uaW5nID0gZmFsc2U7Cgp9CgpmdW5jdGlvbiBhY3Rpb25fd2VicGFnZSgpCnsKCS8vLyBAZGVzY3JpcHRpb24gKE9sZCBEbkQpIC0gc2hvdyB3ZWJwYWdlCgkvLy8gQHBhcmFtIGNtZCBwYWdlIHRvIHNob3cKCWV4ZWN1dGVfc2hlbGwoIGFyZ3VtZW50MCwgIiIgKTsKCn0KCmZ1bmN0aW9uIGFjdGlvbl93cmFwKCkKewoJLy8vIEBkZXNjcmlwdGlvbiAoT2xkIERuRCkgLSBtb3Rpb24gd3JhcAoJLy8vIEBwYXJhbSBpbmRleCAgKDAgfHwgMiApIGhvcml6b250YWwgd3JhcCAoMSB8fCAyICkgdmVydGljYWwgd3JhcAoJCgl2YXIgdyA9IHNwcml0ZV93aWR0aDsKCXZhciBoID0gc3ByaXRlX2hlaWdodDsKCQoJaWYgKChhcmd1bWVudDAgPT0gMCkgfHwgKGFyZ3VtZW50MCA9PSAyKSkgewoJCgkJaWYgKGhzcGVlZCA8IDApICYmICh4IDwgMCkKCQkJeCArPSByb29tX3dpZHRoICsgdzsKCQlpZiAoaHNwZWVkID4gMCkgJiYgKHggPj0gcm9vbV93aWR0aCkKCQkJeCAtPSByb29tX3dpZHRoICsgdzsKCX0gLy8gZW5kIGlmCgkKCWlmICgoYXJndW1lbnQwID09IDEpIHx8IChhcmd1bWVudDAgPT0gMikpIHsKCQoJCWlmICh2c3BlZWQgPCAwKSAmJiAoeSA8IDApCgkJCXkgKz0gcm9vbV9oZWlnaHQgKyBoOwoJCWlmICh2c3BlZWQgPiAwKSAmJiAoeSA+PSByb29tX2hlaWdodCkKCQkJeSAtPSByb29tX2hlaWdodCArIGg7Cgl9IC8vIGVuZCBpZgoKfQoKZnVuY3Rpb24gX19pbml0X2FjdGlvbigpCnsKCWdtbF9wcmFnbWEoICJnbG9iYWwiLCAiX19pbml0X2FjdGlvbigpOyIpOwoJZ2xvYmFsLl9fcGFydF9zeXN0PS0xOwoJZ2xvYmFsLl9fcGFydF9lbWl0PVtdOwoJZ2xvYmFsLl9fYXJndW1lbnRfcmVsYXRpdmU9ZmFsc2U7CglnbG9iYWwuX19wYXJ0X3R5cGU9W107CgkKCWZvciggdmFyIGk9MDsgaTw9MTU7ICsraSkgCgl7CgkJZ2xvYmFsLl9fcGFydF90eXBlW2ldID0gLTE7CgkJZ2xvYmFsLl9fcGFydF9lbWl0W2ldID0gLTE7Cgl9Cn0KCiNlbmRyZWdpb24K"));
public class ResourceBase
{
	public ResourceBase()
	{
		resourceType = base.GetType().Name;
	}

	[JsonProperty(NullValueHandling = NullValueHandling.Ignore)]
	public IdReference parent { get; set; }

	[JsonProperty(NullValueHandling = NullValueHandling.Ignore)]
	public Dictionary<string, Dictionary<string, string>> ConfigValues { get; set; }

	[JsonProperty(NullValueHandling = NullValueHandling.Ignore)]
	public string resourceVersion { get; set; } = "1.0";

	[JsonProperty(NullValueHandling = NullValueHandling.Ignore)]
	public string name { get; set; } = "";

	[JsonProperty(NullValueHandling = NullValueHandling.Ignore, DefaultValueHandling = DefaultValueHandling.Ignore)]
	public List<string> tags { get; set; } = new List<string>();

	[JsonProperty(NullValueHandling = NullValueHandling.Ignore)]
	public string resourceType { get; set; }
}
public class IdReference
{
	public string name { get; set; }
	public string path { get; set; }
}
public class GMProject : ResourceBase
{
	public GMProject()
	{
		resourceVersion = "1.6";
	}

	public class ResourceWeight
	{
		public IdReference id { get; set; }
		public int order { get; set; }
	}
	public class GMProjectConfig
	{
		public string name { get; set; } = "Default";
		public List<GMProjectConfig> children { get; set; } = new List<GMProjectConfig>();
	}
	public class GMRoomOrderNode
	{
		public IdReference roomId { get; set; }
	}
	public class GMFolder : ResourceBase
	{
		public string folderPath { get; set; }
		public int order { get; set; }
	}

	public List<ResourceWeight> resources { get; set; } = new List<ResourceWeight>();
	public List<IdReference> Options { get; set; } = new List<IdReference>();
	public int defaultScriptType { get; set; } = 1; // None, GML, DND
	public bool isEcma { get; set; } = false;
	public GMProjectConfig configs { get; set; } = new GMProjectConfig();
	public List<GMRoomOrderNode> RoomOrderNodes { get; set; } = new List<GMRoomOrderNode>();
	public List<GMFolder> Folders { get; set; } = new List<GMFolder>();
	public List<GMAudioGroup> AudioGroups { get; set; } = new List<GMAudioGroup>();
	public List<GMTextureGroup> TextureGroups { get; set; } = new List<GMTextureGroup>();
	public List<GMIncludedFile> IncludedFiles { get; set; } = new List<GMIncludedFile>();
	public Dictionary<string, string> MetaData = new Dictionary<string, string>();
}
public class GMAudioGroup : ResourceBase
{
	public GMAudioGroup()
	{
		resourceVersion = "1.3";
		name = "audiogroup_default";
	}
	public long targets { get; set; } = -1L; // target platforms
}
public class GMTextureGroup : ResourceBase
{
	public GMTextureGroup()
	{
		resourceVersion = "1.3";
		name = "Default";
	}

	public bool isScaled { get; set; } = true;
	public string compressFormat { get; set; } = "bz2";
	public bool autocrop { get; set; } = true; // padded images in tpage if false
	public int border { get; set; } = 2;
	public int mipsToGenerate { get; set; }
	public IdReference groupParent { get; set; }
	public string loadType { get; set; } = "default"; // GM2022.9
	public string directory { get; set; } = ""; // GM2022.9

	public long targets { get; set; } = -1L; // target platforms
}
public class GMIncludedFile : ResourceBase
{
	public GMIncludedFile()
	{
		tags = null;
	}

	public long CopyToMask { get; set; } = -1L; // target platforms
	public string filePath { get; set; } = "datafiles";
}
public class GMMainOptions : ResourceBase
{
	public GMMainOptions()
	{
		resourceVersion = "1.4";
		name = "Main";
	}
	public string option_gameguid { get; set; } = Guid.NewGuid().ToString();
	public string option_gameid { get; set; } = "0";
	public int option_game_speed { get; set; } = 60;
	public bool option_mips_for_3d_textures { get; set; }
	public uint option_draw_colour { get; set; } = uint.MaxValue;
	public uint option_window_colour { get; set; } = 255U;
	public string option_steam_app_id { get; set; } = "0";
	public bool option_sci_usesci { get; set; } // source control
	public string option_author { get; set; } = "";
	public bool option_collision_compatibility { get; set; }
	public bool option_copy_on_write_enabled { get; set; }
	public string option_lastchanged { get; set; } = "";
	public bool option_spine_licence { get; set; }
	public string option_template_image { get; set; } = "${base_options_dir}/main/template_image.png";
	public string option_template_icon { get; set; } = "${base_options_dir}/main/template_icon.png";
	public string option_template_description { get; set; }
}
public class GMWindowsOptions : ResourceBase
{
	public GMWindowsOptions()
	{
		resourceVersion = "1.1";
		name = "Windows";
	}
	public string option_windows_display_name { get; set; } = "Created with GameMaker";
	public string option_windows_executable_name { get; set; } = "${project_name}.exe";
	public string option_windows_version { get; set; } = "1.0.0.0";
	public string option_windows_company_info { get; set; } = "YoYo Games Ltd";
	public string option_windows_product_info { get; set; } = "Created with GameMaker";
	public string option_windows_copyright_info { get; set; } = "";
	public string option_windows_description_info { get; set; } = "A GameMaker Game";
	public bool option_windows_display_cursor { get; set; } = true;
	public string option_windows_icon { get; set; } = "${base_options_dir}/windows/icons/icon.ico";
	public int option_windows_save_location { get; set; } = 0;
	public string option_windows_splash_screen { get; set; } = "${base_options_dir}/windows/splash/splash.png";
	public bool option_windows_use_splash { get; set; }
	public bool option_windows_start_fullscreen { get; set; }
	public bool option_windows_allow_fullscreen_switching { get; set; }
	public bool option_windows_interpolate_pixels { get; set; }
	public bool option_windows_vsync { get; set; }
	public bool option_windows_resize_window { get; set; }
	public bool option_windows_borderless { get; set; }
	public int option_windows_scale { get; set; }
	public bool option_windows_copy_exe_to_dest { get; set; }
	public int option_windows_sleep_margin { get; set; } = 10;
	public string option_windows_texture_page { get; set; } = "2048x2048";
	public string option_windows_installer_finished { get; set; } = "${base_options_dir}/windows/installer/finished.bmp";
	public string option_windows_installer_header { get; set; } = "${base_options_dir}/windows/installer/header.bmp";
	public string option_windows_license { get; set; } = "${base_options_dir}/windows/installer/license.txt";
	public string option_windows_nsis_file { get; set; } = "${base_options_dir}/windows/installer/nsis_script.nsi";
	public bool option_windows_enable_steam { get; set; }
	public bool option_windows_disable_sandbox { get; set; }
	public bool option_windows_steam_use_alternative_launcher { get; set; }
	public bool option_windows_use_x64 { get; set; } = true;
}
public class Point
{
	public float x { get; set; }
	public float y { get; set; }
}
public class Keyframe<T> : ResourceBase
{
	public Keyframe()
	{
		name = null;
		tags = null;
	}

	public Guid id { get; set; } = Guid.NewGuid();
	public float Key { get; set; }
	public float Length { get; set; }
	public bool Stretch { get; set; }
	public bool Disabled { get; set; }
	public bool IsCreationKey { get; set; }
	public Dictionary<string, T> Channels { get; set; } = new Dictionary<string, T>();

	public string resourceType
	{
		get
		{
			return base.GetType().Name.Replace("`1", "<" + typeof(T).Name + ">");
		}
	}

	//public string elementType { get { return typeof(T).Name; } }
}
public class KeyframeStore<T> : ResourceBase
{
	public KeyframeStore()
	{
		name = null;
		tags = null;
	}
	public string resourceType
	{
		get
		{
			return base.GetType().Name.Replace("`1", "<" + typeof(T).Name + ">");
		}
	}

	public List<Keyframe<T>> Keyframes { get; set; } = new List<Keyframe<T>>();
	//public string elementType { get { return typeof(T).Name; } }
}
public class AssetKeyframe : ResourceBase
{
	public IdReference Id { get; set; }
}
public class SpriteFrameKeyframe : AssetKeyframe
{
	
}
public class AssetSpriteKeyframe : AssetKeyframe
{
	
}
public class AssetInstanceKeyframe : AssetKeyframe
{

}
public class AssetTextKeyframe : AssetKeyframe
{
	public string Text { get; set; }
	public bool Wrap { get; set; }

	public int Alignment { get; set; }
	// 0: left, 1: centre, 2: right, 3: justify
	// vertical middle alignment adds 256, bottom alignment adds 512
}
public class AudioKeyframe : AssetKeyframe
{
	public int Mode { get; set; } // Single, Loop
}
public class AnimCurveKeyframe : ResourceBase
{
	public AnimCurveKeyframe()
	{
		name = null;
		tags = null;
	}

	public IdReference AnimCurveId { get; set; }
	public GMAnimCurve EmbeddedAnimCurve { get; set; }
}
public class RealKeyframe : AnimCurveKeyframe
{
	public float RealValue { get; set; }
}
public class ColourKeyframe : AnimCurveKeyframe
{
	public uint Colour { get; set; }
}
public class MessageEventKeyframe : ResourceBase
{
	public List<string> Events { get; set; }
}
public class MomentsEventKeyframe : ResourceBase
{
	public List<string> Events { get; set; }
}
public class GMSequence : ResourceBase
{
	public GMSequence()
	{
		resourceVersion = "1.4";
	}

	public List<GMBaseTrack> tracks { get; set; } = new List<GMBaseTrack>();
	public Point visibleRange { get; set; }
	public IdReference spriteId { get; set; }
	public int timeUnits { get; set; } = 1; // Time, Frames
	public int playback { get; set; } // None = -1, Normal, Loop, PingPong
	public float playbackSpeed { get; set; } = 60f;
	public int playbackSpeedType { get; set; } // FramesPerSecond, FramesPerGameFrame
	public bool autoRecord { get; set; } = true;
	public float volume { get; set; } = 1f;
	public float length { get; set; } = 60f;
	public KeyframeStore<MessageEventKeyframe> events { get; set; } = new KeyframeStore<MessageEventKeyframe>();
	public KeyframeStore<MomentsEventKeyframe> moments { get; set; } = new KeyframeStore<MomentsEventKeyframe>();
	public bool lockOrigin { get; set; }
	public bool showBackdrop { get; set; } = true;
	public bool showBackdropImage { get; set; }
	public string backdropImagePath { get; set; } = "";
	public float backdropImageOpacity { get; set; } = 0.5f;
	public int backdropWidth { get; set; } = 1366;
	public int backdropHeight { get; set; } = 768;
	public float backdropXOffset { get; set; }
	public float backdropYOffset { get; set; }
	public int xorigin { get; set; }
	public int yorigin { get; set; }
	public Dictionary<int, string> eventToFunction { get; set; } = new Dictionary<int, string>();
	public IdReference eventStubScript { get; set; }
}
public class GMBaseTrack : ResourceBase
{
	public uint trackColour { get; set; }
	public bool inheritsTrackColour { get; set; } = true;
	public int builtinName { get; set; }
	public int traits { get; set; }
	public int interpolation { get; set; } = 1; // None, Linear
	public List<GMBaseTrack> tracks { get; set; } = new List<GMBaseTrack>();
	public List<GMEvent> events { get; set; } = new List<GMEvent>();
	public bool isCreationTrack { get; set; }
	public List<string> modifiers { get; set; } = new List<string>();
}
public class GMSpriteFramesTrack : GMBaseTrack
{
	public IdReference spriteId { get; set; }
	public KeyframeStore<SpriteFrameKeyframe> keyframes { get; set; } = new KeyframeStore<SpriteFrameKeyframe>();
	public string name { get { return "frames"; } }
}
public class GMGraphicTrack : GMBaseTrack
{
	public KeyframeStore<AssetSpriteKeyframe> keyframes { get; set; } = new KeyframeStore<AssetSpriteKeyframe>();
}
public class GMInstanceTrack : GMBaseTrack
{
	public KeyframeStore<AssetInstanceKeyframe> keyframes { get; set; } = new KeyframeStore<AssetInstanceKeyframe>();
}
public class GMRealTrack : GMBaseTrack
{
	public KeyframeStore<RealKeyframe> keyframes { get; set; } = new KeyframeStore<RealKeyframe>();
}
public class GMGroupTrack : GMBaseTrack
{
	
}
public class GMAudioTrack : GMBaseTrack
{
	public KeyframeStore<AudioKeyframe> keyframes { get; set; } = new KeyframeStore<AudioKeyframe>();
}
public class GMClipMaskTrack : GMBaseTrack
{
	
}
public class GMClipMask_Mask : GMGroupTrack
{
	
}
public class GMClipMask_Subject : GMGroupTrack
{
	
}
public class GMColourTrack : GMBaseTrack
{
	public KeyframeStore<ColourKeyframe> keyframes { get; set; } = new KeyframeStore<ColourKeyframe>();
}
public class GMSprite : ResourceBase
{
	public class GMSpriteBitmap : ResourceBase
	{
		public IdReference FrameId { get; set; }
		public IdReference LayerId { get; set; }
	}
	public class GMSpriteFrame : ResourceBase
	{
		public GMSpriteFrame()
		{
			resourceVersion = "1.1";
		}

		// 2022.8 got rid of these, thank god for that

		//public GMSpriteBitmap compositeImage { get; set; } = new GMSpriteBitmap();
		//public List<GMSpriteBitmap> images { get; set; } = new List<GMSpriteBitmap>();
	}
	public class GMImageLayer : ResourceBase
	{
		public GMImageLayer()
		{
			name = Guid.NewGuid().ToString();
		}
		public bool visible { get; set; } = true;
		public bool isLocked { get; set; }
		public int blendMode { get; set; } // Normal, Add, Subtract, Multiply
		public float opacity { get; set; } = 100f;
		public string displayName { get; set; } = "default";
	}
	public class GMNineSliceData
	{
		public string resourceVersion { get { return "1.0"; } }
		public string loadedVersion { get; set; }
		public string resourceType { get { return base.GetType().Name; } }

		public int left { get; set; }
		public int top { get; set; }
		public int right { get; set; }
		public int bottom { get; set; }
		public uint[] guideColour { get; set; } = new uint[] { 0xFFFF00FF, 0xFFFF00FF, 0xFFFF00FF, 0xFFFF00FF }; // hard fuchsia
		public uint highlightColour { get; set; } = 1728023040U; // transparent light blue
		public int highlightStyle { get; set; } // inverted or normal
		public bool enabled { get; set; }
		public int[] tileMode { get; set; } = new int[5];
	}

	public bool HTile { get; set; }
	public bool VTile { get; set; }
	public bool For3D { get; set; } // separate texture page
	public bool DynamicTexturePage { get; set; } // 2022.9
	public bool preMultiplyAlpha { get; set; }
	public bool edgeFiltering { get; set; }
	public uint collisionTolerance { get; set; }
	public int bbox_left { get; set; }
	public int bbox_right { get; set; } = 63;
	public int bbox_top { get; set; }
	public int bbox_bottom { get; set; } = 63;
	public int origin { get; set; } = 9; // 9 is custom
	public int bboxMode { get; set; } = 2;
	public int collisionKind { get; set; } = 1; // 1 is rectangle
	public int type { get; set; } = 0; // Bitmap, SWF, Spine, Vector
	public float swfPrecision { get; set; } = 2.525f;
	public int width { get; set; } = 64;
	public int height { get; set; } = 64;
	public IdReference textureGroupId { get; set; }
	public List<uint> swatchColours { get; set; } // custom color palette in the image editor.
	public int gridX { get; set; }
	public int gridY { get; set; }
	public List<GMSpriteFrame> frames { get; set; } = new List<GMSpriteFrame>();
	public GMSequence sequence { get; set; }
	public List<GMImageLayer> layers { get; set; } = new List<GMImageLayer>();
	public GMNineSliceData nineSlice { get; set; }
}
public class GMEvent : ResourceBase
{
	public bool isDnD { get; set; }
	public int eventNum { get; set; }
	public int eventType { get; set; }
	public IdReference collisionObjectId { get; set; }
}
public class GMOverriddenProperty : ResourceBase
{
	public IdReference propertyId { get; set; } // variable name, parent object path
	public IdReference objectId { get; set; } // parent object name, parent object path
	public string value { get; set; }
}
public class GMObject : ResourceBase
{
	public class GMObjectProperty : ResourceBase
	{
		public int varType { get; set; } = 4; // Real, Integer, String, Boolean, Expression, Resource, List, Color
		public string value { get; set; } = "0";
		public bool rangeEnabled { get; set; } // affects reals and integers, replaces the input field with a slider in the IDE
		public float rangeMin { get; set; }
		public float rangeMax { get; set; } = 10f;
		public List<string> listItems { get; set; } = new List<string>(); // items in the List variable type
		public bool multiselect { get; set; } // for the List variable type
		public List<string> filters { get; set; } = new List<string>(); // for the Resource/Asset variable type
	}
	
	public IdReference spriteId { get; set; }
	public bool solid { get; set; }
	public bool visible { get; set; } = true;
	public bool managed { get; set; } = true; // ???
	public IdReference spriteMaskId { get; set; }
	public bool persistent { get; set; }
	public IdReference parentObjectId { get; set; }

	public bool physicsObject { get; set; }
	public bool physicsSensor { get; set; }
	public int physicsShape { get; set; } = 1;
	public int physicsGroup { get; set; } = 1;
	public float physicsDensity { get; set; } = 0.5f;
	public float physicsRestitution { get; set; } = 0.1f;
	public float physicsLinearDamping { get; set; } = 0.1f;
	public float physicsAngularDamping { get; set; } = 0.1f;
	public float physicsFriction { get; set; } = 0.2f;
	public bool physicsStartAwake { get; set; } = true;
	public bool physicsKinematic { get; set; }
	public List<Point> physicsShapePoints { get; set; } = new List<Point>();
	public List<GMEvent> eventList { get; set; } = new List<GMEvent>();
	public List<GMObjectProperty> properties { get; set; } = new List<GMObjectProperty>();
	public List<GMOverriddenProperty> overriddenProperties { get; set; } = new List<GMOverriddenProperty>();
}
public class GMRoom : ResourceBase
{
	public class GMRView
	{
		public bool inherit { get; set; }
		public bool visible { get; set; }
		public int xview { get; set; } = 0;
		public int yview { get; set; } = 0;
		public int wview { get; set; } = 1366;
		public int hview { get; set; } = 768;
		public int xport { get; set; } = 0;
		public int yport { get; set; } = 0;
		public int wport { get; set; } = 1366;
		public int hport { get; set; } = 768;
		public uint hborder { get; set; } = 32;
		public uint vborder { get; set; } = 32;
		public int hspeed { get; set; } = -1;
		public int vspeed { get; set; } = -1;
		public IdReference objectId { get; set; } = null;
	}
	public class GMRLayer : ResourceBase
	{
		public class GMEffectProp
		{
			public int type { get; set; }
			public string name { get; set; }
			public string value { get; set; }
		}

		// every layer
		public bool visible { get; set; } = true;
		public int depth { get; set; } = 0;
		public bool userdefinedDepth { get; set; } = false;
		public bool inheritLayerDepth { get; set; } = false;
		public bool inheritLayerSettings { get; set; } = false;
		public int gridX { get; set; } = 32;
		public int gridY { get; set; } = 32;
		public List<GMRLayer> layers { get; set; } = new List<GMRLayer>(); // sub-layers I assume
		public bool hierarchyFrozen { get; set; } = false;
		public bool effectEnabled { get; set; } = true;
		public string effectType { get; set; } = null;
		public List<GMEffectProp> properties { get; set; } = new List<GMEffectProp>();
	}
	public class GMRInstanceLayer : GMRLayer
	{
		public class GMRInstance : ResourceBase
		{
			public List<GMOverriddenProperty> properties { get; set; } = new List<GMOverriddenProperty>();
			public bool isDnd { get; set; } = false;
			public IdReference objectId { get; set; }
			public bool inheritCode { get; set; } = false;
			public bool hasCreationCode { get; set; } = false;
			public uint colour { get; set; } = 0xFFFFFFFF;
			public float rotation { get; set; } = 0.0f;
			public float scaleX { get; set; } = 1.0f;
			public float scaleY { get; set; } = 1.0f;
			public int imageIndex { get; set; } = 0;
			public float imageSpeed { get; set; } = 1.0f;
			public IdReference inheritedItemId { get; set; } = null;
			public bool frozen { get; set; } = false;
			public bool ignore { get; set; } = false;
			public bool inheritItemSettings { get; set; } = false;
			public int x { get; set; } = 0;
			public int y { get; set; } = 0;
		}
		public List<GMRInstance> instances { get; set; } = new List<GMRInstance>();
	}
	public class GMRTileLayer : GMRLayer
	{
		public GMRTileLayer()
		{
			resourceVersion = "1.1";
		}

		public IdReference tilesetId { get; set; }
		public int x { get; set; } = 0;
		public int y { get; set; } = 0;
		public TileMap tiles { get; set; } = new TileMap(0, 0);
	}
	public class GMRBackgroundLayer : GMRLayer
	{
		public IdReference spriteId { get; set; }

		public uint colour { get; set; } = 0xFFFFFFFF;
		public int x { get; set; } = 0;
		public int y { get; set; } = 0;
		public bool htiled { get; set; } = false;
		public bool vtiled { get; set; } = false;
		public float hspeed { get; set; } = 0.0f;
		public float vspeed { get; set; } = 0.0f;
		public bool stretch { get; set; } = false;
		public float animationFPS { get; set; } = 15.0f;
		public int animationSpeedType { get; set; } = 0;
		public bool userdefinedAnimFPS { get; set; } = false;
	}
	public class GMRAssetLayer : GMRLayer
	{
		public class GMRAsset : ResourceBase
		{
			public IdReference spriteId { get; set; } = null;
			public uint colour { get; set; } = 0xFFFFFFFF;
			public IdReference inheritedItemId { get; set; } = null;
			public bool frozen { get; set; } = false;
			public bool ignore { get; set; } = false;
			public bool inheritItemSettings { get; set; } = false;
			public float x { get; set; } = 0.0f;
			public float y { get; set; } = 0.0f;
		}
		public class GMRSpriteGraphic : GMRAsset
		{
			public float headPosition { get; set; } = 0.0f; // frame
			public float rotation { get; set; } = 0.0f;
			public float scaleX { get; set; } = 1.0f;
			public float scaleY { get; set; } = 1.0f;
			public float animationSpeed { get; set; } = 1.0f;
		}
		public class GMRGraphic : GMRAsset
		{
			public uint w { get; set; }
			public uint h { get; set; }
			public uint u0 { get; set; }
			public uint v0 { get; set; }
			public uint u1 { get; set; }
			public uint v1 { get; set; }
		}
		public List<GMRAsset> assets { get; set; } = new List<GMRAsset>();
	}
	public class GMREffectLayer : GMRLayer
	{

	}

	public bool isDnd { get; set; } = false;
	public float volume { get; set; } = 1.0f; // potentially unused?
	public IdReference parentRoom { get; set; } = null;

	public List<GMRView> views { get; set; } = Enumerable.Repeat(new GMRView(), 8).ToList(); // generate 8 default views
	public List<GMRLayer> layers { get; set; } = new List<GMRLayer>();

	public bool inheritLayers { get; set; } = false;
	public string creationCodeFile { get; set; } = null;
	public bool inheritCode { get; set; } = false;
	public List<IdReference> instanceCreationOrder { get; set; } = new List<IdReference>();
	public bool inheritCreationOrder { get; set; } = false;
	public IdReference sequenceId { get; set; } = null;

	// room settings
	public class GMRoomSettings
	{
		public bool inheritRoomSettings { get; set; } = false;
		public int Width { get; set; } = 960;
		public int Height { get; set; } = 540;
		public bool persistent { get; set; } = false;
	}
	public GMRoomSettings roomSettings { get; set; } = new GMRoomSettings();

	// view settings
	public class GMRViewSettings
	{
		public bool inheritViewSettings { get; set; } = false;
		public bool enableViews { get; set; } = true;
		public bool clearViewBackground { get; set; } = true;
		public bool clearDisplayBuffer { get; set; } = true;
	}
	public GMRViewSettings viewSettings { get; set; } = new GMRViewSettings();

	// physics world settings
	public class GMRPhysicsSettings
	{
		public bool inheritPhysicsSettings { get; set; } = false;
		public bool PhysicsWorld { get; set; } = false;
		public float PhysicsWorldGravityX { get; set; } = 0.0f;
		public float PhysicsWorldGravityY { get; set; } = 10.0f;
		public float PhysicsWorldPixToMetres { get; set; } = 0.1f;
	}
	public GMRPhysicsSettings physicsSettings { get; set; } = new GMRPhysicsSettings();
}
public class TileMap
{
	public TileMap(int _width, int _height)
	{
		SerialiseWidth = _width;
		SerialiseHeight = _height;

		// no idea how the compressed data works, so
		TileDataFormat = 0; // use old format
		TileSerialiseData = new List<uint>();
	}

	public int TileDataFormat { get; set; } // 0 is old, 1 is new
	public int SerialiseWidth { get; set; }
	public int SerialiseHeight { get; set; }

	[JsonProperty(DefaultValueHandling = DefaultValueHandling.Ignore)] // 2022.8
	public List<uint> TileSerialiseData { get; set; }

	// 2022.8 introduced encoded tile data
	[JsonProperty(DefaultValueHandling = DefaultValueHandling.Ignore)]
	public List<int> TileCompressedData { get; set; }
}
public class GMTileSet : ResourceBase
{
	public class GMAutoTileSet : ResourceBase
	{
		public List<uint> tiles { get; set; } = new List<uint>();
		public bool closed_edge { get; set; }
	}
	public class GMTileAnimation : ResourceBase
	{
		public List<uint> frames { get; set; } = new List<uint>();
	}
	public class TileAnimation
	{
		public List<uint> FrameData { get; set; } = new List<uint>();
		public int SerialiseFrameCount { get; set; }
	}

	public IdReference spriteId { get; set; }
	public int tileWidth { get; set; } = 16;
	public int tileHeight { get; set; } = 16;
	public int tilexoff { get; set; }
	public int tileyoff { get; set; }
	public int tilehsep { get; set; }
	public int tilevsep { get; set; }
	public bool spriteNoExport { get; set; } = true;
	public IdReference textureGroupId { get; set; }
	public int out_tilehborder { get; set; } = 2;
	public int out_tilevborder { get; set; } = 2;
	public int out_columns { get; set; }
	public int tile_count { get; set; }
	public List<GMAutoTileSet> autoTileSets { get; set; } = new List<GMAutoTileSet>();
	public List<GMTileAnimation> tileAnimationFrames { get; set; } = new List<GMTileAnimation>();
	public float tileAnimationSpeed { get; set; } = 15f; // 1000000 / ms
	public TileAnimation tileAnimation { get; set; } = new TileAnimation();
	public TileMap macroPageTiles { get; set; } = new TileMap(0, 0); // tileset brush, ide only.
}
public class GMScript : ResourceBase
{
	public bool isDnD { get; set; }
	public bool isCompatibility { get; set; }
}
public class GMSound : ResourceBase
{
	public int conversionMode { get; set; }
	public int compression { get; set; }
	public float volume { get; set; } = 1f;
	public bool preload { get; set; } // "Preload... or not..."
	public int bitRate { get; set; } = 128;
	public int sampleRate { get; set; } = 44100;
	public int type { get; set; }
	public int bitDepth { get; set; } = 1;
	public IdReference audioGroupId { get; set; }
	public string soundFile { get; set; } = "";
	public float duration { get; set; }
}
public class GMShader : ResourceBase
{
	public int type { get; set; } = 1; // None, GLSLES, GLSL, HLSL11, PSSL
}
public class GMFont : ResourceBase
{
	public class Glyph
	{
		public int x { get; set; }
		public int y { get; set; }
		public int w { get; set; }
		public int h { get; set; }
		public int character { get; set; }
		public int shift { get; set; }
		public int offset { get; set; }
	}
	public class KerningPair
	{
		public int first { get; set; }
		public int second { get; set; }
		public int amount { get; set; }
	}
	public class FontRange
	{
		public FontRange(int _lower, int _upper)
		{
			lower = _lower;
			upper = _upper;
		}

		public int lower { get; set; }
		public int upper { get; set; }
	}

	public bool includeTTF { get; set; }
	public float size { get; set; }
	public string sampleText { get; set; } = "abcdef ABCDEF\n0123456789 .,<>\"'&!?\nthe quick brown fox jumps over the lazy dog\nTHE QUICK BROWN FOX JUMPS OVER THE LAZY DOG\nDefault character:  (9647)";
	public int hinting { get; set; } // Normal, Mono, Light
	public int glyphOperations { get; set; } // Default, DisableHinting, DisableAutoHinting, PreferAutoHinting = 4, Warping = 8, NoScale = 16
	public int interpreter { get; set; } // TrueType40, TrueType35
	public int pointRounding { get; set; } // Floor, Round, Ceil
	public int applyKerning { get; set; } // On, Off
	public string fontName { get; set; } = "";
	public string styleName { get; set; } = "Regular";
	public bool bold { get; set; }
	public bool italic { get; set; }
	public int charset { get; set; }
	public int AntiAlias { get; set; } = 1; // Mono, Normal
	public int first { get; set; }
	public int last { get; set; }
	public string TTFName { get; set; } = "";
	public IdReference textureGroupId { get; set; }
	public int ascenderOffset { get; set; }
	public int ascender { get; set; }
	public Dictionary<int, Glyph> glyphs { get; set; } = new Dictionary<int, Glyph>();
	public List<KerningPair> kerningPairs { get; set; } = new List<KerningPair>();
	public List<FontRange> ranges { get; set; } = new List<FontRange>();
	public bool regenerateBitmap { get; set; }
	public bool canGenerateBitmap { get; set; } = true;
	public bool maintainGms1Font { get; set; }
}
public class GMPath : ResourceBase
{
	public class PathPoint : Point
	{
		public float speed { get; set; }
	}

	public int kind { get; set; }
	public bool closed { get; set; }
	public int precision { get; set; } = 4;
	public List<PathPoint> points { get; set; } = new List<PathPoint>();
}
public class GMMoment : ResourceBase
{
	public int moment { get; set; }
	public GMEvent evnt { get; set; }
}
public class GMTimeline : ResourceBase
{
	public List<GMMoment> momentList { get; set; } = new List<GMMoment>();
}
public class GMAnimCurve : ResourceBase
{
	public GMAnimCurve()
	{
		resourceVersion = "1.2";
	}

	public int function { get; set; } // Linear, CentripetalCatmullRom, Bezier2D
	public List<GMAnimCurveChannel> channels { get; set; } = new List<GMAnimCurveChannel>();
}
public class GMAnimCurveChannel : ResourceBase
{
	public uint colour { get; set; }
	public bool visible { get; set; } = true;
	public List<CurvePoint> points { get; set; } = new List<CurvePoint>();
}
public class CurvePoint : Point
{
	public float th0 { get; set; }
	public float th1 { get; set; }
	public float tv0 { get; set; }
	public float tv1 { get; set; }
}
public class GMExtension : ResourceBase
{
	public GMExtension()
	{
		resourceVersion = "1.2";
	}

	public string optionsFile { get; set; } = "options.json";
	public List<GMExtensionOption> options { get; set; } = new List<GMExtensionOption>();
	public bool exportToGame { get; set; } = true;
	public long supportedTargets { get; set; } = -1L;
	public string extensionVersion { get; set; } = "";
	public string packageId { get; set; } = "";
	public string productId { get; set; } = "";
	public string author { get; set; } = "";
	public DateTime date { get; set; } = DateTime.Now;
	public string license { get; set; } = "";
	public string description { get; set; } = "";
	public string helpfile { get; set; } = "";
	public bool iosProps { get; set; }
	public bool tvosProps { get; set; }
	public bool androidProps { get; set; }
	public string installdir { get; set; } = "";
	public List<GMExtensionFile> files { get; set; } = new List<GMExtensionFile>();
	public string classname { get; set; } = "";
	public string tvosclassname { get; set; }
	public string tvosdelegatename { get; set; }
	public string iosdelegatename { get; set; } = "";
	public string androidclassname { get; set; } = "";
	public string sourcedir { get; set; } = "";
	public string androidsourcedir { get; set; } = "";
	public string macsourcedir { get; set; } = "";
	public string maccompilerflags { get; set; } = "";
	public string tvosmaccompilerflags { get; set; } = "";
	public string maclinkerflags { get; set; } = "";
	public string tvosmaclinkerflags { get; set; } = "";
	public string iosplistinject { get; set; }
	public string tvosplistinject { get; set; }
	public string androidinject { get; set; }
	public string androidmanifestinject { get; set; }
	public string androidactivityinject { get; set; }
	public string gradleinject { get; set; }
	public string androidcodeinjection { get; set; } = "";
	public bool hasConvertedCodeInjection { get; set; }
	public string ioscodeinjection { get; set; } = "";
	public string tvoscodeinjection { get; set; } = "";
	public List<GMExtensionFrameworkEntry> iosSystemFrameworkEntries { get; set; } = new List<GMExtensionFrameworkEntry>();
	public List<GMExtensionFrameworkEntry> tvosSystemFrameworkEntries { get; set; } = new List<GMExtensionFrameworkEntry>();
	public List<GMExtensionFrameworkEntry> iosThirdPartyFrameworkEntries { get; set; } = new List<GMExtensionFrameworkEntry>();
	public List<GMExtensionFrameworkEntry> tvosThirdPartyFrameworkEntries { get; set; } = new List<GMExtensionFrameworkEntry>();
	public List<string> IncludedResources { get; set; } = new List<string>();
	public List<string> androidPermissions { get; set; } = new List<string>();
	public long copyToTargets { get; set; } = -1L;
	public string iosCocoaPods { get; set; } = "";
	public string tvosCocoaPods { get; set; } = "";
	public string iosCocoaPodDependencies { get; set; } = "";
	public string tvosCocoaPodDependencies { get; set; } = "";
}
public class GMExtensionOption : ResourceBase
{
	public IdReference extensionId { get; set; }
	public Guid guid { get; set; } = Guid.NewGuid();
	public string displayName { get; set; } = "";
	public string description { get; set; } = "";
	public string defaultValue { get; set; } = "0";
	public bool exportToINI { get; set; }
	public int optType { get; set; } = 1; // Boolean, Number, String, FilePath, FolderPath, Section
}
public class GMExtensionFile : ResourceBase
{
	public string filename { get; set; } = "";
	public string origname { get; set; } = "";
	public string init { get; set; } = "";
	public string final { get; set; } = "";
	public int kind { get; set; }
	public bool uncompress { get; set; }
	public List<GMExtensionFunction> functions { get; set; } = new List<GMExtensionFunction>();
	public List<GMExtensionConstant> constants { get; set; } = new List<GMExtensionConstant>();
	public List<GMProxyFile> ProxyFiles { get; set; } = new List<GMProxyFile>();
	public long copyToTargets { get; set; } = -1L;
	public List<IdReference> order { get; set; } = new List<IdReference>();
}
public class GMExtensionFunction : ResourceBase
{
	public string externalName { get; set; } = "";
	public int kind { get; set; }
	public string help { get; set; } = "";
	public bool hidden { get; set; }
	public int returnType { get; set; }
	public int argCount { get; set; }
	public List<int> args { get; set; } = new List<int>();
}
public class GMExtensionConstant : ResourceBase
{
	public string value { get; set; } = "";
	public bool hidden { get; set; }
}
public class GMProxyFile : ResourceBase
{
	public long TargetMask { get; set; }
}
public class GMExtensionFrameworkEntry : ResourceBase
{
	public bool weakReference { get; set; }
	public int embed { get; set; }
}
public class GMNotes : ResourceBase
{
	// nothing lol
}

#endregion
#region GM2022 Asset Dumpers

void AddResource(IdReference resource)
{
	var res = new GMProject.ResourceWeight
	{
		id = resource,
		order = exportData.resources.Count
	};

	if (!exportData.resources.Any(i => i.id.name == res.id.name))
		exportData.resources.Add(res);
}
void DumpOptions()
{
	string optionsPath = "options/";
	string mainOptionsPath = optionsPath + "main/";
	Directory.CreateDirectory(rootPath + mainOptionsPath);

	// make main options
	var exportMainOptions = new GMMainOptions();
	exportMainOptions.option_gameid = Data.GeneralInfo.GameID.ToString();
	exportMainOptions.option_game_speed = (int)Data.GeneralInfo.GMS2FPS;
	exportMainOptions.option_window_colour = (uint)Data.Options.WindowColor;
	exportMainOptions.option_steam_app_id = Data.GeneralInfo.SteamAppID.ToString();
	//exportMainOptions.option_collision_compatibility = (Data.Options.Info.HasFlag(UndertaleOptions.OptionsFlags.FastCollisionCompatibility) || !Data.GMS2022_1);
	//exportMainOptions.option_copy_on_write_enabled = (Data.Options.Info.HasFlag(UndertaleOptions.OptionsFlags.WriteErrors) || !Data.GMS2022_2);
							// unsure ^

	// make windows options
	string windowsOptionsPath = optionsPath + "windows/";
	Directory.CreateDirectory(rootPath + windowsOptionsPath);

	var exportWindowsOptions = new GMWindowsOptions();
	exportWindowsOptions.option_windows_display_name = Data.GeneralInfo.DisplayName.Content;
	//exportWindowsOptions.option_windows_copyright_info = "Decompiler script by REDACTED";

	exportWindowsOptions.option_windows_start_fullscreen = (Data.Options.Info.HasFlag(UndertaleOptions.OptionsFlags.FullScreen));
	exportWindowsOptions.option_windows_interpolate_pixels = (Data.Options.Info.HasFlag(UndertaleOptions.OptionsFlags.InterpolatePixels));
	exportWindowsOptions.option_windows_borderless = (Data.Options.Info.HasFlag(UndertaleOptions.OptionsFlags.NoBorder));
	exportWindowsOptions.option_windows_display_cursor = (Data.Options.Info.HasFlag(UndertaleOptions.OptionsFlags.ShowCursor));
	exportWindowsOptions.option_windows_resize_window = (Data.Options.Info.HasFlag(UndertaleOptions.OptionsFlags.Sizeable));
	exportWindowsOptions.option_windows_disable_sandbox = (Data.Options.Info.HasFlag(UndertaleOptions.OptionsFlags.DisableSandbox));
	exportWindowsOptions.option_windows_vsync = (Data.GeneralInfo.Info.HasFlag(UndertaleGeneralInfo.InfoFlags.SyncVertex1));
	exportWindowsOptions.option_windows_allow_fullscreen_switching = (Data.GeneralInfo.Info.HasFlag(UndertaleGeneralInfo.InfoFlags.ScreenKey));
	exportWindowsOptions.option_windows_enable_steam = (Data.GeneralInfo.Info.HasFlag(UndertaleGeneralInfo.InfoFlags.SteamEnabled));
	if (!Data.GeneralInfo.Info.HasFlag(UndertaleGeneralInfo.InfoFlags.Scale))
		exportWindowsOptions.option_windows_scale = 1;
	if (Data.GeneralInfo.Info.HasFlag(UndertaleGeneralInfo.InfoFlags.LocalDataEnabled))
		exportWindowsOptions.option_windows_save_location = 1;

	// use runner
	string runnerExePath = dataPath + Data.GeneralInfo.FileName.Content + ".exe";
	if (!File.Exists(runnerExePath))
	{
		foreach (var f in Directory.GetFiles(dataPath, "*.exe", SearchOption.TopDirectoryOnly))
		{
			var lastLine = File.ReadLines(f).Last();
			if (lastLine.Contains("YoYoGames.GameMaker.Runner"))
				runnerExePath = f;
		}
	}
	if (File.Exists(runnerExePath))
	{
		// product info
		var vinfo = FileVersionInfo.GetVersionInfo(runnerExePath);
		exportWindowsOptions.option_windows_product_info = vinfo.ProductName;
		exportWindowsOptions.option_windows_company_info = vinfo.CompanyName;
		exportWindowsOptions.option_windows_description_info = vinfo.FileDescription;
		exportWindowsOptions.option_windows_copyright_info = vinfo.LegalCopyright;
		exportWindowsOptions.option_windows_version = vinfo.FileVersion;

		// icon
		var iconExport = getIcon(runnerExePath);
		if (iconExport != null)
		{
			string iconPath = rootPath + windowsOptionsPath + "icons/";
			exportWindowsOptions.option_windows_icon = "icons/icon.ico";

			Directory.CreateDirectory(iconPath);
			using (var stream = new FileStream($"{iconPath}icon.ico", FileMode.Create))
				iconExport.Save(stream);

			using (var stream = new FileStream($"{iconPath}readme.txt", FileMode.Create))
			{
				byte[] info = Encoding.Default.GetBytes("yes I know the icon is bad please");
				stream.Write(info, 0, info.Length);
			}
		}
	}

	// splash
	string splashPath = dataPath + "splash.png";
	if (File.Exists(splashPath))
	{
		Directory.CreateDirectory(rootPath + windowsOptionsPath + "splash");
		File.Copy(splashPath, rootPath + windowsOptionsPath + "splash/splash.png", true);

		exportWindowsOptions.option_windows_splash_screen = "splash/splash.png";
		exportWindowsOptions.option_windows_use_splash = true;
	}

	// constants
	foreach (var i in Data.Options.Constants)
	{
		if (i.Name.Content == "@@DrawColour")
			exportMainOptions.option_draw_colour = UInt32.Parse(i.Value.Content);
		if (i.Name.Content == "@@SleepMargin")
			exportWindowsOptions.option_windows_sleep_margin = Int32.Parse(i.Value.Content);
	}

	// export and add to data
	doJson(exportMainOptions, mainOptionsPath + "options_main.yy");
	doJson(exportWindowsOptions, windowsOptionsPath + "options_windows.yy");
	exportData.Options.Add(new IdReference { name = exportMainOptions.name, path = mainOptionsPath + "options_main.yy" });
	exportData.Options.Add(new IdReference { name = exportWindowsOptions.name, path = windowsOptionsPath + "options_windows.yy" });
}

void DumpSprite(UndertaleSprite sprite)
{
	string spritePath = "sprites/" + sprite.Name.Content + "/";
	string exportedPath = $"sprites/{sprite.Name.Content}/{sprite.Name.Content}.yy";

	// skip over sprite if it was already exported
	if (File.Exists(rootPath + exportedPath))
	{
		AddResource(new IdReference
		{
			name = sprite.Name.Content,
			path = exportedPath
		});
		UpdateProgress();
		return;
	}
	Directory.CreateDirectory(rootPath + spritePath);

	var exportedSprite = new GMSprite
	{
		name = sprite.Name.Content,
		width = Math.Max((int)sprite.Width, 1),
		height = Math.Max((int)sprite.Height, 1),
		bbox_left = sprite.MarginLeft,
		bbox_right = sprite.MarginRight,
		bbox_bottom = sprite.MarginBottom,
		bbox_top = sprite.MarginTop,
		preMultiplyAlpha = sprite.Transparent,
		edgeFiltering = sprite.Smooth,
		bboxMode = (int)sprite.BBoxMode,
		type = (int)sprite.SSpriteType,
	};

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, sprite);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedSprite.tags.Add(tag.Content);
	}

	// figure out collision mask
	if (sprite.CollisionMasks.Count > 1)
		exportedSprite.collisionKind = 4; // precise per frame
	else
	{
		switch ((int)sprite.SepMasks)
		{
			case 0: exportedSprite.collisionKind = 1; break; // rectangle
			case 1: exportedSprite.collisionKind = 0; break; // precise
			case 2: exportedSprite.collisionKind = 5; break; // rotated rectangle

			// there are more but modtool is too retarded to figure it out and so am I
		}
	}

	// figure out the sprite origin setting
	int ox = sprite.OriginX, oy = sprite.OriginY, ow = (int)sprite.Width, oh = (int)sprite.Height, og = 9;
	if (ox == 0)
		og = 0;
	else if (ox == ow / 2)
		og = 1;
	else if (ox == ow)
		og = 2;

	if (og != 9)
	{
		if (oy == oh / 2)
			og += 3;
		else if (oy == oh)
			og += 6;
		else if (oy != 0)
			og = 9;
	}
	exportedSprite.origin = og;

	// folder sprite is in
	exportedSprite.parent = new IdReference
	{
		name = "Sprites",
		path = "folders/Sprites.yy"
	};
	if (_APND.Checked) exportedSprite.parent = APNDREF;

	// animation sequence
	exportedSprite.sequence = new GMSequence
	{
		spriteId = new IdReference
		{
			name = exportedSprite.name,
			path = exportedPath
		},
		playbackSpeed = sprite.GMS2PlaybackSpeed,
		playbackSpeedType = (int)sprite.GMS2PlaybackSpeedType,
		length = (float)sprite.Textures.Count,
		xorigin = sprite.OriginX,
		yorigin = sprite.OriginY,
		name = exportedSprite.name,

		/*
		parent = new IdReference
		{
			name = exportedSprite.name,
			path = exportedPath
		}
		*/
};

	// nine slice
	if (sprite.V3NineSlice != null)
	{
		exportedSprite.nineSlice = new GMSprite.GMNineSliceData
		{
			left = sprite.V3NineSlice.Left,
			top = sprite.V3NineSlice.Top,
			right = sprite.V3NineSlice.Right,
			bottom = sprite.V3NineSlice.Bottom,
			enabled = sprite.V3NineSlice.Enabled,
			tileMode = Array.ConvertAll(sprite.V3NineSlice.TileModes, item => (int)item),
		};
	}

	string tgrp = "Default";
	if (sprite.Textures.Count > 0)
	{
		// add the default layer
		string layerGuid = Guid.NewGuid().ToString();
		exportedSprite.layers.Add(new GMSprite.GMImageLayer { name = layerGuid });

		// export every frame
		var baseTrack = new GMSpriteFramesTrack();
		for (var j = 0; j < sprite.Textures.Count; j++)
		{
			var frame = sprite.Textures[j];

			// texture group
			if (frame.Texture != null)
			{
				if (tpageAlign.ContainsKey(frame.Texture.TexturePage.Name.Content))
					tgrp = tpageAlign[frame.Texture.TexturePage.Name.Content];
				else if (tpageAlign.ContainsKey(exportedSprite.name))
					tgrp = tpageAlign[exportedSprite.name];
			}

			// make guids and stuff
			string compositeGuid = Guid.NewGuid().ToString();
			string layersPath = rootPath + spritePath + "layers/" + compositeGuid + "/";
			Directory.CreateDirectory(layersPath);

			// extract images
			if (frame.Texture != null)
			{
				Bitmap img;
				try
				{
					// fetch bitmap image
					img = worker.GetTextureFor(frame.Texture, compositeGuid + ".png", true);
				}
				catch
				{
					// give up immediately and make an empty image
					img = new Bitmap(exportedSprite.width, exportedSprite.height);
				}
				TextureWorker.SaveImageToFile(rootPath + spritePath + compositeGuid + ".png", img, false);
				TextureWorker.SaveImageToFile(layersPath + layerGuid + ".png", img);
			}

			// add to frames
			var spriteFrame = new GMSprite.GMSpriteFrame();
			spriteFrame.name = compositeGuid;

			// pre-2022.8
			/*
			spriteFrame.compositeImage.FrameId = new IdReference
			{
				name = compositeGuid,
				path = exportedPath
			};
			spriteFrame.parent = new IdReference
			{
				name = exportedSprite.name,
				path = exportedPath
			};

			var spriteFrame2 = new GMSprite.GMSpriteBitmap();
			spriteFrame2.FrameId = new IdReference
			{
				name = compositeGuid,
				path = exportedPath
			};
			spriteFrame2.LayerId = new IdReference
			{
				name = layerGuid,
				path = exportedPath
			};

			spriteFrame.images.Add(spriteFrame2);
			*/

			exportedSprite.frames.Add(spriteFrame);

			// add to sequence
			var channelId = new IdReference
			{
				name = compositeGuid,
				path = exportedPath
			};
			var keyframe = new Keyframe<SpriteFrameKeyframe>
			{
				Key = (float)j,
				Length = 1.0f,
			};
			keyframe.Channels.Add("0", new SpriteFrameKeyframe
			{
				Id = channelId
			});
			baseTrack.keyframes.Keyframes.Add(keyframe);
		}
		exportedSprite.sequence.tracks.Add(baseTrack);
	}

	// texture page
	if (tgrp.StartsWith("__YY__") && tgrp.Contains("_YYG_AUTO_GEN_TEX_GROUP_NAME_"))
		exportedSprite.For3D = true;
	else
	{
		exportedSprite.textureGroupId = new IdReference
		{
			name = tgrp,
			path = $"texturegroups/{tgrp}"
		};
	}

	// finish
	doJson(exportedSprite, spritePath + $"{exportedSprite.name}.yy");
	AddResource(new IdReference
	{
		name = exportedSprite.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpObject(UndertaleGameObject obj)
{
	var exportedObject = new GMObject
	{
		name = obj.Name.Content,
		visible = obj.Visible,
		solid = obj.Solid,
		persistent = obj.Persistent,
		physicsObject = obj.UsesPhysics,
		physicsSensor = obj.IsSensor,
		physicsShape = (int)obj.CollisionShape,
		physicsGroup = (int)obj.Group,
		physicsDensity = obj.Density,
		physicsRestitution = obj.Restitution,
		physicsLinearDamping = obj.LinearDamping,
		physicsAngularDamping = obj.AngularDamping,
		physicsFriction = obj.Friction,
		physicsStartAwake = obj.Awake,
		physicsKinematic = obj.Kinematic,
	};

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, obj);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedObject.tags.Add(tag.Content);
	}

	// folder
	exportedObject.parent = new IdReference
	{
		name = "Objects",
		path = "folders/Objects.yy"
	};
	if (_APND.Checked) exportedObject.parent = APNDREF;

	// port sprite, mask and parent
	if (obj.Sprite != null)
	{
		string spriteName = obj.Sprite.Name.Content;
		exportedObject.spriteId = new IdReference
		{
			name = spriteName,
			path = $"sprites/{spriteName}/{spriteName}.yy"
		};
	}
	if (obj.TextureMaskId != null)
	{
		string maskName = obj.TextureMaskId.Name.Content;
		exportedObject.spriteMaskId = new IdReference
		{
			name = maskName,
			path = $"sprites/{maskName}/{maskName}.yy"
		};
	}
	if (obj.ParentId != null)
	{
		string parentName = obj.ParentId.Name.Content;
		exportedObject.parentObjectId = new IdReference
		{
			name = parentName,
			path = $"objects/{parentName}/{parentName}.yy"
		};
	}

	// port physics vertices
	foreach (var i in obj.PhysicsVertices)
	{
		exportedObject.physicsShapePoints.Add(new Point
		{
			x = i.X,
			y = i.Y
		});
	}

	// paths
	string objectPath = "objects/" + obj.Name.Content + "/";
	string exportedPath = $"{objectPath}{obj.Name.Content}.yy";
	Directory.CreateDirectory(rootPath + objectPath);

	// port events
	for (var i = 0; i < obj.Events.Count; i++)
	{
		foreach (var j in obj.Events[i])
		{
			if (i == 14)
			{
				// reverse the pre create event
				string code = decompileCode(j.Actions[0].CodeId);
				code.Replace("event_inherited()\n", "");
				
				var varDefs = code.Split("\n");
				foreach (var match in varDefs)
				{
					var find = match.Split(" = ");
					if (find.Length >= 2)
					{
						var varName = "";
						var varValue = "";
						
						foreach (var f in find)
						{
							if (varName == "")
								varName = f.Replace("self.", "");
							else
								varValue += f;
						}
						
						exportedObject.properties.Add(new GMObject.GMObjectProperty
						{
							name = varName,
							value = varValue
						});
					}
				}
			}
			else
			{
				string codeName = Enum.GetName(typeof(EventType), i);
				var evnt = new GMEvent
				{
					eventType = i,
					eventNum = (int)j.EventSubtype,
				};

				// collision event
				if (i == 4)
				{
					var colobj = Data.GameObjects[evnt.eventNum];
					evnt.eventNum = 0;

					if (colobj != null)
					{
						evnt.collisionObjectId = new IdReference
						{
							name = colobj.Name.Content,
							path = $"objects/{colobj.Name.Content}/{colobj.Name.Content}.yy"
						};
						codeName += "_" + colobj.Name.Content;
					}
				}
				else
					codeName += "_" + evnt.eventNum;
				
				// code
				if (j.Actions.Count > 0)
				{
					string code = "";
					if (j.Actions[0].CodeId == null)
					{
						// if yyc, write subfunctions
						foreach (var y in Data.Scripts)
						{
							var n = y.Name.Content;
							if (n.EndsWith($"_gml_Object_{obj.Name.Content}_{codeName}"))
							{
								var funcname = n.Substring("gml_Script_".Length, n.LastIndexOf("_gml_Object_") - "gml_Script_".Length);
								code += $"function {funcname}()\n{{\n	\n}}\n\n";
							}
						}
					}
					else
					{	
						try
						{
							code = decompileCode(j.Actions[0].CodeId);
						}
						catch (Exception e)
						{
							if (!skipErrors)
								ScriptError("A " + codeName + " event in " + exportedObject.name + " failed to decompile!\n\n" + e.ToString());
							else
								errorList.Add($"{exportedObject.name} {codeName} - {e.Message}");
							code = "/* (decompilation failed.) */\n";
						}
					}
					File.WriteAllText(rootPath + objectPath + codeName + ".gml", code);
				}
				exportedObject.eventList.Add(evnt);
			}
		}
	}

	// finish
	doJson(exportedObject, objectPath + $"{exportedObject.name}.yy");
	AddResource(new IdReference
	{
		name = exportedObject.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpRoom(UndertaleRoom room)
{
	var exportedRoom = new GMRoom { name = room.Name.Content };

	exportedRoom.roomSettings.Width = (int)room.Width;
	exportedRoom.roomSettings.Height = (int)room.Height;
	exportedRoom.viewSettings.clearDisplayBuffer = !room.Flags.HasFlag(UndertaleRoom.RoomEntryFlags.ClearDisplayBuffer);
	exportedRoom.viewSettings.enableViews = room.Flags.HasFlag(UndertaleRoom.RoomEntryFlags.EnableViews);
	exportedRoom.viewSettings.clearViewBackground = room.Flags.HasFlag(UndertaleRoom.RoomEntryFlags.ShowColor);

	exportedRoom.physicsSettings.PhysicsWorldGravityX = room.GravityX;
	exportedRoom.physicsSettings.PhysicsWorldGravityY = room.GravityY;
	exportedRoom.physicsSettings.PhysicsWorldPixToMetres = room.MetersPerPixel;

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, room);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedRoom.tags.Add(tag.Content);
	}

	// paths
	string roomPath = "rooms/" + exportedRoom.name + "/";
	string exportedPath = $"{roomPath}{exportedRoom.name}.yy";
	Directory.CreateDirectory(rootPath + roomPath);

	// folder
	exportedRoom.parent = new IdReference
	{
		name = "Rooms",
		path = "folders/Rooms.yy"
	};
	if (_APND.Checked) exportedRoom.parent = APNDREF;

	// room creation code
	if (room.CreationCodeId != null)
	{
		string code = "";
		try { code = decompileCode(room.CreationCodeId); }
		catch (Exception e)
		{
			if (!skipErrors)
				ScriptError($"A room create event in {exportedRoom.name} failed to decompile!\n\n{e.ToString()}");
			else
				errorList.Add($"{exportedRoom.name} - {e.Message}");
			code = "/* (decompilation failed.) */\n";
		}
		File.WriteAllText(rootPath + roomPath + "RoomCreationCode.gml", code);
		exportedRoom.creationCodeFile = "${project_dir}/rooms/" + exportedRoom.name + "/RoomCreationCode.gml";
	}

	// add views
	for (var i = 0; i < room.Views.Count; i++)
	{
		var v = room.Views[i];
		exportedRoom.views[i] = new GMRoom.GMRView
		{
			visible = v.Enabled,
			xview = v.ViewX,
			yview = v.ViewY,
			wview = v.ViewWidth,
			hview = v.ViewHeight,
			xport = v.PortX,
			yport = v.PortY,
			wport = v.PortWidth,
			hport = v.PortHeight,
			hborder = v.BorderX,
			vborder = v.BorderY,
			hspeed = v.SpeedX,
			vspeed = v.SpeedY
		};
		if (v.ObjectId != null)
		{
			exportedRoom.views[i].objectId = new IdReference
			{
				name = v.ObjectId.Name.Content,
				path = $"objects/{v.ObjectId.Name.Content}/{v.ObjectId.Name.Content}.yy"
			};
		}
	}

	// port instance order
	foreach (var i in room.GameObjects)
	{
		var asset = new IdReference
		{
			name = instName((int)i.InstanceID),
			path = exportedPath
		};
		exportedRoom.instanceCreationOrder.Add(asset);
	}

	// add layers
	if (Data.IsGameMaker2())
	{
		for (var lid = 0; lid < room.Layers.Count; lid++)
		{
			var l = room.Layers[lid];
			if (l.Data != null)
			{
				// do different stuff depending on which layer type it is
				switch (l.LayerType)
				{
					case UndertaleRoom.LayerType.Instances: // Instances
						var instLayer = new GMRoom.GMRInstanceLayer
						{
							name = l.LayerName.Content,
							depth = l.LayerDepth,
							visible = l.IsVisible,
							userdefinedDepth = (l.LayerDepth != lid * 100)
						};

						if (l.InstancesData != null)
						{
							// loop through every instance in the layer.
							foreach (var i in l.InstancesData.Instances)
							{
								var inst = new GMRoom.GMRInstanceLayer.GMRInstance()
								{
									name = instName((int)i.InstanceID),
									x = i.X,
									y = i.Y,
									hasCreationCode = (i.CreationCode != null),
									scaleX = i.ScaleX,
									scaleY = i.ScaleY,
									colour = i.Color,
									rotation = i.Rotation,
									imageSpeed = i.ImageSpeed,
									imageIndex = i.ImageIndex
								};
								string objname = i.ObjectDefinition.Name.Content;
								
								// dump creation code
								string code = "";
								if (i.CreationCode != null)
								{
									try
									{
										code = decompileCode(i.CreationCode);
									}
									catch (Exception e)
									{
										if (!skipErrors)
											ScriptError("An " + objname + " with the ID of " + i.InstanceID + $"\nfailed to decompile its room creation code in {exportedRoom.name}!\n\n" + e.ToString());
										else
											errorList.Add($"{exportedRoom.name} - {objname} ({i.InstanceID}) - {e.Message}");
										code = "/* (decompilation failed.) */\n";
									}
								}
								
								// try to reverse the pre create event
								if (i.PreCreateCode != null)
								{
									try
									{
										string tempCode = decompileCode(i.PreCreateCode);
										tempCode = tempCode.Replace("event_inherited()\n", "");
										
										var varDefs = tempCode.Split("\n");
										foreach (var match in varDefs)
										{
											var find = match.Split(" = ");
											if (find.Length >= 2)
											{
												var varName = "";
												var varValue = "";
												
												foreach (var f in find)
												{
													if (varName == "")
														varName = f.Replace("self.", "");
													else
														varValue += f;
												}
												
												inst.properties.Add(new GMOverriddenProperty
												{
													propertyId = new IdReference
													{
														name = varName,
														path = $"objects/{objname}/{objname}.yy"
													},
													objectId = new IdReference
													{
														name = objname,
														path = $"objects/{objname}/{objname}.yy"
													},
													value = varValue
												});
											}
										}
									}
									catch (Exception e)
									{
										if (!skipErrors)
											ScriptError("An " + objname + " with the ID of " + i.InstanceID + "\nfailed to decompile its room pre-creation code in {exportedRoom.name}!\n\n" + e.ToString());
										else
											errorList.Add($"{exportedRoom.name} - {objname} ({i.InstanceID}) Pre-Create - {e.Message}");
									}
								}

								string roomcreate = rootPath + roomPath + "InstanceCreationCode_" + inst.name + ".gml";
								if (code != "")
									File.WriteAllText(roomcreate, code);

								string objpath = "objects/" + objname + "/" + objname + ".yy"; ;
								inst.objectId = new IdReference
								{
									name = objname,
									path = objpath
								};

								instLayer.instances.Add(inst);
							}
						}

						if (l.EffectData != null)
						{
							instLayer.effectType = l.EffectType.Content;
							instLayer.effectEnabled = l.EffectEnabled;

							foreach (var i in l.EffectProperties)
							{
								instLayer.properties.Add(new GMRoom.GMRLayer.GMEffectProp()
								{
									type = (int)i.Kind,
									name = i.Name.Content,
									value = i.Value.Content
								});
							}
						}
						exportedRoom.layers.Add(instLayer);
						break;

					case UndertaleRoom.LayerType.Tiles: // Tiles
						var tileLayer = new GMRoom.GMRTileLayer
						{
							name = l.LayerName.Content,
							depth = l.LayerDepth,
							visible = l.IsVisible,
							userdefinedDepth = (l.LayerDepth != lid * 100)
						};

						var tile = l.TilesData;
						if (tile != null)
						{
							if (tile.Background != null)
							{
								string tilename = tile.Background.Name.Content;
								string tilepath = "tilesets/" + tilename + "/" + tilename + ".yy";
								tileLayer.tilesetId = new IdReference
								{
									name = tilename,
									path = tilepath
								};
							}

							tileLayer.x = (int)l.XOffset;
							tileLayer.y = (int)l.YOffset;

							var tileset = new TileMap((int)tile.TilesX, (int)tile.TilesY)
							{
								SerialiseWidth = (int)tile.TilesX,
								SerialiseHeight = (int)tile.TilesY
							};

							// make tile data
							for (int x = 0; x < tile.TilesY; x++)
							{
								for (int y = 0; y < tile.TilesX; y++)
									tileset.TileSerialiseData.Add(tile.TileData[x][y]);
							}
							tileLayer.tiles = tileset;
						}

						if (l.EffectData != null)
						{
							tileLayer.effectType = l.EffectType.Content;
							tileLayer.effectEnabled = l.EffectEnabled;

							foreach (var i in l.EffectProperties)
							{
								tileLayer.properties.Add(new GMRoom.GMRLayer.GMEffectProp()
								{
									type = (int)i.Kind,
									name = i.Name.Content,
									value = i.Value.Content
								});
							}
						}
						exportedRoom.layers.Add(tileLayer);
						break;

					case UndertaleRoom.LayerType.Background: // Backgrounds
						var bgLayer = new GMRoom.GMRBackgroundLayer
						{
							name = l.LayerName.Content,
							depth = l.LayerDepth,
							visible = l.IsVisible,
							userdefinedDepth = (l.LayerDepth != lid * 100)
						};

						var bg = l.BackgroundData;
						if (bg != null)
						{
							if (bg.Sprite != null)
							{
								string bgname = bg.Sprite.Name.Content;
								string bgpath = "sprites/" + bgname + "/" + bgname + ".yy";
								bgLayer.spriteId = new IdReference
								{
									name = bgname,
									path = bgpath
								};
							}

							if (!bg.Visible)
								bgLayer.visible = false;
							bgLayer.htiled = bg.TiledHorizontally;
							bgLayer.vtiled = bg.TiledVertically;
							bgLayer.hspeed = l.HSpeed;
							bgLayer.vspeed = l.VSpeed;
							bgLayer.stretch = bg.Stretch;
							bgLayer.colour = bg.Color;
							bgLayer.animationFPS = bg.AnimationSpeed;
							bgLayer.animationSpeedType = (int)bg.AnimationSpeedType;
							bgLayer.x = (int)l.XOffset;
							bgLayer.y = (int)l.YOffset;
						}

						if (l.EffectData != null)
						{
							bgLayer.effectType = l.EffectType.Content;
							bgLayer.effectEnabled = l.EffectEnabled;

							foreach (var i in l.EffectProperties)
							{
								bgLayer.properties.Add(new GMRoom.GMRLayer.GMEffectProp()
								{
									type = (int)i.Kind,
									name = i.Name.Content,
									value = i.Value.Content
								});
							}
						}
						exportedRoom.layers.Add(bgLayer);
						break;

					case UndertaleRoom.LayerType.Assets: // Assets
						var assetLayer = new GMRoom.GMRAssetLayer
						{
							name = l.LayerName.Content,
							depth = l.LayerDepth,
							visible = l.IsVisible,
							userdefinedDepth = (l.LayerDepth != lid * 100)
						};

						if (l.AssetsData != null)
						{
							assetLayer.assets = new List<GMRoom.GMRAssetLayer.GMRAsset>();

							// normal assets
							foreach (var i in l.AssetsData.Sprites)
							{
								if (i == null || i.Sprite == null)
									continue;

								var ass = new GMRoom.GMRAssetLayer.GMRSpriteGraphic();

								ass.x = (float)i.X;
								ass.y = (float)i.Y;
								ass.scaleX = i.ScaleX;
								ass.scaleY = i.ScaleY;
								ass.colour = i.Color;
								ass.animationSpeed = i.AnimationSpeed;
								ass.headPosition = i.FrameIndex;
								ass.rotation = i.Rotation;
								ass.name = i.Name.Content;

								string assname = i.Sprite.Name.Content;
								string asspath = "sprites/" + assname + "/" + assname + ".yy";
								ass.spriteId = new IdReference
								{
									name = assname,
									path = asspath
								};

								assetLayer.assets.Add(ass);
							}

							// legacy tiles
							foreach (var i in l.AssetsData.LegacyTiles)
							{
								var ass = new GMRoom.GMRAssetLayer.GMRGraphic();

								ass.x = (float)i.X;
								ass.y = (float)i.Y;
								ass.w = i.Width;
								ass.h = i.Height;
								ass.u0 = i.SourceX;
								ass.v0 = i.SourceY;
								ass.u1 = i.SourceX + i.Width;
								ass.v1 = i.SourceY + i.Height;
								ass.name = instName((int)i.InstanceID);

								if (i.ObjectDefinition != null)
								{
									string assname = i.ObjectDefinition.Name.Content;
									string asspath = "sprites/" + assname + "/" + assname + ".yy";
									ass.spriteId = new IdReference
									{
										name = assname,
										path = asspath
									};
								}
								assetLayer.assets.Add(ass);
							}
						}

						if (l.EffectData != null)
						{
							assetLayer.effectType = l.EffectType.Content;
							assetLayer.effectEnabled = l.EffectEnabled;

							foreach (var i in l.EffectProperties)
							{
								assetLayer.properties.Add(new GMRoom.GMRLayer.GMEffectProp()
								{
									type = (int)i.Kind,
									name = i.Name.Content,
									value = i.Value.Content
								});
							}
						}
						exportedRoom.layers.Add(assetLayer);
						break;

					case UndertaleRoom.LayerType.Effect: // Effects
						var effectLayer = new GMRoom.GMREffectLayer
						{
							name = l.LayerName.Content,
							depth = l.LayerDepth,
							visible = l.IsVisible,
							userdefinedDepth = (l.LayerDepth != lid * 100)
						};

						if (l.EffectData != null)
						{
							effectLayer.effectType = l.EffectType.Content;
							effectLayer.effectEnabled = l.EffectEnabled;

							foreach (var i in l.EffectProperties)
							{
								effectLayer.properties.Add(new GMRoom.GMRLayer.GMEffectProp()
								{
									type = (int)i.Kind,
									name = i.Name.Content,
									value = i.Value.Content
								});
							}
						}
						exportedRoom.layers.Add(effectLayer);
						break;
				}
			}
		}
	}

	// convert GMS1 rooms to GMS2
	else
	{
		// add instances layer
		int lDepth = 0;
		var instlayer = new GMRoom.GMRInstanceLayer
		{
			name = "Instances_1",
			depth = 0,
		};

		foreach (var i in room.GameObjects)
		{
			var inst = new GMRoom.GMRInstanceLayer.GMRInstance();

			inst.name = instName((int)i.InstanceID);
			inst.x = i.X;
			inst.y = i.Y;
			inst.hasCreationCode = (i.CreationCode != null);
			inst.scaleX = i.ScaleX;
			inst.scaleY = i.ScaleY;
			inst.colour = i.Color;
			inst.rotation = i.Rotation;
			inst.imageSpeed = i.ImageSpeed;
			inst.imageIndex = i.ImageIndex;

			string objname = i.ObjectDefinition.Name.Content;
			string roomcreate = rootPath + roomPath + "InstanceCreationCode_" + inst.name + ".gml";

			string code = "";
			if (i.CreationCode != null)
			{
				try
				{
					code = decompileCode(i.CreationCode);
				}
				catch (Exception e)
				{
					if (!skipErrors)
						ScriptError("An " + objname + " with the ID of " + i.InstanceID + "\nfailed to decompile its room creation code in " + exportedRoom.name + "!\n\n" + e.ToString());
					else
						errorList.Add($"{exportedRoom.name} - {objname} ({i.InstanceID}) - {e.Message}");
					code = "/* (decompilation failed.) */\n";
				}
			}
			if (code != "")
				File.WriteAllText(roomcreate, code);

			string objpath = "objects/" + objname + "/" + objname + ".yy";
			inst.objectId = new IdReference
			{
				name = objname,
				path = objpath
			};

			instlayer.instances.Add(inst);
		}
		exportedRoom.layers.Add(instlayer);

		// compatibility tiles layer
		List<int> tiledepths = new List<int>();
		foreach (var i in room.Tiles)
		{
			if (!tiledepths.Contains(i.TileDepth))
				tiledepths.Add(i.TileDepth);
		}
		tiledepths.Sort();

		foreach (var j in tiledepths)
		{
			var tilelayer = new GMRoom.GMRAssetLayer
			{
				name = $"Tiles_Depth{j}",
				depth = j,
			};

			foreach (var i in room.Tiles)
			{
				if (i.BackgroundDefinition != null && i.TileDepth == j)
				{
					var graphic = new GMRoom.GMRAssetLayer.GMRGraphic
					{
						spriteId = new IdReference
						{
							name = i.BackgroundDefinition.Name.Content,
							path = $"sprites/{i.BackgroundDefinition.Name.Content}/{i.BackgroundDefinition.Name.Content}.yy"
						},
						x = (float)i.X,
						y = (float)i.Y,
						w = i.Width,
						h = i.Height,
						u0 = i.SourceX,
						v0 = i.SourceY,
						u1 = i.SourceX + i.Width,
						v1 = i.SourceY + i.Height,
						colour = i.Color
					};
					tilelayer.assets.Add(graphic);
				}
			}
			exportedRoom.layers.Add(tilelayer);

			lDepth = j;
		}

		// background layers
		bool dobgcolor = room.DrawBackgroundColor;
		for (var i = 0; i < room.Backgrounds.Count; i++)
		{
			var bg = room.Backgrounds[i];
			if (bg.BackgroundDefinition != null)
			{
				if (bg.Enabled)
					dobgcolor = false;

				string bgname = bg.BackgroundDefinition.Name.Content;
				string bgpath = "sprites/" + bgname + "/" + bgname + ".yy";

				var bglayer = new GMRoom.GMRBackgroundLayer
				{
					name = "Backgrounds_" + (i + 1),
					depth = lDepth + ((i + 1) * (bg.Foreground ? -100 : 100)),
					visible = bg.Enabled,
					x = bg.X,
					y = bg.Y,
					hspeed = bg.SpeedX,
					vspeed = bg.SpeedY,
					stretch = bg.Stretch,
					htiled = bg.TiledHorizontally,
					vtiled = bg.TiledVertically
				};

				bglayer.spriteId = new IdReference
				{
					name = bgname,
					path = bgpath
				};
				exportedRoom.layers.Add(bglayer);
			}
		}

		if (dobgcolor)
		{
			var bglayer = new GMRoom.GMRBackgroundLayer
			{
				name = "Backgrounds_1",
				depth = 100,
				colour = room.BackgroundColor
			};
			exportedRoom.layers.Add(bglayer);
		}
	}

	// finish
	doJson(exportedRoom, roomPath + $"{exportedRoom.name}.yy");
	AddResource(new IdReference
	{
		name = exportedRoom.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpTileset(UndertaleBackground bg)
{
	// make tileset into a sprite
	var exportedSprite = new GMSprite
	{
		name = (Data.IsGameMaker2() ? "tilespr_" : "") + bg.Name.Content,
		width = (int)bg.Texture.TargetWidth,
		height = (int)bg.Texture.TargetHeight,
		bbox_left = 0,
		bbox_right = (int)bg.Texture.TargetWidth - 1,
		bbox_bottom = (int)bg.Texture.TargetHeight - 1,
		bbox_top = 0,
		origin = 0
	};

	// make the tileset
	GMTileSet exportedTileset = new GMTileSet
	{
		name = bg.Name.Content,
		tileWidth = (int)bg.GMS2TileWidth,
		tileHeight = (int)bg.GMS2TileHeight,
		out_columns = (int)bg.GMS2TileColumns,
		tile_count = (int)bg.GMS2TileCount,
		tileAnimationSpeed = (float)(Math.Floor((double)(1000000 / bg.GMS2FrameLength) * 100) / 100),
		spriteNoExport = false, // we can't be sure that original sprite is used, so just in case...

		/*
			we can't automatically sort the tileset because the
			original columns are unknown, so a sacrifice must be made.
		*/
		tilexoff = (int)bg.GMS2OutputBorderX,
		tileyoff = (int)bg.GMS2OutputBorderY,
		tilehsep = (int)bg.GMS2OutputBorderX * 2,
		tilevsep = (int)bg.GMS2OutputBorderY * 2
	};

	// paths
	string tilesetPath = "tilesets/" + exportedTileset.name + "/";
	string exportedPath = $"tilesets/{exportedTileset.name}/{exportedTileset.name}.yy";
	string newFolderName = "Backgrounds";

	if (Data.IsGameMaker2())
	{
		newFolderName = "GMS2 TileSets";
		Directory.CreateDirectory(rootPath + tilesetPath);

		// folder
		exportedTileset.parent = new IdReference
		{
			name = "Tile Sets",
			path = "folders/Tile Sets.yy"
		};
		if (_APND.Checked) exportedTileset.parent = APNDREF;

		// tile ids
		var fcount = (int)bg.GMS2ItemsPerTileCount;
		exportedTileset.tileAnimation.SerialiseFrameCount = fcount;

		List<uint> lastid = new List<uint>(); // temporary variables
		List<uint> idignorer = new List<uint>();
		foreach (var i in bg.GMS2TileIds)
		{
			exportedTileset.tileAnimation.FrameData.Add(i.ID);
			if (fcount > 1)
			{
				if (lastid.Count >= fcount)
				{
					if (lastid.Distinct().Count() > 1 && !idignorer.Any(x => lastid.Any(y => y == x)))
					{
						// found animation
						exportedTileset.tileAnimationFrames.Add(new GMTileSet.GMTileAnimation
						{
							frames = new List<uint>(lastid),
							name = "animation_" + (exportedTileset.tileAnimationFrames.Count + 1)
						});
						idignorer.AddRange(lastid);
					}
					lastid.Clear();
				}
				lastid.Add(i.ID);
			}
		}

		// add the sprite into the tileset
		exportedTileset.spriteId = new IdReference
		{
			name = exportedSprite.name,
			path = $"sprites/{exportedSprite.name}/{exportedSprite.name}.yy"
		};
	}

	// sprite folders
	string spritePath = $"sprites/{exportedSprite.name}/";
	Directory.CreateDirectory(rootPath + spritePath);
	string spriteYYPath = $"{spritePath}{exportedSprite.name}.yy";

	// animation sequence
	exportedSprite.sequence = new GMSequence
	{
		spriteId = new IdReference
		{
			name = exportedSprite.name,
			path = spriteYYPath
		},
		playbackSpeed = 1,
		playbackSpeedType = 1,
		length = 1,
		name = exportedSprite.name,

		/*
		parent = new IdReference
		{
			name = exportedSprite.name,
			path = spriteYYPath
		}
		*/
	};

	// export texture as sprite
	string tgrp = "Default";
	var baseTrack = new GMSpriteFramesTrack();
	string layerGuid = Guid.NewGuid().ToString();
	exportedSprite.layers.Add(new GMSprite.GMImageLayer { name = layerGuid });

	// texture group
	if (tpageAlign.ContainsKey(bg.Texture.TexturePage.Name.Content))
		tgrp = tpageAlign[bg.Texture.TexturePage.Name.Content];
	else if (tpageAlign.ContainsKey(bg.Name.Content))
		tgrp = tpageAlign[bg.Name.Content];

	// make guids and stuff
	string compositeGuid = Guid.NewGuid().ToString();
	string layersPath = rootPath + spritePath + "layers/" + compositeGuid + "/";
	Directory.CreateDirectory(layersPath);

	// extract images
	Bitmap img;
	try
	{
		// fetch bitmap image
		img = worker.GetTextureFor(bg.Texture, compositeGuid + ".png", true);
	}
	catch
	{
		// give up immediately and make an empty image
		img = new Bitmap(exportedSprite.width, exportedSprite.height);
	}
	
	TextureWorker.SaveImageToFile(rootPath + spritePath + compositeGuid + ".png", img, false);
	TextureWorker.SaveImageToFile(layersPath + layerGuid + ".png", img, false);
	if (Data.IsGameMaker2())
		TextureWorker.SaveImageToFile(rootPath + tilesetPath + "output_tileset.png", img, false);
	
	img.Dispose();

	// add to frames
	var spriteFrame = new GMSprite.GMSpriteFrame();
	spriteFrame.name = compositeGuid;

	// pre-2022.8
	/*
	spriteFrame.compositeImage.FrameId = new IdReference
	{
		name = compositeGuid,
		path = spriteYYPath
	};
	spriteFrame.parent = new IdReference
	{
		name = exportedSprite.name,
		path = spriteYYPath
	};

	var spriteFrame2 = new GMSprite.GMSpriteBitmap();
	spriteFrame2.FrameId = new IdReference
	{
		name = compositeGuid,
		path = spriteYYPath
	};
	spriteFrame2.LayerId = new IdReference
	{
		name = layerGuid,
		path = spriteYYPath
	};

	spriteFrame.images.Add(spriteFrame2);
	*/

	exportedSprite.frames.Add(spriteFrame);

	// add to sequence
	var channelId = new IdReference
	{
		name = compositeGuid,
		path = spriteYYPath
	};
	var keyframe = new Keyframe<SpriteFrameKeyframe>
	{
		Key = 0.0f,
		Length = 1.0f,
	};
	keyframe.Channels.Add("0", new SpriteFrameKeyframe { Id = channelId });
	baseTrack.keyframes.Keyframes.Add(keyframe);
	exportedSprite.sequence.tracks.Add(baseTrack);

	// apply texture page
	if (tgrp.StartsWith("__YY__") && tgrp.Contains("_YYG_AUTO_GEN_TEX_GROUP_NAME_"))
		exportedSprite.For3D = true;
	else
	{
		exportedSprite.textureGroupId = new IdReference
		{
			name = tgrp,
			path = $"texturegroups/{tgrp}"
		};
	}

	// finish
	if (_APND.Checked)
		exportedSprite.parent = APNDREF;
	else
	{
		addFolder(newFolderName, $"Sprites/{newFolderName}", Data.Sprites.Count);
		exportedSprite.parent = new IdReference
		{
			name = newFolderName,
			path = $"folders/Sprites/{newFolderName}.yy"
		};
	}

	doJson(exportedSprite, spritePath + $"{exportedSprite.name}.yy");
	AddResource(new IdReference
	{
		name = exportedSprite.name,
		path = spriteYYPath
	});

	if (Data.IsGameMaker2())
	{
		exportedTileset.textureGroupId = exportedSprite.textureGroupId;

		// tags
		var tagid = UndertaleTags.GetAssetTagID(Data, bg);
		if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
		{
			foreach (var tag in Data.Tags.AssetTags[tagid])
			{
				exportedTileset.tags.Add(tag.Content);
				exportedSprite.tags.Add(tag.Content);
			}
		}

		doJson(exportedTileset, tilesetPath + $"{exportedTileset.name}.yy");
		AddResource(new IdReference
		{
			name = exportedTileset.name,
			path = exportedPath
		});
	}
	UpdateProgress();
}

void DumpScript(UndertaleScript scr)
{
	if ((scr.Code != null && scr.Code.ParentEntry != null) || (scr.Code == null && scr.Name.Content.StartsWith("gml_Script_")))
	{
		UpdateProgress();
		return;
	}

	var exportedScript = new GMScript
	{
		name = scr.Name.Content.Replace("gml_Script_", ""),
		//isCompatibility = !Data.GMS2_3
	};

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, scr);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedScript.tags.Add(tag.Content);
	}

	// folder
	exportedScript.parent = new IdReference
	{
		name = "Scripts",
		path = "folders/Scripts.yy"
	};
	if (_APND.Checked) exportedScript.parent = APNDREF;

	// paths
	string scriptPath = "scripts/" + exportedScript.name + "/";
	string exportedPath = $"scripts/{exportedScript.name}/{exportedScript.name}.yy";
	Directory.CreateDirectory(rootPath + scriptPath);

	// export code
	string code = "";
	if (scr.Code != null)
	{
		try
		{
			code = decompileCode(scr.Code);
		}
		catch (Exception e)
		{
			if (!skipErrors)
				ScriptError("The script " + exportedScript.name + " failed to decompile its code!\n\n" + e.ToString());
			else
				errorList.Add($"{exportedScript.name} - {e.Message}");
			code = "/* (decompilation failed.) */\n";
		}
	}

	if (code != "")
		File.WriteAllText(rootPath + scriptPath + exportedScript.name + ".gml", code);

	// finish
	doJson(exportedScript, scriptPath + $"{exportedScript.name}.yy");
	AddResource(new IdReference
	{
		name = exportedScript.name,
		path = exportedPath
	});
	UpdateProgress();
}

WaveFileReader wavReader;
VorbisWaveReader oggReader;
Mp3FileReader mp3Reader;

void DumpSound(UndertaleSound snd)
{
	var exportedSound = new GMSound
	{
		name = snd.Name.Content,
		volume = snd.Volume,
		preload = snd.Preload,
	};
	if (snd.File != null && snd.File.Content != "")
		exportedSound.soundFile = snd.File.Content;

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, snd);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedSound.tags.Add(tag.Content);
	}

	// compression type
	if (snd.Flags.HasFlag(UndertaleSound.AudioEntryFlags.IsDecompressedOnLoad))
		exportedSound.compression = 2;
	else if (snd.Flags.HasFlag(UndertaleSound.AudioEntryFlags.IsCompressed))
		exportedSound.compression = 1;
	else if (snd.Flags.HasFlag(UndertaleSound.AudioEntryFlags.IsEmbedded))
		exportedSound.compression = 0;
	else if (File.Exists(dataPath + exportedSound.soundFile))
		exportedSound.compression = 3;
	else
		return;
	
	// audio group
	string agrp = "audiogroup_default";

	var tryagrp = Data.AudioGroups.ElementAtOrDefault(snd.GroupID);
	if (tryagrp == null)
		tryagrp = Data.AudioGroups.ByName(agrp);
	if (tryagrp != null)
		agrp = tryagrp.Name.Content;

	exportedSound.audioGroupId = new IdReference
	{
		name = agrp,
		path = $"audiogroups/{agrp}"
	};

	// paths
	string soundPath = "sounds/" + exportedSound.name + "/";
	string exportedPath = $"sounds/{exportedSound.name}/{exportedSound.name}.yy";
	Directory.CreateDirectory(rootPath + soundPath);

	// export sound
	if (exportedSound.soundFile != null)
	{
		string soundFilePath = rootPath + soundPath + exportedSound.soundFile;
		try
		{
			if (snd.GroupID != 0 && File.Exists(dataPath + $"audiogroup{snd.GroupID}.dat"))
			{
				UndertaleData data = null;
				using (var stream = new FileStream(dataPath + $"audiogroup{snd.GroupID}.dat", FileMode.Open, FileAccess.Read))
					data = UndertaleIO.Read(stream);
				File.WriteAllBytes(soundFilePath, data.EmbeddedAudio[snd.AudioID].Data);
			}
			else if (snd.AudioFile != null)
				File.WriteAllBytes(soundFilePath, snd.AudioFile.Data);
			else if (File.Exists(dataPath + exportedSound.soundFile))
				File.Copy(dataPath + exportedSound.soundFile, soundFilePath, true);

			// read the file
			byte[] dat = File.ReadAllBytes(soundFilePath);

			// some audio files might be all null characters
			if (dat.All(i => i == 0))
			{
				File.Delete(soundFilePath);
				exportedSound.soundFile = "";
			}
			else
			{
				// get audio properties
				WaveStream wavReader = null;

				if (dat != null && dat.Length > 4)
				{
					if (dat[0] == 'R' && dat[1] == 'I' && dat[2] == 'F' && dat[3] == 'F')
						wavReader = new WaveFileReader(soundFilePath);
					else if (dat[0] == 'O' && dat[1] == 'g' && dat[2] == 'g' && dat[3] == 'S')
						wavReader = new VorbisWaveReader(soundFilePath);
					else
					{
						try
						{
							wavReader = new Mp3FileReader(soundFilePath);
						}
						catch { } // please stop trying
					}
				}

				if (wavReader != null)
				{
					exportedSound.sampleRate = wavReader.WaveFormat.SampleRate;
					exportedSound.type = wavReader.WaveFormat.Channels - 1;

					var audiolen = wavReader.TotalTime;
					exportedSound.duration = (((float)audiolen.Hours * 60) * 60) + ((float)audiolen.Minutes * 60) + (float)audiolen.Seconds + ((float)audiolen.Milliseconds / 1000);
				}
			}
		}
		catch (Exception e)
		{
			if (!skipErrors)
				ScriptError($"The sound {snd.Name.Content} failed to export!\n\n{e.ToString()}");
			else
				errorList.Add($"{snd.Name.Content} - {e.Message}");
		}
	}

	// folder
	exportedSound.parent = new IdReference
	{
		name = "Sounds",
		path = "folders/Sounds.yy"
	};
	if (_APND.Checked) exportedSound.parent = APNDREF;

	// finish
	doJson(exportedSound, soundPath + $"{exportedSound.name}.yy");
	AddResource(new IdReference
	{
		name = exportedSound.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpShader(UndertaleShader shd)
{
	var exportedShader = new GMShader
	{
		name = shd.Name.Content,
	};

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, shd);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedShader.tags.Add(tag.Content);
	}

	// folder
	exportedShader.parent = new IdReference
	{
		name = "Shaders",
		path = "folders/Shaders.yy"
	};
	if (_APND.Checked) exportedShader.parent = APNDREF;

	// paths
	string shaderPath = "shaders/" + exportedShader.name + "/";
	string exportedPath = $"shaders/{exportedShader.name}/{exportedShader.name}.yy";
	Directory.CreateDirectory(rootPath + shaderPath);

	// shader type
	switch((int)shd.Type)
	{
		case 1: exportedShader.type = 1; break;
		case 2: exportedShader.type = 2; break;
		case 4: exportedShader.type = 3; break;
		case 5: exportedShader.type = 4; break;
	}

	// port shader vertex and fragment
	var vertex = shd.GLSL_ES_Vertex.Content;
	var fragment = shd.GLSL_ES_Fragment.Content;

	if (vertex != null && fragment != null)
	{
		string splitter = "#define _YY_GLSLES_ 1\n";
		if (vertex.Contains(splitter))
			vertex = vertex.Substring(vertex.IndexOf(splitter) + splitter.Length);
		if (fragment.Contains(splitter))
			fragment = fragment.Substring(fragment.IndexOf(splitter) + splitter.Length);

		File.WriteAllText(rootPath + shaderPath + exportedShader.name + ".vsh", vertex);
		File.WriteAllText(rootPath + shaderPath + exportedShader.name + ".fsh", fragment);
	}

	// finish
	doJson(exportedShader, shaderPath + $"{exportedShader.name}.yy");
	AddResource(new IdReference
	{
		name = exportedShader.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpFont(UndertaleFont font)
{
	var exportedFont = new GMFont
	{
		name = font.Name.Content,
		size = (float)font.EmSize,
		fontName = font.DisplayName.Content,
		first = (int)font.RangeStart,
		last = (int)font.RangeEnd,
		AntiAlias = (int)font.AntiAliasing,
		ascenderOffset = (int)font.AscenderOffset,
		ascender = (int)font.Ascender,
		canGenerateBitmap = false,
		maintainGms1Font = true,
	};
	if (font.Bold)
	{
		exportedFont.styleName = "Bold";
		if (font.Italic)
			exportedFont.styleName = "Bold Italic";
	}
	else if (font.Italic)
		exportedFont.styleName = "Italic";

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, font);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedFont.tags.Add(tag.Content);
	}

	// folder
	exportedFont.parent = new IdReference
	{
		name = "Fonts",
		path = "folders/Fonts.yy"
	};
	if (_APND.Checked) exportedFont.parent = APNDREF;

	// paths
	string fontPath = "fonts/" + exportedFont.name + "/";
	string exportedPath = $"fonts/{exportedFont.name}/{exportedFont.name}.yy";
	Directory.CreateDirectory(rootPath + fontPath);

	// port glyphs
	foreach (var glyph in font.Glyphs)
	{
		exportedFont.glyphs[(int)glyph.Character] = new GMFont.Glyph
		{
			x = (int)glyph.SourceX,
			y = (int)glyph.SourceY,
			w = (int)glyph.SourceWidth,
			h = (int)glyph.SourceHeight,
			shift = (int)glyph.Shift,
			offset = (int)glyph.Offset,
			character = (int)glyph.Character
		};
	}

	// export font sprite
	string tgrp = "Default";
	if (font.Texture != null)
	{
		worker.ExportAsPNG(font.Texture, rootPath + fontPath + exportedFont.name + ".png", null, true);

		if (tpageAlign.ContainsKey(font.Texture.TexturePage.Name.Content))
			tgrp = tpageAlign[font.Texture.TexturePage.Name.Content];
		else if (tpageAlign.ContainsKey(exportedFont.name))
			tgrp = tpageAlign[exportedFont.name];
	}
	exportedFont.textureGroupId = new IdReference
	{
		name = tgrp,
		path = $"texturegroups/{tgrp}"
	};

	// finish
	doJson(exportedFont, fontPath + $"{exportedFont.name}.yy");
	AddResource(new IdReference
	{
		name = exportedFont.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpPath(UndertalePath path)
{
	var exportedPth = new GMPath
	{
		name = path.Name.Content,
		kind = (path.IsSmooth ? 1 : 0),
		closed = path.IsClosed,
		precision = (int)path.Precision
	};

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, path);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedPth.tags.Add(tag.Content);
	}

	// add path points
	foreach (var point in path.Points)
	{
		exportedPth.points.Add(new GMPath.PathPoint
		{
			x = point.X,
			y = point.Y,
			speed = point.Speed
		});
	}

	// folder
	exportedPth.parent = new IdReference
	{
		name = "Paths",
		path = "folders/Paths.yy"
	};
	if (_APND.Checked) exportedPth.parent = APNDREF;

	// paths
	string pathPath = "paths/" + exportedPth.name + "/";
	string exportedPath = $"paths/{exportedPth.name}/{exportedPth.name}.yy";
	Directory.CreateDirectory(rootPath + pathPath);

	// finish
	doJson(exportedPth, pathPath + $"{exportedPth.name}.yy");
	AddResource(new IdReference
	{
		name = exportedPth.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpTimeline(UndertaleTimeline tl)
{
	var exportedTL = new GMTimeline
	{
		name = tl.Name.Content,
	};

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, tl);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedTL.tags.Add(tag.Content);
	}

	// folder
	exportedTL.parent = new IdReference
	{
		name = "Timelines",
		path = "folders/Timelines.yy"
	};
	if (_APND.Checked) exportedTL.parent = APNDREF;

	// paths
	string tlPath = "timelines/" + exportedTL.name + "/";
	string exportedPath = $"timelines/{exportedTL.name}/{exportedTL.name}.yy";
	Directory.CreateDirectory(rootPath + tlPath);

	// moments
	foreach (var tm in tl.Moments)
	{
		exportedTL.momentList.Add(new GMMoment
		{
			moment = (int)tm.Step,
			evnt = new GMEvent
			{
				eventNum = (int)tm.Step
			}
		});

		string code = "";
		foreach (var m in tm.Event)
		{
			if (m.CodeId != null)
			{
				try
				{
					code += decompileCode(m.CodeId);
				}
				catch (Exception e)
				{
					code += "/* (decompilation failed.) */\n";
				}
			}
		}
		File.WriteAllText(rootPath + tlPath + $"moment_{tm.Step}.gml", code);
	}

	// finish
	doJson(exportedTL, tlPath + $"{exportedTL.name}.yy");
	AddResource(new IdReference
	{
		name = exportedTL.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpSequence(UndertaleSequence seq)
{
	var exportedSeq = new GMSequence
	{
		name = seq.Name.Content,
		playback = (int)seq.Playback,
		playbackSpeed = seq.PlaybackSpeed,
		playbackSpeedType = (int)seq.PlaybackSpeedType,
		length = seq.Length,
		xorigin = seq.OriginX,
		yorigin = seq.OriginY,
		volume = seq.Volume,
	};
	string stubscript = "";

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, seq);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedSeq.tags.Add(tag.Content);
	}

	// folder
	exportedSeq.parent = new IdReference
	{
		name = "Sequences",
		path = "folders/Sequences.yy"
	};
	if (_APND.Checked) exportedSeq.parent = APNDREF;

	// paths
	string seqPath = "sequences/" + exportedSeq.name + "/";
	string exportedPath = $"sequences/{exportedSeq.name}/{exportedSeq.name}.yy";
	Directory.CreateDirectory(rootPath + seqPath);

	// tracks
	List<GMBaseTrack> DumpTracks(ICollection<UndertaleSequence.Track> tracks)
	{
		var tracklist = new List<GMBaseTrack>();

		foreach (var track in tracks)
		{
			GMBaseTrack GMTrack = null;
			switch (track.ModelName.Content)
			{
				default:
					if (!skipErrors)
						throw new Exception($"Unimplemented sequence track type in {seq.Name.Content}: \"{track.ModelName.Content}\"");
					else
					{
						var errorStr = $"{exportedSeq.name} - Unimplemented sequence track type \"{track.ModelName.Content}\"";
						if (!errorList.Contains(errorStr))
							errorList.Add(errorStr);
					}
					break;

				case "GMGroupTrack":
					GMTrack = new GMGroupTrack();
					break;
				
				case "GMClipMaskTrack": // contains the mask and subject tracks as subtracks, but has no data of it's own
					GMTrack = new GMClipMaskTrack();
					break;
				case "GMClipMask_Mask":
					GMTrack = new GMClipMask_Mask();
					break;
				case "GMClipMask_Subject":
					GMTrack = new GMClipMask_Subject();
					break;

				case "GMAudioTrack":
					GMTrack = new GMAudioTrack();
					foreach (var keyframe in (track.Keyframes as UndertaleSequence.AudioKeyframes).List)
					{
						var GMKeyframe = new Keyframe<AudioKeyframe>
						{
							Key = keyframe.Key,
							Length = keyframe.Length,
							Stretch = keyframe.Stretch,
							Disabled = keyframe.Disabled,
						};

						foreach (var ch in keyframe.Channels)
						{
							var resourceName = ch.Value.Resource.Resource.Name.Content;
							var value = new AudioKeyframe
							{
								Mode = ch.Value.Mode,
								Id = new IdReference
								{
									name = resourceName,
									path = $"sounds/{resourceName}/{resourceName}.yy",
								}
							};
							GMKeyframe.Channels.Add(ch.Key.ToString(), value);
						}
						
						(GMTrack as GMAudioTrack).keyframes.Keyframes.Add(GMKeyframe);
					}
					break;

				case "GMGraphicTrack":
					GMTrack = new GMGraphicTrack();
					foreach (var keyframe in (track.Keyframes as UndertaleSequence.GraphicKeyframes).List)
					{
						var GMKeyframe = new Keyframe<AssetSpriteKeyframe>
						{
							Key = keyframe.Key,
							Length = keyframe.Length,
							Stretch = keyframe.Stretch,
							Disabled = keyframe.Disabled,
						};

						foreach (var ch in keyframe.Channels)
						{
							var resourceName = ch.Value.Resource.Resource.Name.Content;

							var value = new AssetSpriteKeyframe();
							value.Id = new IdReference
							{
								name = resourceName,
								path = $"sprites/{resourceName}/{resourceName}.yy",
							};
							GMKeyframe.Channels.Add(ch.Key.ToString(), value);
						}

						(GMTrack as GMGraphicTrack).keyframes.Keyframes.Add(GMKeyframe);
					}
					break;

				case "GMInstanceTrack":
					GMTrack = new GMInstanceTrack();
					foreach (var keyframe in (track.Keyframes as UndertaleSequence.InstanceKeyframes).List)
					{
						var GMKeyframe = new Keyframe<AssetInstanceKeyframe>
						{
							Key = keyframe.Key,
							Length = keyframe.Length,
							Stretch = keyframe.Stretch,
							Disabled = keyframe.Disabled,
						};

						foreach (var ch in keyframe.Channels)
						{
							var resourceName = ch.Value.Resource.Resource.Name.Content;

							var value = new AssetInstanceKeyframe();
							value.Id = new IdReference
							{
								name = resourceName,
								path = $"objects/{resourceName}/{resourceName}.yy",
							};
							GMKeyframe.Channels.Add(ch.Key.ToString(), value);
						}

						(GMTrack as GMInstanceTrack).keyframes.Keyframes.Add(GMKeyframe);
					}
					break;

				case "GMRealTrack":
					GMTrack = new GMRealTrack();
					GMTrack.interpolation = (track.Keyframes as UndertaleSequence.RealKeyframes).Interpolation;

					foreach (var keyframe in (track.Keyframes as UndertaleSequence.RealKeyframes).List)
					{
						var GMKeyframe = new Keyframe<RealKeyframe>
						{
							Key = keyframe.Key,
							Length = keyframe.Length,
							Stretch = keyframe.Stretch,
							Disabled = keyframe.Disabled,
						};

						foreach (var ch in keyframe.Channels)
						{
							var value = new RealKeyframe
							{
								RealValue = ch.Value.Value,
							};
							if (ch.Value.AssetAnimCurve != null && ch.Value.AssetAnimCurve.Resource != null)
							{
								var n = ch.Value.AssetAnimCurve.Resource.Name.Content;
								value.AnimCurveId = new IdReference
								{
									name = n,
									path = $"animcurves/{n}/{n}.yy"
								};
							}
							GMKeyframe.Channels.Add(ch.Key.ToString(), value);
						}

						(GMTrack as GMRealTrack).keyframes.Keyframes.Add(GMKeyframe);
					}
					break;

				case "GMColourTrack": // doesnt even work cuz utmt is trying to read an uint as a float
					GMTrack = new GMColourTrack();
					GMTrack.interpolation = (track.Keyframes as UndertaleSequence.RealKeyframes).Interpolation;

					foreach (var keyframe in (track.Keyframes as UndertaleSequence.RealKeyframes).List)
					{
						var GMKeyframe = new Keyframe<ColourKeyframe>
						{
							Key = keyframe.Key,
							Length = keyframe.Length,
							Stretch = keyframe.Stretch,
							Disabled = keyframe.Disabled,
						};

						foreach (var ch in keyframe.Channels)
						{
							var value = new ColourKeyframe
							{
								Colour = (uint)ch.Value.Value,
							};
							if (ch.Value.AssetAnimCurve != null && ch.Value.AssetAnimCurve.Resource != null)
							{
								var n = ch.Value.AssetAnimCurve.Resource.Name.Content;
								value.AnimCurveId = new IdReference
								{
									name = n,
									path = $"animcurves/{n}/{n}.yy"
								};
							}
							GMKeyframe.Channels.Add(ch.Key.ToString(), value);
						}

						(GMTrack as GMColourTrack).keyframes.Keyframes.Add(GMKeyframe);
					}
					break;

				case "GMTextTrack": // UTMT DOESNT EVEN FUCKING DECOMPILE THIS ONE
					break;
			}
			//if (GMTrack != null)
			//{
			//	GMTrack.name = track.Name.Content;
			//	GMTrack.isCreationTrack = track.IsCreationTrack;
				//GMTrack.builtinName = track.BuiltinName;
			//	GMTrack.traits = track.Traits;
			//	GMTrack.tracks = DumpTracks(track.Tracks);
			//	tracklist.Add(GMTrack);
			//}
		}

		return tracklist;
	}
	exportedSeq.tracks = DumpTracks(seq.Tracks);
	
	// events
	foreach (var i in seq.BroadcastMessages)
	{
		var kf = new Keyframe<MessageEventKeyframe>
		{
			Key = i.Key,
			Length = i.Length,
			Stretch = i.Stretch,
			Disabled = i.Disabled
		};
		foreach (var ch in i.Channels)
		{
			var msg = new MessageEventKeyframe
			{
				Events = new List<string>()
			};
			foreach (var ev in ch.Value.Messages)
				msg.Events.Add(ev.Content);
			kf.Channels.Add(ch.Key.ToString(), msg);
		}
		exportedSeq.events.Keyframes.Add(kf);
	}

	// moments
	foreach (var i in seq.Moments)
	{
		var kf = new Keyframe<MomentsEventKeyframe>
		{
			Key = i.Key,
			Length = i.Length,
			Stretch = i.Stretch,
			Disabled = i.Disabled
		};
		foreach (var ch in i.Channels)
		{
			var msg = new MomentsEventKeyframe
			{
				Events = new List<string>()
			};
			var ev = ch.Value.Event;
			if (ev != null)
			{
				msg.Events.Add(ev.Content.Replace("gml_Script_", ""));

				var try2find = Data.Scripts.ByName(ev.Content);
				if (try2find != null && try2find.Code != null && try2find.Code.ParentEntry != null)
					stubscript = try2find.Code.ParentEntry.Name.Content.Replace("gml_GlobalScript_", "");
			}
			kf.Channels.Add(ch.Key.ToString(), msg);
		}
		exportedSeq.moments.Keyframes.Add(kf);
	}

	// event to function
	foreach (var i in seq.FunctionIDs)
		exportedSeq.eventToFunction.Add(i.Key, i.Value.Content.Replace("gml_Script_", ""));

	// stub script
	if (stubscript != "")
	{
		exportedSeq.eventStubScript = new IdReference
		{
			name = stubscript,
			path = $"scripts/{stubscript}/{stubscript}.yy"
		};
	}

	// finish
	doJson(exportedSeq, seqPath + $"{exportedSeq.name}.yy");
	AddResource(new IdReference
	{
		name = exportedSeq.name,
		path = exportedPath
	});
	UpdateProgress();
}
void DumpExtension(UndertaleExtension ext)
{
	var exportedExt = new GMExtension
	{
		name = ext.Name.Content,
		classname = ext.ClassName.Content,
	};

	// utmt doesn't like tags with this one.

	// folder
	exportedExt.parent = new IdReference
	{
		name = "Extensions",
		path = "folders/Extensions.yy"
	};
	if (_APND.Checked) exportedExt.parent = APNDREF;

	// paths
	string extPath = "extensions/" + exportedExt.name + "/";
	string exportedPath = $"extensions/{exportedExt.name}/{exportedExt.name}.yy";
	Directory.CreateDirectory(rootPath + extPath);

	// file list
	foreach (var file in ext.Files)
	{
		var outFile = new GMExtensionFile
		{
			filename = file.Filename.Content,
			init = file.InitScript.Content,
			final = file.CleanupScript.Content,
			kind = (int)file.Kind
		};

		// files
		if (file.Kind == UndertaleExtensionKind.GML)
		{
			var fileContent = "// UNIMPLEMENTED!!!";

			// loop thru every script that doesn't have a parent, and add it
			// to the ignorer list, i think. i think. probably not. idk.

			File.WriteAllText(rootPath + extPath + outFile.filename, fileContent);
		}
		else if (File.Exists(dataPath + outFile.filename))
			File.Copy(dataPath + outFile.filename, rootPath + extPath + outFile.filename, true);

		// functions
		foreach (var func in file.Functions)
		{
			var outFunc = new GMExtensionFunction()
			{
				name = func.Name.Content,
				externalName = func.ExtName.Content,
				returnType = (int)func.RetType,
				kind = (int)func.Kind,
				argCount = func.Arguments.Count,
			};

			// arguments
			foreach (var arg in func.Arguments)
				outFunc.args.Add((int)arg.Type);

			outFile.functions.Add(outFunc);
		}
		exportedExt.files.Add(outFile);
	}

	// finish
	doJson(exportedExt, extPath + $"{exportedExt.name}.yy");
	AddResource(new IdReference
	{
		name = exportedExt.name,
		path = exportedPath
	});
	UpdateProgress();
}

void DumpCurve(UndertaleAnimationCurve curve)
{
	var exportedCurve = new GMAnimCurve
	{
		name = curve.Name.Content,
	};

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, curve);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedCurve.tags.Add(tag.Content);
	}

	// folder
	exportedCurve.parent = new IdReference
	{
		name = "Animation Curves",
		path = "folders/Animation Curves.yy"
	};
	if (_APND.Checked) exportedCurve.parent = APNDREF;

	// paths
	string curvePath = "animcurves/" + exportedCurve.name + "/";
	string exportedPath = $"{curvePath}{exportedCurve.name}.yy";
	Directory.CreateDirectory(rootPath + curvePath);

	// channels and points
	foreach (var ch in curve.Channels)
	{
		if (exportedCurve.function != 2)
			exportedCurve.function = (int)ch.Function;

		var outChannel = new GMAnimCurveChannel()
		{
			name = ch.Name.Content,
			colour = 4290799884,
		};
		foreach (var point in ch.Points)
		{
			var outPoint = new CurvePoint()
			{
				x = point.X,
				y = point.Value,
				th0 = point.BezierX0,
				th1 = point.BezierX1,
				tv0 = point.BezierY0,
				tv1 = point.BezierY1
			};
			if (outPoint.th0 != 0 || outPoint.th1 != 0 || outPoint.tv0 != 0 || outPoint.tv1 != 0)
				exportedCurve.function = 2;

			outChannel.points.Add(outPoint);
		}

		exportedCurve.channels.Add(outChannel);
	}

	// finish
	doJson(exportedCurve, curvePath + $"{exportedCurve.name}.yy");
	AddResource(new IdReference
	{
		name = exportedCurve.name,
		path = exportedPath
	});
	UpdateProgress();
}

/*
void DumpTemplate(UndertaleObject a)
{
	var exportedA = new GMA
	{
		name = a.Name.Content,
	};

	// tags
	var tagid = UndertaleTags.GetAssetTagID(Data, a);
	if (Data.Tags != null && Data.Tags.AssetTags.ContainsKey(tagid))
	{
		foreach (var tag in Data.Tags.AssetTags[tagid])
			exportedA.tags.Add(tag.Content);
	}
	
	// folder
	exportedA.parent = new IdReference
	{
		name = "A",
		path = "folders/A.yy"
	};
	if (_APND.Checked) exportedA.parent = APNDREF;
	
	// paths
	string aPath = "a/" + exportedA.name + "/";
	string exportedPath = $"a/{exportedA.name}/{exportedA.name}.yy";
	Directory.CreateDirectory(rootPath + aPath);
	
	// finish
	doJson(exportedA, aPath + $"{exportedA.name}.yy");
	AddResource(new IdReference
	{
		name = exportedA.name,
		path = exportedPath
	});
	UpdateProgress();
}
*/

async Task DumpSprites()
{
	for (var i = 0; i < Data.Sprites.Count; i++)
	{
		var dumpy = Data.Sprites[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpSprite(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpObjects()
{
	for (var i = 0; i < Data.GameObjects.Count; i++)
	{
		var dumpy = Data.GameObjects[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpObject(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpRooms()
{
	for (var i = 0; i < Data.Rooms.Count; i++)
	{
		var dumpy = Data.Rooms[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpRoom(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpTilesets()
{
	for (var i = 0; i < Data.Backgrounds.Count; i++)
	{
		var dumpy = Data.Backgrounds[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpTileset(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpScripts()
{
	for (var i = 0; i < Data.Scripts.Count; i++)
	{
		var dumpy = Data.Scripts[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpScript(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}

	// extra script
	if (CSTM.Count == 0)
	{
		string code = "";
		var globalinit = new GMScript
		{
			name = "hqdecomp_globalinit",
			parent = new IdReference
			{
				name = "Scripts",
				path = "folders/Scripts.yy"
			}
		};
		if (_APND.Checked) globalinit.parent = APNDREF;

		while (Data.Scripts.Any(i => i.Name != null && i.Name.Content == globalinit.name))
			globalinit.name = $"_{globalinit.name}";

		// global init code
		if (Data.GlobalInitScripts.Count > 0)
		{
			foreach (var i in Data.GlobalInitScripts)
			{
				if (i.Code != null && Regex.IsMatch(i.Code.Name.Content, @"gml_GlobalScript_(\d+)"))
				{
					try { code += decompileCode(i.Code); }
					catch (Exception e)
					{
						if (!skipErrors)
							ScriptError("The global script " + i.Code.Name.Content + " failed to decompile!\n\n" + e.ToString());
						else
							errorList.Add($"{i.Code.Name.Content} - {e.Message}");
						code += "/* (decompilation failed.) */\n";
					}
				}
			}
			if (code != "")
				code += "\n";
		}

		// GMS1 compatibility scripts
		if (!Data.IsGameMaker2())
		{
			// object depths
			string objectDepths = "";
			string objectNames = "";

			for (var i = 0; i < Data.GameObjects.Count; i++)
			{
				objectDepths += $"\tglobal.__objectDepths[{i}] = {Data.GameObjects[i].Depth}; // {Data.GameObjects[i].Name.Content}\n";
				objectNames += $"\tglobal.__objectNames[{i}] = \"{Data.GameObjects[i].Name.Content}\";\n";
			}

			code += $"/// GMS1 Compatibility Scripts\n{GMS1Compatibility.Replace("\t//${compatibilityObjectDepths}", $"{objectDepths}\n\n{objectNames}")}";
		}

		// save it
		if (code != "")
		{
			// paths
			string scriptPath = "scripts/" + globalinit.name + "/";
			string exportedPath = $"scripts/{globalinit.name}/{globalinit.name}.yy";
			Directory.CreateDirectory(rootPath + scriptPath);

			// finish
			File.WriteAllText(rootPath + scriptPath + globalinit.name + ".gml", code);

			doJson(globalinit, scriptPath + $"{globalinit.name}.yy");
			AddResource(new IdReference
			{
				name = globalinit.name,
				path = exportedPath
			});
		}
	}
}
async Task DumpSounds()
{
	for (var i = 0; i < Data.Sounds.Count; i++)
	{
		var dumpy = Data.Sounds[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpSound(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpShaders()
{
	for (var i = 0; i < Data.Shaders.Count; i++)
	{
		var dumpy = Data.Shaders[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpShader(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpFonts()
{
	for (var i = 0; i < Data.Fonts.Count; i++)
	{
		var dumpy = Data.Fonts[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpFont(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpPaths()
{
	for (var i = 0; i < Data.Paths.Count; i++)
	{
		var dumpy = Data.Paths[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpPath(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpTimelines()
{
	for (var i = 0; i < Data.Timelines.Count; i++)
	{
		var dumpy = Data.Timelines[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpTimeline(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpSequences()
{
	for (var i = 0; i < Data.Sequences.Count; i++)
	{
		var dumpy = Data.Sequences[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpSequence(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpExtensions()
{
	for (var i = 0; i < Data.Extensions.Count; i++)
	{
		var dumpy = Data.Extensions[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpExtension(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}
async Task DumpCurves()
{
	for (var i = 0; i < Data.AnimationCurves.Count; i++)
	{
		var dumpy = Data.AnimationCurves[i];
		if (!ignore.Contains(dumpy.Name.Content) && (!(CSTM.Count > 0 && !CSTM.Contains(dumpy.Name.Content))))
		{
			DumpCurve(dumpy);
			await Task.Delay(1);
		}
		else UpdateProgress();
	}
}

#endregion
#region GMS1 Decompiler

static class GMS1
{
	public const string header = "<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->";

}

#endregion

#region Decompiler Functions

static string regexReplacer(this string s, int index, int length, string replacement)
{
	// https://codereview.stackexchange.com/questions/119519/regex-to-first-match-then-replace-found-matches
	var builder = new StringBuilder();
	builder.Append(s.Substring(0, index));
	builder.Append(replacement);
	builder.Append(s.Substring(index + length));
	return builder.ToString();
}

// code decompiler, and turn any asset indices into equivalent asset names
ThreadLocal<GlobalDecompileContext> DECOMPILE_CONTEXT = new ThreadLocal<GlobalDecompileContext>(() => new GlobalDecompileContext(Data, false));
string decompileCode(UndertaleCode codeId)
{
	if (codeId == null)
		return "";
	if (ignore.Contains(codeId.Name.Content))
		return "";
	if (File.Exists($"{dataPath}code/{codeId.Name.Content}.gml"))
		return File.ReadAllText($"{dataPath}code/{codeId.Name.Content}.gml");
	
	string code = Decompiler.Decompile(codeId, DECOMPILE_CONTEXT.Value);
	var tempReplaces = new Dictionary<string, string>();

	// regex functions
	void quickRegex(Regex rx)
	{
		foreach (Match match in rx.Matches(code).Cast<Match>().Reverse())
		{
			var digits = match.Groups[1];
			code = code.regexReplacer(digits.Index, digits.Length, match.Groups[2].Value);
		}
	}
	void assetRegex<T>(Regex rx, IList<T> dataList)
	{
		foreach (Match match in rx.Matches(code).Cast<Match>().Reverse())
		{
			var digits = match.Groups[1];
			if (int.TryParse(digits.Value, out int digit) && digit < dataList.Count)
				code = code.regexReplacer(digits.Index, digits.Length, ((UndertaleNamedResource)dataList[digit]).Name.Content);
		}
	}

	// replace targetRooms
	/*
	assetRegex<UndertaleRoom>(new Regex(@"targetRoom =+ (\d+)", RegexOptions.IgnoreCase), Data.Rooms);

	// replace contents in pizza boxes and baddie spawners
	assetRegex<UndertaleGameObject>(new Regex(@"content =+ (\d+)", RegexOptions.IgnoreCase), Data.GameObjects);

	// replace sprite indices
	assetRegex<UndertaleSprite>(new Regex(@"spr(?:ite)?(?:_[^\s]+)? =+ (\d+)", RegexOptions.IgnoreCase), Data.Sprites);
	*/

	// sprite_index = choose() conundrum
	foreach (Match match in new Regex(@"sprite_index = choose\(([\d ,]+)\)", RegexOptions.IgnoreCase).Matches(code).Cast<Match>().Reverse())
	{
		var digits = match.Groups[1];
		var digits_final = digits.Value;

		string[] subs = digits_final.Split(", ");
		foreach (var sub in subs)
		{
			if (int.TryParse(sub, out int digit))
				digits_final = digits_final.Replace(sub, Data.Sprites[digit].Name.Content);
		}

		code = code.regexReplacer(digits.Index, digits.Length, digits_final);
	}

	// scr_soundeffect(1, 2, etc) conundrum
	/*
	foreach (Match match in new Regex(@"(?:scr_sound|scr_soundeffect|scr_music)\(([\d ,]+)\)", RegexOptions.IgnoreCase).Matches(code).Cast<Match>().Reverse())
	{
		var digits = match.Groups[1];
		var digits_final = digits.Value;

		string[] subs = digits_final.Split(", ");
		foreach (var sub in subs)
		{
			if (int.TryParse(sub, out int digit))
				digits_final = digits_final.Replace(sub, Data.Sounds[digit].Name.Content);
		}

		code = code.regexReplacer(digits.Index, digits.Length, digits_final);
	}

	// replace sound indices
	assetRegex<UndertaleSound>(new Regex(@"(?:snd|sound)(?:_[^\s]+)? =+ (\d+)", RegexOptions.IgnoreCase), Data.Sounds);
	*/

	// referencing an inst_XXXXXX
	if (Data.IsGameMaker2())
	{
		foreach (Match match in new Regex(@"(\d+)\.[^0-9].*").Matches(code).Cast<Match>().Reverse())
		{
			var digits = match.Groups[1];
			if (int.TryParse(digits.Value, out int digit) && digit > 100000)
			{
				code = code.regexReplacer(digits.Index, digits.Length, instName((int)digit));
				tempReplaces.Add(digit.ToString(), instName((int)digit));
			}
		}
	}

	// temp replaces
	foreach (var i in tempReplaces)
		code = code.Replace(i.Key, i.Value);

	// attempt to fix utmt 2.3 decompilation issues
	//if (Data.GMS2_3)
	//{
	//	quickRegex(new Regex(@"((.+\.)\2)"));
		//quickRegex(new Regex(@"[^ ]*(gml_Script_(.+\((?:.*)\)))"));
	//	code = code.Replace("gml_Script_", "");
	//	quickRegex(new Regex(@"function.*?(?=(\n    return;)())", RegexOptions.Singleline));
	//}
	return code;
}

// generate a random "inst_XXXXXXXX" with the instance id.
string instName(int id)
{
	const string hex = "0123456789ABCDEF";
	var r = new Random(id);
	return "inst_" + new string(Enumerable.Range(1, 8).Select(_ => hex[r.Next(hex.Length)]).ToArray());
}

// progress bar
void SetupProgress(string status, double progress, double max)
{
	SetProgressBar(null, status, progress, max);
}
void UpdateProgress(string status = "")
{
	IncrementProgressParallel();
	if (status != "")
		UpdateProgressStatus(status);
}

// extract icon from file
Icon getIcon(string filePath)
{
	Icon result;
	try
	{
		result = Icon.ExtractAssociatedIcon(filePath);
	}
	catch
	{
		result = (Icon)null;
	}
	return result;
}

// make a json out of an object
void doJson(object obj, string path = "")
{
	// prepare json writer
	var settings = new JsonSerializerSettings
	{
		Formatting = Newtonsoft.Json.Formatting.Indented,
		ObjectCreationHandling = ObjectCreationHandling.Replace,
		ConstructorHandling = ConstructorHandling.AllowNonPublicDefaultConstructor
	};

	// turn the class into a json and export it
	string jsonString = JsonConvert.SerializeObject(obj, settings);
	File.WriteAllText(rootPath + path, jsonString);
}

// simply serialize without saving
string debugJson(object obj)
{
	return JsonConvert.SerializeObject(obj, new JsonSerializerSettings { Formatting = Newtonsoft.Json.Formatting.Indented });
}

// add folders to data file
void addFolder(string n, string p, int o)
{
	foreach (var f in exportData.Folders)
	{
		if (f.name == n)
			return; // folder already exists
	}

	exportData.Folders.Add(new GMProject.GMFolder
	{
		name = n,
		folderPath = $"folders/{p}.yy",
		order = o
	});
}
void addFolder(string n)
{
	addFolder(n, n, exportData.Folders.Count + 1);
}

#endregion
#region Startup Form

// I am so sorry for this
bool DUMP, isGMS1, OPTN, OBJT, ROOM, EXTN, SCPT, TMLN, SOND, SHDR, PATH, ACRV, SEQN, FONT, SPRT, BGND;
List<string> CSTM = new List<string>();

var tooltip = new ToolTip();
Form FORM = new Form()
{
	AutoSize = true,
	Text = "Decompiler",
	MaximizeBox = false,
	MinimizeBox = false,
	StartPosition = FormStartPosition.CenterScreen,
	FormBorderStyle = FormBorderStyle.FixedDialog,
};
FORM.Controls.Add(new Label()
{
	Text = "Warning: Decompiling with UTMT is an unreliable process.\nSometimes specific code snippets enter an infinite loop of decompilation and freeze the script until you kill the task.\nAnd since you're decompiling a lot of code at once, it has way more chances of happening, so proceed at your own risk.",
	AutoSize = true,
	Location = new System.Drawing.Point(8, 8),
});
FORM.Controls.Add(new Label()
{
	Text = "Select which resources you want to dump:",
	AutoSize = true,
	Location = new System.Drawing.Point(8, 72),
	Font = new Font(Label.DefaultFont, FontStyle.Bold)
});

var _OPTN = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 0), 100 + (32 * 0)),
	Text = "Options",
	Checked = true
};
FORM.Controls.Add(_OPTN);

var _OBJT = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 1), 100 + (32 * 0)),
	Text = "Objects",
	Checked = true
};
FORM.Controls.Add(_OBJT);

var _ROOM = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 2), 100 + (32 * 0)),
	Text = "Rooms",
	Checked = true
};
FORM.Controls.Add(_ROOM);

var _EXTN = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 3), 100 + (32 * 0)),
	Text = "Extensions",
	Checked = true
};
FORM.Controls.Add(_EXTN);

var _SCPT = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 4), 100 + (32 * 0)),
	Text = "Scripts",
	Checked = true
};
FORM.Controls.Add(_SCPT);

var _TMLN = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 5), 100 + (32 * 0)),
	Text = "Timelines",
	Checked = true
};
FORM.Controls.Add(_TMLN);

var _SOND = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 0), 100 + (32 * 1)),
	Text = "Sounds",
	Checked = true
};
FORM.Controls.Add(_SOND);

var _SHDR = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 1), 100 + (32 * 1)),
	Text = "Shaders",
	Checked = true
};
FORM.Controls.Add(_SHDR);

var _PATH = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 2), 100 + (32 * 1)),
	Text = "Paths",
	Checked = true
};
FORM.Controls.Add(_PATH);

var _ACRV = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 3), 100 + (32 * 1)),
	Text = "Anim. Curves",
	Checked = true,
};
if (Data.AnimationCurves == null)
{
	_ACRV.Enabled = false;
	_ACRV.Checked = false;
	_ACRV.Text = "ACRV (2.3+)";
}
FORM.Controls.Add(_ACRV);

var _SEQN = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 4), 100 + (32 * 1)),
	Text = "Sequences",
	Checked = true,
};
if (Data.Sequences == null)
{
	_SEQN.Enabled = false;
	_SEQN.Checked = false;
	_SEQN.Text = "SEQN (2.3+)";
}
FORM.Controls.Add(_SEQN);

var _FONT = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 5), 100 + (32 * 1)),
	Text = "Fonts",
	Checked = true
};
FORM.Controls.Add(_FONT);

var _SPRT = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 0), 100 + (32 * 2)),
	Text = "Sprites",
	Checked = true
};
FORM.Controls.Add(_SPRT);

var _BGND = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 1), 100 + (32 * 2)),
	Text = (Data.IsGameMaker2() ? "Backgrounds" : "Tilesets"),
	Checked = true
};
FORM.Controls.Add(_BGND);

var _PJCT = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 2), 100 + (32 * 2)),
	Text = "Project File",
	Checked = true
};
FORM.Controls.Add(_PJCT);

// custom
var _CSTM = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 1), 228 + (24 * 0)),
	Text = "Pick Assets",
	AutoSize = true
};
_CSTM.CheckedChanged += (o, e) =>
{
	if (_CSTM.Checked)
	{
		_OBJT.Enabled = _ROOM.Enabled = _EXTN.Enabled = _SCPT.Enabled = _TMLN.Enabled = _SOND.Enabled = _SHDR.Enabled = _PATH.Enabled = _ACRV.Enabled = _SEQN.Enabled = _FONT.Enabled = _SPRT.Enabled = _BGND.Enabled = false;
		_OBJT.Checked = _ROOM.Checked = _EXTN.Checked = _SCPT.Checked = _TMLN.Checked = _SOND.Checked = _SHDR.Checked = _PATH.Checked = _ACRV.Checked = _SEQN.Checked = _FONT.Checked = _SPRT.Checked = _BGND.Checked = false;
		_CMBT.Enabled = true;
	}
	else
	{
		_OBJT.Enabled = _ROOM.Enabled = _EXTN.Enabled = _SCPT.Enabled = _TMLN.Enabled = _SOND.Enabled = _SHDR.Enabled = _PATH.Enabled = _ACRV.Enabled = _SEQN.Enabled = _FONT.Enabled = _SPRT.Enabled = _BGND.Enabled = true;
		_CMBT.Enabled = false;

		if (Data.Sequences == null)
			_SEQN.Enabled = false;
		if (Data.AnimationCurves == null)
			_ACRV.Enabled = false;
	}
};
FORM.Controls.Add(_CSTM);
tooltip.SetToolTip(_CSTM, "Individually pick one by one which resources you want to dump.");

// customize button
var _CMBT = new Button()
{
	Location = new System.Drawing.Point(16 + (120 * 1) + 92, 228 + (24 * 0) - 4),
	Text = "Change...",
	AutoSize = true,
	Enabled = false
};
_CMBT.Click += (o, e) =>
{
	// make custom form
	FORM.Enabled = false;

	var form2 = new Form()
	{
		AutoSize = true,
		Text = "Asset Picker",
		MaximizeBox = false,
		MinimizeBox = false,
		StartPosition = FormStartPosition.CenterScreen,
		FormBorderStyle = FormBorderStyle.FixedDialog,
		ControlBox = false
	};

	// tree view
	var treeView = new TreeView()
	{
		Location = new System.Drawing.Point(4, 24 + 4 + 4),
		Height = 400,
		Width = 200,
	};

	treeView.BeginUpdate();
	treeView.Nodes.Add("Data").Expand();
	treeView.Nodes[0].Nodes.Add("Sounds");
	treeView.Nodes[0].Nodes.Add("Sprites");
	treeView.Nodes[0].Nodes.Add(Data.IsGameMaker2() ? "Tilesets" : "Backgrounds");
	treeView.Nodes[0].Nodes.Add("Paths");
	treeView.Nodes[0].Nodes.Add("Scripts");
	treeView.Nodes[0].Nodes.Add("Shaders");
	treeView.Nodes[0].Nodes.Add("Fonts");
	treeView.Nodes[0].Nodes.Add("Timelines");
	treeView.Nodes[0].Nodes.Add("Game objects");
	treeView.Nodes[0].Nodes.Add("Rooms");
	treeView.Nodes[0].Nodes.Add("Extensions");

	if (Data.Sequences != null)
		treeView.Nodes[0].Nodes.Add("Sequences");
	if (Data.AnimationCurves != null)
		treeView.Nodes[0].Nodes.Add("Curves");

	UpdateTree(treeView, Data, "");
	treeView.EndUpdate();

	// search bar
	var searchbar = new TextBox()
	{
		Location = new System.Drawing.Point(4, 4),
		Width = 200,
	};
	searchbar.TextChanged += (o, s) =>
	{
		treeView.BeginUpdate();
		UpdateTree(treeView, Data, searchbar.Text);
		treeView.EndUpdate();
	};

	// list box
	var listbox = new ListBox()
	{
		Location = new System.Drawing.Point(300, 24 + 4 + 4),
		Height = 400,
		Width = 200,
		HorizontalScrollbar = true
	};
	UpdateList(listbox, "");

	// search bar 2
	var searchbar2 = new TextBox()
	{
		Location = new System.Drawing.Point(300, 4),
		Width = 200,
	};
	searchbar2.TextChanged += (o, s) =>
	{
		listbox.BeginUpdate();
		UpdateList(listbox, searchbar2.Text);
		listbox.EndUpdate();
	};

	// double click left side
	treeView.NodeMouseDoubleClick += (s, e) =>
	{
		if (!CSTM.Contains(e.Node.Text) && e.Node.Level == 2)
			CSTM.Add(e.Node.Text);
		UpdateList(listbox, searchbar2.Text);
	};
	listbox.DoubleClick += (s, e) =>
	{
		CSTM.RemoveAll(r => r == listbox.SelectedItem);
		UpdateList(listbox, searchbar2.Text);
	};

	// ok
	var OKBT = new Button()
	{
		Location = new System.Drawing.Point(215, 180),
		Text = "OK",
		Height = 32
	};
	OKBT.Click += (o, s) =>
	{
		FORM.Enabled = true;
		form2.Close();
	};
	form2.Controls.Add(OKBT);

	// >
	var ADBT = new Button()
	{
		Location = new System.Drawing.Point(215, 140),
		Text = "->",
		Height = 32
	};
	ADBT.Click += (o, s) =>
	{
		if (!CSTM.Contains(treeView.SelectedNode.Text))
			CSTM.Add(treeView.SelectedNode.Text);
		UpdateList(listbox, searchbar2.Text);
	};
	form2.Controls.Add(ADBT);

	// <
	var RMBT = new Button()
	{
		Location = new System.Drawing.Point(215, 220),
		Text = "<-",
		Height = 32
	};
	RMBT.Click += (o, s) =>
	{
		CSTM.RemoveAll(r => r == listbox.SelectedItem);
		UpdateList(listbox, searchbar2.Text);
	};
	form2.Controls.Add(RMBT);

	// add them
	form2.Controls.Add(treeView);
	form2.Controls.Add(searchbar);
	form2.Controls.Add(listbox);
	form2.Controls.Add(searchbar2);

	void UpdateList(ListBox list, string search)
	{
		list.Items.Clear();
		foreach (var i in CSTM)
		{
			if (i.Contains(search))
				list.Items.Add(i);
		}
	}
	void UpdateTree(TreeView tree, UndertaleData data, string search)
	{
		foreach (TreeNode i in tree.Nodes[0].Nodes)
			i.Nodes.Clear();

		// sounds
		foreach (var i in data.Sounds)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[0].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// sprites
		foreach (var i in data.Sprites)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[1].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// backgrounds
		foreach (var i in data.Backgrounds)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[2].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// paths
		foreach (var i in data.Paths)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[3].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// scripts
		foreach (var i in data.Scripts)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[4].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// shaders
		foreach (var i in data.Shaders)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[5].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// fonts
		foreach (var i in data.Fonts)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[6].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// timelines
		foreach (var i in data.Timelines)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[7].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// objects
		foreach (var i in data.GameObjects)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[8].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// rooms
		foreach (var i in data.Rooms)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[9].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// extensions
		foreach (var i in data.Extensions)
		{
			if (i.Name.Content.Contains(search))
				tree.Nodes[0].Nodes[10].Nodes.Add(new TreeNode(i.Name.Content));
		}

		// sequences
		if (data.Sequences != null)
		{
			foreach (var i in data.Sequences)
			{
				if (i.Name.Content.Contains(search))
					tree.Nodes[0].Nodes[11].Nodes.Add(new TreeNode(i.Name.Content));
			}
		}

		// animation curves
		if (data.AnimationCurves != null)
		{
			foreach (var i in data.AnimationCurves)
			{
				if (i.Name.Content.Contains(search))
					tree.Nodes[0].Nodes[12].Nodes.Add(new TreeNode(i.Name.Content));
			}
		}
	}
	form2.ShowDialog();
};
FORM.Controls.Add(_CMBT);

// settings
FORM.Controls.Add(new Label()
{
	Text = "Decompiler settings",
	AutoSize = true,
	Location = new System.Drawing.Point(8, 200),
	Font = new Font(Label.DefaultFont, FontStyle.Bold)
});

var _EROR = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 0), 228 + (24 * 0)),
	Text = "Show Errors",
	Checked = false
};
FORM.Controls.Add(_EROR);
tooltip.SetToolTip(_EROR, "If unchecked, all errors will be logged in a text file.");

var _APND = new CheckBox()
{
	Location = new System.Drawing.Point(16 + (120 * 0), 228 + (24 * 1)),
	Text = "Append To Project",
	Checked = false,
	AutoSize = true
};
_APND.CheckedChanged += (o, s) =>
{
	if (_APND.Checked)
	{
		_OPTN.Enabled = _OPTN.Checked = false;
		_PJCT.Enabled = _PJCT.Checked = false;
	}
	else
	{
		_OPTN.Enabled = true;
		_PJCT.Enabled = true;
	}
};
FORM.Controls.Add(_APND);
tooltip.SetToolTip(_APND, "Adds the decompiled resources to an existing project file.");

// if appended use this folder
var APNDREF = new IdReference
{
	name = "Decompiled",
	path = "folders/Decompiled.yy"
};

// ok button
var OKBT = new Button()
{
	Text = (Directory.Exists($"{rootPath}") ? "Overwrite Dump" : "Start Dump"),
	Dock = DockStyle.Bottom,
	Height = 48,
};
OKBT.Click += (o, s) =>
{
	FORM.Enabled = false;

	// warnings
	if (Data.IsYYC() && (_SCPT.Checked || _OBJT.Checked || _TMLN.Checked))
	{
		if (!ScriptQuestion("This game is YYC compiled, tl;dr the game's code is unavailable, so you're not getting anything playable out of this. The most use you'd get out of it is maybe checking out the rooms in a more comfy editor.\n\nAre you SURE that you want to continue?"))
		{
			FORM.Close();
			return;
		}
	}
	else if (!isGMS1 && !Data.IsGameMaker2() && (_SCPT.Checked || _OBJT.Checked || _ROOM.Checked))
	{
		if (!ScriptQuestion("This game is made in GMS1, and you're decompiling to a GMS2 project. The format differences are huge so a LOT of stuff is bound to break.\n\nAre you SURE that you want to continue?"))
		{
			FORM.Close();
			return;
		}
	}
	else if (isGMS1 && Data.IsGameMaker2())
	{
		if (!ScriptQuestion("This game is made in GMS2, and you're decompiling to a GMS1 project. The format differences are huge so a LOT of stuff is bound to break.\n\nAre you SURE that you want to continue?"))
		{
			FORM.Close();
			return;
		}
	}
	/*
	if (Data.TexturePageItems.Count >= 5000 && _SPRT.Checked)
	{
		if (!ScriptQuestion($"This game seems to have a LOT of texture page items ({Data.TexturePageItems.Count} to be exact,) and these are the thing that takes the longest to export.\n\nAre you SURE that you want to continue?"))
		{
			FORM.Close();
			return;
		}
	}
	*/

	// clear custom assets if unchecked
	if (!_CSTM.Checked)
		CSTM.Clear();

	// append to project
	if (_APND.Checked)
	{
		//ScriptMessage("You selected the \"Append to Project\" option, which will decompile the assets to an already existing project file.\n\nSelect the project file you want to decompile to, and the dump will start.");
		using (var openFileDialog = new OpenFileDialog())
		{
			openFileDialog.Filter = "GameMaker Project (*.yyp)|*.yyp";
			openFileDialog.RestoreDirectory = true;

			if (openFileDialog.ShowDialog() == DialogResult.OK)
			{
				rootPath = Path.GetDirectoryName(openFileDialog.FileName) + "\\";
				
				var fileStream = openFileDialog.OpenFile();
				try
				{
					using (StreamReader reader = new StreamReader(fileStream))
						exportData = (GMProject)JsonConvert.DeserializeObject(reader.ReadToEnd(), typeof(GMProject));
				}
				catch (Exception e)
				{
					// invalid file
					ScriptMessage("The project file has failed to load.\nOnly projects of version 1.6 are supported.");
					FORM.Enabled = true;
					return;
				}

				// invalid version
				if (exportData.resourceVersion != "1.6")
				{
					if (!ScriptQuestion($"The project version should be 1.6, but this one's seems to be {exportData.resourceVersion}.\nIt loaded properly, but it *could* corrupt the project.\n\nAre you SURE that you want to continue?"))
					{
						FORM.Enabled = true;
						return;
					}
				}
			}
			else
			{
				FORM.Enabled = true;
				return;
			}
		}
	}

	// I'm not happy
	FORM.Close();
	DUMP = true;

	OPTN = _OPTN.Checked;
	OBJT = _OBJT.Checked;
	ROOM = _ROOM.Checked;
	EXTN = _EXTN.Checked;
	SCPT = _SCPT.Checked;
	TMLN = _TMLN.Checked;
	SOND = _SOND.Checked;
	SHDR = _SHDR.Checked;
	PATH = _PATH.Checked;
	ACRV = _ACRV.Checked;
	SEQN = _SEQN.Checked;
	FONT = _FONT.Checked;
	SPRT = _SPRT.Checked;
	BGND = _BGND.Checked;

	skipErrors = (!_EROR.Checked);
};
FORM.Controls.Add(OKBT);

FORM.Height += 64;
FORM.AcceptButton = OKBT;
Application.EnableVisualStyles();
FORM.ShowDialog();

if (!DUMP)
	return;

#endregion

// prepare project file
Directory.CreateDirectory(rootPath);
if (exportData == null)
{
	exportData = new GMProject
	{
		name = Data.GeneralInfo.Name.Content,
		isEcma = (Data.GeneralInfo.Info.HasFlag(UndertaleGeneralInfo.InfoFlags.JavaScriptMode))
	};
	exportData.MetaData.Add("IDEVersion", "2022.9.0.0");

	// add default folders
	addFolder("Sprites");
	addFolder("Tile Sets");
	addFolder("Sounds");
	addFolder("Paths");
	addFolder("Scripts");
	addFolder("Shaders");
	addFolder("Fonts");
	addFolder("Timelines");
	addFolder("Objects");
	addFolder("Rooms");
	addFolder("Sequences");
	addFolder("Animation Curves");
	addFolder("Notes");
	addFolder("Extensions");

	// groups
	if (SPRT && Data.TextureGroupInfo != null)
	{
		foreach (var i in Data.TextureGroupInfo)
		{
			var tg = new GMTextureGroup { name = i.Name.Content };

			// detect compression format (pre 2022.9)
			/*
			if (Data.UseBZipFormat)
				tg.compressFormat = "bz2";
			else if (Data.UseQoiFormat)
				tg.compressFormat = "qoi";
			else
				tg.compressFormat = "png";
			*/

			// detect 2022.9 external textures
			if ((int)i.LoadType != 0)
			{
				tg.loadType = "dynamicpages";
				tg.directory = i.Directory.Content;
			}

			// align to texture pages for future use
			foreach (var j in i.TexturePages)
			{
				tpageAlign.Add(j.Resource.Name.Content, tg.name);

				// extra settings
				tg.mipsToGenerate = (int)j.Resource.GeneratedMips;
				if (j.Resource.Scaled == 0)
					tg.isScaled = false;

				// detect compression format
				if (j.Resource.TextureData.FormatBZ2)
					tg.compressFormat = "bz2";
				else if (j.Resource.TextureData.FormatQOI)
					tg.compressFormat = "qoi";
				else
					tg.compressFormat = "png";
			}
			foreach (var j in i.Sprites)
				tpageAlign.Add(j.Resource.Name.Content, tg.name);
			foreach (var j in i.Fonts)
				tpageAlign.Add(j.Resource.Name.Content, tg.name);
			foreach (var j in i.Tilesets)
				tpageAlign.Add(j.Resource.Name.Content, tg.name);

			// DON'T add if it's a separate texture page
			if (!(i.Name.Content.StartsWith("__YY__") && i.Name.Content.Contains("_YYG_AUTO_GEN_TEX_GROUP_NAME_")))
				exportData.TextureGroups.Add(tg);
		}
	}
	else
		exportData.TextureGroups.Add(new GMTextureGroup());

	if (SOND && Data.AudioGroups != null)
	{
		foreach (var i in Data.AudioGroups)
			exportData.AudioGroups.Add(new GMAudioGroup { name = i.Name.Content });
	}
	else
		exportData.AudioGroups.Add(new GMAudioGroup());
}
else
{
	// add default folders
	if (!exportData.Folders.Any(i => i.name == "Decompiled"))
		addFolder("Decompiled");

	// audio groups
	if (SOND && Data.AudioGroups != null)
	{
		foreach (var i in Data.AudioGroups)
		{
			if (!exportData.AudioGroups.Any(x => x.name == i.Name.Content))
				exportData.AudioGroups.Add(new GMAudioGroup { name = i.Name.Content });
		}
	}
}

// resource dumps
StartProgressBarUpdater(); // progress bar
if (OPTN)
	DumpOptions();

if (OBJT || CSTM.Count > 0)
{
	SetupProgress("Objects", 0, Data.GameObjects.Count);
	await DumpObjects();
}

if (ROOM || CSTM.Count > 0)
{
	SetupProgress("Rooms", 0, Data.Rooms.Count);
	await DumpRooms();

	// room order
	for (var i = 0; i < Data.GeneralInfo.RoomOrder.Count; i++)
	{
		var r = Data.GeneralInfo.RoomOrder[i].Resource;
		var rname = r.Name.Content;

		if (ignore.Contains(rname) || (CSTM.Count > 0 && !CSTM.Contains(rname)))
			continue;

		var ron = new GMProject.GMRoomOrderNode
		{
			roomId = new IdReference
			{
				name = rname,
				path = $"rooms/{rname}/{rname}.yy"
			}
		};
		exportData.RoomOrderNodes.Add(ron);
	}
}

if (EXTN || CSTM.Count > 0)
{
	SetupProgress("Extensions", 0, Data.Extensions.Count);
	await DumpExtensions();
}

if (SCPT || CSTM.Count > 0)
{
	SetupProgress("Scripts", 0, Data.Scripts.Count);
	await DumpScripts();
}

if (TMLN || CSTM.Count > 0)
{
	SetupProgress("Timelines", 0, Data.Timelines.Count);
	await DumpTimelines();
}

if (SOND || CSTM.Count > 0)
{
	SetupProgress("Sounds", 0, Data.Sounds.Count);
	await DumpSounds();
}

if (SHDR || CSTM.Count > 0)
{
	SetupProgress("Shaders", 0, Data.Shaders.Count);
	await DumpShaders();
}

if (PATH || CSTM.Count > 0)
{
	SetupProgress("Paths", 0, Data.Paths.Count);
	await DumpPaths();
}

if ((ACRV || CSTM.Count > 0) && Data.AnimationCurves != null)
{
	SetupProgress("Animation Curves", 0, Data.AnimationCurves.Count);
	await DumpCurves();
}

if ((SEQN || CSTM.Count > 0) && Data.Sequences != null)
{
	SetupProgress("Sequences", 0, Data.Sequences.Count);
	await DumpSequences();
}

if (FONT || CSTM.Count > 0)
{
	SetupProgress("Fonts", 0, Data.Fonts.Count);
	await DumpFonts();
}

if (SPRT || CSTM.Count > 0)
{
	SetupProgress("Sprites", 0, Data.Sprites.Count);
	await DumpSprites();
}

if (BGND || CSTM.Count > 0)
{
	SetupProgress((Data.IsGameMaker2() ? "TileSets" : "Backgrounds"), 0, Data.Backgrounds.Count);
	await DumpTilesets();
}

if (_PJCT.Checked && SCPT)
{
	// add warning note
	var note = new GMNotes()
	{
		name = "readme",
		parent = new IdReference()
		{
			name = "Notes",
			path = "folders/Notes.yy"
		}
	};
	string notePath = $"notes/{note.name}/";
	Directory.CreateDirectory(rootPath + notePath);

	var str = @"As a warning, neither this decompiler nor even UTMT can be perfect.
There's likely gonna be some stuff you're gonna have to fix on your own.
Most notably asset indices. GameMaker stores assets referenced in the code as just numbers,
and the decompiler would have to GUESS which variables are for assets and which aren't.
";
	//if (Data.GMS2_3)
		//str += "\nAlso since this game is made in GM2.3+ some of the code probably failed to decompile.\nI can't do anything about this, it's UTMT's fault. Just fix it yourself.\n";

	//File.WriteAllText(rootPath + $"{notePath}{note.name}.txt", str);
	//doJson(note, $"{notePath}/{note.name}.yy");
	//AddResource(new IdReference
	//{
	//	name = note.name,
	//	path = $"{notePath}{note.name}.yy"
	//});
}

// export final yyp
if (_PJCT.Checked || _APND.Checked)
	doJson(exportData, $"{exportData.name}.yyp");

// cleanup
await StopUpdater();
worker.Cleanup();
HideProgressBar();

// done
if (errorList.Count > 0)
{
	File.WriteAllLinesAsync(dataPath + "error_log.txt", errorList);
	ScriptMessage($"Done with {errorList.Count} errors.\n{rootPath}\n\nA text file can be found in the data folder with logged exception messages for each error.");
}
else
	ScriptMessage("Done!" + (_PJCT.Checked ? " Remember to copy any necessary files into the \"datafiles\" folder." : ""));

if (!_APND.Checked)
	Process.Start("explorer.exe", rootPath); // pray that this works
